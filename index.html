<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkGold - –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∑–∞—Ä–∞–±–æ—Ç–∫–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>


           <style>
            
.admin-task-item {
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 12px;
    transition: all 0.3s ease;
}

.admin-task-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.admin-task-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 8px;
}

.admin-task-title {
    flex: 1;
    font-weight: 600;
    font-size: 16px;
}

.admin-task-actions {
    display: flex;
    gap: 8px;
}

.admin-task-delete {
    background: var(--error);
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
}

.admin-task-description {
    color: var(--text-secondary);
    font-size: 14px;
}

.copy-btn {
    background: var(--accent);
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
    transition: background 0.3s ease;
}

.copy-btn:hover {
    background: var(--accent-dark);
}

.no-tasks {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-secondary);
}

            /* –°—Ç–∏–ª–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ */
.verification-modal-content {
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
}

.screenshot-error-placeholder {
    background: #f5f5f5;
    border: 2px dashed #ccc;
    border-radius: 10px;
    padding: 40px 20px;
    text-align: center;
    color: #666;
}

.retry-button {
    background: #ff9800;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 10px;
}

.retry-button:hover {
    background: #f57c00;
}

.emergency-approve {
    background: linear-gradient(45deg, #ff6b6b, #ee5a24);
    color: white;
    border: none;
    padding: 12px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    margin-top: 10px;
    width: 100%;
}

.emergency-approve:hover {
    background: linear-gradient(45deg, #ff5252, #e84118);
}
             /* –°—Ç–∏–ª–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ —Å—Å—ã–ª–æ–∫ */
.link-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 10px;
    margin: 10px 0;
}

.link-stat {
    text-align: center;
    padding: 10px;
    background: var(--bg-secondary);
    border-radius: 8px;
}

.link-stat-value {
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 4px;
}

.link-stat-label {
    font-size: 11px;
    color: var(--text-secondary);
}

.copy-btn {
    background: var(--accent);
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.3s ease;
}

.copy-btn:hover {
    background: var(--accent-dark);
    transform: translateY(-1px);
}
            .verification-modal-content {
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
}

.verification-user-info {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
    padding: 15px;
    background: var(--bg-secondary);
    border-radius: 12px;
    border-left: 4px solid var(--accent);
}

.verification-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: var(--purple-gradient);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: 18px;
    flex-shrink: 0;
}

.verification-user-name {
    font-weight: 600;
    font-size: 16px;
    margin-bottom: 4px;
}

.verification-task-title {
    color: var(--text-secondary);
    font-size: 14px;
}

.verification-price {
    font-size: 20px;
    font-weight: 700;
    color: var(--gold);
    margin-left: auto;
}

.verification-screenshot {
    margin: 20px 0;
    text-align: center;
}

.verification-modal-screenshot {
    max-width: 100%;
    max-height: 400px;
    object-fit: contain;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}
            .verification-item {
    transition: all 0.3s ease;
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 12px;
    background: var(--card-bg);
    cursor: pointer;
}

.verification-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    border-color: var(--accent);
}

.verification-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--purple-gradient);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    flex-shrink: 0;
}
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –∞–¥–º–∏–Ω–∫–µ */
        .admin-search-container {
            position: relative;
            margin-bottom: 16px;
        }

        .admin-search-input {
            width: 100%;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 12px 16px 12px 45px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .admin-search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .admin-search-results {
            margin-top: 10px;
            font-size: 12px;
            color: var(--text-secondary);
            text-align: center;
        }

        .admin-search-clear {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 18px;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .admin-search-clear:hover {
            color: var(--error);
        }
            /* üîß –ü–õ–ê–í–ù–ê–Ø –ü–†–û–ö–†–£–¢–ö–ê –î–õ–Ø –í–°–ï–• –≠–õ–ï–ú–ï–ù–¢–û–í */
html {
    scroll-behavior: smooth;
}

/* üîß –§–ò–ö–° –î–õ–Ø –ú–û–ë–ò–õ–¨–ù–û–ô –ü–†–û–ö–†–£–¢–ö–ò */
@media (max-width: 768px) {
    .tab-content,
    .page {
        overflow-anchor: none;
    }
    
    body {
        -webkit-overflow-scrolling: touch;
    }
}

/* üîß –ü–†–ï–î–û–¢–í–†–ê–©–ï–ù–ò–ï –°–ö–ê–ß–ö–û–í –ü–†–ò –ü–ï–†–ï–•–û–î–ê–• */
.tab-content,
.page {
    transform: translateZ(0);
    backface-visibility: hidden;
    perspective: 1000;
}
            /* üîß –ü–õ–ê–í–ù–ê–Ø –ü–†–û–ö–†–£–¢–ö–ê –î–õ–Ø –í–°–ï–• –≠–õ–ï–ú–ï–ù–¢–û–í */


/* üîß –ü–†–ï–î–û–¢–í–†–ê–©–ï–ù–ò–ï –°–ö–ê–ß–ö–û–í –ü–†–ò –ü–ï–†–ï–•–û–î–ê–• */
.tab-content,
.page {
    transform: translateZ(0);
    backface-visibility: hidden;
    perspective: 1000;
}
            /* –û–¢–ö–õ–Æ–ß–ò–¢–ï —Å–ª–æ–∂–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
@media (max-width: 768px) {
    * {
        transition: none !important;
        animation: none !important;
        transform: none !important;
    }
    
    .card, .task-card {
        backdrop-filter: none !important;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
    }
}
            /* –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ –∑–∞–¥–∞–Ω–∏—è */
.task-card {
    position: relative;
    overflow: visible !important;
}

.task-availability {
    position: absolute;
    top: 10px;
    right: 10px;
    background: var(--accent);
    color: white;
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 10px;
    font-weight: 600;
    z-index: 10;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    max-width: 80px;
    text-overflow: ellipsis;
    overflow: hidden;
    white-space: nowrap;
}

.task-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 12px;
    gap: 10px;
    position: relative;
    z-index: 5;
}

.task-title {
    flex: 1;
    min-width: 0;
    margin-right: 30px; /* –û—Å—Ç–∞–≤–ª—è–µ–º –º–µ—Å—Ç–æ –¥–ª—è –±–ª–æ–∫–∞ "–æ—Å—Ç–∞–ª–æ—Å—å" */
}

.task-price {
    font-size: 18px !important;
    font-weight: 800 !important;
    background: var(--gold-gradient) !important;
    -webkit-background-clip: text !important;
    background-clip: text !important;
    color: transparent !important;
    flex-shrink: 0 !important;
    white-space: nowrap !important;
    z-index: 5;
    position: relative;
}

/* –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ - –ø–µ—Ä–µ–º–µ—â–∞–µ–º –±–ª–æ–∫ "–æ—Å—Ç–∞–ª–æ—Å—å" */
.task-card-with-image .task-availability {
    top: 48px; /* –ü–æ–¥ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º */
    right:65px;
    background: rgba(82, 48, 255, 0.7);
    backdrop-filter: blur(10px);
}

/* –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
@media (max-width: 480px) {
    .task-availability {
        top: 8px;
        right: 8px;
        font-size: 9px;
        padding: 3px 6px;
        max-width: 70px;
    }
    
    .task-title {
        margin-right: 50px;
    }
}
            .bottom-nav {
    position: fixed;
    bottom: 10px;
    left: 10px;
    right: 10px;
    background: rgba(25, 25, 50, 0.95);
    border-radius: 16px;
    padding: 6px 8px; /* –£–º–µ–Ω—å—à–∏–ª–∏ padding */
    display: flex;
    justify-content: space-around;
    box-shadow: 0 -6px 25px rgba(0, 0, 0, 0.4);
    border: 1px solid var(--border);
    z-index: 1000;
    backdrop-filter: blur(20px);
    height: 65px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –≤—ã—Å–æ—Ç—É */
}

.nav-item {
    text-align: center;
    cursor: pointer;
    padding: 4px 6px; /* –£–º–µ–Ω—å—à–∏–ª–∏ padding */
    border-radius: 12px;
    flex: 1;
    opacity: 0.7;
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: auto; /* –£–±—Ä–∞–ª–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤—ã—Å–æ—Ç—É */
    border: 1px solid transparent;
    gap: 2px; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ */
}

.nav-icon {
    font-size: 18px;
    margin-bottom: 1px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É */
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
    height: 24px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –∏–∫–æ–Ω–æ–∫ */
}

.nav-icon img {
    width: 40px; /* –£–≤–µ–ª–∏—á–∏–ª —Ä–∞–∑–º–µ—Ä –∫–∞—Ä—Ç–∏–Ω–æ–∫ */
    height: 40px;
    object-fit: contain;
    opacity: 0.7;
    transition: all 0.3s ease;
}

.nav-label {
    font-size: 10px;
    color: var(--text-secondary);
    font-weight: 500;
    line-height: 2; /* –£–º–µ–Ω—å—à–∏–ª–∏ –º–µ–∂—Å—Ç—Ä–æ—á–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª */
}

.nav-item.active {
    background: var(--accent);
    opacity: 1;
    box-shadow: 0 0 16px rgba(99, 102, 241, 0.4);
    transform: translateY(-2px);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.nav-item.active .nav-icon,
.nav-item.active .nav-label {
    color: white;
}

.nav-item.active .nav-icon img {
    opacity: 1;
    filter: none;
}

/* –î–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
@media (max-width: 360px) {
    .bottom-nav {
        height: 60px;
        padding: 4px 6px;
    }
    
    .nav-item {
        padding: 3px 4px;
    }
    
    .nav-icon img {
        width: 35px;
        height: 35px;
    }
    
    .nav-label {
        font-size: 9px ;
    }
}
            /* üîß –§–ò–ö–°–´ –î–õ–Ø –ü–†–ï–î–û–¢–í–†–ê–©–ï–ù–ò–Ø –í–´–•–û–î–ê –ó–ê –ü–†–ï–î–ï–õ–´ –≠–ö–†–ê–ù–ê */
html, body {
    max-width: 100% !important;
    overflow-x: hidden !important;
    position: relative;
    width: 100% !important;
}

.main-content {
    overflow-x: hidden !important;
    width: 100% !important;
    max-width: 100% !important;
}

.container {
    max-width: 100% !important;
    overflow-x: hidden !important;
}

/* üîß –§–ò–ö–° –î–õ–Ø –ö–û–ù–¢–ï–ô–ù–ï–†–û–í –ó–ê–î–ê–ù–ò–ô */
.tasks-grid {
    display: grid !important;
    grid-template-columns: 1fr !important;
    gap: 12px !important;
    width: 100% !important;
    box-sizing: border-box !important;
    margin: 0 !important;
    padding: 0 !important;
    overflow: hidden !important;
}

/* üîß –§–ò–ö–° –î–õ–Ø –ö–ê–†–¢–û–ß–ï–ö –ó–ê–î–ê–ù–ò–ô */
.task-card {
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
    margin: 0 0 12px 0 !important;
    overflow: hidden !important;
}

/* üîß –§–ò–ö–° –î–õ–Ø –ú–û–ë–ò–õ–¨–ù–´–• –£–°–¢–†–û–ô–°–¢–í */
@media (max-width: 480px) {
    body {
        padding: 8px !important;
        padding-bottom: 80px !important;
    }
    
    .main-content {
        padding: 8px !important;
        padding-bottom: 80px !important;
    }
    
    .card, .task-card {
        width: 100% !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
    }
        .nav-icon img {
        width: 35px;
        height: 35px;
    }
}

@media (max-width: 360px) {
    body {
        padding: 6px !important;
        padding-bottom: 75px !important;
    }
    
    .main-content {
        padding: 6px !important;
        padding-bottom: 75px !important;
    }
}

/* üîß –ü–†–ï–î–û–¢–í–†–ê–©–ï–ù–ò–ï –ì–û–†–ò–ó–û–ù–¢–ê–õ–¨–ù–û–ô –ü–†–û–ö–†–£–¢–ö–ò –î–õ–Ø –í–°–ï–• –≠–õ–ï–ú–ï–ù–¢–û–í */
* {
    max-width: 100%;
    box-sizing: border-box;
}

/* üîß –§–ò–ö–° –î–õ–Ø –ö–ù–û–ü–û–ö –ò –ò–ù–ü–£–¢–û–í */
.task-btn, .btn, .search-input, .admin-input {
    white-space: nowrap !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
}

/* üîß –§–ò–ö–° –î–õ–Ø –¢–ï–ö–°–¢–ê */
.task-title, .task-description {
    word-break: break-word !important;
    overflow-wrap: break-word !important;
    hyphens: auto !important;
    max-width: 100% !important;
}
            /* –û—Ç–∫–ª—é—á–∏—Ç–µ —Å–ª–æ–∂–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
@media (max-width: 768px) {
    .card, .task-card, .modal-content {
        backdrop-filter: none !important;
        -webkit-backdrop-filter: none !important;
    }
    
    * {
        transition: none !important;
        animation: none !important;
    }
}
            /* üî• –≠–§–§–ï–ö–¢ –ü–ê–†–Ø–©–ò–• –ú–ê–¢–û–í–´–• –°–¢–ï–ö–û–õ –° –û–¢–†–ê–ñ–ï–ù–ò–ï–ú –¢–ï–ù–ò */

/* –ë–∞–∑–æ–≤—ã–π —ç—Ñ—Ñ–µ–∫—Ç –ø–∞—Ä–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ */
.card, 
.task-card, 
.profile-stat, 
.admin-section,
.stat-card,
.post-item,
.modal-content,
.exchange-card,
.post-promo,
.verification-item,
.chat-item,
.admin-task-item,
.level-progress,
.referral-system,
.about-content,
.about-feature,
.profile-action,
.withdraw-operation,
.confirmation-modal-content,
.verification-modal-content,
.prices-content,
.task-modal-content {
    background: rgba(20, 20, 40, 0.7) !important;
    backdrop-filter: blur(20px) saturate(180%) !important;
    -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
    border: 1px solid rgba(255, 255, 255, 0.125) !important;
    position: relative;
    z-index: 1;
    
    /* –≠—Ñ—Ñ–µ–∫—Ç –ø–∞—Ä–µ–Ω–∏—è —Å –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω–æ–π —Ç–µ–Ω—å—é */
    box-shadow: 
        /* –û—Å–Ω–æ–≤–Ω–∞—è —Ç–µ–Ω—å */
        0 25px 50px -12px rgba(0, 0, 0, 0.4),
        /* –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–≤–µ—á–µ–Ω–∏–µ */
        inset 0 1px 0 rgba(255, 255, 255, 0.1),
        inset 0 -1px 0 rgba(0, 0, 0, 0.2),
        /* –ê–∫—Ü–µ–Ω—Ç–Ω–∞—è —Ç–µ–Ω—å */
        0 0 0 1px rgba(255, 255, 255, 0.05),
        /* –û—Ç—Ä–∞–∂–µ–Ω–Ω–∞—è —Ç–µ–Ω—å –Ω–∞ —Ñ–æ–Ω */
        0 15px 35px -10px rgba(0, 0, 0, 0.3) !important;
    
    transform: translateY(0) scale(1);
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}


/* –£—Å–∏–ª–µ–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
.bottom-nav {
    background: rgba(25, 25, 50, 0.8) !important;
    backdrop-filter: blur(25px) saturate(200%) !important;
    -webkit-backdrop-filter: blur(25px) saturate(200%) !important;
    border: 1px solid rgba(255, 255, 255, 0.15) !important;
    
    box-shadow: 
        0 -20px 40px rgba(0, 0, 0, 0.3),
        0 -5px 15px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.1),
        0 0 20px rgba(99, 102, 241, 0.1) !important;
}

/* –≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω —Å —É—Å–∏–ª–µ–Ω–Ω–æ–π —Ç–µ–Ω—å—é */
.modal {
    background: rgba(5, 5, 16, 0.85) !important;
    backdrop-filter: blur(15px) !important;
    -webkit-backdrop-filter: blur(15px) !important;
}

.modal-content {
    box-shadow: 
        0 50px 100px -20px rgba(0, 0, 0, 0.6),
        0 30px 60px -30px rgba(0, 0, 0, 0.5),
        inset 0 1px 0 rgba(255, 255, 255, 0.1),
        0 0 0 1px rgba(255, 255, 255, 0.05),
        0 0 50px rgba(99, 102, 241, 0.1) !important;
    
    transform: translateY(20px) scale(0.95);
    opacity: 0;
    transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.modal.active .modal-content {
    transform: translateY(0) scale(1);
    opacity: 1;
}

/* –≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è –≥–µ—Ä–æ–π-–±–∞–Ω–Ω–µ—Ä–∞ —Å –ø–∞—Ä—è—â–∏–º —ç—Ñ—Ñ–µ–∫—Ç–æ–º */
.hero-banner {
    background: rgba(26, 26, 58, 0.6) !important;
    backdrop-filter: blur(15px) !important;
    -webkit-backdrop-filter: blur(15px) !important;
    
    box-shadow: 
        0 20px 40px rgba(0, 0, 0, 0.3),
        0 10px 25px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.1),
        0 0 30px rgba(99, 102, 241, 0.15) !important;
}

/* –≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Å –ø–∞—Ä—è—â–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º */
.btn,
.task-btn,
.admin-btn,
.profile-btn,
.withdraw-btn,
.tasks-btn,
.prices-btn,
.copy-btn,
.support-btn,
.confirmation-btn,
.upload-btn,
.chat-send,
.admin-chat-send {
    background: rgba(99, 102, 241, 0.8) !important;
    backdrop-filter: blur(10px) !important;
    -webkit-backdrop-filter: blur(10px) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    
    box-shadow: 
        0 8px 20px rgba(234, 99, 241, 0.3),
        0 4px 10px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.2),
        0 0 0 1px rgba(255, 255, 255, 0.1) !important;
    
    transform: translateY(0);
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.btn:hover,
.task-btn:hover,
.admin-btn:hover {
    transform: translateY(-3px) !important;
    box-shadow: 
        0 12px 25px rgba(99, 102, 241, 0.4),
        0 6px 15px rgba(0, 0, 0, 0.25),
        inset 0 1px 0 rgba(255, 255, 255, 0.25),
        0 0 0 1px rgba(255, 255, 255, 0.15) !important;
}

/* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –∑–æ–ª–æ—Ç—ã—Ö –∫–Ω–æ–ø–æ–∫ */
.btn-primary {
    background: linear-gradient(135deg, 
        rgba(255, 215, 0, 0.8), 
        rgba(55, 255, 0, 0.8)
    ) !important;
    backdrop-filter: blur(15px) !important;
    -webkit-backdrop-filter: blur(15px) !important;
    
    box-shadow: 
        0 8px 20px rgba(255, 215, 0, 0.4),
        0 4px 10px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.3),
        0 0 0 1px rgba(255, 255, 255, 0.15) !important;
}

/* –≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ —Å –ª–µ–≥–∫–∏–º –ø–∞—Ä–µ–Ω–∏–µ–º */
.admin-input, 
.search-input, 
.chat-input input,
.admin-chat-input,
.admin-textarea {
    background: rgba(30, 30, 60, 0.6) !important;
    backdrop-filter: blur(10px) !important;
    -webkit-backdrop-filter: blur(10px) !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    
    box-shadow: 
        0 4px 15px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.05),
        0 0 0 1px rgba(255, 255, 255, 0.05) !important;
    
    transition: all 0.3s ease;
}

.admin-input:focus, 
.search-input:focus, 
.chat-input input:focus {
    transform: translateY(-2px);
    box-shadow: 
        0 6px 20px rgba(0, 0, 0, 0.25),
        inset 0 1px 0 rgba(255, 255, 255, 0.1),
        0 0 0 1px rgba(99, 102, 241, 0.3) !important;
}

/* –≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å –ø–∞—Ä—è—â–µ–π –∞–Ω–∏–º–∞—Ü–∏–µ–π */
.notification {
    background: rgba(99, 102, 241, 0.9) !important;
    backdrop-filter: blur(20px) !important;
    -webkit-backdrop-filter: blur(20px) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    
    box-shadow: 
        0 20px 40px rgba(0, 0, 0, 0.3),
        0 10px 25px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.2),
        0 0 20px rgba(99, 102, 241, 0.3) !important;
    
    animation: floatIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

@keyframes floatIn {
    from {
        opacity: 0;
        transform: translateX(100%) translateY(20px) scale(0.9);
    }
    to {
        opacity: 1;
        transform: translateX(0) translateY(0) scale(1);
    }
}

/* –≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è —Å—Ç–∞—Ç—É—Å-–∫–∞—Ä—Ç–æ—á–µ–∫ —Å —É—Å–∏–ª–µ–Ω–Ω—ã–º –ø–∞—Ä–µ–Ω–∏–µ–º */
.stat-card {
    transform: translateY(0) scale(1);
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.stat-card:hover {
    transform: translateY(-10px) scale(1.05) !important;
}

.stat-card.balance-card {
    background: linear-gradient(135deg, 
        rgb(138, 92, 246), 
        rgba(124, 58, 237, 0.7), 
        rgba(109, 40, 217, 0.7)
    ) !important;
    
    box-shadow: 
        0 20px 40px rgba(139, 92, 246, 0.3),
        0 10px 25px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.2),
        0 0 20px rgba(139, 92, 246, 0.2) !important;
}

.stat-card.support-card {
    background: linear-gradient(135deg, 
        rgb(14, 164, 233), 
        rgba(3, 105, 161, 0.7), 
        rgb(7, 89, 133)
    ) !important;
    
    box-shadow: 
        0 20px 40px rgba(14, 165, 233, 0.3),
        0 10px 25px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.2),
        0 0 20px rgba(14, 165, 233, 0.2) !important;
}

/* –≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –æ–±–º–µ–Ω–∞ */
.exchange-card {
    background: linear-gradient(135deg, 
        rgb(255, 217, 0), 
        rgb(255, 183, 0)
    ) !important;
    
    box-shadow: 
        0 20px 40px rgba(255, 215, 0, 0.3),
        0 10px 25px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.3),
        0 0 20px rgba(255, 215, 0, 0.2) !important;
}

/* –≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Ç–µ */
.message {
    backdrop-filter: blur(15px) !important;
    -webkit-backdrop-filter: blur(15px) !important;
    transform: translateY(0);
    transition: all 0.3s ease;
}

.message:hover {
    transform: translateY(-2px);
}

.message-admin {
    background: rgba(30, 30, 60, 0.7) !important;
    box-shadow: 
        0 8px 20px rgba(0, 0, 0, 0.2),
        0 4px 10px rgba(0, 0, 0, 0.1) !important;
}

.message-user {
    background: rgba(99, 102, 241, 0.7) !important;
    box-shadow: 
        0 8px 20px rgba(99, 102, 241, 0.3),
        0 4px 10px rgba(0, 0, 0, 0.1) !important;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º –ø–∞—Ä–µ–Ω–∏—è */
.card, 
.task-card, 
.profile-stat, 
.admin-section {
    animation: glassFloatIn 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

@keyframes glassFloatIn {
    from {
        opacity: 0;
        transform: translateY(30px) scale(0.9);
        backdrop-filter: blur(0px);
        box-shadow: 0 0 0 rgba(0, 0, 0, 0);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
        backdrop-filter: blur(20px);
        box-shadow: 
            0 25px 50px -12px rgba(0, 0, 0, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.1),
            inset 0 -1px 0 rgba(0, 0, 0, 0.2),
            0 0 0 1px rgba(255, 255, 255, 0.05),
            0 15px 35px -10px rgba(0, 0, 0, 0.3);
    }
}

/* –≠—Ñ—Ñ–µ–∫—Ç –æ—Ç—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–Ω–∏ –Ω–∞ —Ñ–æ–Ω */
body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
        radial-gradient(ellipse at 20% 20%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
        radial-gradient(ellipse at 40% 40%, rgba(14, 165, 233, 0.05) 0%, transparent 50%);
    pointer-events: none;
    z-index: -1;
}

/* –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ç–µ–Ω–∏ –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏ –º—ã—à–∏ */
body {
    position: relative;
    overflow-x: hidden;
}

/* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
@media (max-width: 768px) {
    .card, 
    .task-card, 
    .profile-stat, 
    .admin-section,
    .stat-card {
        backdrop-filter: blur(15px) saturate(160%) !important;
        -webkit-backdrop-filter: blur(15px) saturate(160%) !important;
        
        box-shadow: 
            0 15px 30px rgba(0, 0, 0, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.1),
            inset 0 -1px 0 rgba(0, 0, 0, 0.2),
            0 0 0 1px rgba(255, 255, 255, 0.05) !important;
    }
    
    .card:hover, 
    .task-card:hover, 
    .profile-stat:hover {
        transform: translateY(-4px) scale(1.01) !important;
    }
    
    .bottom-nav {
        backdrop-filter: blur(20px) saturate(180%) !important;
        -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
        
        box-shadow: 
            0 -10px 25px rgba(0, 0, 0, 0.25),
            0 -3px 10px rgba(0, 0, 0, 0.15),
            inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
    }
}

/* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–æ–≤ –±–µ–∑ backdrop-filter */
@supports not (backdrop-filter: blur(20px)) {
    .card, 
    .task-card, 
    .profile-stat, 
    .admin-section,
    .stat-card {
        background: rgba(20, 20, 40, 0.95) !important;
        box-shadow: 
            0 20px 40px rgba(0, 0, 0, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
    }
}

/* –ü–†–ï–î–û–¢–í–†–ê–©–ï–ù–ò–ï –ë–õ–û–ö–ò–†–û–í–ö–ò –†–ï–ù–î–ï–†–ò–ù–ì–ê */
.performance-optimized {
  transform: translateZ(0);
  backface-visibility: hidden;
  perspective: 1000px;
}
            /* üî• –°–£–ü–ï–†-–ü–õ–ê–í–ù–´–ï –ê–ù–ò–ú–ê–¶–ò–ò –ò –ü–ï–†–ï–•–û–î–´ */
* {
    -webkit-overflow-scrolling: touch; /* –ü–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª –Ω–∞ iOS */
    -webkit-tap-highlight-color: transparent; /* –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –ø—Ä–∏ —Ç–∞–ø–µ */
    -webkit-font-smoothing: antialiased; /* –°–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ —à—Ä–∏—Ñ—Ç–æ–≤ */
    -moz-osx-font-smoothing: grayscale;
}

/* üîß –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –î–õ–Ø –ê–ù–ò–ú–ê–¶–ò–ô */
.tab-content,
.page,
.modal,
.task-card,
.card {
    transform: translateZ(0); /* –ê–ø–ø–∞—Ä–∞—Ç–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ */
    backface-visibility: hidden;
    perspective: 1000;
    will-change: transform, opacity;
}

/* üöÄ –°–£–ü–ï–†-–ü–õ–ê–í–ù–´–ï –ü–ï–†–ï–•–û–î–´ –ú–ï–ñ–î–£ –°–¢–†–ê–ù–ò–¶–ê–ú–ò */
.tab-content,
.page {
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    animation-duration: 0.4s;
    animation-fill-mode: both;
}

/* üî• –ü–õ–ê–í–ù–û–ï –ü–û–Ø–í–õ–ï–ù–ò–ï */
@keyframes smoothFadeIn {
    from {
        opacity: 0;
        transform: translateY(20px) scale(0.98);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

@keyframes smoothSlideIn {
    from {
        opacity: 0;
        transform: translateX(20px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

/* üîß –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –ü–õ–ê–í–ù–´–• –ê–ù–ò–ú–ê–¶–ò–ô */
.fade-in {
    animation: smoothFadeIn 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
}

.slide-in {
    animation: smoothSlideIn 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
}

/* üéØ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –î–õ–Ø –ö–ê–†–¢–û–ß–ï–ö */
.task-card,
.card {
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    transform-origin: center;
}

.task-card:hover,
.card:hover {
    transform: translateY(-2px) scale(1.02);
}

/* üî• –ü–õ–ê–í–ù–´–ï –ö–ù–û–ü–ö–ò */
.btn,
.task-btn,
.nav-item {
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    transform: translateZ(0);
    position: relative;
    overflow: hidden;
}

/* –≠—Ñ—Ñ–µ–∫—Ç –ø—É–ª—å—Å–∞—Ü–∏–∏ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ */
.btn:active,
.task-btn:active,
.nav-item:active {
    transform: scale(0.96);
    transition: transform 0.1s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

/* üåä –í–æ–ª–Ω–æ–≤–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –∫–ª–∏–∫–µ */
.ripple {
    position: absolute;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.6);
    transform: scale(0);
    animation: ripple 0.6s linear;
    pointer-events: none;
}

@keyframes ripple {
    to {
        transform: scale(4);
        opacity: 0;
    }
}

/* üîß –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –°–ö–†–û–õ–õ–ê */
.tasks-grid,
.modal-content,
.chat-messages {
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
}

/* üöÄ –ü–†–ï–î–ó–ê–ì–†–£–ó–ö–ê –î–õ–Ø –ë–û–õ–ï–ï –ü–õ–ê–í–ù–´–• –ü–ï–†–ï–•–û–î–û–í */
.tab-content:not(.active),
.page:not(.active) {
    display: none;
}

/* üîß –§–ò–ö–° –î–õ–Ø –ú–û–î–ê–õ–¨–ù–´–• –û–ö–û–ù */
.modal {
    transition: opacity 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    backdrop-filter: blur(10px);
}

.modal-content {
    transform: scale(0.9);
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.modal.active .modal-content {
    transform: scale(1);
}

/* üî• –ü–õ–ê–í–ù–ê–Ø –ù–ê–í–ò–ì–ê–¶–ò–Ø */
.bottom-nav {
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.nav-item {
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    position: relative;
}

.nav-item::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 50%;
    width: 0;
    height: 2px;
    background: var(--accent);
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    transform: translateX(-50%);
}

.nav-item.active::after {
    width: 70%;
}



/* üîß –ü–†–ï–î–û–¢–í–†–ê–©–ï–ù–ò–ï –ë–õ–û–ö–ò–†–û–í–ö–ò –ì–õ–ê–í–ù–û–ì–û –ü–û–¢–û–ö–ê */
.lazy-load {
    opacity: 0;
    transform: translateY(20px);
    transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.lazy-load.loaded {
    opacity: 1;
    transform: translateY(0);
}

/* üöÄ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò */
.performance-optimized {
    transform: translateZ(0);
    backface-visibility: hidden;
    perspective: 1000px;
}

/* üîß –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò –°–ö–†–û–õ–õ–ê */
.smooth-scroll {
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
}

/* –î–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π */
.scroll-container {
    overflow: auto;
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
}
        /* üîß –û–°–ù–û–í–ù–´–ï –§–ò–ö–°–´ –î–õ–Ø –ú–û–ë–ò–õ–¨–ù–´–• */
        .tg-header {
            background: var(--bg-primary) !important;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, Roboto, Oxygen, Ubuntu, sans-serif;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            -webkit-tap-highlight-color: transparent;
            max-width: 100%;
        }

        :root {
            --bg-primary: #050510;
            --bg-secondary: #0a0a1a;
            --text-primary: #ffffff;
            --text-secondary: #8b9bda;
            --accent: #6366f1;
            --accent-hover: #4f46e5;
            --card-bg: #0f0f23;
            --border: #1a1a3a;
            --shadow: rgba(99, 102, 241, 0.1);
            --nav-bg: rgba(15, 15, 35, 0.85);
            --gold: #ffd700;
            --gold-gradient: linear-gradient(135deg, #ffd700, #ffb700);
            --purple-gradient: linear-gradient(135deg, #8b5cf6, #7c3aed);
            --blue-gradient: linear-gradient(135deg, #3b82f6, #2563eb);
            --teal-gradient: linear-gradient(135deg, #0ea5e9, #0369a1);
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
        }

        /* –§–∏–∫—Å –¥–ª—è body */
        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 12px;
            padding-bottom: 100px;
            line-height: 1.6;
            background-image: 
                radial-gradient(circle at 15% 50%, rgba(99, 102, 241, 0.05) 0%, transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(139, 92, 246, 0.05) 0%, transparent 25%);
            margin: 0;
            width: 100%;
            box-sizing: border-box;
            overflow-x: hidden;
            position: relative;
        }

        /* üî• –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –Ø–†–ö–ò–ï –ë–õ–û–ö–ò */
        :root {
            --card-bg: rgba(20, 20, 40, 0.95);
            --bg-secondary: rgba(25, 25, 50, 0.9);
            --border: rgba(99, 102, 241, 0.3);
            --shadow: rgba(99, 102, 241, 0.15);
        }

        /* üî• –Ø–†–ö–ò–ï –ö–ê–†–¢–û–ß–ö–ò */
        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
        }

        /* üî• –Ø–†–ö–ò–ï –°–¢–ê–¢–ò–°–¢–ò–ß–ï–°–ö–ò–ï –ö–ê–†–¢–û–ß–ö–ò */
        .stat-card {
            border-radius: 16px;
            padding: 16px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            min-height: 100px;
            width: 48%;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            flex: 1;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            transform: translateZ(0);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .stat-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 50%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .stat-card:hover::after {
            opacity: 1;
        }
        /* –ò—Å–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ–Ω –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –∑–∞–¥–∞–Ω–∏–π */
        .task-card {
            background: var(--card-bg) !important;
            border-radius: 16px !important;
            padding: 16px !important;
            margin-bottom: 12px !important;
            border: 1px solid var(--border) !important;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25) !important;
            backdrop-filter: blur(10px) !important;
            position: relative !important;
            overflow: hidden !important;
            width: 100% !important;
            box-sizing: border-box !important;
            display: block !important;
            opacity: 1 !important;
            visibility: visible !important;
        }

/* –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —á—Ç–æ –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª—ã */
.task-card * {
    max-width: 100% !important;
}
        /* –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –°–¢–ò–õ–¨ –î–õ–Ø –ö–ê–†–¢–û–ß–ï–ö –ó–ê–î–ê–ù–ò–ô
        .task-card {
            background: var(--card-bg);
            border-radius: 14px;
            padding: 14px;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: transform 0.3s ease;
            position: relative;
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 0;
            display: flex;
            flex-direction: column;
            min-height: 160px;
            height: auto;
            overflow: visible;
        } */
/* –°—Ç–∏–ª–∏ –¥–ª—è –æ–±–ª–∞—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
/* –î–ª—è –∞–¥–º–∏–Ω—Å–∫–æ–π –ø–∞–Ω–µ–ª–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏—è */


.image-upload-area:hover {
    border-color: var(--accent);
    background: rgba(99, 102, 241, 0.05);
    transform: translateY(-2px);
}

.image-upload-area.dragover {
    border-color: var(--accent);
    background: rgba(99, 102, 241, 0.1);
    transform: scale(1.02);
}

.upload-placeholder {
    color: var(--text-secondary);
    pointer-events: none;
    transition: all 0.3s ease;
}











/* –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ */
.upload-progress {
    width: 100%;
    height: 4px;
    background: var(--border);
    border-radius: 2px;
    margin-top: 10px;
    overflow: hidden;
    display: none;
}

.upload-progress-bar {
    height: 100%;
    background: var(--accent);
    border-radius: 2px;
    width: 0%;
    transition: width 0.3s ease;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Å–µ—Ç–∫–∏ –∑–∞–¥–∞–Ω–∏–π —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ */
.tasks-grid-with-images {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 16px;
    margin-top: 16px;
}


        .task-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--accent), var(--purple-gradient));
            opacity: 0.7;
        }

        .task-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            border-color: var(--accent);
        }

        /* üî• –Ø–†–ö–ò–ï –ö–ù–û–ü–ö–ò */
        .btn {
            display: inline-block;
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            transform: translateZ(0);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(99, 102, 241, 0.4);
        }

        .btn-primary {
            background: var(--gold-gradient);
            color: #000;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(255, 204, 0, 0.4);
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        /* üî• –Ø–†–ö–ò–ï –ö–ê–†–¢–û–ß–ö–ò –í –ü–†–û–§–ò–õ–ï */
        .profile-stat {
            background: var(--card-bg);
            border-radius: 14px;
            padding: 16px;
            text-align: center;
            border: 1px solid var(--border);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .profile-stat:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

  

        .nav-item {
            text-align: center;
            cursor: pointer;
            padding: 6px 8px;
            border-radius: 12px;
            flex: 1;
            opacity: 0.7;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 35px;
            border: 1px solid transparent;
        }

        .nav-item.active {
            background: var(--accent);
            opacity: 1;
            box-shadow: 0 0 16px rgba(99, 102, 241, 0.4);
            transform: translateY(-2px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* üî• –Ø–†–ö–ò–ï –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê */
        .modal-content {
            background: var(--card-bg);
            border-radius: 18px;
            padding: 20px;
            width: 95%;
            max-width: 400px;
            border: 1px solid var(--border);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            max-height: 80vh;
            overflow-y: auto;
            backdrop-filter: blur(20px);
        }

        /* üî• –Ø–†–ö–ò–ï –ü–û–°–¢–´ */
        .post-item {
            background: var(--card-bg);
            border-radius: 14px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            animation: fadeIn 0.6s ease-out;
            overflow: hidden;
            position: relative;
        }

        .post-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--accent);
            opacity: 0.7;
        }

        /* üî• –Ø–†–ö–ò–ï –§–û–†–ú–´ */
        .admin-input, .search-input {
            width: 100%;
            background: rgba(30, 30, 60, 0.8);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 12px 16px 12px 45px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .admin-input:focus, .search-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            background: rgba(35, 35, 70, 0.9);
        }

        /* üî• –Ø–†–ö–ò–ï –°–ï–ö–¶–ò–ò –ê–î–ú–ò–ù–ö–ò */
        .admin-section {
            background: var(--card-bg);
            border-radius: 14px;
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid var(--border);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
        }

        .admin-task-item {
            background: rgba(30, 30, 60, 0.8);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 8px;
            border: 1px solid var(--border);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .admin-task-item:hover {
            background: rgba(35, 35, 70, 0.9);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* üî• –Ø–†–ö–ò–ï –ì–ï–†–û–ô –ë–ê–ù–ù–ï–†–´ */
        .hero-banner {
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 16px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
            position: relative;
            height: 150px;
            background: linear-gradient(45deg, #1a1a3a, #252550);
            border: 1px solid var(--border);
        }

        /* üî• –Ø–†–ö–ò–ï –ö–ê–†–¢–û–ß–ö–ò –û–ë–ú–ï–ù–ê */
        .exchange-card {
            background: var(--gold-gradient);
            color: #000;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.3);
            border: 1px solid rgba(255, 215, 0, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .exchange-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, transparent 50%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .exchange-card:hover::before {
            opacity: 1;
        }

        .exchange-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 215, 0, 0.4);
        }

        /* üî• –Ø–†–ö–ò–ï –í–ö–õ–ê–î–ö–ò */
        .tasks-tabs {
            display: flex;
            margin-bottom: 16px;
            background: var(--card-bg);
            border-radius: 14px;
            padding: 6px;
            border: 1px solid var(--border);
            overflow-x: auto;
            white-space: nowrap;
            position: relative;
            z-index: 2;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        /* –£–ª—É—á—à–∞–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –≤–∫–ª–∞–¥–æ–∫ */
        .task-tab {
            flex: 1;
            text-align: center;
            padding: 8px 6px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 70px;
            border: 1px solid transparent;
            background: var(--bg-secondary);
            color: var(--text-secondary);
        }

        .task-tab.active {
            background: var(--accent) !important;
            color: white !important;
            box-shadow: 0 4px 10px rgba(99, 102, 241, 0.3) !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
        }

        /* üî• –Ø–†–ö–ò–ï –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø */
        .notification {
            position: fixed;
            top: 16px;
            right: 16px;
            background: var(--accent);
            color: white;
            padding: 10px 14px;
            border-radius: 10px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 280px;
            animation: slideIn 0.3s ease-out;
            border: 1px solid var(--border);
            backdrop-filter: blur(20px);
        }

        /* üî• –Ø–†–ö–ò–ô –ü–†–û–ì–†–ï–°–° –ë–ê–† */
        .progress-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 6px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .progress-fill {
            height: 100%;
            background: var(--gold-gradient);
            border-radius: 3px;
            width: 0%;
            box-shadow: 0 0 8px rgba(255, 215, 0, 0.3);
        }

        /* üî• –Ø–†–ö–ò–ï –ò–ö–û–ù–ö–ò –ò –ê–í–ê–¢–ê–†–´ */
        .profile-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 14px;
            position: relative;
            border: 2px solid var(--accent);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .chat-avatar-small {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--purple-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            color: white;
            font-weight: 600;
            font-size: 14px;
            box-shadow: 0 4px 8px rgba(139, 92, 246, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        /* üî• –£–°–ò–õ–ï–ù–ù–´–ï –¢–ï–ù–ò –ò –ì–õ–£–ë–ò–ù–ê */
        .card, .task-card, .profile-stat, .admin-section {
            box-shadow: 
                0 6px 20px rgba(0, 0, 0, 0.25),
                0 1px 3px rgba(255, 255, 255, 0.05) inset;
        }

        /* üî• –£–õ–£–ß–®–ï–ù–ù–´–ï –ì–†–ê–î–ò–ï–ù–¢–´ */
        .stat-card.balance-card {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed, #6d28d9);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }

        .stat-card.support-card {
            background: linear-gradient(135deg, #0ea5e9, #0369a1, #075985);
            box-shadow: 0 6px 20px rgba(14, 165, 233, 0.4);
        }

        /* üî• –ü–û–î–°–í–ï–¢–ö–ê –ü–†–ò –ù–ê–í–ï–î–ï–ù–ò–ò */
        .card:hover, .profile-stat:hover, .admin-task-item:hover {
            box-shadow: 
                0 8px 25px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(99, 102, 241, 0.1);
        }

        .nav-icon {
            font-size: 18px;
            margin-bottom: 2px;
            color: var(--text-secondary);
        }

        .nav-label {
            font-size: 10px;
            color: var(--text-secondary);
            font-weight: 500;
        }

       .main-content {
    overflow-x: hidden !important;
    width: 100% !important;
}

        /* –£–±–µ–¥–∏–º—Å—è —á—Ç–æ –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç—Å—è */
        .tab-content {
            min-height: calc(100vh - 200px);
            padding-bottom: 16px;
        }

        .page {
            padding-bottom: 90px;
        }

        /* üîß –§–ò–ö–° –î–õ–Ø –í–°–ï–• –≠–ö–†–ê–ù–û–í */
.container {
    max-width: 100% !important;
    overflow-x: hidden !important;
}

        .header {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }

        .logo {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 6px;
            cursor: pointer;
        }

        .logo-text {
            font-size: 24px;
            font-weight: 800;
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            letter-spacing: -0.5px;
        }

        .logo-icon {
            width: 28px;
            height: 28px;
            margin-right: 8px;
            border-radius: 6px;
            overflow: hidden;
        }

        .slogan {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 500;
            margin-bottom: 16px;
        }

        .video-icon {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }

        .video-container {
            width: 100px;
            height: 100px;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .video-medium {
            width: 36px;
            height: 36px;
        }

        .video-large {
            width: 48px;
            height: 48px;
        }

        .hero-banner video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .stats-grid {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
            justify-content: space-between;
        }

        .stat-card:active {
            transform: scale(0.97) translateZ(0);
        }

        .balance-card {
            background: var(--purple-gradient);
            box-shadow: 0 6px 16px rgba(139, 92, 246, 0.2);
        }

        .support-card {
            background: var(--teal-gradient);
            box-shadow: 0 6px 16px rgba(14, 165, 233, 0.2);
        }

        .stat-icon {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 11px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 6px;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 800;
            color: white;
            line-height: 1.2;
        }

        .exchange-card:active {
            transform: scale(0.98);
        }

        .exchange-icon {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
        }

        .exchange-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .exchange-text {
            font-size: 12px;
            opacity: 0.9;
            line-height: 1.3;
        }

        .post-promo {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 16px;
            text-align: center;
            border: 1px solid var(--border);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .post-icon {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 12px;
        }

        .post-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 6px;
            color: var(--text-primary);
        }

        .post-description {
            color: var(--text-secondary);
            margin-bottom: 14px;
            font-size: 12px;
            line-height: 1.4;
        }

        .btn:active {
            transform: scale(0.95) translateZ(0);
        }

        .btn-primary {
            background: var(--gold-gradient);
            color: #000;
            font-weight: 700;
            box-shadow: 0 4px 10px rgba(255, 204, 0, 0.25);
        }

        .btn-full {
            width: 100%;
        }

        .btn-success {
            background: var(--success);
        }

        .btn-warning {
            background: var(--warning);
        }

        .btn-error {
            background: var(--error);
        }

        .tasks-button-container {
            margin: 20px 0;
            text-align: center;
        }

        .tasks-btn {
            background: var(--purple-gradient);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 14px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 6px 16px rgba(139, 92, 246, 0.25);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .tasks-btn:active {
            transform: scale(0.96);
        }

        .nav-item {
            text-align: center;
            cursor: pointer;
            padding: 6px 10px;
            border-radius: 12px;
            flex: 1;
            opacity: 0.7;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .nav-item.active {
            background: var(--accent);
            opacity: 1;
            box-shadow: 0 0 16px rgba(99, 102, 241, 0.25);
            transform: translateY(-2px);
        }

        .nav-item.active .nav-icon,
        .nav-item.active .nav-label {
            color: white;
        }

        .nav-item.notification {
            position: relative;
        }

        .nav-item.notification::after {
            content: '';
            position: absolute;
            top: 4px;
            right: 4px;
            width: 6px;
            height: 6px;
            background: var(--error);
            border-radius: 50%;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤ */
        .withdraw-hero {
            text-align: center;
            padding: 30px 16px;
            background: var(--purple-gradient);
            border-radius: 16px;
            margin-bottom: 16px;
            color: white;
        }

        .withdraw-balance {
            font-size: 48px;
            font-weight: 800;
            margin: 16px 0;
            text-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .withdraw-subtitle {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .withdraw-btn {
            background: var(--gold-gradient);
            color: #000;
            border: none;
            padding: 16px 24px;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.3);
            width: 100%;
            max-width: 260px;
            margin: 0 auto;
        }

        .withdraw-btn:active {
            transform: scale(0.95);
        }

        .withdraw-form {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            margin-top: 16px;
            border: 1px solid var(--border);
            display: none;
        }

        .withdraw-info {
            background: var(--bg-secondary);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 16px;
        }

        .withdraw-history {
            margin-top: 20px;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(5, 5, 16, 0.95);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            padding: 16px;
        }

        .modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 16px;
    position: relative;
    flex-shrink: 0;
}

.modal-title {
    font-size: 18px;
    font-weight: 700;
    background: var(--gold-gradient);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
}

.modal-close {
    background: none;
    border: none;
    font-size: 22px;
    color: var(--text-secondary);
    cursor: pointer;
    position: absolute;
    top: -8px;
    right: -8px;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: var(--card-bg);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.modal-close:hover {
    background: var(--bg-secondary);
    color: var(--text-primary);
}
        .modal-body {
            margin-bottom: 16px;
            text-align: left;
        }

        .balance-amount {
            font-size: 40px;
            font-weight: 800;
            margin: 20px 0;
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .profile-btn {
            background: var(--purple-gradient);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            text-align: center;
            margin-top: 16px;
            box-shadow: 0 6px 16px rgba(139, 92, 246, 0.25);
        }

        .chat-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(5, 5, 16, 0.95);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .chat-modal.active {
            opacity: 1;
            pointer-events: all;
        }

        /* –£–º–µ–Ω—å—à–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞ */
        .chat-header {
            background: var(--card-bg);
            padding: 10px 14px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chat-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--purple-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .chat-avatar .video-icon {
            width: 20px;
            height: 20px;
        }

        .chat-info {
            flex: 1;
        }

        .chat-name {
            font-weight: 600;
            font-size: 15px;
        }

        .chat-status {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .chat-close {
            background: none;
            border: none;
            font-size: 22px;
            color: var(--text-secondary);
            cursor: pointer;
        }

        /* –£–º–µ–Ω—å—à–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —á–∞—Ç–æ–≤ */
        .chat-messages {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 6px;
            max-height: calc(100vh - 120px);
        }

        .message {
            max-width: 85%;
            padding: 8px 12px;
            border-radius: 12px;
            margin-bottom: 4px;
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: pre-wrap;
            position: relative;
            font-size: 14px;
            line-height: 1.3;
        }

        .message-admin {
            background: var(--card-bg);
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }

        .message-user {
            background: var(--accent);
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }

        /* –£–º–µ–Ω—å—à–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –≤ —á–∞—Ç–µ */
        .chat-input {
            padding: 8px 10px;
            background: var(--card-bg);
            border-top: 1px solid var(--border);
            display: flex;
            gap: 8px;
        }

        .chat-input input {
            flex: 1;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 10px 14px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .chat-send {
            background: var(--accent);
            border: none;
            border-radius: 50%;
            width: 38px;
            height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }

        .prices-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(5, 5, 16, 0.95);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .prices-modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .prices-content {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            width: 95%;
            max-width: 380px;
            border: 1px solid var(--border);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        .prices-title {
            text-align: center;
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 16px;
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .price-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 16px;
        }

        .price-item {
            background: var(--bg-secondary);
            padding: 14px;
            border-radius: 12px;
            display: flex;
            justify-content: between;
            align-items: center;
            border: 1px solid var(--border);
        }

        .price-time {
            font-weight: 600;
            flex: 1;
        }

        .price-amount {
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 800;
            font-size: 16px;
        }

        .prices-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            text-align: center;
        }

        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
            padding: 14px;
            background: var(--card-bg);
            border-radius: 16px;
            border: 1px solid var(--border);
        }
        
        .profile-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 14px;
            position: relative;
            border: 2px solid var(--accent);
        }
        
        .profile-avatar video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .profile-info {
            flex: 1;
        }
        
        .profile-name {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .profile-id {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }
        
        .profile-level {
            display: inline-block;
            background: var(--purple-gradient);
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .profile-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 16px;
        }
        
        .profile-stat {
            background: var(--card-bg);
            border-radius: 14px;
            padding: 14px;
            text-align: center;
            border: 1px solid var(--border);
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .stat-label {
            font-size: 11px;
            color: var(--text-secondary);
        }
        
        .profile-section {
            margin-bottom: 16px;
        }
        
        .section-title {
            font-size: 23px;
            font-weight: 700;
            margin-bottom: 20px;
            margin-top: 20px;
            padding-left: 6px;
            border-left: 3px solid var(--accent);
        }
        
        .profile-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .profile-action {
            display: flex;
            align-items: center;
            padding: 14px;
            background: var(--card-bg);
            border-radius: 14px;
            border: 1px solid var(--border);
            cursor: pointer;
        }

        
        
        .action-icon {
    width: 22px;
    height: 22px;
    margin-right: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 6px;
    
}
        
        .action-text {
            flex: 1;
            font-size: 14px;
            font-weight: 500;
        }
        
        .action-arrow {
            color: var(--text-secondary);
        }
        
        .level-progress {
            margin-top: 16px;
            background: var(--card-bg);
            border-radius: 14px;
            padding: 14px;
            border: 1px solid var(--border);
        }
        
        .level-title {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .level-name {
            font-weight: 600;
        }
        
        .level-count {
            color: var(--text-secondary);
            font-size: 13px;
        }
        
        .progress-bar {
            height: 6px;
            background: var(--bg-secondary);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 6px;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--gold-gradient);
            border-radius: 3px;
            width: 0%;
        }
        
        .level-info {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .referral-system {
            background: var(--card-bg);
            border-radius: 14px;
            padding: 14px;
            margin: 16px 0;
            border: 1px solid var(--border);
        }
        
        .referral-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .referral-code {
            background: var(--bg-secondary);
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 14px;
            text-align: center;
            border: 1px solid var(--border);
        }
        
        .code-value {
            font-size: 18px;
            font-weight: 700;
            letter-spacing: 2px;
            margin-bottom: 6px;
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .copy-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
        }
        
        .referral-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 14px;
        }
        
        .referral-stat {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            border: 1px solid var(--border);
        }
        
        .referral-value {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .referral-label {
            font-size: 11px;
            color: var(--text-secondary);
        }
        
        .referral-info {
            font-size: 12px;
            color: var(--text-secondary);
            text-align: center;
            margin-top: 8px;
        }
        
        .about-content {
            background: var(--card-bg);
            border-radius: 14px;
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid var(--border);
        }
        
        .about-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 14px;
            text-align: center;
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .about-text {
            font-size: 20px;
            line-height: 1.6;
            color: var(--text-secondary);
            margin-bottom: 14px;
        }
        
        .about-features {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 16px;
        }
        
        .about-feature {
            background: var(--bg-secondary);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            border: 1px solid var(--border);
        }
        
        .feature-icon {
            font-size: 20px;
            margin-bottom: 6px;
        }
        
        .feature-text {
            font-size: 11px;
            color: var(--text-secondary);
        }
        
        .about-footer {
            text-align: center;
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 16px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ –∑–∞–¥–∞–Ω–∏–π */
        .tasks-tab {
            padding-bottom: 16px;
        }
        
        .search-container {
            margin-bottom: 16px;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 12px 16px 12px 45px;
            color: var(--text-primary);
            font-size: 14px;
        }
        
        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }
        
        .filters-container {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            overflow-x: auto;
            padding-bottom: 4px;
        }
        
        .filter-btn {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 6px 12px;
            font-size: 11px;
            color: var(--text-secondary);
            cursor: pointer;
            white-space: nowrap;
        }
        
        .filter-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }
        
     /* üîß –§–ò–ö–°–´ –î–õ–Ø –ú–û–ë–ò–õ–¨–ù–´–• –£–°–¢–†–û–ô–°–¢–í - –ü–†–ï–î–û–¢–í–†–ê–©–ï–ù–ò–ï –í–´–•–û–î–ê –ó–ê –ü–†–ï–î–ï–õ–´ –≠–ö–†–ê–ù–ê */
.tasks-grid {
    display: grid !important;
    grid-template-columns: 1fr !important;
    gap: 12px !important;
    width: 100% !important;
    box-sizing: border-box !important;
    margin: 0 !important;
    padding: 0 !important;
    overflow: hidden !important;
}
        /* –£–±–∏—Ä–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é fade-in –¥–ª—è –∑–∞–¥–∞–Ω–∏–π —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ —Å–º–µ—â–µ–Ω–∏—è */
        .task-card.fade-in {
            animation: none;
        }
        
        /* üîß –ó–ê–ì–û–õ–û–í–û–ö –ò –¶–ï–ù–ê */
.task-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 12px;
    gap: 10px;
    width: 100%;
    flex-wrap: wrap;
}

.task-title {
    font-size: 15px !important;
    line-height: 1.3 !important;
    word-break: break-word !important;
    overflow-wrap: break-word !important;
    hyphens: auto !important;
    color: var(--text-primary) !important;
    font-weight: 600 !important;
    margin-bottom: 8px !important;
    flex: 1;
    min-width: 0;
}

        /* –ö–∞—Ç–µ–≥–æ—Ä–∏—è */
        .task-category {
            font-size: 11px;
            color: var(--accent);
            background: rgba(99, 102, 241, 0.1);
            padding: 4px 8px;
            border-radius: 10px;
            display: inline-block;
            font-weight: 600;
            border: 1px solid rgba(99, 102, 241, 0.2);
            flex-shrink: 0;
        }

.task-price {
    font-size: 18px !important;
    font-weight: 800 !important;
    background: var(--gold-gradient) !important;
    -webkit-background-clip: text !important;
    background-clip: text !important;
    color: transparent !important;
    flex-shrink: 0 !important;
    white-space: nowrap !important;
    margin-left: 10px;
}

        /* –ú–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è */
        .task-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 6px;
            flex-shrink: 0;
        }

    

    




        .task-description {
            font-size: 13px !important;
            line-height: 1.4 !important;
            word-break: break-word !important;
            overflow-wrap: break-word !important;
            hyphens: auto !important;
            color: var(--text-secondary) !important;
            margin-bottom: 12px !important;
        }

        /* –ü–ª–∞–≤–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å –∫–Ω–æ–ø–∫–æ–π "–ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ" */
        .task-description.collapsed {
            max-height: 50px;
            overflow: hidden;
        }

        .task-description.collapsed::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 25px;
            background: linear-gradient(transparent, var(--card-bg));
            pointer-events: none;
        }

        .read-more-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 6px;
            display: inline-block;
            align-self: flex-start;
        }

        /* –§—É—Ç–µ—Ä */
        .task-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
            flex-shrink: 0;
            width: 100%;
            padding-top: 10px;
            border-top: 1px solid var(--border);
            flex-wrap: wrap;
            gap: 6px;
        }

        /* –í—Ä–µ–º—è */
        .task-time {
            font-size: 11px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 4px;
            font-weight: 500;
            flex-shrink: 0;
        }

        .task-time::before {
            content: '‚è±Ô∏è';
            font-size: 12px;
        }

        /* –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ */
        .task-btn {
            background: var(--accent) !important;
            color: white !important;
            border: none !important;
            padding: 8px 14px !important;
            border-radius: 8px !important;
            font-size: 13px !important;
            font-weight: 600 !important;
            cursor: pointer !important;
            white-space: nowrap !important;
            flex-shrink: 0 !important;
            transition: all 0.3s ease !important;
            box-shadow: 0 4px 10px rgba(99, 102, 241, 0.25) !important;
            display: inline-block !important;
        }

        .task-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .task-btn:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(99, 102, 241, 0.35);
        }

        .task-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(99, 102, 241, 0.3);
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ */
        .task-availability {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--purple-gradient);
            color: white;
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 9px;
            font-weight: 700;
            text-transform: uppercase;
            z-index: 2;
        }

        /* üîß –ê–ù–ò–ú–ê–¶–ò–Ø –ü–û–Ø–í–õ–ï–ù–ò–Ø */
        @keyframes taskCardAppear {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .task-card {
            animation: taskCardAppear 0.5s ease-out;
        }

        /* üîß –°–¢–ò–õ–ò –î–õ–Ø –†–ê–ó–ù–´–• –°–¢–ê–¢–£–°–û–í */
        .task-card.completed {
            border-left: 3px solid var(--success);
            background: linear-gradient(135deg, var(--card-bg), rgba(16, 185, 129, 0.05));
        }

        .task-card.pending {
            border-left: 3px solid var(--warning);
            background: linear-gradient(135deg, var(--card-bg), rgba(245, 158, 11, 0.05));
        }

        .task-card.rejected {
            border-left: 3px solid var(--error);
            background: linear-gradient(135deg, var(--card-bg), rgba(239, 68, 68, 0.05));
        }

        /* üîß –ò–ù–î–ò–ö–ê–¢–û–† –ü–†–û–ì–†–ï–°–°–ê */
        .task-progress {
            width: 100%;
            height: 4px;
            background: var(--bg-secondary);
            border-radius: 2px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .task-progress-bar {
            height: 100%;
            background: var(--accent);
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        .task-progress-text {
            font-size: 10px;
            color: var(--text-secondary);
            text-align: right;
            margin-top: 2px;
        }

        /* –°–ª–æ–∂–Ω–æ—Å—Ç—å */
        .task-difficulty {
            font-size: 10px;
            font-weight: 700;
            padding: 3px 6px;
            border-radius: 8px;
            text-transform: uppercase;
            flex-shrink: 0;
        }

        .task-difficulty.–ª–µ–≥–∫–∞—è {
            background: rgba(16, 185, 129, 0.15);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .task-difficulty.—Å—Ä–µ–¥–Ω—è—è {
            background: rgba(245, 158, 11, 0.15);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .task-difficulty.—Å–ª–æ–∂–Ω–∞—è {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

      .no-tasks {
    padding: 20px !important;
    margin: 0 !important;
    min-height: auto !important;
}
        
        .no-tasks-icon {
            font-size: 36px;
            margin-bottom: 12px;
        }
        
        .task-modal-content {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            width: 95%;
            max-width: 480px;
            max-height: 80vh;
            border: 1px solid var(--border);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            overflow-y: auto;
        }

        .task-modal-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 6px;
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            line-height: 1.3;
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 80%;
        }

        .task-modal-category {
            display: inline-block;
            background: var(--bg-secondary);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 14px;
        }

        .task-modal-price {
            font-size: 24px;
            font-weight: 800;
            margin: 16px 0;
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-align: center;
        }

        .task-modal-description {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 20px;
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: pre-wrap;
            padding: 14px;
            background: var(--bg-secondary);
            border-radius: 10px;
            border-left: 3px solid var(--accent);
        }

        .task-modal-details {
            background: var(--bg-secondary);
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .task-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 6px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .task-detail:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .task-detail-label {
            color: var(--text-secondary);
            font-weight: 500;
        }

        .task-detail-value {
            font-weight: 600;
            color: var(--text-primary);
            text-align: right;
            max-width: 60%;
            word-wrap: break-word;
        }

        .task-modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 16px;
            flex-shrink: 0;
        }

        .task-modal-cancel {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border);
            padding: 12px 16px;
            border-radius: 10px;
            flex: 1;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .task-modal-start {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 10px;
            flex: 1;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .task-modal-cancel:hover,
        .task-modal-start:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è */
        .confirmation-task {
            background: var(--card-bg);
            border-radius: 14px;
            padding: 14px;
            border: 1px solid var(--border);
            margin-bottom: 14px;
        }
        
        .confirmation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .confirmation-title {
            font-size: 15px;
            font-weight: 600;
        }
        
        .confirmation-price {
            font-size: 16px;
            font-weight: 700;
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .confirmation-question {
            font-size: 13px;
            margin-bottom: 14px;
            text-align: center;
        }
        
        .confirmation-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 14px;
        }
        
        .confirmation-no {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border);
            padding: 8px;
            border-radius: 8px;
            flex: 1;
            cursor: pointer;
            font-weight: 600;
        }
        
        .confirmation-yes {
            background: var(--accent);
            color: white;
            border: none;
            padding: 8px;
            border-radius: 8px;
            flex: 1;
            cursor: pointer;
            font-weight: 600;
        }
        
        .confirmation-rejected {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .confirmation-rejected-text {
            color: var(--error);
            font-size: 13px;
            margin-bottom: 6px;
        }
        
        .confirmation-support {
            background: var(--accent);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–∞–Ω–µ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ */
        .admin-panel {
            background: var(--card-bg);
            border-radius: 14px;
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid var(--border);
        }
        
        .admin-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 14px;
            text-align: center;
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .admin-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 16px;
        }
        
        .admin-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
        }
        
        .admin-form {
            background: var(--bg-secondary);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }
        
        .admin-input {
            width: 100%;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px;
            color: var(--text-primary);
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .admin-textarea {
            width: 100%;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px;
            color: var(--text-primary);
            font-size: 14px;
            margin-bottom: 10px;
            min-height: 80px;
            resize: vertical;
        }
        
        .admin-submit {
            background: var(--success);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
        }
        
        .admin-task-list {
            max-height: 280px;
            overflow-y: auto;
        }
        
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .admin-section {
            display: none;
        }

        #admin-posts-section {
            display: block;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ—Å—Ç–æ–≤ */
        .post {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 12px;
            border-left: 3px solid var(--accent);
        }
/* –í —Ä–∞–∑–¥–µ–ª CSS –¥–æ–±–∞–≤—å—Ç–µ */
.task-card.rejected {
    border-left: 3px solid var(--error);
    background: linear-gradient(135deg, var(--card-bg), rgba(239, 68, 68, 0.05));
}

.task-card.rejected:hover {
    border-color: var(--error);
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.2);
}

.rejection-info {
    background: rgba(239, 68, 68, 0.1) !important;
    border: 1px solid rgba(239, 68, 68, 0.3) !important;
    border-radius: 8px;
    padding: 10px;
    margin: 10px 0;
}

.support-btn {
    background: var(--accent) !important;
    color: white !important;
    border: none !important;
    padding: 8px 12px !important;
    border-radius: 6px !important;
    font-size: 12px !important;
    font-weight: 600 !important;
    cursor: pointer !important;
    transition: all 0.3s ease !important;
}

.support-btn:hover {
    background: var(--accent-hover) !important;
    transform: translateY(-1px) !important;
}
        .post-content {
            margin-bottom: 8px;
            white-space: pre-wrap;
        }

        .post-meta {
            font-size: 11px;
            color: var(--text-secondary);
            border-top: 1px solid var(--border);
            padding-top: 8px;
        }

        .admin-badge {
            display: inline-block;
            background: var(--error);
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 9px;
            margin-left: 6px;
            text-transform: uppercase;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω-—á–∞—Ç–æ–≤ */
        .admin-chats-container {
            max-height: 350px;
            overflow-y: auto;
            margin-top: 12px;
        }

        .chat-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: var(--bg-secondary);
            border-radius: 10px;
            margin-bottom: 6px;
            cursor: pointer;
            border: 1px solid var(--border);
        }

        .chat-item.unread {
            border-left: 3px solid var(--error);
        }

        .chat-info-small {
            flex: 1;
        }

        .chat-name-small {
            font-weight: 600;
            font-size: 13px;
        }

        .chat-last-message {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .unread-indicator {
            width: 6px;
            height: 6px;
            background: var(--error);
            border-radius: 50%;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü (–≤–º–µ—Å—Ç–æ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω) */
        .page-header {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }

        .back-button {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 22px;
            margin-right: 10px;
            cursor: pointer;
        }

        .page-title {
            font-size: 20px;
            font-weight: 700;
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–¥–∞–Ω–∏–π */
        .verification-item {
            background: var(--card-bg);
            border-radius: 14px;
            padding: 14px;
            margin-bottom: 10px;
            border: 1px solid var(--border);
        }

        .verification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .verification-user {
            font-weight: 600;
        }

        .verification-task {
            color: var(--text-secondary);
        }

        .verification-image {
            width: 100%;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .verification-actions {
            display: flex;
            gap: 10px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @media (min-width: 768px) {
            .profile-stats {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .referral-stats {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .about-features {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .tasks-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .admin-buttons {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification-error {
            background: var(--error);
        }

        .notification-success {
            background: var(--success);
        }

        .notification-warning {
            background: var(--warning);
        }

        .notification-content {
            flex: 1;
            font-size: 13px;
            font-weight: 500;
        }

        .notification-close {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            padding: 0;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —á–∞—Ç–∞ –∞–¥–º–∏–Ω–∞ */
        .admin-chat-list {
            max-height: 350px;
            overflow-y: auto;
            margin-top: 12px;
        }

        .chat-item:hover {
            background: var(--bg-secondary);
            transform: translateY(-2px);
        }

        .chat-item.unread {
            border-left: 3px solid var(--error);
            background: rgba(239, 68, 68, 0.05);
        }

        .chat-info-small {
            flex: 1;
            min-width: 0;
        }
.action-icon img {
    width: 20px;
    height: 20px;
    object-fit: contain;
  
}
        .chat-name-small {
            font-weight: 600;
            font-size: 13px;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-last-message {
            font-size: 11px;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 180px;
        }

        .chat-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 3px;
            flex-shrink: 0;
        }

        .chat-time {
            font-size: 10px;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .unread-badge {
            background: var(--error);
            color: white;
            border-radius: 8px;
            padding: 2px 5px;
            font-size: 9px;
            font-weight: 600;
            min-width: 16px;
            text-align: center;
        }

        /* –û–∫–Ω–æ —á–∞—Ç–∞ –¥–ª—è –∞–¥–º–∏–Ω–∞ */
        .admin-chat-window {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(5, 5, 16, 0.95);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .admin-chat-window.active {
            opacity: 1;
            pointer-events: all;
        }

        .admin-chat-header {
            background: var(--card-bg);
            padding: 14px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .admin-chat-user {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-chat-messages {
            flex: 1;
            padding: 14px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .admin-chat-input-container {
            padding: 10px 14px;
            background: var(--card-bg);
            border-top: 1px solid var(--border);
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .admin-chat-input {
            flex: 1;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 18px;
            padding: 10px 14px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .admin-chat-send {
            background: var(--accent);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π —Å —Ñ–æ—Ç–æ */
        .message-image {
            margin-bottom: 4px;
        }

        .message-image img {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .message-time {
            font-size: 10px;
            color: var(--text-secondary);
            text-align: right;
            margin-top: 3px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–¥–∞–Ω–∏–π –∞–¥–º–∏–Ω–∞ */
        .admin-task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 6px;
        }

        .admin-task-title {
            font-weight: 600;
            font-size: 14px;
            flex: 1;
        }

        .admin-task-description {
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 6px;
        }

        .admin-task-details {
            display: flex;
            gap: 8px;
            font-size: 11px;
            flex-wrap: wrap;
        }

        .admin-task-price {
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 700;
        }

        .admin-task-category {
            background: var(--bg-secondary);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .admin-task-time {
            color: var(--text-secondary);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –æ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ */
        .screenshot-note {
            margin: 12px 0;
            padding: 8px;
            background: var(--bg-secondary);
            border-radius: 6px;
            border-left: 2px solid var(--warning);
        }

        .screenshot-note p {
            margin: 0;
            font-size: 11px;
            color: var(--text-secondary);
        }
/* üîß –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ –î–õ–Ø –û–ß–ï–ù–¨ –ú–ê–õ–ï–ù–¨–ö–ò–• –≠–ö–†–ê–ù–û–í */
@media (max-width: 480px) {
    .task-card {
        padding: 10px !important;
        margin: 0 0 10px 0 !important;
    }
    
    .task-title {
        font-size: 14px !important;
    }
    
    .task-description {
        font-size: 12px !important;
    }
    
    .task-price {
        font-size: 16px !important;
    }
    
    .task-btn {
        padding: 8px 12px !important;
        font-size: 12px !important;
    }
}


/* üîß –ü–†–ï–î–û–¢–í–†–ê–©–ï–ù–ò–ï –ì–û–†–ò–ó–û–ù–¢–ê–õ–¨–ù–û–ô –ü–†–û–ö–†–£–¢–ö–ò */
html, body {
    max-width: 100% !important;
    overflow-x: hidden !important;
    position: relative;
}



/* üîß –§–ò–ö–° –î–õ–Ø –ö–ù–û–ü–û–ö */
.task-btn {
    white-space: nowrap !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
}

/* üîß –§–ò–ö–° –î–õ–Ø –ú–ï–¢–ê-–ò–ù–§–û–†–ú–ê–¶–ò–ò */
.task-meta {
    flex-wrap: wrap !important;
    gap: 4px !important;
}

.task-category, .task-difficulty {
    font-size: 10px !important;
    padding: 3px 6px !important;
    white-space: nowrap !important;
}




        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ–∫–Ω–∞ —á–∞—Ç–∞ –∞–¥–º–∏–Ω–∞ */
        .admin-chat-header {
            background: var(--card-bg);
            padding: 12px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .admin-chat-user {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .admin-chat-messages {
            flex: 1;
            padding: 12px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .admin-chat-input-container {
            padding: 8px 12px;
            background: var(--card-bg);
            border-top: 1px solid var(--border);
            display: flex;
            gap: 8px;
            align-items: center;
        }



        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ—Å–∫–æ–≤—Å–∫–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –≤ –ø–æ—Å—Ç–∞—Ö */
        .post-date {
            font-size: 11px;
            color: var(--text-secondary);
            opacity: 0.8;
        }

        .post-author {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .admin-badge {
            background: var(--purple-gradient);
            color: white;
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 9px;
            font-weight: 600;
        }

        /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —á–∞—Ç–æ–≤ */
        .chat-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 3px;
            min-width: 50px;
        }



        /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –≤ –ø–æ—Å—Ç–∞—Ö */
        .post-content {
            color: var(--text-primary);
            line-height: 1.5;
            margin-bottom: 10px;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 100%;
        }

        .post-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 6px;
            line-height: 1.3;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .post-item {
            background: var(--card-bg);
            border-radius: 14px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            animation: fadeIn 0.6s ease-out;
            overflow: hidden;
        }

        /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –¥–ª–∏–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ */
        .post-text-container {
            max-height: none;
            overflow: visible;
        }

        /* –ü–ª–∞–≤–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å –∫–Ω–æ–ø–∫–æ–π "–ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ" */
        .post-content.collapsed {
            max-height: 120px;
            overflow: hidden;
            position: relative;
        }

        .post-content.collapsed::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 50px;
            background: linear-gradient(transparent, var(--card-bg));
            pointer-events: none;
        }

        .read-more-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 6px;
            display: inline-block;
        }

        /* üîß –°–¢–ò–õ–ò –î–õ–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ß–ê–¢–ê–ú–ò */
        .chat-tabs {
            display: flex;
            gap: 6px;
            margin-bottom: 12px;
            overflow-x: auto;
            padding-bottom: 4px;
        }

        .chat-tab-btn {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 6px 10px;
            font-size: 11px;
            color: var(--text-secondary);
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
        }

        .chat-tab-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .chat-stats {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
        }

        .chat-item.archived {
            opacity: 0.7;
            background: rgba(100, 100, 100, 0.1);
        }

        .chat-actions {
            display: flex;
            gap: 4px;
            margin-left: 8px;
        }

        .chat-action-btn {
            background: none;
            border: none;
            padding: 4px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 10px;
            transition: all 0.3s ease;
        }

        .chat-delete-btn {
            color: var(--error);
            background: rgba(239, 68, 68, 0.1);
        }

        .chat-delete-btn:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        .chat-archive-btn {
            color: var(--warning);
            background: rgba(245, 158, 11, 0.1);
        }

        .chat-archive-btn:hover {
            background: rgba(245, 158, 11, 0.2);
        }

        .chat-restore-btn {
            color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }

        .chat-restore-btn:hover {
            background: rgba(16, 185, 129, 0.2);
        }

        .archived-badge {
            background: var(--warning);
            color: white;
            border-radius: 4px;
            padding: 1px 3px;
            font-size: 8px;
            margin-left: 4px;
        }


        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–¥–∞–Ω–∏–π */
        .confirmation-modal-content {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            width: 95%;
            max-width: 380px;
            border: 1px solid var(--border);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            text-align: center;
        }

        .confirmation-icon {
            font-size: 56px;
            margin-bottom: 12px;
        }

        .confirmation-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 12px;
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .confirmation-text {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .confirmation-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
        }

        .confirmation-btn {
            flex: 1;
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
        }

        .confirmation-yes {
            background: var(--success);
            color: white;
        }

        .confirmation-no {
            background: var(--error);
            color: white;
        }

        .confirmation-cancel {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ */
        .screenshot-upload {
            margin: 16px 0;
        }

        .screenshot-preview {
            max-width: 100%;
            max-height: 250px;
            border-radius: 10px;
            margin: 12px 0;
            display: none;
        }

        .upload-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 12px;
        }

        .file-input {
            display: none;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–¥–∞–Ω–∏–π –∞–¥–º–∏–Ω–æ–º */
        .verification-list {
            max-height: 450px;
            overflow-y: auto;
            margin-top: 12px;
        }

        .verification-item {
            background: var(--card-bg);
            border-radius: 14px;
            padding: 14px;
            margin-bottom: 10px;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .verification-item:hover {
            background: var(--bg-secondary);
            transform: translateY(-2px);
        }

        .verification-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .verification-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--purple-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            color: white;
            font-weight: 600;
            font-size: 16px;
        }

        .verification-user-info {
            flex: 1;
        }

        .verification-user-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 3px;
        }

        .verification-task-title {
            color: var(--text-secondary);
            font-size: 12px;
        }

        .verification-price {
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 700;
            font-size: 16px;
        }

        .verification-time {
            font-size: 11px;
            color: var(--text-secondary);
            text-align: right;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–¥–∞–Ω–∏—è */
        .verification-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(5, 5, 16, 0.95);
            z-index: 3000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            padding: 16px;
        }

        .verification-modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .verification-modal-content {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            width: 95%;
            max-width: 480px;
            border: 1px solid var(--border);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            max-height: 80vh;
            overflow-y: auto;
        }

        .verification-modal-header {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }

        .verification-modal-user {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .verification-modal-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--purple-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            color: white;
            font-weight: 600;
            font-size: 18px;
        }

        .verification-modal-user-info {
            flex: 1;
        }

        .verification-modal-user-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 3px;
        }

        .verification-modal-task {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .verification-modal-price {
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 700;
            font-size: 20px;
        }

        .verification-modal-screenshot {
            width: 100%;
            border-radius: 10px;
            margin: 16px 0;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .verification-modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 16px;
        }

        .verification-approve {
            background: var(--success);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            flex: 1;
        }

        .verification-reject {
            background: var(--error);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            flex: 1;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π */
        .rejected-task {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .rejected-badge {
            background: var(--error);
            color: white;
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            margin-left: 6px;
        }

        .support-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 6px;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }



        /* –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –¥–∏–∑–∞–π–Ω –ø–æ—Å—Ç–æ–≤ */
        .posts-feed {
            margin-top: 16px;
        }

        .post-item:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .post-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .post-author {
            font-size: 11px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .post-date {
            font-size: 10px;
            color: var(--text-secondary);
            white-space: nowrap;
            margin-left: 8px;
        }

        .post-image {
            width: 100%;
            border-radius: 6px;
            margin: 8px 0;
            max-height: 250px;
            object-fit: cover;
        }

        .post-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 10px;
            border-top: 1px solid var(--border);
        }

        .post-actions {
            display: flex;
            gap: 12px;
        }

        .like-btn, .share-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 3px;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .like-btn:hover, .share-btn:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .loading-posts {
            text-align: center;
            padding: 30px 16px;
            color: var(--text-secondary);
        }

        .loading-spinner {
            font-size: 20px;
            margin-bottom: 10px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }



        .back-button {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 20px;
            margin-right: 10px;
            cursor: pointer;
            padding: 6px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: var(--bg-secondary);
        }



        /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ */
        [data-theme="light"] {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --accent: #6366f1;
            --accent-hover: #4f46e5;
            --card-bg: #ffffff;
            --border: #e2e8f0;
            --shadow: rgba(0, 0, 0, 0.1);
            --nav-bg: rgba(255, 255, 255, 0.95);
            --gold: #d97706;
            --gold-gradient: linear-gradient(135deg, #f59e0b, #d97706);
            --purple-gradient: linear-gradient(135deg, #8b5cf6, #7c3aed);
            --blue-gradient: linear-gradient(135deg, #3b82f6, #2563eb);
            --teal-gradient: linear-gradient(135deg, #0ea5e9, #0369a1);
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
        }

        /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã */
        .theme-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }

        .theme-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .theme-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border);
            transition: .4s;
            border-radius: 28px;
        }

        .theme-slider:before {
            position: absolute;
            content: "üåô";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 3px;
            background-color: var(--accent);
            transition: .4s;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        input:checked + .theme-slider {
            background-color: var(--accent);
        }

        input:checked + .theme-slider:before {
            content: "‚òÄÔ∏è";
            transform: translateX(22px);
        }

        /* –î–ª—è –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ —á–∞—Ç–∞ */
        .admin-chat-messages {
            flex: 1;
            padding: 12px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: calc(100vh - 160px);
        }

        .message-text {
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: pre-wrap;
            line-height: 1.3;
            max-width: 100%;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞ –∞–¥–º–∏–Ω–æ–≤ */
        .admin-admins-list {
            max-height: 350px;
            overflow-y: auto;
            margin-top: 12px;
        }

        .admin-admin-item {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 8px;
            border: 1px solid var(--border);
        }

        .admin-admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .admin-admin-name {
            font-weight: 600;
            font-size: 14px;
        }

        .admin-admin-info {
            color: var(--text-secondary);
            font-size: 12px;
        }

        .admin-admin-actions {
            display: flex;
            gap: 6px;
        }

        /* üîß –§–ò–ö–° –î–õ–Ø –í–ö–õ–ê–î–ö–ò –ó–ê–î–ê–ù–ò–ô - –£–°–¢–†–ê–ù–ï–ù–ò–ï –°–ú–ï–©–ï–ù–ò–Ø –ë–õ–û–ö–û–í */
        .tasks-tab {
            min-height: 400px;
            position: relative;
        }
        /* –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∑–∞–¥–∞–Ω–∏–π */
        .tasks-grid {
            display: block !important;
            width: 100% !important;
            opacity: 1 !important;
            visibility: visible !important;
        }


        /* –£–±–∏—Ä–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ tasks-tab */
        .tasks-tab .fade-in {
            animation: none !important;
            opacity: 1 !important;
        }

        /* –§–∏–∫—Å –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
        .filters-container {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            overflow-x: auto;
            padding-bottom: 3px;
            flex-wrap: nowrap;
            position: relative;
            z-index: 1;
        }

        /* –§–∏–∫—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ */
        .search-container {
            margin-bottom: 16px;
            position: relative;
            z-index: 1;
        }

        /* –£–±–∏—Ä–∞–µ–º –∑–∞–¥–µ—Ä–∂–∫–∏ –∞–Ω–∏–º–∞—Ü–∏–∏ */
        .task-card[style*="animation-delay"] {
            animation-delay: 0s !important;
        }

        /* –§–∏–∫—Å –¥–ª—è –≤–∫–ª–∞–¥–æ–∫ –∑–∞–¥–∞–Ω–∏–π */
        .tasks-tabs {
            display: flex;
            margin-bottom: 16px;
            background: var(--card-bg);
            border-radius: 14px;
            padding: 6px;
            border: 1px solid var(--border);
            overflow-x: auto;
            white-space: nowrap;
            position: relative;
            z-index: 2;
        }

        /* –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—Ç—Å—è */
        #new-tasks,
        #confirmation-tasks,
        #completed-tasks,
        #rejected-tasks {
            position: relative;
            min-height: 250px;
            transform: none !important;
            transition: none !important;
            animation: none !important;
            height: auto;
            min-height: auto;
        }

        /* –§–∏–∫—Å –¥–ª—è –ø—É—Å—Ç–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è */
        .no-tasks {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            width: 100%;
        }

        /* –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ */
        .tasks-tab > div[id$="-tasks"] {
            display: none !important;
            opacity: 0 !important;
            transition: opacity 0.3s ease !important;
        }

        .tasks-tab > div[id$="-tasks"].active {
            display: block !important;
            opacity: 1 !important;
        }

        /* –£–±–∏—Ä–∞–µ–º –ª—é–±—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ */
        .tasks-tab {
            overflow: visible !important;
        }


        /* –°—Ç–∏–ª—å –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loading-spinner {
            font-size: 28px;
            margin-bottom: 12px;
            animation: spin 1s linear infinite;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è */
        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 13px;
        }

        .form-row {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

   

        .image-upload-area:hover {
            border-color: var(--accent);
            background: rgba(99, 102, 241, 0.05);
        }

        .upload-placeholder {
            color: var(--text-secondary);
            pointer-events: none;
        }

     

        /* –ö–Ω–æ–ø–∫–∏ —Ñ–æ—Ä–º—ã */
        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border);
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: var(--card-bg);
            border-color: var(--accent);
        }








.task-availability {
    position: absolute;
    top: 10px;
    right: 10px;
    background: var(--accent);
    color: white;
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 10px;
    font-weight: 600;
    z-index: 2;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}
.task-status {
    font-size: 12px;
    font-weight: 600;
    padding: 6px 10px;
    border-radius: 8px;
    display: inline-flex;
    align-items: center;
    gap: 4px;
}

.task-status.completed {
    background: rgba(16, 185, 129, 0.15);
    color: #10b981;
    border: 1px solid rgba(16, 185, 129, 0.3);
}

.task-status.rejected {
    background: rgba(239, 68, 68, 0.15);
    color: #ef4444;
    border: 1px solid rgba(239, 68, 68, 0.3);
}

/* üîß –°–¢–ò–õ–ò –î–õ–Ø –§–ò–õ–¨–¢–†–û–í –ö–ê–¢–ï–ì–û–†–ò–ô */
.filters-container {
    display: flex;
    gap: 8px;
    margin-bottom: 16px;
    overflow-x: auto;
    padding-bottom: 4px;
    scrollbar-width: thin;
    scrollbar-color: var(--accent) var(--bg-secondary);
}

.filters-container::-webkit-scrollbar {
    height: 4px;
}

.filters-container::-webkit-scrollbar-track {
    background: var(--bg-secondary);
    border-radius: 2px;
}

.filters-container::-webkit-scrollbar-thumb {
    background: var(--accent);
    border-radius: 2px;
}

.filter-btn {
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 8px 12px;
    font-size: 12px;
    color: var(--text-secondary);
    cursor: pointer;
    white-space: nowrap;
    transition: all 0.3s ease;
    flex-shrink: 0;
}

.filter-btn:hover {
    border-color: var(--accent);
    color: var(--text-primary);
    transform: translateY(-1px);
}

.filter-btn.active {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∏–ª—å—Ç—Ä–∞—Ö */
#filter-info {
    margin: 10px 0;
    padding: 12px;
    background: var(--bg-secondary);
    border-radius: 10px;
    font-size: 14px;
    color: var(--text-secondary);
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-left: 3px solid var(--accent);
}


    </style>
</head>
<body>

<!-- –ó–ê–ú–ï–ù–ò–¢–¨ —ç—Ç–æ—Ç –±–ª–æ–∫ -->
<header class="header fade-in">
    <div class="logo" onclick="showMainTab()">
        <div class="logo-text">LinkGold</div>
    </div>
    <div class="slogan">–ú–æ–Ω–µ—Ç–∏–∑–∏—Ä—É–π—Ç–µ –≤–∞—à—É –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div>
</header>

<main class="main-content">
    <!-- –í–∫–ª–∞–¥–∫–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <div id="main-tab" class="tab-content active">
        <!-- –ì–µ—Ä–æ–π –±–∞–Ω–Ω–µ—Ä —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º -->
        <div class="hero-banner fade-in">
            <img src="IMG_4397.png" alt="LinkGold" style="width: 100%; height: 100%; object-fit: cover;">
        </div>

        <!-- –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –±–ª–æ–∫–∏ -->
        <div class="stats-grid fade-in">
            <div class="stat-card balance-card" onclick="showBalanceModal()">
                <div class="stat-icon">
                    <div class="video-container">
                        <img src="curved-stack-money-icon-3d-illustration.png" alt="–ë–∞–ª–∞–Ω—Å" style="width: 100%; height: 100%; object-fit: contain; ">
                    </div>
                </div>
                <div class="stat-label">–ë–∞–ª–∞–Ω—Å</div>
                <div class="stat-value" id="user-balance-main">0 ‚≠ê</div>
            </div>
            
            <div class="stat-card support-card" onclick="openAdminChat()">
                <div class="stat-icon">
                    <div class="video-container">
                        <img src="3d-rendering-ruk-dausih-biznes-koncepciu-udara-kul-no-bg-preview (carve.photos).png" alt="–ü–æ–¥–¥–µ—Ä–∂–∫–∞" style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                </div>
                <div class="stat-label">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</div>
                <div class="stat-value">24/7</div>
            </div>
        </div>

        <!-- –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç -->
        <div class="exchange-card fade-in" onclick="showHowItWorksPage()">
            <div class="exchange-icon">
                <div class="video-container">
                    <img src="m003t0593_a_bag_with_hand_31aug22-edited-free (carve.photos).png" alt="–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç" style="width: 100%; height: 100%; object-fit: contain;">
                </div>
            </div>
            <div class="exchange-title">–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç</div>
            <div class="exchange-text">–û –∑–∞—Ä–∞–±–æ—Ç–∫–µ –∏ –≤—ã–≤–æ–¥–µ —Å—Ä–µ–¥—Å—Ç–≤</div>
        </div>

        <!-- –†–∞–∑–º–µ—â–µ–Ω–∏–µ –ø–æ—Å—Ç–∞ -->
        <div class="post-promo fade-in">
            <div class="post-icon">
                <div class="video-container video-large">
                    <img src="m011t0430_a_clipboard_30aug22-edited-free (carve.photos).png" alt="–†–∞–∑–º–µ—Å—Ç–∏—Ç—å –ø–æ—Å—Ç" style="width: 100%; height: 100%; object-fit: contain;">
                </div>
            </div>
            <div class="post-title">–†–∞–∑–º–µ—Å—Ç–∏—Ç–µ –ø–æ—Å—Ç</div>
            <div class="post-description">–†–µ–∫–ª–∞–º–∏—Ä—É–π—Ç–µ –≤ –Ω–∞—à–µ–º –∫–∞–Ω–∞–ª–µ –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –æ—Ö–≤–∞—Ç –∞—É–¥–∏—Ç–æ—Ä–∏–∏</div>
            <button class="btn btn-primary btn-full" onclick="showPrices()">–†–∞–∑–º–µ—Å—Ç–∏—Ç—å</button>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –∑–∞–¥–∞–Ω–∏—è–º -->
        <div class="tasks-button-container fade-in">
            <button class="tasks-btn" onclick="showTasksTab()">
                –°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è
            </button>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –ø–æ—Å—Ç–æ–≤ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π -->
        <div id="posts-section" class="fade-in" style="display: none; margin-top: 20px;">
            <div class="posts-header">
                <h2 style="color: var(--text-primary); margin-bottom: 25px; text-align: center; font-size: 24px;">üì¢ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏</h2>
            </div>
            <div id="posts-container">
                <!-- –ü–æ—Å—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
            </div>
        </div>


            
            <!-- –ß–∞—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ -->
            <div id="admin-chats-container" class="admin-chats-container" style="display: none;">
                <button class="chat-photo-btn" onclick="sendPhotoToAdmin()" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ">üì∑</button>
                <!-- –ß–∞—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            



            <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞–Ω–∏–π -->
            <div id="task-verification" class="admin-form" style="display: none;">
                <h3>–ó–∞–¥–∞–Ω–∏—è –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</h3>
                <div id="verification-list">
                    <!-- –ó–∞–¥–∞–Ω–∏—è –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>

        <!-- –õ–µ–Ω—Ç–∞ –ø–æ—Å—Ç–æ–≤ -->
        <div id="posts-section" class="card fade-in" style="display: none;">
            <div class="posts-header">
                <h2>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ—Å—Ç—ã</h2>
                <button onclick="loadPosts()" class="refresh-btn">–û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>
            <div id="posts-container">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–æ–≤...</div>
            </div>
        </div>
    </div>
    
    <div id="tasks-tab" class="tab-content tasks-tab">
    <div class="tasks-tabs">
        <div class="task-tab active" onclick="showTaskCategory('new')">–ù–æ–≤—ã–µ</div>
        <div class="task-tab" onclick="showTaskCategory('confirmation')">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</div>
        <div class="task-tab" onclick="showTaskCategory('completed')">–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ</div>
        <div class="task-tab" onclick="showTaskCategory('rejected')">–û—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ</div>
    </div>
        
        <div class="search-container fade-in">
            <div class="search-icon"></div>
            <input type="text" class="search-input" id="task-search" placeholder="–ü–æ–∏—Å–∫ –∑–∞–¥–∞–Ω–∏–π...">
        </div>
        
        <div class="filters-container fade-in">
    <button class="filter-btn active" data-filter="all" onclick="filterTasks('all')">–í—Å–µ</button>
    <button class="filter-btn" data-filter="social" onclick="filterTasks('social')">–°–æ—Ü—Å–µ—Ç–∏</button>
    <button class="filter-btn" data-filter="subscribe" onclick="filterTasks('subscribe')">–ü–æ–¥–ø–∏—Å–∫–∏</button>
    <button class="filter-btn" data-filter="view" onclick="filterTasks('view')">–ü—Ä–æ—Å–º–æ—Ç—Ä—ã</button>
    <button class="filter-btn" data-filter="comment" onclick="filterTasks('comment')">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</button>
    <button class="filter-btn" data-filter="repost" onclick="filterTasks('repost')">–†–µ–ø–æ—Å—Ç—ã</button>
</div>

        
          <!-- –ù–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è -->
    <div id="new-tasks" class="tasks-grid active" style="display: block;">
        <!-- –ó–∞–¥–∞–Ω–∏—è –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
    </div>
    
    <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –î–û–õ–ñ–ù–´ –±—ã—Ç—å —Å–∫—Ä—ã—Ç—ã -->
    <div id="confirmation-tasks" class="tasks-grid" style="display: none;">
        <!-- ... -->
    </div>
    
    <div id="completed-tasks" class="tasks-grid" style="display: none;">
        <!-- ... -->
    </div>

    <div id="rejected-tasks" class="tasks-grid" style="display: none;">
        <!-- ... -->
    </div>
</div> <!-- –ó–∞–∫—Ä—ã—Ç–∏–µ tasks-tab -->
    
    <!-- –í–∫–ª–∞–¥–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
    <div id="profile-tab" class="tab-content">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–æ—Ñ–∏–ª—è -->
        <div class="profile-header fade-in">
            <div class="profile-avatar">
                <img id="user-photo" src="" alt="–§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è" style="width: 100%; height: 100%; object-fit: cover;">
            </div>
            <div class="profile-info">
                <div class="profile-name" id="user-first-name">–ò–º—è</div>
                <div class="profile-id">TG: @<span id="user-username">username</span></div>
                <div class="profile-level">–£—Ä–æ–≤–µ–Ω—å <span id="user-level">0</span></div>
            </div>
        </div>
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
        <div class="profile-stats fade-in">
            <div class="profile-stat">
                <div class="stat-value">0 ‚≠ê</div>
                <div class="stat-label">–ë–∞–ª–∞–Ω—Å</div>
            </div>
            <div class="profile-stat">
                <div class="stat-value">0</div>
                <div class="stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
            </div>
            <div class="profile-stat">
                <div class="stat-value">0</div>
                <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
            </div>
            <div class="profile-stat">
                <div class="stat-value">0%</div>
                <div class="stat-label">–ö–∞—á–µ—Å—Ç–≤–æ</div>
            </div>
        </div>
        
        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å —É—Ä–æ–≤–Ω—è -->
        <div class="level-progress fade-in">
            <div class="level-title">
                <span class="level-name">–ü—Ä–æ–≥—Ä–µ—Å—Å —É—Ä–æ–≤–Ω—è</span>
                <span class="level-count">–°–∫–æ—Ä–æ...</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="level-progress-bar"></div>
            </div>
            <div class="level-info">
                –°–∫–æ—Ä–æ...
            </div>
        </div>
        
        <!-- –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ -->
<!-- –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –°–ò–°–¢–ï–ú–ê -->
<div class="referral-system fade-in">
    <div class="referral-title">–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</div>
    
    <div class="referral-code">
        <div class="referral-label">–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞</div>
        <input type="text" id="referral-link" readonly style="width: 100%; padding: 8px; margin: 8px 0; background: var(--bg-primary); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); text-align: center;">
        <button class="copy-btn" onclick="copyReferralLink()">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
    </div>
    
    <div class="referral-stats">
        <div class="referral-stat">
            <div class="referral-value" id="ref-invited">0</div>
            <div class="referral-label">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ</div>
        </div>
        <div class="referral-stat">
            <div class="referral-value" id="ref-earned">0 ‚≠ê</div>
            <div class="referral-label">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
        </div>
    </div>
    
    <div class="referral-info">
        üéÅ <strong>–ù–æ–≤–∞—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞:</strong><br>
        ‚Ä¢ –í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ <strong>10%</strong> –æ—Ç –∑–∞—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö<br>
        ‚Ä¢ –ü—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–π –ø–æ–ª—É—á–∞–µ—Ç <strong>90%</strong> –æ—Ç —Å–≤–æ–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∫–∞<br>
        ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å –∫–∞–∂–¥–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è<br><br>
        üîó –ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –¥—Ä—É–≥—É —ç—Ç—É —Å—Å—ã–ª–∫—É –≤ Telegram
    </div>
</div>
        <!-- –í —Å–µ–∫—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ—Å–ª–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã -->
<div class="referral-system fade-in">
    <div class="referral-title">üé´ –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞</div>
    
    <div class="referral-code">
        <div class="referral-label">–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–æ–Ω—É—Å–∞</div>
        <input type="text" id="promocode-input" 
               style="width: 100%; padding: 12px; margin: 8px 0; background: var(--bg-primary); 
                      border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); 
                      text-align: center; text-transform: uppercase;"
               placeholder="–í–í–ï–î–ò–¢–ï –ü–†–û–ú–û–ö–û–î" maxlength="20">
        <button class="copy-btn" onclick="activatePromoCode()">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</button>
    </div>
    
    <div id="promocode-message" style="margin-top: 10px; min-height: 20px; font-size: 14px;"></div>
</div>


        <!-- –í —Ä–∞–∑–¥–µ–ª–µ –ø—Ä–æ—Ñ–∏–ª—è -->
<div class="profile-actions">
    <div class="profile-action" onclick="showWithdrawPage()">
        <div class="action-icon">
            <img src="–°–Ω–∏–º–æ–∫ —ç–∫—Ä–∞–Ω–∞ 2025-11-01 203523-Photoroom.png" alt="–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤" style="width: 20px; height: 20px;">
        </div>
        <div class="action-text">–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</div>
        <div class="action-arrow">‚Ä∫</div>
    </div>
    <div class="profile-action" onclick="showHowItWorksPage()">
        <div class="action-icon">
            <img src="–°–Ω–∏–º–æ–∫ —ç–∫—Ä–∞–Ω–∞ 2025-11-01 204653-Photoroom.png" alt="–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç" style="width: 20px; height: 20px;">
        </div>
        <div class="action-text">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</div>
        <div class="action-arrow">‚Ä∫</div>
    </div>
    <div class="profile-action" onclick="showAboutPage()">
        <div class="action-icon">
            <img src="–°–Ω–∏–º–æ–∫ —ç–∫—Ä–∞–Ω–∞ 2025-11-01 204727-Photoroom.png" alt="–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏" style="width: 20px; height: 20px;">
        </div>
        <div class="action-text">–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</div>
        <div class="action-arrow">‚Ä∫</div>
    </div>
</div>


        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div class="profile-section fade-in">
            <div class="section-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
            <div class="profile-actions">
              <div class="profile-action" onclick="openAdminChat()">
        <div class="action-icon">
            <img src="–°–Ω–∏–º–æ–∫ —ç–∫—Ä–∞–Ω–∞ 2025-11-01 204806-Photoroom.png" alt="–ü–æ–¥–¥–µ—Ä–∂–∫–∞" style="width: 20px; height: 20px;">
        </div>
        <div class="action-text">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</div>
        <div class="action-arrow">‚Ä∫</div>
    </div>
</div>
        </div>
    </div>


  <div id="admin-tab" class="tab-content">
    <div class="page-header">
        <button class="back-button" onclick="showMainTab()">‚Üê</button>
        <div class="page-title">–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</div>
    </div>


<div class="admin-buttons">
    <button class="admin-btn" onclick="showAdminSection('posts')">üìù –ü–æ—Å—Ç—ã</button>
    <button class="admin-btn" onclick="showAdminSection('tasks')">üìã –ó–∞–¥–∞–Ω–∏—è</button>
    <button class="admin-btn" onclick="showAdminVerificationSection()">‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞</button>
    <button class="admin-btn" onclick="showAdminSection('support')">üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
    <button class="admin-btn" onclick="showAdminSection('payments')">üí≥ –û–ø–ª–∞—Ç—ã</button>
    <button class="admin-btn" onclick="showAdminSection('admins')">üë• –ê–¥–º–∏–Ω—ã</button>
    <button class="admin-btn" onclick="showAdminSection('promocodes')">üé´ –ü—Ä–æ–º–æ–∫–æ–¥—ã</button>
<button class="admin-btn" onclick="showAdminSection('links')">üîó –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å—Å—ã–ª–æ–∫</button>

</div>

<!-- –°–µ–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ —Å—Å—ã–ª–æ–∫ -->
<!-- –°–µ–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ —Å—Å—ã–ª–æ–∫ -->
<div id="admin-links-section" class="admin-section" style="display: none;">
    <div class="admin-form">
        <h3>üîó –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å—Å—ã–ª–æ–∫</h3>
        
        <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏ -->
        <div class="form-group">
            <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ *</label>
            <input type="text" class="admin-input" id="link-name" 
                   placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –†–µ–∫–ª–∞–º–Ω–∞—è –∫–∞–º–ø–∞–Ω–∏—è –Ω–æ—è–±—Ä—å" maxlength="50">
        </div>
        
        <div class="form-group">
            <label>–û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
            <textarea class="admin-textarea" id="link-description" 
                      placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ü–µ–ª–∏ —Å—Å—ã–ª–∫–∏..." rows="2"></textarea>
        </div>

        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∞) -->
        <div id="link-access-control" style="display: none;">
            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="allow-admins-links">
                    –†–∞–∑—Ä–µ—à–∏—Ç—å –Ω–∞–Ω—è—Ç—ã–º –∞–¥–º–∏–Ω–∞–º —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å—Å—ã–ª–∫–∏
                </label>
            </div>
        </div>

        <button class="admin-submit" onclick="createReferralLink()" id="create-link-btn">
            üîó –°–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É
        </button>
        
        <div id="link-form-message" style="margin-top: 12px; min-height: 20px; font-size: 14px;"></div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ -->
    <div style="margin-top: 25px;">
        <h4>üìã –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏</h4>
        <div id="links-list" class="admin-task-list">
            <!-- –°—Å—ã–ª–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
        </div>
    </div>
</div>
<!-- –°–µ–∫—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞–º–∏ -->
<div id="admin-admins-section" class="admin-section" style="display: none;">
    <div class="admin-form">
        <h3>üë• –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤</h3>
        <p style="color: var(--text-secondary); margin-bottom: 16px; font-size: 14px;">
            <strong>–¢–æ–ª—å–∫–æ –≥–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (ID: 8036875641) –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –¥—Ä—É–≥–∏—Ö –∞–¥–º–∏–Ω–æ–≤</strong>
        </p>
        
        <div style="background: var(--bg-secondary); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
            <h4 style="color: var(--gold); margin-bottom: 10px;">üí° –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:</h4>
            <ol style="color: var(--text-secondary); font-size: 14px; padding-left: 20px;">
                <li>–ü–æ–ø—Ä–æ—Å–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞–ø–∏—Å–∞—Ç—å –±–æ—Ç—É: <strong>@LinkGoldMoney_bot</strong></li>
                <li>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É <strong>/start</strong></li>
                <li>–£–∑–Ω–∞–π—Ç–µ –µ–≥–æ Telegram username (–Ω–∞–ø—Ä–∏–º–µ—Ä: <strong>@username</strong>)</li>
                <li>–í–≤–µ–¥–∏—Ç–µ username –Ω–∏–∂–µ –±–µ–∑ —Å–∏–º–≤–æ–ª–∞ @</li>
            </ol>
            <div style="margin-top: 10px; padding: 10px; background: rgba(255,215,0,0.1); border-radius: 8px;">
                <strong>–ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö username:</strong>
                <div style="font-size: 12px; margin-top: 5px;">
                    ‚Ä¢ ivanpetrov (–±–µ–∑ @)<br>
                    ‚Ä¢ maria_ivanova (–±–µ–∑ @)<br>
                    ‚Ä¢ alexsmith123 (–±–µ–∑ @)
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label>Telegram username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è *</label>
            <input type="text" class="admin-input" id="new-admin-username" 
                   placeholder="–í–≤–µ–¥–∏—Ç–µ username –±–µ–∑ @ (–Ω–∞–ø—Ä–∏–º–µ—Ä: ivanpetrov)"
                   style="text-align: center; font-weight: 600;">
            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">
                –¢–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –±–æ—Ç–µ @LinkGoldMoney_bot
            </div>
        </div>
        
        <button class="admin-submit" onclick="addNewAdmin()" id="add-admin-btn">
            ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        </button>
        
        <div id="admin-form-message" style="margin-top: 12px; min-height: 20px; font-size: 14px;"></div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ —Ç–µ–∫—É—â–∏—Ö –∞–¥–º–∏–Ω–æ–≤ -->
    <div style="margin-top: 25px;">
        <h4>üìã –¢–µ–∫—É—â–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã</h4>
        <div id="admins-list" class="admin-task-list">
            <!-- –°–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–æ–≤ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –∑–¥–µ—Å—å -->
        </div>
    </div>
</div>

<!-- –°–µ–∫—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞–º–∏ -->
<div id="admin-promocodes-section" class="admin-section" style="display: none;">
    <div class="admin-form">
        <h3>üé´ –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</h3>
        
        <div class="form-group">
            <label for="promocode-code">–ö–æ–¥ –ø—Ä–æ–º–æ–∫–æ–¥–∞ *</label>
            <input type="text" id="promocode-code" class="admin-input" 
                   placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: WELCOME100" maxlength="20">
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="promocode-max-uses">–ú–∞–∫—Å. –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π *</label>
                <input type="number" id="promocode-max-uses" class="admin-input" 
                       value="10" min="1" max="10000">
            </div>
            
            <div class="form-group">
                <label for="promocode-reward">–ù–∞–≥—Ä–∞–¥–∞ (–∑–≤–µ–∑–¥—ã) *</label>
                <input type="number" id="promocode-reward" class="admin-input" 
                       value="50" min="1" max="100000" step="1">
            </div>
        </div>
        
        <div class="form-group">
            <label for="promocode-expires">–î–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
            <input type="datetime-local" id="promocode-expires" class="admin-input">
        </div>
        
        <div id="promocode-form-message" style="margin: 10px 0; min-height: 20px;"></div>
        
        <button id="create-promocode-btn" class="admin-submit" onclick="createPromoCode()">
            üé´ –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥
        </button>
    </div>
    
    <div class="admin-tasks-list" id="promocodes-list">
        <!-- –°–ø–∏—Å–æ–∫ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
    </div>
</div>
  

        
   
        

        

<!-- –°–µ–∫—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã–ø–ª–∞—Ç–∞–º–∏ -->
<div id="admin-payments-section" class="admin-section" style="display: none;">
    <div class="admin-form">
        <h3>üí≥ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–ø–ª–∞—Ç–∞–º–∏</h3>
        
        <!-- –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div style="margin-bottom: 15px; padding: 10px; background: var(--bg-secondary); border-radius: 10px;">
            <div style="display: flex; justify-content: space-between; font-size: 12px;">
                <span>–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞—è–≤–∫–∏: <strong id="active-withdrawals-count">0</strong></span>
                <span>–í—Å–µ–≥–æ: <strong id="total-withdrawals-count">0</strong></span>
            </div>
            <!-- –î–æ–±–∞–≤—å—Ç–µ —ç—Ç—É –∫–Ω–æ–ø–∫—É —Ä—è–¥–æ–º —Å –¥—Ä—É–≥–∏–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã–ø–ª–∞—Ç–∞–º–∏ -->
<button class="btn btn-warning" onclick="showCancelledWithdrawals()" style="margin: 10px 0;">
    üìã –ò—Å—Ç–æ—Ä–∏—è –æ—Ç–º–µ–Ω–µ–Ω–Ω—ã—Ö –≤—ã–ø–ª–∞—Ç
</button>
            <div style="margin-top: 8px;">
                <button class="btn btn-primary" onclick="loadWithdrawalRequests()" style="padding: 6px 12px; font-size: 12px;">
                    üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                </button>
                <button class="btn btn-warning" onclick="createTestWithdrawal()" style="padding: 6px 12px; font-size: 12px; margin-left: 8px;">
                    üß™ –¢–µ—Å—Ç
                </button>
            </div>
        </div>
        
        <!-- –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ -->
        <div id="withdrawal-requests-list">
            <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                <div style="font-size: 48px; margin-bottom: 16px;">üí´</div>
                <div>–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞—è–≤–æ–∫...</div>
            </div>
        </div>
    </div>
</div>
<div id="admin-posts-section" class="admin-section" style="display: none;">
    <div class="admin-form">
        <h3>üìù –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø–æ—Å—Ç</h3>
        <input type="text" class="admin-input" id="admin-post-title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å—Ç–∞">
        <textarea class="admin-textarea" id="admin-post-content" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞..."></textarea>
        <button class="admin-submit" onclick="addNewPost()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
    </div>
    
    <div style="margin-top: 25px;">
        <h3>üìã –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ—Å—Ç—ã</h3>
        <div id="admin-posts-list">
            <!-- –ü–æ—Å—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
        </div>
    </div>
</div>


            <!-- –°–µ–∫—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è–º–∏ –≤ –∞–¥–º–∏–Ω–∫–µ -->
    <div id="admin-tasks-section" class="admin-section" style="display: none;">
        <div class="admin-form">
            <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ</h3>
            
            <!-- –ü–æ–∏—Å–∫–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∑–∞–¥–∞–Ω–∏–π -->
            <div class="admin-search-container">
                <div class="admin-search-icon">üîç</div>
                <input type="text" class="admin-search-input" id="admin-task-search" 
                       placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –æ–ø–∏—Å–∞–Ω–∏—é –∏–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏...">
                <button class="admin-search-clear" onclick="clearAdminTaskSearch()" style="display: none;">√ó</button>
            </div>
            <div class="admin-search-results" id="admin-search-results">
                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
            </div>

            <!-- –û—Å—Ç–∞–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è -->
            <div class="form-group">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è *</label>
                <input type="text" class="admin-input" id="admin-task-title" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è">
            </div>
        
        <div class="form-group">
            <label>–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è *</label>
            <textarea class="admin-textarea" id="admin-task-description" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è" rows="4"></textarea>
        </div>
        
        <div class="form-row">
            <div class="form-group" style="flex: 1;">
                <label>–¶–µ–Ω–∞ (–≤ –∑–≤–µ–∑–¥–∞—Ö) *</label>
                <input type="number" class="admin-input" id="admin-task-price" placeholder="50">
            </div>
            <div class="form-group" style="flex: 1;">
                <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                <select class="admin-input" id="admin-task-category">
                    <option value="subscribe">üì± –ü–æ–¥–ø–∏—Å–∫–∏</option>
                    <option value="view">üëÄ –ü—Ä–æ—Å–º–æ—Ç—Ä—ã</option>
                    <option value="comment">üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</option>
                    <option value="repost">üîÑ –†–µ–ø–æ—Å—Ç—ã</option>
                    <option value="social">üë• –°–æ—Ü—Å–µ—Ç–∏</option>
                    <option value="other">üìã –î—Ä—É–≥–æ–µ</option>
                </select>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group" style="flex: 1;">
                <label>–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</label>
                <input type="text" class="admin-input" id="admin-task-time" placeholder="5-10 –º–∏–Ω—É—Ç">
            </div>
            <div class="form-group" style="flex: 1;">
                <label>–°–ª–æ–∂–Ω–æ—Å—Ç—å</label>
                <select class="admin-input" id="admin-task-difficulty">
                    <option value="–õ–µ–≥–∫–∞—è">üü¢ –õ–µ–≥–∫–∞—è</option>
                    <option value="–°—Ä–µ–¥–Ω—è—è">üü° –°—Ä–µ–¥–Ω—è—è</option>
                    <option value="–°–ª–æ–∂–Ω–∞—è">üî¥ –°–ª–æ–∂–Ω–∞—è</option>
                </select>
            </div>
        </div>
        
        <div class="form-group">
            <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π</label>
            <input type="number" class="admin-input" id="admin-task-people" placeholder="10" value="10">
        </div>
        
        <div class="form-group">
            <label>–°—Å—ã–ª–∫–∞ –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
            <input type="url" class="admin-input" id="admin-task-url" placeholder="https://...">
        </div>


        
            <button class="admin-submit" onclick="addTaskWithImage()">
                ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ
            </button>
        </div>
        
        <!-- –°–ø–∏—Å–æ–∫ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π -->
        <div id="admin-tasks-list-container" style="margin-top: 30px;">
            <h3>üìã –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</h3>
            <div id="admin-tasks-list">
                <!-- –ó–∞–¥–∞–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
            </div>
        </div>
    </div>
            <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞–Ω–∏–π -->
            <div id="admin-verification-section" class="admin-section" style="display: none;">
                <h3>–ó–∞–¥–∞–Ω–∏—è –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</h3>
                <div id="admin-verification-list">
                    <!-- –ó–∞–¥–∞–Ω–∏—è –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>

            <!-- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ -->
            <div id="admin-support-section" class="admin-section" style="display: none;">
                <h3>üí¨ –ß–∞—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h3>
                
                <!-- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –∏ –∞—Ä—Ö–∏–≤–Ω—ã–º–∏ —á–∞—Ç–∞–º–∏ -->
                <div class="chat-tabs" style="margin-bottom: 15px;">
                    <button class="chat-tab-btn active" onclick="showChatTab('active')">–ê–∫—Ç–∏–≤–Ω—ã–µ —á–∞—Ç—ã</button>
                    <button class="chat-tab-btn" onclick="showChatTab('archived')">–ê—Ä—Ö–∏–≤–Ω—ã–µ —á–∞—Ç—ã</button>
                    <button class="chat-tab-btn" onclick="showChatTab('all')">–í—Å–µ —á–∞—Ç—ã</button>
                </div>
                
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–∞—Ç–æ–≤ -->
                <div class="chat-stats" style="margin-bottom: 15px; padding: 10px; background: var(--bg-secondary); border-radius: 10px;">
                    <div style="display: flex; justify-content: space-between; font-size: 12px;">
                        <span>–ê–∫—Ç–∏–≤–Ω—ã–µ: <strong id="active-chats-count">0</strong></span>
                        <span>–ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ: <strong id="unread-chats-count">0</strong></span>
                        <span>–í—Å–µ–≥–æ: <strong id="total-chats-count">0</strong></span>
                    </div>
                </div>
                
                <!-- –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤ -->
                <div id="active-chats-list" class="admin-chat-list">
                    <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ —á–∞—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
                </div>
                
                <!-- –°–ø–∏—Å–æ–∫ –∞—Ä—Ö–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤ -->
                <div id="archived-chats-list" class="admin-chat-list" style="display: none;">
                    <!-- –ê—Ä—Ö–∏–≤–Ω—ã–µ —á–∞—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
                </div>
                
                <!-- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —á–∞—Ç–æ–≤ -->
                <div id="all-chats-list" class="admin-chat-list" style="display: none;">
                    <!-- –í—Å–µ —á–∞—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
                </div>
            </div>
        </div>
        
    </div>
 
    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ "–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç" -->
    <div id="how-it-works-page" class="page">
        <div class="page-header">
            <button class="back-button" onclick="showProfileTab()">‚Üê</button>
            <div class="page-title">–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç LinkGold</div>
        </div>

        <div class="card">
            <p class="about-text">LinkGold ‚Äî —ç—Ç–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∑–∞—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–¥–∞–Ω–∏–π –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö.</p>
            
            <p class="about-text">–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã:</p>
            <ul class="about-text" style="padding-left: 20px; margin-bottom: 16px;">
                <li><strong>–í—ã–±–∏—Ä–∞–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è</strong> –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö </li>
                <li><strong>–í—ã–ø–æ–ª–Ω—è–π—Ç–µ</strong> –∏—Ö —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</li>
                <li><strong>–ü–æ–ª—É—á–∞–π—Ç–µ –æ–ø–ª–∞—Ç—É</strong>–ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ </li>
                <li><strong>–í—ã–≤–æ–¥–∏—Ç–µ —Å—Ä–µ–¥—Å—Ç–≤–∞</strong></li>
            </ul>
            
            <p class="about-text">–í–∏–¥—ã –∑–∞–¥–∞–Ω–∏–π:</p>
            <ul class="about-text" style="padding-left: 20px; margin-bottom: 16px;">
                <li>–ü–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª—ã –∏ –∞–∫–∫–∞—É–Ω—Ç—ã</li>
                <li>–ü—Ä–æ—Å–º–æ—Ç—Ä—ã –∏ –ª–∞–π–∫–∏</li>
                <li>–†–µ–ø–æ—Å—Ç—ã –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</li>
                <li>–£—á–∞—Å—Ç–∏–µ –≤ –æ–ø—Ä–æ—Å–∞—Ö</li>
                <li>–ò –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ</li>
            </ul>

            <div class="about-features">
                <div class="about-feature">
                    <div class="feature-icon">üöÄ</div>
                    <div class="feature-text">–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç</div>
                </div>
                <div class="about-feature">
                    <div class="feature-icon">üíé</div>
                    <div class="feature-text">–ß–µ—Å—Ç–Ω—ã–µ —É—Å–ª–æ–≤–∏—è</div>
                </div>
                <div class="about-feature">
                    <div class="feature-icon">üõ°Ô∏è</div>
                    <div class="feature-text">–ù–∞–¥–µ–∂–Ω–∞—è –∑–∞—â–∏—Ç–∞</div>
                </div>
                <div class="about-feature">
                    <div class="feature-icon">üìà</div>
                    <div class="feature-text">–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π —Ä–æ—Å—Ç</div>
                </div>
            </div>
        </div>
    </div>

    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ "–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏" -->
    <div id="about-page" class="page">
        <div class="page-header">
            <button class="back-button" onclick="showProfileTab()">‚Üê</button>
            <div class="page-title">–û LinkGold</div>
        </div>

        <div class="card">
            <p class="about-text">LinkGold ‚Äî —ç—Ç–æ –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∑–∞—Ä–∞–±–æ—Ç–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–∞–∂–¥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –º–æ–Ω–µ—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ. –ú—ã —Å–æ–∑–¥–∞–ª–∏ —É–¥–æ–±–Ω—ã–π –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Å–µ—Ä–≤–∏—Å, –≥–¥–µ –≤—ã –º–æ–∂–µ—Ç–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –∏ –ø–æ–ª—É—á–∞—Ç—å –∑–∞ —ç—Ç–æ –¥–æ—Å—Ç–æ–π–Ω–æ–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ.</p>
            
            <p class="about-text">–ù–∞—à–∞ –º–∏—Å—Å–∏—è ‚Äî –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –≤—Å–µ—Ö, –∫—Ç–æ –≥–æ—Ç–æ–≤ –ø—Ä–æ—è–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø—Ä–æ—Å—Ç—ã–µ –∑–∞–¥–∞—á–∏. –ú—ã –≤–µ—Ä–∏–º, —á—Ç–æ –∫–∞–∂–¥—ã–π –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–æ–Ω–µ—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–µ –≤—Ä–µ–º—è –∏ —É—Å–∏–ª–∏—è, –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—ã–µ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ.</p>
            
            <p class="about-text">–ú—ã –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ —É–ª—É—á—à–µ–Ω–∏–µ–º —Å–µ—Ä–≤–∏—Å–∞, –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –∑–∞—Ä–∞–±–æ—Ç–∫–∞. –ù–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ –∑–∞–±–æ—Ç–∏—Ç—Å—è –æ –∫–∞–∂–¥–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏ —Å—Ç—Ä–µ–º–∏—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –ª—É—á—à–∏–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è –≤–∑–∞–∏–º–æ–≤—ã–≥–æ–¥–Ω–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞.</p>
            
            <div class="about-footer">
                LinkGold ¬© 2023. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
            </div>
        </div>
    </div>

<!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤ -->
<div id="withdraw-page" class="page">
    <div class="page-header">
        <button class="back-button" onclick="goBackToProfile()">‚Üê</button>
        <div class="page-title">üí´ –í—ã–≤–æ–¥ –∑–≤–µ–∑–¥</div>
    </div>

    <div class="card">
        <!-- –ë–ª–æ–∫ —Å –±–∞–ª–∞–Ω—Å–æ–º -->
        <div class="withdraw-hero">
            <div class="withdraw-balance" id="withdraw-balance-display">0 ‚≠ê</div>
            <div class="withdraw-subtitle">–í–∞—à —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å</div>
            
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–º –≤—ã–≤–æ–¥–µ -->
            <div style="background: rgba(255, 215, 0, 0.1); border: 1px solid var(--gold); border-radius: 12px; padding: 12px; margin: 16px 0; text-align: center;">
                <div style="font-size: 14px; color: var(--gold); font-weight: 600;">
                    üí´ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞: <span style="color: white;">250 ‚≠ê</span>
                </div>
                <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                    –ë–∞–ª–∞–Ω—Å –±—É–¥–µ—Ç –æ–±–Ω—É–ª–µ–Ω –ø—Ä–∏ –≤—ã–≤–æ–¥–µ
                </div>
            </div>
            
            <button class="withdraw-btn" onclick="requestWithdraw()" id="withdraw-btn">
                –í—ã–≤–µ—Å—Ç–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞
            </button>
        </div>

        <!-- –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π -->
        <div class="withdraw-history">
            <h3 style="margin-bottom: 15px; color: var(--text-primary);">üìä –ò—Å—Ç–æ—Ä–∏—è –≤—ã–≤–æ–¥–æ–≤</h3>
            <div id="withdraw-history-list">
                <!-- –ò—Å—Ç–æ—Ä–∏—è –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∑–¥–µ—Å—å -->
            </div>
        </div>
    </div>
</div>

    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ "–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç" -->
    <div id="how-it-works-page" class="page">
        <div class="page-header">
            <button class="back-button" onclick="goBackToProfile()">‚Üê</button>
            <div class="page-title">‚ùì –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</div>
        </div>

        <div class="card">
            <div class="workflow-steps">
                <div class="workflow-step" style="display: flex; align-items: flex-start; margin-bottom: 25px; padding: 15px; background: var(--bg-secondary); border-radius: 12px;">
                    <div class="step-number" style="background: var(--accent); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; flex-shrink: 0;">1</div>
                    <div>
                        <h4 style="margin-bottom: 8px;">üìã –í—ã–±–∏—Ä–∞–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è</h4>
                        <p style="color: var(--text-secondary); font-size: 14px; line-height: 1.5;">
                            –í —Ä–∞–∑–¥–µ–ª–µ "–ó–∞–¥–∞–Ω–∏—è" –¥–æ—Å—Ç—É–ø–Ω—ã —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏: –ø–æ–¥–ø–∏—Å–∫–∏, –ª–∞–π–∫–∏, —Ä–µ–ø–æ—Å—Ç—ã –∏ –¥—Ä—É–≥–∏–µ –∑–∞–¥–∞–Ω–∏—è –æ—Ç —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª–µ–π.
                        </p>
                    </div>
                </div>

                <div class="workflow-step" style="display: flex; align-items: flex-start; margin-bottom: 25px; padding: 15px; background: var(--bg-secondary); border-radius: 12px;">
                    <div class="step-number" style="background: var(--accent); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; flex-shrink: 0;">2</div>
                    <div>
                        <h4 style="margin-bottom: 8px;">‚ö° –í—ã–ø–æ–ª–Ω—è–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è</h4>
                        <p style="color: var(--text-secondary); font-size: 14px; line-height: 1.5;">
                            –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤ –∫–∞–∂–¥–æ–º –∑–∞–¥–∞–Ω–∏–∏. –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∑–∞–¥–∞–Ω–∏–π –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞ 2-5 –º–∏–Ω—É—Ç.
                        </p>
                    </div>
                </div>

                <div class="workflow-step" style="display: flex; align-items: flex-start; margin-bottom: 25px; padding: 15px; background: var(--bg-secondary); border-radius: 12px;">
                    <div class="step-number" style="background: var(--accent); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; flex-shrink: 0;">3</div>
                    <div>
                        <h4 style="margin-bottom: 8px;">üì∏ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–π—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</h4>
                        <p style="color: var(--text-secondary); font-size: 14px; line-height: 1.5;">
                            –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏. –ú–æ–¥–µ—Ä–∞—Ü–∏—è –∑–∞–Ω–∏–º–∞–µ—Ç –¥–æ 24 —á–∞—Å–æ–≤.
                        </p>
                    </div>
                </div>

                <div class="workflow-step" style="display: flex; align-items: flex-start; margin-bottom: 25px; padding: 15px; background: var(--bg-secondary); border-radius: 12px;">
                    <div class="step-number" style="background: var(--accent); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; flex-shrink: 0;">4</div>
                    <div>
                        <h4 style="margin-bottom: 8px;">üí≥ –í—ã–≤–æ–¥–∏—Ç–µ –¥–µ–Ω—å–≥–∏</h4>
                        <p style="color: var(--text-secondary); font-size: 14px; line-height: 1.5;">
                            –ü–æ–ª—É—á–∞–π—Ç–µ –≤—ã–ø–ª–∞—Ç—ã –Ω–∞ –∫–∞—Ä—Ç—É, —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–µ –∫–æ—à–µ–ª—å–∫–∏ –∏–ª–∏ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—É. –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞ - 50 —Ä—É–±–ª–µ–π.
                        </p>
                    </div>
                </div>
            </div>

            <div class="faq-section" style="margin-top: 30px;">
                <h4 style="margin-bottom: 15px;">‚ùî –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã</h4>
                
                <div class="faq-item" style="margin-bottom: 15px; padding: 15px; background: var(--bg-secondary); border-radius: 12px;">
                    <div class="faq-question" style="font-weight: 600; margin-bottom: 8px;">–°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–Ω–∏–º–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞–Ω–∏—è?</div>
                    <div class="faq-answer" style="color: var(--text-secondary); font-size: 14px;">
                        –û–±—ã—á–Ω–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–Ω–∏–º–∞–µ—Ç –æ—Ç 1 –¥–æ 24 —á–∞—Å–æ–≤. –í –≤—ã—Ö–æ–¥–Ω—ã–µ –¥–Ω–∏ –≤–æ–∑–º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏.
                    </div>
                </div>

                <div class="faq-item" style="margin-bottom: 15px; padding: 15px; background: var(--bg-secondary); border-radius: 12px;">
                    <div class="faq-question" style="font-weight: 600; margin-bottom: 8px;">–ü–æ—á–µ–º—É –∑–∞–¥–∞–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ?</div>
                    <div class="faq-answer" style="color: var(--text-secondary); font-size: 14px;">
                        –ó–∞–¥–∞–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è –µ—Å–ª–∏: –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –≤—Å–µ —É—Å–ª–æ–≤–∏—è, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω –Ω–µ—á–µ—Ç–∫–∏–π —Å–∫—Ä–∏–Ω—à–æ—Ç, –Ω–∞—Ä—É—à–µ–Ω—ã –ø—Ä–∞–≤–∏–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
                    </div>
                </div>

                <div class="faq-item" style="margin-bottom: 15px; padding: 15px; background: var(--bg-secondary); border-radius: 12px;">
                    <div class="faq-question" style="font-weight: 600; margin-bottom: 8px;">–ö–∞–∫ —É–≤–µ–ª–∏—á–∏—Ç—å —Å–≤–æ–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫?</div>
                    <div class="faq-answer" style="color: var(--text-secondary); font-size: 14px;">
                        –†–µ–≥—É–ª—è—Ä–Ω–æ –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è, –ø—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ, –ø–æ–≤—ã—à–∞–π—Ç–µ —É—Ä–æ–≤–µ–Ω—å –∞–∫–∫–∞—É–Ω—Ç–∞.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ "–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏" -->
    <div id="about-page" class="page">
        <div class="page-header">
            <button class="back-button" onclick="goBackToProfile()">‚Üê</button>
            
            <div class="page-title">‚ÑπÔ∏è –û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</div>
        </div>

        <div class="card">
            <div style="text-align: center; margin-bottom: 25px;">
                <div style="font-size: 48px; margin-bottom: 10px;">üí∞</div>
                <h2 style="margin-bottom: 10px;">LinkGold</h2>
                <p style="color: var(--text-secondary);">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∑–∞—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏–π</p>
            </div>

            <div class="app-info" style="margin-bottom: 25px;">
                <p style="color: var(--text-secondary); line-height: 1.6; margin-bottom: 15px;">
                    LinkGold ‚Äî —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–∞–∂–¥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –º–æ–Ω–µ—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å 
                    —Å–≤–æ—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ. –ú—ã —Å–æ–∑–¥–∞–ª–∏ –ø—Ä–æ–∑—Ä–∞—á–Ω—É—é –∏ —É–¥–æ–±–Ω—É—é —Å–∏—Å—Ç–µ–º—É –¥–ª—è –∑–∞—Ä–∞–±–æ—Ç–∫–∞ 
                    –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–¥–∞–Ω–∏–π.
                </p>
                
                <p style="color: var(--text-secondary); line-height: 1.6; margin-bottom: 15px;">
                    –ù–∞—à–∞ –º–∏—Å—Å–∏—è ‚Äî –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö, 
                    –∫—Ç–æ –≥–æ—Ç–æ–≤ –ø—Ä–æ—è–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –∑–∞–¥–∞—á–∏ –æ—Ç —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª–µ–π.
                </p>
            </div>

            <div class="app-stats" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 25px;">
                <div style="background: var(--bg-secondary); padding: 15px; border-radius: 12px; text-align: center;">
                    <div style="font-size: 24px; font-weight: 700; margin-bottom: 5px; background: var(--gold-gradient); -webkit-background-clip: text; background-clip: text; color: transparent;">10K+</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                </div>
                <div style="background: var(--bg-secondary); padding: 15px; border-radius: 12px; text-align: center;">
                    <div style="font-size: 24px; font-weight: 700; margin-bottom: 5px; background: var(--gold-gradient); -webkit-background-clip: text; background-clip: text; color: transparent;">50K+</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π</div>
                </div>
                <div style="background: var(--bg-secondary); padding: 15px; border-radius: 12px; text-align: center;">
                    <div style="font-size: 24px; font-weight: 700; margin-bottom: 5px; background: var(--gold-gradient); -webkit-background-clip: text; background-clip: text; color: transparent;">2M+</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">–í—ã–ø–ª–∞—á–µ–Ω–æ —Ä—É–±–ª–µ–π</div>
                </div>
                <div style="background: var(--bg-secondary); padding: 15px; border-radius: 12px; text-align: center;">
                    <div style="font-size: 24px; font-weight: 700; margin-bottom: 5px; background: var(--gold-gradient); -webkit-background-clip: text; background-clip: text; color: transparent;">99%</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤</div>
                </div>
            </div>

            <div class="contact-info" style="background: var(--bg-secondary); padding: 20px; border-radius: 12px; text-align: center;">
                <h4 style="margin-bottom: 15px;">üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã</h4>
                <p style="color: var(--text-secondary); margin-bottom: 10px; font-size: 14px;">
                    –ü–æ –≤—Å–µ–º –≤–æ–ø—Ä–æ—Å–∞–º –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É —á–µ—Ä–µ–∑ —Ä–∞–∑–¥–µ–ª "–ü–æ–¥–¥–µ—Ä–∂–∫–∞" –≤ –≤–∞—à–µ–º –ø—Ä–æ—Ñ–∏–ª–µ
                </p>
                <button class="btn btn-primary" onclick="openAdminChat()" style="margin-top: 10px;">
                    üí¨ –ù–∞–ø–∏—Å–∞—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É
                </button>
            </div>

            <div class="about-footer" style="text-align: center; margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border);">
                <div style="color: var(--text-secondary); font-size: 12px;">
                    LinkGold ¬© 2024. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.<br>
                    –í–µ—Ä—Å–∏—è 1.0.0
                </div>
            </div>
        </div>
    </div>


</main> 





<!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
<nav class="bottom-nav">
    <div class="nav-item active" onclick="showMainTab()">
        <div class="nav-icon">
            <img src="10316158-no-bg-preview (carve.photos).png" alt="–ì–ª–∞–≤–Ω–∞—è" style="width: 40px; height: 40px;">
        </div>
        <div class="nav-label">–ì–ª–∞–≤–Ω–∞—è</div>
    </div>
    <div class="nav-item" onclick="showTasksTab()">
        <div class="nav-icon">
            <img src="7645190-no-bg-preview (carve.photos).png" alt="–ó–∞–¥–∞–Ω–∏—è" style="width: 40px; height: 40px;">
        </div>
        <div class="nav-label">–ó–∞–¥–∞–Ω–∏—è</div>
    </div>
    <div class="nav-item" onclick="showProfileTab()">
        <div class="nav-icon">
            <img src="–°–Ω–∏–º–æ–∫ —ç–∫—Ä–∞–Ω–∞ 2025-10-22 074950-no-bg-preview (carve.photos) .png" alt="–ü—Ä–æ—Ñ–∏–ª—å" style="width: 45px; height: 45px;">
        </div>
        <div class="nav-label">–ü—Ä–æ—Ñ–∏–ª—å</div>
    </div>
    <div class="nav-item" id="admin-nav-item" onclick="showAdminTab()" style="display: none;">
        <div class="nav-icon">‚öôÔ∏è</div>
        <div class="nav-label">–ê–¥–º–∏–Ω</div>
    </div>
</nav>



<div class="modal" id="prices-modal">
    <div class="prices-content">
        <!-- –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∫–Ω–æ–ø–∫–æ–π –∑–∞–∫—Ä—ã—Ç–∏—è -->
        <div class="modal-header">
            <div class="modal-title">üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–∑–º–µ—â–µ–Ω–∏—è</div>
            <button class="modal-close" onclick="closeModal('prices-modal')">√ó</button>
        </div>
        
        <div class="price-grid">
            <div class="price-item">
                <span class="price-time">1 —á–∞—Å</span>
                <span class="price-amount">200 ‚ÇΩ</span>
            </div>
            <div class="price-item">
                <span class="price-time">3 —á–∞—Å–∞</span>
                <span class="price-amount">600 ‚ÇΩ</span>
            </div>
            <div class="price-item">
                <span class="price-time">1 –¥–µ–Ω—å</span>
                <span class="price-amount">4 500 ‚ÇΩ</span>
            </div>
            <div class="price-item">
                <span class="price-time">7 –¥–Ω–µ–π</span>
                <span class="price-amount">20 000 ‚ÇΩ</span>
            </div>
        </div>
        <button class="prices-btn" onclick="openAdminChatFromPrices()">
            üí¨ –ù–∞–ø–∏—Å–∞—Ç—å –æ —Ä–µ–∫–ª–∞–º–µ
        </button>
    </div>
</div>

<div class="modal" id="task-modal">
    <div class="modal-content task-modal-content">
        <div class="modal-header">
            <div class="task-modal-title" id="task-modal-title">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</div>
            <button class="modal-close" onclick="closeModal('task-modal')">√ó</button>
        </div>
        <div class="modal-body">
            <div class="task-modal-category" id="task-modal-category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</div>
            

            
            <div class="task-modal-price" id="task-modal-price">0 ‚≠ê</div>
            <div class="task-modal-description" id="task-modal-description">–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</div>
            
            <div class="task-modal-details">
                <div class="task-detail">
                    <span class="task-detail-label">–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</span>
                    <span class="task-detail-value" id="task-modal-time">5 –º–∏–Ω</span>
                </div>
                <div class="task-detail">
                    <span class="task-detail-label">–°–ª–æ–∂–Ω–æ—Å—Ç—å:</span>
                    <span class="task-detail-value" id="task-modal-difficulty">–õ–µ–≥–∫–∞—è</span>
                </div>
                <div class="task-detail">
                    <span class="task-detail-label">–û—Å—Ç–∞–ª–æ—Å—å:</span>
                    <span class="task-detail-value" id="task-modal-available">15 –∑–∞–¥–∞–Ω–∏–π</span>
                </div>
            </div>
            
            <div class="task-modal-buttons">
                <button class="task-modal-cancel" onclick="closeModal('task-modal')">–û—Ç–º–µ–Ω–∞</button>
                <button class="task-modal-start" onclick="startTask()">–ù–∞—á–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ</button>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è -->
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è -->
<div class="modal" id="confirmation-modal">
    <div class="confirmation-modal-content">
        <div class="confirmation-icon">‚ùì</div>
        <div class="confirmation-title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</div>
        <div class="confirmation-text" id="confirmation-task-text">–í—ã –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –∑–∞–¥–∞–Ω–∏–µ "<span id="confirmation-task-name"></span>"?</div>
        
        <div class="confirmation-buttons">
            <button class="confirmation-btn confirmation-yes" onclick="showScreenshotUpload()">–î–∞, –≤—ã–ø–æ–ª–Ω–∏–ª</button>
            <button class="confirmation-btn confirmation-no" onclick="showCancelConfirmation()">–ù–µ—Ç, –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª</button>
        </div>
        
        <button class="confirmation-btn confirmation-cancel" onclick="closeModal('confirmation-modal')">–û—Ç–º–µ–Ω–∞</button>
    </div>
</div>
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–º–µ–Ω—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
 <div class="task-detail" id="task-modal-url">
<div class="modal" id="cancel-confirmation-modal">
    <div class="confirmation-modal-content">
        <div class="confirmation-icon">‚ö†Ô∏è</div>
        <div class="confirmation-title">–í—ã —É–≤–µ—Ä–µ–Ω—ã?</div>
        <div class="confirmation-text">–í—ã —Ç–æ—á–Ω–æ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ?</div>
        
        <div class="confirmation-buttons">
            <button class="confirmation-btn confirmation-no" onclick="cancelTask()">–ù–µ –≤—ã–ø–æ–ª–Ω–∏–ª</button>
            <button class="confirmation-btn confirmation-yes" onclick="showScreenshotUpload()">–í—ã–ø–æ–ª–Ω–∏–ª</button>
        </div>
        
        <button class="confirmation-btn confirmation-cancel" onclick="closeModal('cancel-confirmation-modal')">–û—Ç–º–µ–Ω–∞</button>
    </div>
</div>
</div>
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ -->
 <div class="task-detail" id="task-modal-url">
<div class="modal" id="screenshot-modal">
    <div class="confirmation-modal-content">
        <div class="confirmation-icon">üì∏</div>
        <div class="confirmation-title">–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç</div>
        <div class="confirmation-text">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º</div>
        
        <div class="screenshot-upload">
            <input type="file" id="screenshot-file" class="file-input" accept="image/*">
            <button class="upload-btn" onclick="document.getElementById('screenshot-file').click()">
                üìÅ –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª
            </button>
            <img id="screenshot-preview" class="screenshot-preview" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å–∫—Ä–∏–Ω—à–æ—Ç–∞">
            <div id="file-name" style="font-size: 14px; color: var(--text-secondary); margin-bottom: 16px;"></div>
        </div>
        
        <div class="confirmation-buttons">
            <button class="confirmation-btn confirmation-cancel" onclick="closeModal('screenshot-modal')">–û—Ç–º–µ–Ω–∞</button>
            <button class="confirmation-btn confirmation-yes" onclick="submitScreenshot()" id="submit-screenshot-btn" disabled>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É</button>
        </div>
    </div>
</div>
</div>
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–¥–∞–Ω–∏—è –¥–ª—è –∞–¥–º–∏–Ω–∞ -->
<div class="modal" id="verification-modal">
    <div class="modal-content verification-modal-content">
        <div class="modal-header">
            <div class="modal-title">‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞–Ω–∏—è</div>
            <button class="modal-close" onclick="closeModal('verification-modal')">√ó</button>
        </div>
        
        <div class="modal-body">
            <div class="verification-user-info">
                <div class="verification-avatar" id="verification-user-avatar">U</div>
                <div>
                    <div class="verification-user-name" id="verification-user-name">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                    <div class="verification-task-title" id="verification-task-title">–ó–∞–¥–∞–Ω–∏–µ</div>
                </div>
                <div class="verification-price" id="verification-task-price">0 ‚≠ê</div>
            </div>
            
            <div class="verification-screenshot">
                <div style="margin-bottom: 10px; font-weight: 600;">–°–∫—Ä–∏–Ω—à–æ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</div>
                <img id="verification-screenshot" class="verification-modal-screenshot" alt="–°–∫—Ä–∏–Ω—à–æ—Ç –∑–∞–¥–∞–Ω–∏—è" 
                     style="width: 100%; border-radius: 10px; border: 2px solid var(--border);">
            </div>
            
            <div class="verification-modal-actions" style="display: flex; gap: 10px; margin-top: 20px;">
    <button class="btn btn-error" style="flex: 1;" onclick="rejectVerification()">
        ‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å
    </button>
    <button class="btn btn-success" style="flex: 1;" onclick="approveVerification()">
        ‚úÖ –û–¥–æ–±—Ä–∏—Ç—å (–¥–∞–∂–µ –±–µ–∑ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞)
    </button>
</div>

<!-- üî• –ù–û–í–ê–Ø –ö–ù–û–ü–ö–ê –î–õ–Ø –ê–í–ê–†–ò–ô–ù–û–ì–û –û–î–û–ë–†–ï–ù–ò–Ø -->
<button class="btn btn-warning" onclick="forceApproveVerification()" 
        style="margin-top: 10px; width: 100%; display: none;" 
        id="emergency-approve-btn">
    üö® –ê–≤–∞—Ä–∏–π–Ω–æ–µ –æ–¥–æ–±—Ä–µ–Ω–∏–µ (–ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö)
</button>

<!-- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ -->
<button class="btn btn-warning" onclick="deleteVerification()" style="margin-top: 10px; width: 100%;">
    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
</button>
        </div>
    </div>
</div>
<div class="chat-modal" id="admin-chat">
    <div class="chat-header">
        <div class="chat-avatar">
            <div class="video-icon">üí¨</div>
        </div>
        <div class="chat-info">
            <div class="chat-name">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä LinkGold</div>
            <div class="chat-status">TG: @linkgold_admin</div>
        </div>
        <button class="chat-close" onclick="closeChat()">√ó</button>
    </div>
    <div class="chat-messages" id="chat-messages">
        <div class="message message-admin">
            –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?
        </div>
    </div>
    <div class="chat-input">
        <input type="text" id="chat-input-field" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
        <button class="chat-send" onclick="sendMessageToAdmin()">‚û§</button>
    </div>
</div>


    <script>

  // üîß –ü–û–ò–°–ö–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê –î–õ–Ø –ê–î–ú–ò–ù–°–ö–ò–• –ó–ê–î–ê–ù–ò–ô

        let allAdminTasks = []; // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–¥–∞–Ω–∏–π
        let currentAdminSearchTerm = ''; // –¢–µ–∫—É—â–∏–π –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞
        function initAdminTaskSearch() {
            const searchInput = document.getElementById('admin-task-search');
            if (searchInput) {
                let searchTimeout;
                
                searchInput.addEventListener('input', function(e) {
                    clearTimeout(searchTimeout);
                    const searchText = e.target.value.trim();
                    
                    searchTimeout = setTimeout(() => {
                        if (searchText.length >= 2 || searchText.length === 0) {
                            searchAdminTasks(searchText);
                        }
                    }, 300);
                });

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏—à–∏ Enter
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchAdminTasks(searchInput.value.trim());
                    }
                });
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ –∑–∞–¥–∞–Ω–∏–π
        async function searchAdminTasks(searchTerm = '') {
            console.log('üîç Searching admin tasks:', searchTerm);
            
            currentAdminSearchTerm = searchTerm;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –æ—á–∏—Å—Ç–∫–∏
            const clearBtn = document.querySelector('.admin-search-clear');
            if (clearBtn) {
                clearBtn.style.display = searchTerm ? 'block' : 'none';
            }

            try {
                if (!currentUser) {
                    showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω', 'error');
                    return;
                }

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                const resultsDiv = document.getElementById('admin-search-results');
                if (resultsDiv) {
                    resultsDiv.innerHTML = '<span style="color: var(--warning);">‚è≥ –ò—â–µ–º –∑–∞–¥–∞–Ω–∏—è...</span>';
                }

                // –§–æ—Ä–º–∏—Ä—É–µ–º URL –¥–ª—è –ø–æ–∏—Å–∫–∞
                const params = new URLSearchParams();
                params.append('adminId', currentUser.id);
                if (searchTerm) {
                    params.append('search', searchTerm);
                }

                const url = `/api/admin/tasks/search?${params.toString()}`;
                console.log('üì° Search URL:', url);

                const result = await makeRequest(url);
                
                if (result.success) {
                    allAdminTasks = result.tasks || [];
                    displayAdminTasks(allAdminTasks, result.statistics);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
                    updateSearchResultsInfo(searchTerm, allAdminTasks.length);
                    
                } else {
                    throw new Error(result.error || '–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞');
                }

            } catch (error) {
                console.error('‚ùå Search error:', error);
                const resultsDiv = document.getElementById('admin-search-results');
                if (resultsDiv) {
                    resultsDiv.innerHTML = `<span style="color: var(--error);">‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞: ${error.message}</span>`;
                }
                showNotification('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –∑–∞–¥–∞–Ω–∏–π', 'error');
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –ø–æ–∏—Å–∫–∞
        function updateSearchResultsInfo(searchTerm, resultsCount) {
            const resultsDiv = document.getElementById('admin-search-results');
            if (!resultsDiv) return;

            if (!searchTerm) {
                resultsDiv.innerHTML = '';
                return;
            }

            if (resultsCount === 0) {
                resultsDiv.innerHTML = `
                    <span style="color: var(--text-secondary);">
                        üîç –ü–æ –∑–∞–ø—Ä–æ—Å—É "<strong>${escapeHtml(searchTerm)}</strong>" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
                    </span>
                `;
            } else {
                resultsDiv.innerHTML = `
                    <span style="color: var(--success);">
                        ‚úÖ –ù–∞–π–¥–µ–Ω–æ <strong>${resultsCount}</strong> –∑–∞–¥–∞–Ω–∏–π –ø–æ –∑–∞–ø—Ä–æ—Å—É "<strong>${escapeHtml(searchTerm)}</strong>"
                    </span>
                `;
            }
        }

        // –û—á–∏—Å—Ç–∫–∞ –ø–æ–∏—Å–∫–∞
        function clearAdminTaskSearch() {
            const searchInput = document.getElementById('admin-task-search');
            if (searchInput) {
                searchInput.value = '';
                searchAdminTasks('');
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∞–¥–º–∏–Ω—Å–∫–∏—Ö –∑–∞–¥–∞–Ω–∏–π
// –ó–ê–ú–ï–ù–ò–¢–ï —Ñ—É–Ω–∫—Ü–∏—é loadAdminTasks –Ω–∞ —ç—Ç—É:
async function loadAdminTasks() {
    console.log('üéØ Loading admin tasks...');
    
    if (!currentUser) {
        console.log('‚ùå No user');
        return;
    }
    
    const container = document.getElementById('admin-tasks-list');
    if (!container) {
        console.log('‚ùå Container not found');
        return;
    }
    
    // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∏–¥–∏–º
    const tasksContainer = document.getElementById('admin-tasks-list-container');
    if (tasksContainer) {
        tasksContainer.style.display = 'block';
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
    container.innerHTML = `
        <div style="text-align: center; padding: 40px 20px;">
            <div class="loading-spinner">‚è≥</div>
            <div style="margin-top: 16px;">–ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω–∞...</div>
        </div>
    `;
    
    try {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ –∑–∞–¥–∞–Ω–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
        const [statsResult, tasksResult] = await Promise.all([
            makeRequest(`/api/admin/tasks-stats?adminId=${currentUser.id}`),
            makeRequest(`/api/admin/simple-tasks?adminId=${currentUser.id}`)
        ]);
        
        console.log('üìä Stats result:', statsResult);
        console.log('üìä Tasks result:', tasksResult);
        
        if (tasksResult.success && statsResult.success) {
            const allAdminTasks = tasksResult.tasks || [];
            displayAdminTasks(allAdminTasks, statsResult.statistics);
        } else {
            throw new Error(tasksResult.error || statsResult.error || 'Unknown error');
        }
        
    } catch (error) {
        console.error('üí• Error:', error);
        container.innerHTML = `
            <div style="text-align: center; padding: 40px 20px; color: var(--error);">
                <div style="font-size: 48px; margin-bottom: 16px;">‚ùå</div>
                <div>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞–Ω–∏–π</div>
                <div style="font-size: 12px; margin-top: 8px;">${error.message}</div>
                
                <div style="margin-top: 20px;">
                    <button class="btn btn-primary" onclick="loadAdminTasks()">
                        üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                    </button>
                </div>
            </div>
        `;
    }
}
// –î–û–ë–ê–í–¨–¢–ï —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é:
function displayAdminTasks(tasks, stats) {
    const container = document.getElementById('admin-tasks-list');
    if (!container) {
        console.error('‚ùå Admin tasks container not found!');
        return;
    }
    
    console.log(`üéØ Displaying ${tasks ? tasks.length : 0} admin tasks`);
    
    container.innerHTML = '';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    if (stats) {
        const completedCount = stats.completed_tasks || 0;
        const rejectedCount = stats.rejected_tasks || 0;
        const pendingCount = stats.pending_tasks || 0;
        const activeCount = stats.active_tasks || 0;
        const totalCount = stats.total_tasks || 0;
        
        const statsHTML = `
            <div class="admin-stats" style="margin-bottom: 20px; padding: 15px; background: var(--card-bg); border-radius: 12px; border: 1px solid var(--border);">
                <h4 style="margin-bottom: 10px;">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–¥–∞–Ω–∏–π</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; font-size: 12px;">
                    <div style="text-align: center;">
                        <div style="font-size: 18px; font-weight: bold; color: var(--accent);">${totalCount}</div>
                        <div>–í—Å–µ–≥–æ –∑–∞–¥–∞–Ω–∏–π</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 18px; font-weight: bold; color: var(--success);">${completedCount}</div>
                        <div>‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 18px; font-weight: bold; color: var(--error);">${rejectedCount}</div>
                        <div>‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 18px; font-weight: bold; color: var(--warning);">${pendingCount}</div>
                        <div>‚è≥ –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</div>
                    </div>
                </div>
            </div>
        `;
        container.innerHTML = statsHTML;
    }
    
    if (!tasks || tasks.length === 0) {
        container.innerHTML += `
            <div class="no-tasks" style="text-align: center; padding: 40px 20px; background: var(--card-bg); border-radius: 12px; border: 1px solid var(--border);">
                <div style="font-size: 48px; margin-bottom: 16px;">üìù</div>
                <div style="font-size: 18px; margin-bottom: 8px;">–ù–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π</div>
                <div style="font-size: 14px; color: var(--text-secondary);">
                    –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É—è —Ñ–æ—Ä–º—É –≤—ã—à–µ
                </div>
            </div>
        `;
        return;
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
    const filterHTML = `
        <div class="task-filter" style="margin-bottom: 15px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
            <label style="font-weight: 600; color: var(--text-primary);">–§–∏–ª—å—Ç—Ä:</label>
            <select id="admin-task-filter" onchange="filterAdminTasks()" style="padding: 8px 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg-primary); color: var(--text-primary);">
                <option value="all">–í—Å–µ –∑–∞–¥–∞–Ω–∏—è</option>
                <option value="active">–¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ</option>
                <option value="completed">–¢–æ–ª—å–∫–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ</option>
                <option value="my">–ú–æ–∏ –∑–∞–¥–∞–Ω–∏—è</option>
            </select>
            <button onclick="loadAdminTasks()" class="btn btn-primary" style="padding: 8px 12px; font-size: 12px;">
                üîÑ –û–±–Ω–æ–≤–∏—Ç—å
            </button>
        </div>
    `;
    container.innerHTML += filterHTML;
    
    const tasksContainer = document.createElement('div');
    tasksContainer.id = 'admin-tasks-container';
    container.appendChild(tasksContainer);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–¥–∞—á–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
    window.currentAdminTasks = tasks;
    
    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è
    renderAdminTasks(tasks);
}

function renderAdminTasks(tasks) {
    const container = document.getElementById('admin-tasks-container');
    if (!container) return;
    
    container.innerHTML = '';
    
    const filter = document.getElementById('admin-task-filter')?.value || 'all';
    
    const filteredTasks = tasks.filter(task => {
        switch (filter) {
            case 'active':
                return task.status === 'active';
            case 'completed':
                return task.status === 'completed';
            case 'my':
                return task.created_by === currentUser.id;
            default:
                return true; // 'all'
        }
    });
    
    console.log(`üéØ Rendering ${filteredTasks.length} filtered tasks (filter: ${filter})`);
    
    if (filteredTasks.length === 0) {
        container.innerHTML = `
            <div class="no-tasks" style="text-align: center; padding: 40px 20px;">
                <div style="font-size: 48px; margin-bottom: 16px;">üîç</div>
                <div>–ó–∞–¥–∞–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>
                <div style="font-size: 14px; color: var(--text-secondary); margin-top: 8px;">
                    –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä
                </div>
            </div>
        `;
        return;
    }
    
    filteredTasks.forEach(task => {
        const taskElement = createAdminTaskElement(task);
        container.appendChild(taskElement);
    });
}
// –î–û–ë–ê–í–¨–¢–ï —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é:
function createAdminTaskElement(task) {
    const taskElement = document.createElement('div');
    taskElement.className = 'admin-task-item';
    taskElement.style.cssText = `
        background: var(--card-bg);
        border: 1px solid ${task.status === 'completed' ? 'var(--success)' : 'var(--border)'};
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 12px;
        opacity: ${task.status === 'completed' ? 0.8 : 1};
    `;
    
    const completedCount = task.completed_count || 0;
    const peopleRequired = task.people_required || 1;
    const progressPercentage = Math.min(100, (completedCount / peopleRequired) * 100);
    const isCompleted = task.status === 'completed';
    
    taskElement.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
            <div style="flex: 1;">
                <div style="font-weight: 600; font-size: 16px; margin-bottom: 4px;">
                    ${task.title}
                    ${isCompleted ? ' <span style="color: var(--success); font-size: 12px;">(–ó–∞–≤–µ—Ä—à–µ–Ω–æ)</span>' : ''}
                </div>
                <div style="color: var(--text-secondary); font-size: 14px;">${task.description}</div>
            </div>
            <div style="display: flex; gap: 8px; align-items: center;">
                <div style="font-size: 20px; color: var(--gold); font-weight: 600;">
                    ${task.price} ‚≠ê
                </div>
                ${!isCompleted ? `
                    <button class="admin-task-delete" onclick="deleteTask(${task.id})" style="background: var(--error); color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer;">
                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                    </button>
                ` : ''}
            </div>
        </div>
        
        <div style="display: flex; gap: 12px; font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">
            <span>üìÅ ${task.category || 'general'}</span>
            <span>üë• ${peopleRequired} —á–µ–ª.</span>
            <span>‚ö° ${task.difficulty || '–õ–µ–≥–∫–∞—è'}</span>
            <span>üïí ${task.time_to_complete || '5-10 –º–∏–Ω—É—Ç'}</span>
            <span style="color: ${isCompleted ? 'var(--success)' : 'var(--accent)'};">
                ${isCompleted ? '‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ' : 'üü¢ –ê–∫—Ç–∏–≤–Ω–æ'}
            </span>
        </div>
        
        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è -->
        <div style="margin: 10px 0;">
            <div style="display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 4px;">
                <span>–í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${completedCount}/${peopleRequired}</span>
                <span>${Math.round(progressPercentage)}%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: ${progressPercentage}%; background: ${isCompleted ? 'var(--success)' : 'var(--accent)'};"></div>
            </div>
        </div>
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∑–∞–¥–∞–Ω–∏—è–º -->
        <div style="display: flex; gap: 15px; font-size: 11px; color: var(--text-secondary);">
            <span>‚úÖ ${completedCount} –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</span>
            <span>‚ùå ${task.rejected_count || 0} –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ</span>
            <span>‚è≥ ${task.pending_count || 0} –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</span>
        </div>
        
        ${task.image_url ? `
            <div style="margin-top: 10px;">
                <img src="${task.image_url}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è" style="max-width: 200px; border-radius: 8px; border: 1px solid var(--border);">
            </div>
        ` : ''}
        
        <div style="margin-top: 8px; font-size: 11px; color: var(--text-secondary);">
            –°–æ–∑–¥–∞–Ω–æ: ${new Date(task.created_at).toLocaleDateString('ru-RU')}
            ${task.last_completed ? ` ‚Ä¢ –ü–æ—Å–ª–µ–¥–Ω–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ: ${new Date(task.last_completed).toLocaleDateString('ru-RU')}` : ''}
        </div>
    `;
    
    return taskElement;
}
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            initAdminTaskSearch();
        });

        // üîß –≠–ö–°–ü–û–†–¢ –§–£–ù–ö–¶–ò–ô
        window.searchAdminTasks = searchAdminTasks;
        window.clearAdminTaskSearch = clearAdminTaskSearch;
        window.initAdminTaskSearch = initAdminTaskSearch;

// üîß –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ü–†–û–ö–†–£–¢–ö–ò –ö –ù–ê–ß–ê–õ–£ –°–¢–†–ê–ù–ò–¶–´
function scrollToTop() {
    window.scrollTo({
        top: 0,
        behavior: 'smooth'
    });
}

// üîß –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –§–£–ù–ö–¶–ò–ò –ü–û–ö–ê–ó–ê –°–¢–†–ê–ù–ò–¶ –° –ü–†–û–ö–†–£–¢–ö–û–ô
function showWithdrawPage() {
    hideAllTabs();
    document.getElementById('withdraw-page').classList.add('active');
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—ã–≤–æ–¥–∞
    updateWithdrawPage();
    loadWithdrawHistory();
    
    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–∞—á–∞–ª—É
    setTimeout(scrollToTop, 100);
}

function showHowItWorksPage() {
    hideAllTabs();
    document.getElementById('how-it-works-page').classList.add('active');
    
    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–∞—á–∞–ª—É
    setTimeout(scrollToTop, 100);
}

function showAboutPage() {
    hideAllTabs();
    document.getElementById('about-page').classList.add('active');
    
    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–∞—á–∞–ª—É
    setTimeout(scrollToTop, 100);
}

function goBackToProfile() {
    showProfileTab();
    
    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–∞—á–∞–ª—É –ø—Ä–æ—Ñ–∏–ª—è
    setTimeout(scrollToTop, 100);
}

// üîß –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ü–û–ö–ê–ó–ê –ü–†–û–§–ò–õ–Ø
function showProfileTab() {
    hideAllTabs();
    document.getElementById('profile-tab').classList.add('active');
    updateNavState('profile');
    
    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è
    setTimeout(() => {
        updateUserData();
        syncUserProfile();
        checkReferralEarnings(); // üî• –î–û–ë–ê–í–¨–¢–ï –≠–¢–£ –°–¢–†–û–ß–ö–£
    }, 100);
}

// üîß –î–û–ë–ê–í–õ–ï–ù–ò–ï –ü–†–û–ö–†–£–¢–ö–ò –ö –°–£–©–ï–°–¢–í–£–Æ–©–ò–ú –§–£–ù–ö–¶–ò–Ø–ú
function showMainTab() {
    hideAllTabs();
    document.getElementById('main-tab').classList.add('active');
    updateNavState('main');
    
    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–∞—á–∞–ª—É
    setTimeout(scrollToTop, 100);
}

function showTasksTab() {
    console.log('üéØ –ü–ï–†–ï–•–û–î –ù–ê –í–ö–õ–ê–î–ö–£ –ó–ê–î–ê–ù–ò–ô');
    
    hideAllTabs();
    const tasksTab = document.getElementById('tasks-tab');
    if (tasksTab) {
        tasksTab.classList.add('active');
    }
    
    updateNavState('tasks');
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
    setTimeout(fixMobileLayout, 100);
    
    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∫–ª–∞–¥–∫—É "–ù–æ–≤—ã–µ" –∏ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–∞—á–∞–ª—É
    setTimeout(() => {
        showTaskCategory('new');
        scrollToTop();
    }, 150);
}

function showAdminTab() {
    const isMainAdmin = parseInt(currentUser?.id) === ADMIN_ID;
    const isRegularAdmin = currentUser?.is_admin === true;
    
    if (!currentUser || (!isMainAdmin && !isRegularAdmin)) {
        showNotification('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω!', 'error');
        return;
    }
    
    hideAllTabs();
    document.getElementById('admin-tab').classList.add('active');
    updateNavState('admin');
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏
    resetAdminPanel();
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é –ø–æ—Å—Ç–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    showAdminSection('posts');
    
    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–∞—á–∞–ª—É
    setTimeout(scrollToTop, 100);
    
    // –ï—Å–ª–∏ –≥–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω, –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–æ–≤ –∑–∞—Ä–∞–Ω–µ–µ
    if (isMainAdmin) {
        setTimeout(() => {
            loadAdminsList();
        }, 500);
    }
}

// üîß –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ö–ù–û–ü–û–ö –í –ü–†–û–§–ò–õ–ï
// –í —Ä–∞–∑–¥–µ–ª–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ—Å–ª–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
document.querySelectorAll('.profile-action').forEach(action => {
    action.addEventListener('click', function() {
        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
        setTimeout(scrollToTop, 50);
    });
});

// üîß –§–ò–ö–° –î–õ–Ø –ú–û–ë–ò–õ–¨–ù–´–• –£–°–¢–†–û–ô–°–¢–í
function fixMobileScroll() {
    // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∫—Ä–æ–ª–ª–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
    if ('scrollRestoration' in history) {
        history.scrollRestoration = 'manual';
    }
    
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –Ω–∞—á–∞–ª—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('load', function() {
        setTimeout(scrollToTop, 100);
    });
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–∫—Å–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
fixMobileScroll();

        // üöÄ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò
class PerformanceOptimizer {
    constructor() {
        this.lazyLoadObserver = null;
        this.init();
    }
    
    init() {
        this.setupLazyLoading();
        this.debounceScrollEvents();
        this.optimizeAnimations();
    }
    
    // –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    setupLazyLoading() {
        if ('IntersectionObserver' in window) {
            this.lazyLoadObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        img.src = img.dataset.src;
                        img.classList.remove('lazy');
                        this.lazyLoadObserver.unobserve(img);
                    }
                });
            });
            
            document.querySelectorAll('img[data-src]').forEach(img => {
                this.lazyLoadObserver.observe(img);
            });
        }
    }
    
    // –î–µ–±–∞—É–Ω—Å —Å–∫—Ä–æ–ª–ª–∞
    debounceScrollEvents() {
        let scrollTimeout;
        window.addEventListener('scroll', () => {
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
                // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
            }, 100);
        }, { passive: true });
    }
    
    // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∞–Ω–∏–º–∞—Ü–∏–π
    optimizeAnimations() {
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ
        const elements = document.querySelectorAll('.card, .task-card');
        elements.forEach(el => {
            el.style.transform = 'translateZ(0)';
        });
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
new PerformanceOptimizer();
        // üîß –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
        console.log('üåê Current URL:', window.location.href);
        const API_BASE_URL = window.location.origin;
        console.log('üîó API Base URL:', API_BASE_URL);
        
        const tg = window.Telegram.WebApp;
        const ADMIN_ID = 8036875641;

     // üîß –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
let currentUser = null;
let currentChatId = null;
let currentAdminChat = null;
let selectedTaskId = null;
let allTasks = [];
let chatUpdateInterval = null;
let currentUserTaskId = null;
let currentVerificationId = null;
let currentTaskImage = null; // ‚Üê –î–û–ë–ê–í–¨–¢–ï –≠–¢–£ –°–¢–†–û–ö–£

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
// üîß –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –£–†–û–í–ù–ï–ô –ë–ï–ó –ë–û–ù–£–°–û–í
const LEVEL_SYSTEM = {
    1: { tasksRequired: 10, name: "–ù–æ–≤–∏—á–æ–∫" },
    2: { tasksRequired: 20, name: "–£—á–µ–Ω–∏–∫" },
    3: { tasksRequired: 30, name: "–û–ø—ã—Ç–Ω—ã–π" },
    4: { tasksRequired: 40, name: "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª" },
    5: { tasksRequired: 50, name: "–≠–∫—Å–ø–µ—Ä—Ç" },
    6: { tasksRequired: 60, name: "–ú–∞—Å—Ç–µ—Ä" },
    7: { tasksRequired: 70, name: "–ì—É—Ä—É" },
    8: { tasksRequired: 80, name: "–õ–µ–≥–µ–Ω–¥–∞" },
    9: { tasksRequired: 90, name: "–ò–º–ø–µ—Ä–∞—Ç–æ—Ä" },
    10: { tasksRequired: 100, name: "–ë–æ–≥ –∑–∞–¥–∞–Ω–∏–π" }
};

// üîß –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –†–ê–°–ß–ï–¢–ê –£–†–û–í–ù–Ø –ë–ï–ó –ë–û–ù–£–°–û–í
function calculateUserLevel(completedTasks) {
    let currentLevel = 1;
    let tasksForCurrentLevel = 0;
    let tasksForNextLevel = LEVEL_SYSTEM[1].tasksRequired;
    let progressPercentage = 0;
    
    // –ù–∞—Ö–æ–¥–∏–º —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å
    for (let level = 1; level <= Object.keys(LEVEL_SYSTEM).length; level++) {
        if (completedTasks >= LEVEL_SYSTEM[level].tasksRequired) {
            currentLevel = level;
        } else {
            break;
        }
    }
    

    
    // –ù–∞—Ö–æ–¥–∏–º —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å
    for (let level = 1; level <= Object.keys(LEVEL_SYSTEM).length; level++) {
        if (completedTasks >= LEVEL_SYSTEM[level].tasksRequired) {
            currentLevel = level;
        } else {
            break;
        }
    }
    
    // –†–∞—Å—á–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
    const currentLevelRequirement = LEVEL_SYSTEM[currentLevel].tasksRequired;
    
    if (currentLevel < Object.keys(LEVEL_SYSTEM).length) {
        const nextLevelRequirement = LEVEL_SYSTEM[currentLevel + 1].tasksRequired;
        const tasksForCurrentLevel = completedTasks - currentLevelRequirement;
        const totalTasksForNextLevel = nextLevelRequirement - currentLevelRequirement;
        
        progressPercentage = Math.min(100, Math.round((tasksForCurrentLevel / totalTasksForNextLevel) * 100));
    } else {
        // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç
        progressPercentage = 100;
    }
    
    return {
        level: currentLevel,
        levelName: LEVEL_SYSTEM[currentLevel].name,
        completedTasks: completedTasks,
        progressPercentage: progressPercentage,
        isMaxLevel: currentLevel === Object.keys(LEVEL_SYSTEM).length
    };
}

function previewTaskImage(input) {
    if (!input.files || !input.files[0]) return;
    
    const file = input.files[0];
    const preview = document.getElementById('task-image-preview');
    const placeholder = document.querySelector('.upload-placeholder');
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
    currentTaskImage = file;
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
    if (!file.type.startsWith('image/')) {
        showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ', 'error');
        currentTaskImage = null;
        return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
    if (file.size > 5 * 1024 * 1024) {
        showNotification('–†–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 5MB', 'error');
        currentTaskImage = null;
        return;
    }
    
    const reader = new FileReader();
    
    reader.onload = function(e) {
        preview.src = e.target.result;
        preview.style.display = 'block';
        if (placeholder) {
            placeholder.style.display = 'none';
        }
    };
    
    reader.onerror = function() {
        showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è', 'error');
        currentTaskImage = null;
    };
    
    reader.readAsDataURL(file);
}
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
// –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
document.addEventListener('DOMContentLoaded', function() {
    console.log('‚úÖ DOM loaded, initializing promocodes...');
    initializePromocodes();
});

function initializePromocodes() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    const elements = [
        'promocode-code',
        'promocode-max-uses', 
        'promocode-reward',
        'promocode-expires',
        'promocode-form-message',
        'create-promocode-btn'
    ];
    
    elements.forEach(id => {
        const element = document.getElementById(id);
        console.log(`üîç ${id}:`, element ? 'FOUND' : 'NOT FOUND');
    });
}

async function makeRequest(endpoint, options = {}) {
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), 30000); // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ç–∞–π–º–∞—É—Ç –¥–æ 30 —Å–µ–∫—É–Ω–¥
    
    try {
        let url;
        if (endpoint.startsWith('http')) {
            url = endpoint;
        } else if (endpoint.startsWith('/api')) {
            url = API_BASE_URL + endpoint;
        } else {
            url = API_BASE_URL + '/api' + (endpoint.startsWith('/') ? endpoint : '/' + endpoint);
        }
        
        console.log(`üöÄ Making ${options.method || 'GET'} request to: ${url}`);
        
        const response = await fetch(url, {
            headers: {
                'Content-Type': 'application/json',
                ...options.headers
            },
            signal: controller.signal,
            ...options
        });

        clearTimeout(timeoutId);

        if (!response.ok) {
            const errorText = await response.text();
            console.error(`‚ùå HTTP ${response.status}: ${errorText}`);
            
            // üî• –£–õ–£–ß–®–ï–ù–ù–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê HTTP –û–®–ò–ë–û–ö
            if (response.status === 403) {
                throw new Error('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤.');
            } else if (response.status === 404) {
                throw new Error('–†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω.');
            } else if (response.status === 500) {
                throw new Error('–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
            } else if (response.status === 502) {
                throw new Error('–ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º. –°–µ—Ä–≤–µ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.');
            } else {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
        }

        const data = await response.json();
        console.log('üì® Response received:', data);
        return data;
        
    } catch (error) {
        clearTimeout(timeoutId);
        console.error('üí• Request failed:', error);
        
        // üî• –£–õ–£–ß–®–ï–ù–ù–ê–Ø –ö–õ–ê–°–°–ò–§–ò–ö–ê–¶–ò–Ø –û–®–ò–ë–û–ö
        if (error.name === 'AbortError') {
            throw new Error('–¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞. –°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç.');
        } else if (error.name === 'TypeError') {
            throw new Error('–ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–µ—Ç—å—é. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.');
        } else if (error.message.includes('Failed to fetch')) {
            throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.');
        } else {
            throw error;
        }
    }
}
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ endpoint'–æ–≤
async function debugAdminEndpoints() {
    console.log('üîç Debugging admin endpoints...');
    
    try {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–∑–æ–≤—ã–π health endpoint
        const health = await makeRequest('/api/health');
        console.log('‚úÖ Health endpoint:', health);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º endpoint –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞
        const testData = {
            adminId: currentUser.id,
            username: 'testuser'
        };
        
        console.log('üß™ Testing admin endpoint with:', testData);
        
        // –ü—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint'–∞
        const response = await fetch(API_BASE_URL + '/api/admin/add-admin', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(testData)
        });
        
        console.log('üì° Endpoint response status:', response.status);
        console.log('üì° Endpoint response ok:', response.ok);
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
    } catch (error) {
        console.error('‚ùå Endpoint debug failed:', error);
    }
}



// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è endpoint'–æ–≤
async function testEndpoints() {
    if (!currentUser || parseInt(currentUser.id) !== ADMIN_ID) return;
    
    try {
        console.log('üß™ Testing endpoints...');
        
        // –¢–µ—Å—Ç–∏—Ä—É–µ–º –±–∞–∑–æ–≤—ã–π endpoint
        const health = await makeRequest('/health');
        console.log('‚úÖ Health endpoint:', health);
        
        // –¢–µ—Å—Ç–∏—Ä—É–µ–º debug endpoints
        const debug = await makeRequest('/debug/endpoints');
        console.log('‚úÖ Debug endpoints:', debug);
        
        // –¢–µ—Å—Ç–∏—Ä—É–µ–º admins-list endpoint
        const admins = await makeRequest(`/admin/admins-list?adminId=${currentUser.id}`);
        console.log('‚úÖ Admins list endpoint:', admins);
        
    } catch (error) {
        console.error('‚ùå Endpoint test failed:', error);
    }
}

// –í—ã–∑–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
setTimeout(() => {
    if (currentUser && parseInt(currentUser.id) === ADMIN_ID) {
        testEndpoints();
    }
}, 5000);
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Initializing LinkGold app...');
            
            if (typeof tg !== 'undefined') {
                tg.expand();
                tg.ready();
                initializeTelegramUser();
            } else {
                console.log('Telegram Web App context not available');
                initializeTestUser();
            }
        });

async function initializeTelegramUser() {
    try {
        if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
            const tgUser = tg.initDataUnsafe.user;
            
            currentUser = {
                id: tgUser.id,
                firstName: tgUser.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                lastName: tgUser.last_name || '',
                username: tgUser.username || `user_${tgUser.id}`,
                photoUrl: tgUser.photo_url || '',
                isAdmin: parseInt(tgUser.id) === ADMIN_ID
            };
            
            // –ü—Ä–æ—Å—Ç–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –±–µ–∑ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞ (–æ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –±–æ—Ç–µ)
            try {
                const authResult = await makeRequest('/user/auth', {
                    method: 'POST',
                    body: JSON.stringify({
                        user: currentUser
                    })
                });
                
                if (authResult.success) {
                    Object.assign(currentUser, authResult.user);
                }
            } catch (authError) {
                console.log('Auth endpoint not available, continuing with basic user data');
            }
            
            initializeApp();
        } else {
            console.log('Telegram user data not available');
            initializeTestUser();
        }
    } catch (error) {
        console.error('Error initializing Telegram user:', error);
        initializeTestUser();
    }
}

function debugWithdrawalSystem() {
    console.log('üêõ DEBUG Withdrawal System:');
    console.log('- currentUser:', currentUser); // ‚Üê –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–µ
    console.log('- isAdmin:', currentUser?.is_admin);
    
    // –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ª–∏ –∑–∞–ø—Ä–æ—Å—ã
    loadWithdrawalRequests().then(() => {
        console.log('‚úÖ Withdrawal requests loaded');
    }).catch(error => {
        console.error('‚ùå Error loading withdrawal requests:', error);
    });
}
// üîß –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø –ò–ù–¢–ï–†–§–ï–ô–°–ê –ü–†–û–í–ï–†–ö–ò
function updateVerificationInterface() {
    if (document.getElementById('admin-verification-section').style.display === 'block') {
        loadTaskVerifications();
    }
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
setInterval(updateVerificationInterface, 30000);
// –í—ã–∑–æ–≤–∏—Ç–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
// setTimeout(debugWithdrawalSystem, 3000);
// üìù –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ (–±–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏)
async function addNewPostAsAdmin() {
    if (!currentUser) return;
    
    const title = prompt('–í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å—Ç–∞:');
    if (!title) return;
    
    const content = prompt('–í–≤–µ–¥–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ø–æ—Å—Ç–∞:');
    if (!content) return;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞
    const isAdmin = await checkAdminAccess(currentUser.id);
    if (!isAdmin) {
        showNotification('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø–æ—Å—Ç—ã!', 'error');
        return;
    }
    
    try {
        const result = await makeRequest('/posts', {
            method: 'POST',
            body: JSON.stringify({
                title: title,
                content: content,
                author: currentUser.firstName,
                authorId: currentUser.id
            })
        });

        if (result.success) {
            showNotification('–ü–æ—Å—Ç —É—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω!', 'success');
            loadMainPagePosts();
        } else {
            showNotification('–û—à–∏–±–∫–∞: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('Error adding post:', error);
        showNotification('–û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ—Å—Ç–∞', 'error');
    }
}

// üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞
async function deletePostAsAdmin(postId) {
    if (!currentUser) return;
    
    if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø–æ—Å—Ç?')) return;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞
    const isAdmin = await checkAdminAccess(currentUser.id);
    if (!isAdmin) {
        showNotification('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –ø–æ—Å—Ç—ã!', 'error');
        return;
    }
    
    try {
        const result = await makeRequest(`/posts/${postId}`, {
            method: 'DELETE',
            body: JSON.stringify({ authorId: currentUser.id })
        });

        if (result.success) {
            showNotification('–ü–æ—Å—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!', 'success');
            loadMainPagePosts();
        } else {
            showNotification('–û—à–∏–±–∫–∞: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('Error deleting post:', error);
        showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞', 'error');
    }
}

// üìã –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è
async function addTaskAsAdmin() {
    if (!currentUser) return;
    
    const title = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è:');
    if (!title) return;
    
    const description = prompt('–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è:');
    if (!description) return;
    
    const price = prompt('–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É –∑–∞–¥–∞–Ω–∏—è (–≤ —Ä—É–±–ª—è—Ö):');
    if (!price) return;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞
    const isAdmin = await checkAdminAccess(currentUser.id);
    if (!isAdmin) {
        showNotification('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è!', 'error');
        return;
    }
    
    try {
        const result = await makeRequest('/tasks', {
            method: 'POST',
            body: JSON.stringify({
                title: title,
                description: description,
                price: parseFloat(price),
                created_by: currentUser.id
            })
        });

        if (result.success) {
            showNotification('–ó–∞–¥–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ!', 'success');
            loadTasks();
        } else {
            showNotification('–û—à–∏–±–∫–∞: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('Error adding task:', error);
        showNotification('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è', 'error');
    }
}

// üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è
async function deleteTaskAsAdmin(taskId) {
    if (!currentUser) return;
    
    if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ?')) return;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞
    const isAdmin = await checkAdminAccess(currentUser.id);
    if (!isAdmin) {
        showNotification('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –∑–∞–¥–∞–Ω–∏—è!', 'error');
        return;
    }
    
    try {
        const result = await makeRequest(`/tasks/${taskId}`, {
            method: 'DELETE',
            body: JSON.stringify({ adminId: currentUser.id })
        });

        if (result.success) {
            showNotification('–ó–∞–¥–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ!', 'success');
            loadTasks();
        } else {
            showNotification('–û—à–∏–±–∫–∞: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('Error deleting task:', error);
        showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è', 'error');
    }
}

// ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞–Ω–∏–π (–¥–ª—è –∞–¥–º–∏–Ω–æ–≤)
async function loadTaskVerificationsForAdmin() {
    if (!currentUser) return;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞
    const isAdmin = await checkAdminAccess(currentUser.id);
    if (!isAdmin) return;
    
    try {
        const result = await makeRequest(`/admin/task-verifications?adminId=${currentUser.id}`);
        if (result.success) {
            showVerificationsModal(result.verifications);
        }
    } catch (error) {
        console.error('Error loading verifications:', error);
    }
}

// üé® –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–¥–∞–Ω–∏–π

function showVerificationsModal(verifications) {
    let modalHTML = `
        <div class="modal active" id="verifications-modal">
            <div class="modal-content" style="max-width: 600px; max-height: 80vh; overflow-y: auto;">
                <div class="modal-header">
                    <div class="modal-title">‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞–Ω–∏–π</div>
                    <button class="modal-close" onclick="closeModal('verifications-modal')">√ó</button>
                </div>
                <div class="modal-body">
    `;
    
    if (!verifications || verifications.length === 0) {
        modalHTML += ``;
    } else {
        verifications.forEach(verification => {
            modalHTML += `
                <div class="verification-item" style="margin-bottom: 16px; padding: 16px; border: 1px solid var(--border); border-radius: 12px;">
                    <div style="display: flex; justify-content: between; align-items: start; margin-bottom: 12px;">
                        <div style="flex: 1;">
                            <div style="font-weight: 600;">${verification.user_name}</div>
                            <div style="color: var(--text-secondary); font-size: 14px;">${verification.task_title}</div>
                        </div>
                        <div style="font-weight: 700; color: var(--gold);">${verification.task_price} ‚≠ê</div>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <img src="${verification.screenshot_url}" alt="–°–∫—Ä–∏–Ω—à–æ—Ç" style="width: 100%; border-radius: 8px;">
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-success" style="flex: 1;" onclick="approveVerification(${verification.id})">‚úÖ –û–¥–æ–±—Ä–∏—Ç—å</button>
                        <button class="btn btn-error" style="flex: 1;" onclick="rejectVerification(${verification.id})">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                    </div>
                </div>
            `;
        });
    }
    
    modalHTML += `
                </div>
            </div>
        </div>
    `;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤ DOM
    document.body.insertAdjacentHTML('beforeend', modalHTML);
}
// –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
function optimizeImages() {
    const images = document.querySelectorAll('img');
    images.forEach(img => {
        // –î–æ–±–∞–≤–ª—è–µ–º lazy loading
        img.loading = 'lazy';
        
        // –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä
        if (img.width > 300) {
            img.style.maxWidth = '100%';
            img.style.height = 'auto';
        }
    });
}

// –°–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π
function compressImage(file, maxSize = 50000) {
    return new Promise((resolve) => {
        if (file.size <= maxSize) {
            resolve(file);
            return;
        }
        
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        
        img.onload = () => {
            const scale = Math.sqrt(maxSize / file.size);
            canvas.width = img.width * scale;
            canvas.height = img.height * scale;
            
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            canvas.toBlob(resolve, 'image/jpeg', 0.7);
        };
        
        img.src = URL.createObjectURL(file);
    });
}
// –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ DOM
class DOMOptimizer {
    constructor() {
        this.updateQueue = [];
        this.batchTimeout = null;
    }
    
    // –ë–∞—Ç—á–∏–Ω–≥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
    batchUpdate(callback) {
        this.updateQueue.push(callback);
        
        if (!this.batchTimeout) {
            this.batchTimeout = setTimeout(() => {
                this.flushUpdates();
            }, 16); // –û–¥–∏–Ω –∫–∞–¥—Ä
        }
    }
    
    flushUpdates() {
        const fragment = document.createDocumentFragment();
        
        this.updateQueue.forEach(callback => {
            callback(fragment);
        });
        
        // –ï–¥–∏–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ DOM
        document.getElementById('tasks-container').appendChild(fragment);
        
        this.updateQueue = [];
        this.batchTimeout = null;
    }
    
    // –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    createElement(tag, attributes = {}) {
        const element = document.createElement(tag);
        Object.keys(attributes).forEach(key => {
            element[key] = attributes[key];
        });
        return element;
    }
}
// –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
const apiCache = new Map();

async function cachedRequest(url, options = {}) {
    const cacheKey = JSON.stringify({ url, options });
    
    if (apiCache.has(cacheKey)) {
        return apiCache.get(cacheKey);
    }
    
    const response = await fetch(url, options);
    const data = await response.json();
    
    // –ö—ç—à–∏—Ä—É–µ–º –Ω–∞ 30 —Å–µ–∫—É–Ω–¥
    apiCache.set(cacheKey, data);
    setTimeout(() => apiCache.delete(cacheKey), 30000);
    
    return data;
}

// –ú–µ–º–æ–∏–∑–∞—Ü–∏—è —Ç—è–∂–µ–ª—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
function memoize(fn) {
    const cache = new Map();
    return function(...args) {
        const key = JSON.stringify(args);
        if (cache.has(key)) return cache.get(key);
        
        const result = fn.apply(this, args);
        cache.set(key, result);
        return result;
    };
}
// –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
class PriorityLoader {
    constructor() {
        this.priorityQueue = [];
    }
    
    addCritical(resource, priority = 0) {
        this.priorityQueue.push({ resource, priority });
        this.priorityQueue.sort((a, b) => b.priority - a.priority);
    }
    
    async load() {
        for (const item of this.priorityQueue) {
            await this.loadResource(item.resource);
        }
    }
    
    async loadResource(resource) {
        if (resource.type === 'script') {
            await this.loadScript(resource.url);
        } else if (resource.type === 'data') {
            await this.loadData(resource.url);
        }
    }
}
// üí¨ –ê–¥–º–∏–Ω-—á–∞—Ç —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
async function openAdminSupportChat() {
    if (!currentUser) return;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞
    const isAdmin = await checkAdminAccess(currentUser.id);
    if (!isAdmin) {
        showNotification('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –≤ —á–∞—Ç–µ!', 'error');
        return;
    }
    
    try {
        const result = await makeRequest(`/support/chats?adminId=${currentUser.id}`);
        if (result.success) {
            showAdminChatsModal(result.chats);
        }
    } catch (error) {
        console.error('Error loading admin chats:', error);
    }
}

// üé® –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —á–∞—Ç–æ–≤ –¥–ª—è –∞–¥–º–∏–Ω–∞
function showAdminChatsModal(chats) {
    let modalHTML = `
        <div class="modal active" id="admin-chats-modal">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header">
                    <div class="modal-title">üí¨ –ß–∞—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</div>
                    <button class="modal-close" onclick="closeModal('admin-chats-modal')">√ó</button>
                </div>
                <div class="modal-body">
    `;
    
    if (!chats || chats.length === 0) {
        modalHTML += `
            <div style="text-align: center; padding: 40px;">
                <div style="font-size: 48px; margin-bottom: 16px;">üí¨</div>
                <div>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤</div>
            </div>
        `;
    } else {
        chats.forEach(chat => {
            modalHTML += `
                <div class="chat-item" style="display: flex; align-items: center; padding: 12px; border: 1px solid var(--border); border-radius: 12px; margin-bottom: 8px; cursor: pointer;" onclick="openChatWithUser(${chat.id})">
                    <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--purple-gradient); display: flex; align-items: center; justify-content: center; margin-right: 12px; color: white; font-weight: 600;">
                        ${chat.user_name ? chat.user_name.charAt(0).toUpperCase() : 'U'}
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600;">${chat.user_name}</div>
                        <div style="color: var(--text-secondary); font-size: 12px;">${chat.last_message || '–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π'}</div>
                    </div>
                </div>
            `;
        });
    }
    
    modalHTML += `
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
}

// üîß –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
function updateAdminInterface() {
    if (!currentUser) return;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    checkAdminAccess(currentUser.id).then(isAdmin => {
        if (isAdmin) {
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ –≤ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            addAdminButtonsToMainPage();
        }
    });
}

// üé® –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –∞–¥–º–∏–Ω–∞ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
function addAdminButtonsToMainPage() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –ª–∏ –∫–Ω–æ–ø–∫–∏ —É–∂–µ
    if (document.getElementById('admin-buttons-container')) return;
    
    const adminButtonsHTML = `
        <div id="admin-buttons-container" class="card fade-in" style="margin-top: 20px;">
            <h3 style="margin-bottom: 16px; text-align: center;">‚öôÔ∏è –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <button class="btn btn-primary" onclick="addNewPostAsAdmin()">üìù –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å—Ç</button>
                <button class="btn btn-primary" onclick="addTaskAsAdmin()">üìã –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ</button>
                <button class="btn btn-warning" onclick="loadTaskVerificationsForAdmin()">‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–¥–∞–Ω–∏—è</button>
                <button class="btn btn-success" onclick="openAdminSupportChat()">üí¨ –û—Ç–≤–µ—Ç–∏—Ç—å –≤ —á–∞—Ç–∞—Ö</button>
            </div>
        </div>
    `;
    
    const mainTab = document.getElementById('main-tab');
    if (mainTab) {
        mainTab.insertAdjacentHTML('beforeend', adminButtonsHTML);
    }
}



// –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
async function isUserAdmin(userId) {
    try {
        const result = await pool.query(
            'SELECT is_admin FROM user_profiles WHERE user_id = $1',
            [userId]
        );
        
        if (result.rows.length > 0) {
            return result.rows[0].is_admin === true || parseInt(userId) === ADMIN_ID;
        }
        return parseInt(userId) === ADMIN_ID;
    } catch (error) {
        return parseInt(userId) === ADMIN_ID;
    }
}

// –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ - –¥–ª—è –≤—Å–µ—Ö –∞–¥–º–∏–Ω–æ–≤
app.post('/api/posts', async (req, res) => {
    const { title, content, author, authorId } = req.body;
    
    if (!title || !content || !author) {
        return res.status(400).json({
            success: false,
            error: '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'
        });
    }
    
    // ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê - –≤—Å–µ –∞–¥–º–∏–Ω—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ—Å—Ç—ã
    const userIsAdmin = await isUserAdmin(authorId);
    if (!userIsAdmin) {
        return res.status(403).json({
            success: false,
            error: '–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø–æ—Å—Ç—ã!'
        });
    }
    
    try {
        const result = await pool.query(`
            INSERT INTO posts (title, content, author, author_id) 
            VALUES ($1, $2, $3, $4)
            RETURNING *
        `, [title, content, author, authorId]);
        
        res.json({
            success: true,
            message: '–ü–æ—Å—Ç —É—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω!',
            post: result.rows[0]
        });
    } catch (error) {
        console.error('Create post error:', error);
        res.status(500).json({
            success: false,
            error: '–û—à–∏–±–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö'
        });
    }
});

// üîß –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò –ü–†–û–ë–õ–ï–ú–´ –° –ó–ê–ì–†–£–ó–ö–û–ô
function debugTasksLoading() {
    console.log('üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ó–ê–ì–†–£–ó–ö–ò –ó–ê–î–ê–ù–ò–ô:');
    
    const tasksTab = document.getElementById('tasks-tab');
    const newTasksContainer = document.getElementById('new-tasks');
    const activeTasksContainer = document.querySelector('#new-tasks.active');
    
    console.log('- tasks-tab exists:', !!tasksTab);
    console.log('- tasks-tab active:', tasksTab?.classList.contains('active'));
    console.log('- new-tasks container exists:', !!newTasksContainer);
    console.log('- new-tasks container active:', !!activeTasksContainer);
    console.log('- new-tasks display:', newTasksContainer?.style.display);
    console.log('- currentUser exists:', !!currentUser);
    console.log('- allTasks count:', allTasks?.length || 0);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
    if (newTasksContainer) {
        const rect = newTasksContainer.getBoundingClientRect();
        console.log('- new-tasks visible:', rect.width > 0 && rect.height > 0);
    }
}
// üîç –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
async function checkUserIsAdmin(userId) {
    try {
        const result = await makeRequest(`/user/${userId}`);
        if (result.success) {
            return result.profile.is_admin === true || parseInt(userId) === ADMIN_ID;
        }
        return false;
    } catch (error) {
        console.error('Admin check error:', error);
        return false;
    }
}
// üîß –§–£–ù–ö–¶–ò–Ø –§–ò–õ–¨–¢–†–ê–¶–ò–ò –ó–ê–î–ê–ù–ò–ô –ü–û –ö–ê–¢–ï–ì–û–†–ò–Ø–ú
function filterTasks(category) {
    console.log('üéØ Filtering tasks by category:', category);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
    const searchText = document.getElementById('task-search').value.trim();
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–¥–∞–Ω–∏—è —Å —Ñ–∏–ª—å—Ç—Ä–æ–º
    loadTasks(searchText, category);
}

async function loadTasks(search = '', category = 'all') {
    try {
        console.log('üéØ START loadTasks with filter:', { 
            search, 
            category, 
            userId: currentUser?.id,
            hasUser: !!currentUser
        });

        if (!currentUser) {
            console.log('‚ùå No current user, aborting loadTasks');
            showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω', 'error');
            return;
        }

        const newTasksContainer = document.getElementById('new-tasks');
        if (!newTasksContainer) {
            console.log('‚ùå new-tasks container not found');
            return;
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        newTasksContainer.innerHTML = `
            <div class="no-tasks" style="min-height: 200px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                <div class="loading-spinner">‚è≥</div>
                <div style="margin-top: 16px;">–ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–¥–∞–Ω–∏—è...</div>
                <div style="font-size: 12px; color: var(--text-secondary); margin-top: 8px;">
                    ID: ${currentUser.id}
                </div>
            </div>
        `;

        // –§–æ—Ä–º–∏—Ä—É–µ–º URL —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
        const params = new URLSearchParams();
        params.append('userId', currentUser.id);
        if (search) params.append('search', search);
        if (category && category !== 'all') params.append('category', category);
        
        const url = `/api/tasks?${params.toString()}`;
        console.log('üì° Request URL:', url);

        const response = await fetch(API_BASE_URL + url);
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const result = await response.json();
        console.log('üì® Server response:', result);

        if (result.success) {
            allTasks = result.tasks || [];
            console.log (`‚úÖ Loaded ${allTasks.length} tasks:`, allTasks.map(t => ({id: t.id, title: t.title})));
            
            // üî• –í–ê–ñ–ù–û: –¢–µ–ø–µ—Ä—å —Å–µ—Ä–≤–µ—Ä —Å–∞–º —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è
            // –ü—Ä–æ—Å—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–æ, —á—Ç–æ –ø—Ä–∏—à–ª–æ —Å —Å–µ—Ä–≤–µ—Ä–∞
            displayTasks(allTasks, 'new');
            
        } else {
            throw new Error(result.error || 'Unknown server error');
        }

    } catch (error) {
        console.error('üí• loadTasks error:', error);
        
        const newTasksContainer = document.getElementById('new-tasks');
        if (newTasksContainer) {
            newTasksContainer.innerHTML = `
                <div class="no-tasks" style="min-height: 200px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                    <div style="font-size: 48px; margin-bottom: 16px;">‚ùå</div>
                    <div>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞–Ω–∏–π</div>
                    <div style="font-size: 12px; color: var(--text-secondary); margin: 8px 0;">
                        ${error.message}
                    </div>
                    <button class="btn btn-primary" onclick="loadTasks()" style="margin-top: 16px;">
                        –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                    </button>
                </div>
            `;
        }
        
        showNotification(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞–Ω–∏–π: ${error.message}`, 'error');
    }
}

// üîß –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
async function getUserActiveTasks() {
    if (!currentUser) return [];
    
    try {
        const response = await fetch(`${API_BASE_URL}/api/user/${currentUser.id}/tasks/active-ids`);
        if (response.ok) {
            const result = await response.json();
            if (result.success) {
                return result.taskIds || [];
            }
        }
    } catch (error) {
        console.error('Error getting user active tasks:', error);
    }
    
    return [];
}
// üîß –§–£–ù–ö–¶–ò–Ø –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –û–¢–§–ò–õ–¨–¢–†–û–í–ê–ù–ù–´–• –ó–ê–î–ê–ù–ò–ô
function displayFilteredTasks(tasks, category, search) {
    const container = document.getElementById('new-tasks');
    if (!container) {
        console.error('‚ùå Container not found');
        return;
    }
    
    container.innerHTML = '';
    
    // –§–∏–ª—å—Ç—Ä—É–µ–º –∑–∞–¥–∞—á–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —É–∂–µ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ, –Ω–æ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏)
    let filteredTasks = tasks;
    
    if (search) {
        const searchLower = search.toLowerCase();
        filteredTasks = tasks.filter(task => 
            task.title.toLowerCase().includes(searchLower) ||
            task.description.toLowerCase().includes(searchLower) ||
            (task.category && task.category.toLowerCase().includes(searchLower))
        );
    }
    
    if (!filteredTasks || filteredTasks.length === 0) {
        let message = '–ó–∞–¥–∞–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ';
        if (search && category !== 'all') {
            message = `–ù–µ—Ç –∑–∞–¥–∞–Ω–∏–π –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${getCategoryDisplayName(category)}" –ø–æ –∑–∞–ø—Ä–æ—Å—É "${search}"`;
        } else if (search) {
            message = `–ù–µ—Ç –∑–∞–¥–∞–Ω–∏–π –ø–æ –∑–∞–ø—Ä–æ—Å—É "${search}"`;
        } else if (category !== 'all') {
            message = `–ù–µ—Ç –∑–∞–¥–∞–Ω–∏–π –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${getCategoryDisplayName(category)}"`;
        }
        
        container.innerHTML = `
            <div class="no-tasks" style="min-height: 200px; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; text-align: center;">
                <div style="font-size: 48px; margin-bottom: 16px;">üîç</div>
                <div style="font-size: 18px; margin-bottom: 8px;">${message}</div>
                <div style="font-size: 14px; color: var(--text-secondary);">
                    –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                </div>
                <button class="btn btn-primary" onclick="clearFilters()" style="margin-top: 16px;">
                    –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                </button>
            </div>
        `;
        return;
    }
    
    console.log(`üé® Rendering ${filteredTasks.length} filtered tasks...`);
    
    filteredTasks.forEach((task, index) => {
        const taskElement = createTaskCardWithImage(task, 'new', index);
        container.appendChild(taskElement);
    });
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∏–ª—å—Ç—Ä–∞—Ö
    showFilterInfo(category, search, filteredTasks.length);
}

// üîß –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –ò–ù–§–û–†–ú–ê–¶–ò–ò –û –§–ò–õ–¨–¢–†–ê–•
function showFilterInfo(category, search, count) {
    // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∏–ª—å—Ç—Ä–∞—Ö
    let filterInfo = document.getElementById('filter-info');
    if (!filterInfo) {
        filterInfo = document.createElement('div');
        filterInfo.id = 'filter-info';
        filterInfo.style.cssText = `
            margin: 10px 0;
            padding: 10px;
            background: var(--bg-secondary);
            border-radius: 8px;
            font-size: 14px;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        `;
        
        const container = document.getElementById('new-tasks');
        if (container) {
            container.parentNode.insertBefore(filterInfo, container);
        }
    }
    
    let filterText = '';
    if (category !== 'all' && search) {
        filterText = `–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${getCategoryDisplayName(category)} ‚Ä¢ –ü–æ–∏—Å–∫: "${search}"`;
    } else if (category !== 'all') {
        filterText = `–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${getCategoryDisplayName(category)}`;
    } else if (search) {
        filterText = `–ü–æ–∏—Å–∫: "${search}"`;
    } else {
        filterText = '–í—Å–µ –∑–∞–¥–∞–Ω–∏—è';
    }
    
    filterInfo.innerHTML = `
        <span>${filterText} ‚Ä¢ –ù–∞–π–¥–µ–Ω–æ: ${count}</span>
        ${(category !== 'all' || search) ? `
            <button class="btn btn-secondary" onclick="clearFilters()" style="padding: 4px 8px; font-size: 12px;">
                ‚úï –°–±—Ä–æ—Å–∏—Ç—å
            </button>
        ` : ''}
    `;
}

// üîß –§–£–ù–ö–¶–ò–Ø –°–ë–†–û–°–ê –§–ò–õ–¨–¢–†–û–í
function clearFilters() {
    console.log('üîÑ Clearing all filters');
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞
    const searchInput = document.getElementById('task-search');
    if (searchInput) {
        searchInput.value = '';
    }
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector('.filter-btn[data-filter="all"]').classList.add('active');
    
    // –£–¥–∞–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∏–ª—å—Ç—Ä–∞—Ö
    const filterInfo = document.getElementById('filter-info');
    if (filterInfo) {
        filterInfo.remove();
    }
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è
    loadTasks();
}

// üîß –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–û–õ–£–ß–ï–ù–ò–Ø –û–¢–û–ë–†–ê–ñ–ê–ï–ú–û–ì–û –ò–ú–ï–ù–ò –ö–ê–¢–ï–ì–û–†–ò–ò
function getCategoryDisplayName(category) {
    const categoryMap = {
        'all': '–í—Å–µ',
        'social': '–°–æ—Ü—Å–µ—Ç–∏',
        'subscribe': '–ü–æ–¥–ø–∏—Å–∫–∏',
        'view': '–ü—Ä–æ—Å–º–æ—Ç—Ä—ã',
        'comment': '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏',
        'repost': '–†–µ–ø–æ—Å—Ç—ã',
        'other': '–î—Ä—É–≥–æ–µ'
    };
    
    return categoryMap[category] || category;
}

// üîß –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–û–ò–°–ö–ê
function initializeSearch() {
    const searchInput = document.getElementById('task-search');
    if (searchInput) {
        let searchTimeout;
        searchInput.addEventListener('input', function(e) {
            clearTimeout(searchTimeout);
            const searchText = e.target.value.trim();
            
            searchTimeout = setTimeout(() => {
                const activeFilter = document.querySelector('.filter-btn.active');
                const filter = activeFilter ? activeFilter.getAttribute('data-filter') : 'all';
                
                loadTasks(searchText, filter);
            }, 300);
        });
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ onclick
    console.log('‚úÖ Search and filters initialized');
}

// üîß –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ü–û–ö–ê–ó–ê –ö–ê–¢–ï–ì–û–†–ò–ò –ó–ê–î–ê–ù–ò–ô
function showTaskCategory(category) {
    console.log('üîÑ Switching to category:', category);
    
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
    const tabs = document.querySelectorAll('.task-tab');
    const containers = document.querySelectorAll('.tasks-grid');
    
    tabs.forEach(tab => tab.classList.remove('active'));
    containers.forEach(container => {
        container.classList.remove('active');
        container.style.display = 'none';
    });
    
    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
    const activeTab = Array.from(tabs).find(tab => 
        tab.textContent.toLowerCase().includes(getCategoryName(category))
    );
    if (activeTab) {
        activeTab.classList.add('active');
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
    const targetContainer = document.getElementById(`${category}-tasks`);
    if (targetContainer) {
        targetContainer.classList.add('active');
        targetContainer.style.display = 'block';
        console.log(`‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä ${category}-tasks –ø–æ–∫–∞–∑–∞–Ω`);
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        if (category === 'new') {
            // –î–ª—è –Ω–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏–π –∑–∞–≥—Ä—É–∂–∞–µ–º —Å —Ç–µ–∫—É—â–∏–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
            const searchText = document.getElementById('task-search').value.trim();
            const activeFilter = document.querySelector('.filter-btn.active');
            const filter = activeFilter ? activeFilter.getAttribute('data-filter') : 'all';
            
            loadTasks(searchText, filter);
        } else {
            // –î–ª—è –¥—Ä—É–≥–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø—Ä–æ—Å—Ç–æ –∑–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–¥–∞–Ω–∏—è
            loadTasksForCategory(category);
        }
    } else {
        console.error(`‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä ${category}-tasks –Ω–µ –Ω–∞–π–¥–µ–Ω`);
    }
}

// üîß –≠–ö–°–ü–û–†–¢ –§–£–ù–ö–¶–ò–ô
window.filterTasks = filterTasks;
window.clearFilters = clearFilters;
window.loadTasks = loadTasks;

// üìù –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞ (–¥–ª—è –≤—Å–µ—Ö –∞–¥–º–∏–Ω–æ–≤)
async function addNewPostAsAdmin() {
    if (!currentUser) {
        showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω', 'error');
        return;
    }
    
    // ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê
    const isAdmin = await checkUserIsAdmin(currentUser.id);
    if (!isAdmin) {
        showNotification('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø–æ—Å—Ç—ã!', 'error');
        return;
    }
    
    const title = prompt('–í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å—Ç–∞:');
    if (!title) return;
    
    const content = prompt('–í–≤–µ–¥–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ø–æ—Å—Ç–∞:');
    if (!content) return;
    
    try {
        const result = await makeRequest('/posts', {
            method: 'POST',
            body: JSON.stringify({
                title: title,
                content: content,
                author: currentUser.firstName,
                authorId: currentUser.id
            })
        });

        if (result.success) {
            showNotification('–ü–æ—Å—Ç —É—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω!', 'success');
            loadMainPagePosts();
        } else {
            showNotification('–û—à–∏–±–∫–∞: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('Error adding post:', error);
        showNotification('–û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ—Å—Ç–∞', 'error');
    }
}
// –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
document.addEventListener('DOMContentLoaded', function() {
  const lazyImages = [].slice.call(document.querySelectorAll('img[data-src]'));
  
  if ('IntersectionObserver' in window) {
    let lazyImageObserver = new IntersectionObserver(function(entries, observer) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          let lazyImage = entry.target;
          lazyImage.src = lazyImage.dataset.src;
          lazyImage.classList.remove('lazy');
          lazyImageObserver.unobserve(lazyImage);
        }
      });
    });

    lazyImages.forEach(function(lazyImage) {
      lazyImageObserver.observe(lazyImage);
    });
  }
});
// –í–º–µ—Å—Ç–æ —Å–ª–æ–∂–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏ - –ø—Ä–æ—Å—Ç–∞—è
function simpleShowTab(tabId) {
  document.querySelectorAll('.tab-content').forEach(tab => {
    tab.style.display = 'none';
  });
  document.getElementById(tabId).style.display = 'block';
}

// –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
async function loadEssentialData() {
  // –ó–∞–≥—Ä—É–∂–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ
  try {
    const [userData, tasks] = await Promise.all([
      fetch('/api/user-data').then(r => r.json()),
      fetch('/api/essential-tasks').then(r => r.json())
    ]);
    return { userData, tasks };
  } catch (error) {
    console.error('Load error:', error);
  }
}
// üìã –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è (–¥–ª—è –≤—Å–µ—Ö –∞–¥–º–∏–Ω–æ–≤)
async function addTaskAsAdmin() {
    if (!currentUser) {
        showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω', 'error');
        return;
    }
    
    // ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê
    const isAdmin = await checkUserIsAdmin(currentUser.id);
    if (!isAdmin) {
        showNotification('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è!', 'error');
        return;
    }
    
    const title = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è:');
    if (!title) return;
    
    const description = prompt('–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è:');
    if (!description) return;
    
    const price = prompt('–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É –∑–∞–¥–∞–Ω–∏—è (–≤ —Ä—É–±–ª—è—Ö):');
    if (!price) return;
    
    try {
        const result = await makeRequest('/tasks', {
            method: 'POST',
            body: JSON.stringify({
                title: title,
                description: description,
                price: parseFloat(price),
                created_by: currentUser.id
            })
        });

        if (result.success) {
            showNotification('–ó–∞–¥–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ!', 'success');
            loadTasks();
        } else {
            showNotification('–û—à–∏–±–∫–∞: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('Error adding task:', error);
        showNotification('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è', 'error');
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
function debugAdminRights() {
    console.log('üêõ DEBUG Admin Rights:');
    console.log('- Current User:', currentUser);
    console.log('- ADMIN_ID:', ADMIN_ID);
    console.log('- is_admin:', currentUser?.is_admin);
    console.log('- isMainAdmin:', currentUser?.id === ADMIN_ID.toString());
    console.log('- Admin Nav Visible:', document.getElementById('admin-nav-item')?.style.display);
    console.log('- Admin Panel Visible:', document.getElementById('admin-panel')?.style.display);
}

// –í—ã–∑–æ–≤ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ (–º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
setTimeout(debugAdminRights, 2000);



        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏
        function showRetryButton() {
            const retryBtn = document.createElement('button');
            retryBtn.textContent = 'üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞';
            retryBtn.className = 'btn btn-primary';
            retryBtn.style.margin = '20px auto';
            retryBtn.style.display = 'block';
            retryBtn.onclick = function() {
                retryBtn.remove();
                initializeApp();
            };
            
            document.body.appendChild(retryBtn);
        }

       // üîß –û–ë–ù–û–í–õ–ï–ù–ù–û–ï –ê–í–¢–û–û–ë–ù–û–í–õ–ï–ù–ò–ï –î–ê–ù–ù–´–•
// –î–æ–±–∞–≤—å—Ç–µ –≤ –Ω–∞—á–∞–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è currentUser
function startUserDataAutoUpdate() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ currentUser –ø–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞
    if (typeof currentUser === 'undefined' || !currentUser) {
        console.log('‚ùå currentUser –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω, –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ');
        setTimeout(startUserDataAutoUpdate, 5000); // –ü–æ–≤—Ç–æ—Ä–∏–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
        return;
    }
    
    setInterval(async () => {
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–Ω—É—Ç—Ä–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞
        if (typeof currentUser === 'undefined' || !currentUser) {
            console.log('‚ùå currentUser –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –≤ –∏–Ω—Ç–µ—Ä–≤–∞–ª–µ');
            return;
        }
        
        try {
            const result = await makeRequest(`/user/${currentUser.id}`);
            if (result.success) {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                const oldLevel = currentUser.level;
                const oldTasksCompleted = currentUser.tasks_completed;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                currentUser = { ...currentUser, ...result.profile };
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                displayUserProfile();
                updateLevelProgress();
                
                console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω—ã');
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
        }
    }, 30000);
}

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function updateUserData() {
            if (!currentUser) return;
            
            try {
                const result = await makeRequest(`/user/${currentUser.id}`);
                if (result.success) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    currentUser = { ...currentUser, ...result.profile };
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö
                    displayUserProfile();
                    
                    console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω—ã:', currentUser.balance);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
            }
        }

        // üîß –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –ü–†–û–§–ò–õ–Ø
function displayUserProfile() {
    if (!currentUser) return;

    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    const firstNameElement = document.getElementById('user-first-name');
    const usernameElement = document.getElementById('user-username');
    const levelElement = document.getElementById('user-level');
    const balanceElement = document.getElementById('user-balance-main');
    
    if (firstNameElement) {
        const fullName = currentUser.lastName ? 
            `${currentUser.firstName} ${currentUser.lastName}` : 
            currentUser.firstName;
        firstNameElement.textContent = fullName;
    }
    
    if (usernameElement) usernameElement.textContent = currentUser.username || 'username';
    if (levelElement) levelElement.textContent = currentUser.level || 1;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö
    const userBalance = currentUser.balance || 0;
    if (balanceElement) balanceElement.textContent = `${userBalance} ‚≠ê`;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä
    const userPhotoElement = document.getElementById('user-photo');
    if (userPhotoElement && currentUser.photoUrl) {
        userPhotoElement.src = currentUser.photoUrl;
        userPhotoElement.alt = '–§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è';
        userPhotoElement.style.display = 'block';
    } else if (userPhotoElement) {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª –µ—Å–ª–∏ –Ω–µ—Ç —Ñ–æ—Ç–æ
        userPhotoElement.style.display = 'flex';
        userPhotoElement.style.alignItems = 'center';
        userPhotoElement.style.justifyContent = 'center';
        userPhotoElement.style.backgroundColor = '#6366f1';
        userPhotoElement.style.color = 'white';
        userPhotoElement.style.fontWeight = 'bold';
        userPhotoElement.style.borderRadius = '50%';
        userPhotoElement.textContent = currentUser.firstName ? currentUser.firstName.charAt(0).toUpperCase() : 'U';
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å
    updateProfileStats();
    updateReferralSystem();
    updateLevelProgress(); // ‚Üê –í–ê–ñ–ù–û: –≤—ã–∑—ã–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —É—Ä–æ–≤–Ω—è

        // –î–æ–±–∞–≤—å—Ç–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    const referralInfo = document.getElementById('referral-info');
    if (referralInfo && currentUser) {
        if (currentUser.referred_by) {
            referralInfo.innerHTML = `
                <div style="background: var(--success-light); padding: 10px; border-radius: 8px; margin: 10px 0;">
                    <div style="font-size: 14px; color: var(--success);">
                        üë• –í—ã –ø—Ä–∏—à–ª–∏ –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ
                    </div>
                    <div style="font-size: 12px; color: var(--text-secondary);">
                        –í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ 90% –æ—Ç –∑–∞—Ä–∞–±–æ—Ç–∫–∞, –ø—Ä–∏–≥–ª–∞—Å–∏–≤—à–∏–π - 10%
                    </div>
                </div>
            `;
        } else {
            referralInfo.innerHTML = `
                <div style="background: var(--bg-secondary); padding: 10px; border-radius: 8px; margin: 10px 0;">
                    <div style="font-size: 14px;">
                        üîó –ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π—Ç–µ 10% –æ—Ç –∏—Ö –∑–∞—Ä–∞–±–æ—Ç–∫–∞!
                    </div>
                </div>
            `;
        }
    }

}

function updateProfileStats() {
    if (!currentUser) return;
    
    const stats = document.querySelectorAll('.profile-stat .stat-value');
    if (stats.length >= 4) {
        // –ë–∞–ª–∞–Ω—Å
        stats[0].textContent = `${currentUser.balance || 0} ‚≠ê`;
        // –í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞–¥–∞–Ω–∏–π
        stats[1].textContent = currentUser.tasks_completed || 0;
        // –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è (–Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∞—Ç—å —Å —Å–µ—Ä–≤–µ—Ä–∞)
        stats[2].textContent = currentUser.active_tasks || 0;
        // –ö–∞—á–µ—Å—Ç–≤–æ (–Ω—É–∂–Ω–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å)
        stats[3].textContent = `${calculateQualityRate() || 0}%`;
    }
}

// –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π
function calculateQualityRate() {
    if (!currentUser) return 0;
    
    const completed = currentUser.tasks_completed || 0;
    const rejected = currentUser.tasks_rejected || 0;
    const total = completed + rejected;
    
    if (total === 0) return 0;
    
    return Math.round((completed / total) * 100);
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π
async function updateActiveTasksCount() {
    if (!currentUser) return;
    
    try {
        const result = await makeRequest(`/user/${currentUser.id}/tasks/active-count`);
        if (result.success) {
            currentUser.active_tasks = result.count;
            updateProfileStats();
        }
    } catch (error) {
        console.error('Error loading active tasks count:', error);
    }
}

// üîß –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø –†–ï–§–ï–†–ê–õ–¨–ù–û–ô –°–ò–°–¢–ï–ú–´
// üîß –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø –†–ï–§–ï–†–ê–õ–¨–ù–û–ô –°–ò–°–¢–ï–ú–´
function updateReferralSystem() {
    if (!currentUser) return;
    
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
    const referralCode = currentUser.referral_code || `ref_${currentUser.id}`;
    const referralLink = `https://t.me/LinkGoldMoney_bot?start=${referralCode}`;
    
    const referralInput = document.getElementById('referral-link');
    if (referralInput) referralInput.value = referralLink;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    const refInvited = document.getElementById('ref-invited');
    const refEarned = document.getElementById('ref-earned');
    
    if (refInvited) refInvited.textContent = currentUser.referral_count || 0;
    if (refEarned) refEarned.textContent = `${currentUser.referral_earned || 0} ‚≠ê`;
    
    // üî• –û–ë–ù–û–í–õ–Ø–ï–ú –¢–ï–ö–°–¢ –° –ù–û–í–´–ú–ò –£–°–õ–û–í–ò–Ø–ú–ò
    const referralInfo = document.querySelector('.referral-info');
    if (referralInfo) {
        referralInfo.innerHTML = `
            üéÅ <strong>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞:</strong><br>
            ‚Ä¢ –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç <strong>2‚≠ê</strong> –∑–∞ –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å—Å—ã–ª–∫–µ<br>
            ‚Ä¢ –í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ <strong>90%</strong> –æ—Ç —Å–≤–æ–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∫–∞<br>
            ‚Ä¢ –ü—Ä–∏–≥–ª–∞—Å–∏–≤—à–∏–π –ø–æ–ª—É—á–∞–µ—Ç <strong>10%</strong> –æ—Ç –≤–∞—à–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∫–∞<br>
            ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å –∫–∞–∂–¥–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è<br>
            ‚Ä¢ –í–∞—à –∑–∞—Ä–∞–±–æ—Ç–æ–∫ —Å —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤: <strong>${currentUser.referral_earned || 0} ‚≠ê</strong><br>
            ‚Ä¢ –ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ –¥—Ä—É–∑–µ–π: <strong>${currentUser.referral_count || 0}</strong><br><br>
            üîó –ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –¥—Ä—É–≥—É —ç—Ç—É —Å—Å—ã–ª–∫—É –≤ Telegram
        `;
    }
}

// üîß –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–†–û–í–ï–†–ö–ò –†–ï–§–ï–†–ê–õ–¨–ù–´–• –ù–ê–ß–ò–°–õ–ï–ù–ò–ô
async function checkReferralEarnings() {
    if (!currentUser) return;
    
    try {
        const result = await makeRequest(`/api/user/${currentUser.id}/referral-earnings`);
        
        if (result.success) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (result.earnings) {
                currentUser.referral_earned = result.earnings.total_earned || 0;
                currentUser.referral_count = result.earnings.referral_count || 0;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                updateReferralSystem();
            }
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π:', error);
    }
}


// üîß –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–û–õ–£–ß–ï–ù–ò–Ø –î–ï–¢–ê–õ–¨–ù–û–ô –°–¢–ê–¢–ò–°–¢–ò–ö–ò –†–ï–§–ï–†–ê–õ–û–í
async function loadDetailedReferralStats() {
    if (!currentUser) return;
    
    try {
        const result = await makeRequest(`/api/user/${currentUser.id}/referrals/detailed`);
        
        if (result.success) {
            displayDetailedReferralStats(result.referrals);
        }
    } catch (error) {
        console.error('Error loading detailed referral stats:', error);
    }
}

// üîß –§–£–ù–ö–¶–ò–Ø –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –î–ï–¢–ê–õ–¨–ù–û–ô –°–¢–ê–¢–ò–°–¢–ò–ö–ò –†–ï–§–ï–†–ê–õ–û–í
function displayDetailedReferralStats(referrals) {
    const container = document.getElementById('detailed-referrals-list');
    if (!container) return;
    
    container.innerHTML = '';
    
    if (!referrals || referrals.length === 0) {
        container.innerHTML = `
            <div class="no-referrals" style="text-align: center; padding: 20px; color: var(--text-secondary);">
                <div style="font-size: 48px; margin-bottom: 16px;">üë•</div>
                <div>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö –¥—Ä—É–∑–µ–π</div>
                <div style="font-size: 14px; margin-top: 8px;">
                    –ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π—Ç–µ 10% –æ—Ç –∏—Ö –∑–∞—Ä–∞–±–æ—Ç–∫–∞!
                </div>
            </div>
        `;
        return;
    }
    
    referrals.forEach(ref => {
        const refElement = document.createElement('div');
        refElement.className = 'referral-item';
        refElement.style.cssText = `
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        `;
        
        refElement.innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <div style="font-weight: 600;">${ref.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}</div>
                <div style="color: ${ref.status === 'active' ? 'var(--success)' : 'var(--warning)'}; font-size: 12px;">
                    ${ref.status === 'active' ? '‚úÖ –ê–∫—Ç–∏–≤–µ–Ω' : '‚è≥ –û–∂–∏–¥–∞–µ—Ç'}
                </div>
            </div>
            <div style="display: flex; justify-content: space-between; font-size: 14px; color: var(--text-secondary);">
                <div>@${ref.username || '–±–µ–∑ username'}</div>
                <div>–ë–∞–ª–∞–Ω—Å: ${ref.friend_balance || 0}‚≠ê</div>
            </div>
            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 8px;">
                –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: ${new Date(ref.created_at).toLocaleDateString('ru-RU')}
            </div>
        `;
        
        container.appendChild(refElement);
    });
}
// –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–µ—Ñ–µ—Ä–∞–ª–∞—Ö
// üîß ENDPOINT –î–õ–Ø –ü–û–õ–£–ß–ï–ù–ò–Ø –î–ï–¢–ê–õ–¨–ù–û–ô –°–¢–ê–¢–ò–°–¢–ò–ö–ò –†–ï–§–ï–†–ê–õ–û–í
app.get('/api/user/:userId/referrals/detailed', async (req, res) => {
    const userId = req.params.userId;
    
    try {
        const result = await pool.query(`
            SELECT 
                u.user_id,
                u.first_name,
                u.username,
                u.created_at,
                u.balance as friend_balance,
                CASE 
                    WHEN u.is_first_login = false THEN 'active'
                    ELSE 'pending'
                END as status
            FROM user_profiles u
            WHERE u.referred_by = $1
            ORDER BY u.created_at DESC
        `, [userId]);
        
        res.json({
            success: true,
            referrals: result.rows
        });
    } catch (error) {
        console.error('Get detailed referrals error:', error);
        res.status(500).json({
            success: false,
            error: 'Database error: ' + error.message
        });
    }
});
function updateLevelProgress() {
    if (!currentUser) return;
    
    const completedTasks = currentUser.tasks_completed || 0;
    const levelInfo = calculateUserLevel(completedTasks);
    
    console.log('üìä Level progress calculation:', {
        completedTasks,
        level: levelInfo.level,
        percentage: levelInfo.progressPercentage
    });
    
    const progressBar = document.getElementById('level-progress-bar');
    const levelCount = document.querySelector('.level-count');
    const levelInfoText = document.querySelector('.level-info');
    
    if (progressBar) {
        progressBar.style.width = `${levelInfo.progressPercentage}%`;
    }
    
    if (levelCount) {
        if (levelInfo.isMaxLevel) {
            levelCount.textContent = "–ú–∞–∫—Å. —É—Ä–æ–≤–µ–Ω—å!";
        } else {
            const nextLevelRequirement = LEVEL_SYSTEM[levelInfo.level + 1].tasksRequired;
            const tasksNeeded = nextLevelRequirement - completedTasks;
            levelCount.textContent = `${completedTasks}/${nextLevelRequirement}`;
        }
    }
    
    if (levelInfoText) {
        if (levelInfo.isMaxLevel) {
            levelInfoText.innerHTML = `üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è!`;
        } else {
            const nextLevelRequirement = LEVEL_SYSTEM[levelInfo.level + 1].tasksRequired;
            const tasksNeeded = nextLevelRequirement - completedTasks;
            levelInfoText.innerHTML = 
                `–£—Ä–æ–≤–µ–Ω—å <strong>${levelInfo.levelName}</strong> ‚Ä¢ ` +
                `–î–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è: <strong>${tasksNeeded}</strong> –∑–∞–¥–∞–Ω–∏–π`;
        }
    }
}
// üîß –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò –ü–†–û–§–ò–õ–Ø –° TELEGRAM
async function syncUserProfile() {
    if (!currentUser || !window.Telegram?.WebApp) return;
    
    try {
        const tg = window.Telegram.WebApp;
        const tgUser = tg.initDataUnsafe?.user;
        
        if (tgUser) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
            const updatedUser = {
                ...currentUser,
                firstName: tgUser.first_name || currentUser.firstName,
                lastName: tgUser.last_name || currentUser.lastName,
                username: tgUser.username || currentUser.username,
                photoUrl: tgUser.photo_url || currentUser.photoUrl
            };
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            currentUser = updatedUser;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            displayUserProfile();
            
            console.log('‚úÖ –ü—Ä–æ—Ñ–∏–ª—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å Telegram');
        }
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è:', error);
    }
}
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ - –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ - –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
function checkAdminRights() {
    const adminNavItem = document.getElementById('admin-nav-item');
    
    const isMainAdmin = parseInt(currentUser?.id) === ADMIN_ID;
    const isRegularAdmin = currentUser?.is_admin === true;
    
    if (currentUser && (isMainAdmin || isRegularAdmin)) {
        if (adminNavItem) {
            adminNavItem.style.display = 'flex';
            console.log('‚úÖ Admin nav item shown - user is admin');
        }
    } else {
        if (adminNavItem) {
            adminNavItem.style.display = 'none';
            console.log('‚ùå Admin nav item hidden - user is not admin');
        }
    }
}
// –í —Ñ—É–Ω–∫—Ü–∏–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ:
if (parseInt(currentUser.id) === ADMIN_ID) {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞–º–∏ —Ç–æ–ª—å–∫–æ –≥–ª–∞–≤–Ω–æ–º—É –∞–¥–º–∏–Ω—É
    const adminButtons = document.querySelector('.admin-buttons');
    if (adminButtons) {
        adminButtons.innerHTML += `
            <button class="admin-btn" onclick="showAdminSection('admins')">üë• –ê–¥–º–∏–Ω—ã</button>
        `;
    }
}
// –û–±–Ω–æ–≤–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è



function showTaskCategory(category) {
    console.log('üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:', category);
    
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
    const tabs = document.querySelectorAll('.task-tab');
    const containers = document.querySelectorAll('.tasks-grid');
    
    tabs.forEach(tab => tab.classList.remove('active'));
    containers.forEach(container => {
        container.classList.remove('active');
        container.style.display = 'none';
    });
    
    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
    const activeTab = Array.from(tabs).find(tab => 
        tab.textContent.toLowerCase().includes(getCategoryName(category))
    );
    if (activeTab) {
        activeTab.classList.add('active');
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
    const targetContainer = document.getElementById(`${category}-tasks`);
    if (targetContainer) {
        targetContainer.classList.add('active');
        targetContainer.style.display = 'block';
        console.log(`‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä ${category}-tasks –ø–æ–∫–∞–∑–∞–Ω`);
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        loadTasksForCategory(category);
    } else {
        console.error(`‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä ${category}-tasks –Ω–µ –Ω–∞–π–¥–µ–Ω`);
    }
}
function getCategoryName(category) {
    const names = {
        'new': '–Ω–æ–≤—ã–µ',
        'confirmation': '–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ', 
        'completed': '–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ',
        'rejected': '–æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ'
    };
    return names[category] || category;
}


async function loadTasksForCategory(category) {
    try {
        console.log(`üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–¥–∞–Ω–∏—è –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: ${category} –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:`, currentUser?.id);
        
        if (!currentUser) {
            console.log('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
            return;
        }

        let endpoint = '';
        let params = new URLSearchParams();
        
        switch(category) {
            case 'new':
                endpoint = '/api/tasks';
                params.append('userId', currentUser.id);
                break;
            case 'confirmation':
                endpoint = `/api/user/${currentUser.id}/tasks/active`;
                break;
            case 'completed':
                endpoint = `/api/user/${currentUser.id}/tasks?status=completed`;
                break;
            case 'rejected':
                endpoint = `/api/user/${currentUser.id}/tasks?status=rejected`;
                break;
        }
        
        const url = endpoint + (params.toString() ? `?${params.toString()}` : '');
        console.log('üì° Request URL:', url);

        const result = await makeRequest(url);
        
        if (result.success) {
            displayTasksForCategory(result.tasks || [], category);
        } else {
            console.error(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${category} –∑–∞–¥–∞–Ω–∏–π:`, result.error);
            showNotification(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${category} –∑–∞–¥–∞–Ω–∏–π`, 'error');
        }
    } catch (error) {
        console.error(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${category} –∑–∞–¥–∞–Ω–∏–π:`, error);
        showNotification(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${category} –∑–∞–¥–∞–Ω–∏–π`, 'error');
    }
}
function displayTasksForCategory(tasks, category) {
    const container = document.getElementById(`${category}-tasks`);
    if (!container) {
        console.error(`‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä ${category}-tasks –Ω–µ –Ω–∞–π–¥–µ–Ω`);
        return;
    }
    
    container.innerHTML = '';
    
    if (!tasks || tasks.length === 0) {
        let message = '';
        switch(category) {
            case 'new':
                message = '–ù–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç';
                break;
            case 'confirmation':
                message = '–ù–µ—Ç –∑–∞–¥–∞–Ω–∏–π –Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏';
                break;
            case 'completed':
                message = '–ù–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π';
                break;
            case 'rejected':
                message = '–ù–µ—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π';
                break;
        }
        
        container.innerHTML = `
            <div class="no-tasks" style="text-align: center; padding: 40px 20px;">
                <div style="font-size: 48px; margin-bottom: 16px;">üìù</div>
                <div style="font-size: 18px; margin-bottom: 8px;">${message}</div>
                <div style="font-size: 14px; color: var(--text-secondary);">
                    ${category === 'new' ? '–ù–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –ø–æ–∑–∂–µ' : '–°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏'}
                </div>
            </div>
        `;
        return;
    }
    
    console.log(`üéØ –û—Ç–æ–±—Ä–∞–∂–∞–µ–º ${tasks.length} –∑–∞–¥–∞–Ω–∏–π –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ${category}`);
    
    tasks.forEach((task, index) => {
        const taskElement = createTaskCardWithImage(task, category, index);
        container.appendChild(taskElement);
    });
}
        // üîß –§–£–ù–ö–¶–ò–Ø –°–û–ó–î–ê–ù–ò–Ø –≠–õ–ï–ú–ï–ù–¢–ê –ó–ê–î–ê–ù–ò–Ø
        function createTaskElement(task, category, index) {
            const taskElement = document.createElement('div');
            taskElement.className = 'task-card';
            taskElement.style.animationDelay = `${index * 0.1}s`;
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            let taskHTML = '';
            
            switch(category) {
                case 'new':
                    taskHTML = createNewTaskHTML(task);
                    break;
                case 'confirmation':
                    taskHTML = createConfirmationTaskHTML(task);
                    break;
                case 'completed':
                    taskHTML = createCompletedTaskHTML(task);
                    break;
                case 'rejected':
                    taskHTML = createRejectedTaskHTML(task);
                    break;
            }
            
            taskElement.innerHTML = taskHTML;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            if (category === 'new') {
                taskElement.addEventListener('click', function(e) {
                    if (!e.target.classList.contains('task-btn')) {
                        openTaskModal(task.id);
                    }
                });
            }
            
            return taskElement;
        }


// üöÄ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò –î–õ–Ø –ü–õ–ê–í–ù–û–°–¢–ò –ò –û–¢–ó–´–í–ß–ò–í–û–°–¢–ò

// üîß –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–õ–ê–í–ù–´–• –ü–ï–†–ï–•–û–î–û–í –ú–ï–ñ–î–£ –°–¢–†–ê–ù–ò–¶–ê–ú–ò
function smoothShowTab(tabId) {
    return new Promise((resolve) => {
        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
        const allTabs = document.querySelectorAll('.tab-content, .page');
        
        // –ê–Ω–∏–º–∞—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è —Ç–µ–∫—É—â–µ–π –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
        const activeTab = document.querySelector('.tab-content.active, .page.active');
        if (activeTab) {
            activeTab.style.opacity = '0';
            activeTab.style.transform = 'translateY(10px)';
            
            setTimeout(() => {
                activeTab.classList.remove('active');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–≤—É—é –≤–∫–ª–∞–¥–∫—É
                const targetTab = document.getElementById(tabId);
                if (targetTab) {
                    targetTab.classList.add('active');
                    
                    // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø–æ—è–≤–ª–µ–Ω–∏—è
                    requestAnimationFrame(() => {
                        targetTab.style.opacity = '0';
                        targetTab.style.transform = 'translateY(-10px)';
                        
                        requestAnimationFrame(() => {
                            targetTab.style.transition = 'all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                            targetTab.style.opacity = '1';
                            targetTab.style.transform = 'translateY(0)';
                            
                            setTimeout(() => {
                                targetTab.style.transition = '';
                                resolve();
                            }, 400);
                        });
                    });
                }
            }, 50);
        }
    });
}

// üîß –£–õ–£–ß–®–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–Ø –í–ö–õ–ê–î–û–ö
function enhancedShowTab(tabId) {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º requestAnimationFrame –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
    requestAnimationFrame(() => {
        hideAllTabs();
        const targetTab = document.getElementById(tabId);
        if (targetTab) {
            targetTab.classList.add('active');
            updateNavState(tabId.replace('-tab', ''));
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –º–∏–∫—Ä–æ-–∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞
            setTimeout(() => {
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π reflow –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏
                targetTab.offsetHeight;
            }, 10);
        }
    });
}

// üîß –ü–õ–ê–í–ù–û–ï –û–¢–ö–†–´–¢–ò–ï/–ó–ê–ö–†–´–¢–ò–ï –ú–û–î–ê–õ–¨–ù–´–• –û–ö–û–ù
function smoothOpenModal(modalId) {
    const modal = document.getElementById(modalId);
    if (!modal) return;
    
    modal.style.display = 'flex';
    
    requestAnimationFrame(() => {
        modal.classList.add('active');
    });
}

function smoothCloseModal(modalId) {
    const modal = document.getElementById(modalId);
    if (!modal) return;
    
    modal.classList.remove('active');
    
    setTimeout(() => {
        modal.style.display = 'none';
    }, 300);
}

// üåä –§–£–ù–ö–¶–ò–Ø –î–õ–Ø RIPPLE –≠–§–§–ï–ö–¢–ê
function createRipple(event) {
    const button = event.currentTarget;
    const circle = document.createElement('span');
    const diameter = Math.max(button.clientWidth, button.clientHeight);
    const radius = diameter / 2;
    
    const rect = button.getBoundingClientRect();
    
    circle.style.width = circle.style.height = `${diameter}px`;
    circle.style.left = `${event.clientX - rect.left - radius}px`;
    circle.style.top = `${event.clientY - rect.top - radius}px`;
    circle.classList.add('ripple');
    
    const ripple = button.getElementsByClassName('ripple')[0];
    if (ripple) {
        ripple.remove();
    }
    
    button.appendChild(circle);
}

// üîß –î–û–ë–ê–í–õ–ï–ù–ò–ï RIPPLE –≠–§–§–ï–ö–¢–ê –ö–û –í–°–ï–ú –ö–ù–û–ü–ö–ê–ú
function initializeRippleEffects() {
    const buttons = document.querySelectorAll('.btn, .task-btn, .nav-item');
    buttons.forEach(button => {
        button.addEventListener('click', createRipple);
    });
}

// üöÄ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ü–†–û–ö–†–£–¢–ö–ò
function smoothScrollTo(element, duration = 500) {
    const target = typeof element === 'string' ? document.querySelector(element) : element;
    if (!target) return;
    
    const targetPosition = target.getBoundingClientRect().top + window.pageYOffset;
    const startPosition = window.pageYOffset;
    const distance = targetPosition - startPosition;
    let startTime = null;
    
    function animation(currentTime) {
        if (startTime === null) startTime = currentTime;
        const timeElapsed = currentTime - startTime;
        const run = easeInOutQuad(timeElapsed, startPosition, distance, duration);
        window.scrollTo(0, run);
        if (timeElapsed < duration) requestAnimationFrame(animation);
    }
    
    function easeInOutQuad(t, b, c, d) {
        t /= d/2;
        if (t < 1) return c/2*t*t + b;
        t--;
        return -c/2 * (t*(t-2) - 1) + b;
    }
    
    requestAnimationFrame(animation);
}

// üîß –ü–†–ï–î–ó–ê–ì–†–£–ó–ö–ê –†–ï–°–£–†–°–û–í –î–õ–Ø –ë–û–õ–ï–ï –ü–õ–ê–í–ù–´–• –ü–ï–†–ï–•–û–î–û–í
function preloadResources() {
    // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –≤–∞–∂–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    const imagesToPreload = [
        'free-icon-home-7102764.png',
        'free-icon-task-list-4173330.png',
        'free-icon-profile-4042565.png'
    ];
    
    imagesToPreload.forEach(src => {
        const img = new Image();
        img.src = src;
    });
}

// üéØ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ê–ù–ò–ú–ê–¶–ò–ô –° –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï–ú WILL-CHANGE
function optimizeAnimations() {
    const animatedElements = document.querySelectorAll('.task-card, .card, .modal-content');
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.willChange = 'transform, opacity';
            } else {
                // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã –∫–æ–≥–¥–∞ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –≤–∏–¥–µ–Ω
                setTimeout(() => {
                    entry.target.style.willChange = 'auto';
                }, 300);
            }
        });
    });
    
    animatedElements.forEach(el => observer.observe(el));
}

// üîß –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –û–¢–õ–û–ñ–ï–ù–ù–û–ô –ó–ê–ì–†–£–ó–ö–ò –ù–ï–ö–†–ò–¢–ò–ß–ù–´–• –†–ï–°–£–†–°–û–í
function lazyLoadImages() {
    const lazyImages = document.querySelectorAll('img[data-src]');
    
    const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                img.src = img.dataset.src;
                img.classList.remove('lazy-load');
                img.classList.add('loaded');
                imageObserver.unobserve(img);
            }
        });
    });
    
    lazyImages.forEach(img => imageObserver.observe(img));
}

// üöÄ –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –§–£–ù–ö–¶–ò–ò –ù–ê–í–ò–ì–ê–¶–ò–ò –° –ê–ù–ò–ú–ê–¶–ò–Ø–ú–ò
function smoothShowMainTab() {
    smoothShowTab('main-tab');
}

function smoothShowTasksTab() {
    smoothShowTab('tasks-tab').then(() => {
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Ö–æ–¥–∞
        loadTasksForCategory('new');
    });
}

function smoothShowProfileTab() {
    smoothShowTab('profile-tab');
}

function smoothShowAdminTab() {
    smoothShowTab('admin-tab');
}

// üîß –û–ë–ù–û–í–õ–ï–ù–ò–ï –°–£–©–ï–°–¢–í–£–Æ–©–ò–• –§–£–ù–ö–¶–ò–ô –î–õ–Ø –ü–õ–ê–í–ù–û–°–¢–ò
// –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
window.showMainTab = smoothShowMainTab;
window.showTasksTab = smoothShowTasksTab;
window.showProfileTab = smoothShowProfileTab;
window.showAdminTab = smoothShowAdminTab;

// –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
window.openTaskModal = function(taskId) {
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
    smoothOpenModal('task-modal');
};

window.closeModal = function(modalId) {
    smoothCloseModal(modalId);
};

// üéØ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ô –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï
document.addEventListener('DOMContentLoaded', function() {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ripple —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
    initializeRippleEffects();
    
    // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∞–Ω–∏–º–∞—Ü–∏–π
    optimizeAnimations();
    
    // –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    lazyLoadImages();
    
    // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
    preloadResources();
    
    // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —Ç–∞—á-—É—Å—Ç—Ä–æ–π—Å—Ç–≤
    if ('ontouchstart' in window) {
        document.body.classList.add('touch-device');
    }
    
    console.log('üöÄ Smooth animations initialized');
});

// üîß –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò –î–õ–Ø –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò
// –î–µ–±–∞—É–Ω—Å –¥–ª—è —á–∞—Å—Ç—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
function debounce(func, wait, immediate) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            timeout = null;
            if (!immediate) func(...args);
        };
        const callNow = immediate && !timeout;
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
        if (callNow) func(...args);
    };
}

// –¢—Ä–æ—Ç—Ç–ª–∏–Ω–≥ –¥–ª—è —Å–∫—Ä–æ–ª–ª–∞ –∏ —Ä–µ—Å–∞–π–∑–∞
function throttle(func, limit) {
    let inThrottle;
    return function(...args) {
        if (!inThrottle) {
            func.apply(this, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
        }
    }
}

// –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º
window.addEventListener('scroll', throttle(function() {
    // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
}, 100));

window.addEventListener('resize', debounce(function() {
    // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏ —Ä–µ—Å–∞–π–∑–µ
}, 250));

// üîß –§–ò–ö–° –î–õ–Ø iOS SMOOTH SCROLL
if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
    document.body.style['-webkit-overflow-scrolling'] = 'touch';
}

// üîß HTML –î–õ–Ø –ù–û–í–´–• –ó–ê–î–ê–ù–ò–ô - –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
function createNewTaskHTML(task) {
    const categoryDisplay = formatCategory(task.category);
    const shortDescription = task.description.length > 120 
        ? task.description.substring(0, 120) + '...' 
        : task.description;
    
    const peopleRequired = task.people_required || 1;
    const completedCount = task.completed_count || 0;
    const availableTasks = Math.max(0, peopleRequired - completedCount);
    
    // üî• –û–¢–û–ë–†–ê–ñ–ê–ï–ú –ü–†–û–ì–†–ï–°–° –í–´–ü–û–õ–ù–ï–ù–ò–Ø
    const progressPercentage = Math.min(100, (completedCount / peopleRequired) * 100);
    
    return `
        ${availableTasks > 0 ? `<div class="task-availability">${availableTasks} –æ—Å—Ç–∞–ª–æ—Å—å</div>` : ''}
        
        <div class="task-header">
            <div class="task-title">${escapeHtml(task.title)}</div>
            <div class="task-price">${task.price} ‚≠ê</div>
        </div>
        
        <div class="task-meta">
            <div class="task-category">${categoryDisplay}</div>
            ${task.difficulty ? `<div class="task-difficulty ${task.difficulty.toLowerCase()}">${task.difficulty}</div>` : ''}
        </div>
        
        <div class="task-description">${escapeHtml(shortDescription)}</div>
        
        <!-- üî• –ü–†–û–ì–†–ï–°–°-–ë–ê–† –í–´–ü–û–õ–ù–ï–ù–ò–Ø –ó–ê–î–ê–ù–ò–Ø -->
        <div class="task-progress-container" style="margin: 10px 0;">
            <div style="display: flex; justify-content: space-between; font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">
                <span>–í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${completedCount}/${peopleRequired}</span>
                <span>${Math.round(progressPercentage)}%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: ${progressPercentage}%"></div>
            </div>
        </div>
        
        <div class="task-footer">
            <div class="task-time">${task.time_to_complete || '5-10 –º–∏–Ω—É—Ç'}</div>
            <button class="task-btn" onclick="event.stopPropagation(); openTaskModal(${task.id})">
                –ù–∞—á–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ
            </button>
        </div>
    `;
}

        // üîß HTML –î–õ–Ø –ó–ê–î–ê–ù–ò–ô –ù–ê –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ò
        function createConfirmationTaskHTML(task) {
            return `
                <div class="task-header">
                    <div style="flex: 1;">
                        <div class="task-title">${escapeHtml(task.title)}</div>
                        <div class="task-category">${task.category || '–û–±—â–µ–µ'}</div>
                    </div>
                    <div class="task-price">${task.price} ‚≠ê</div>
                </div>
                <div class="task-description">${escapeHtml(task.description)}</div>
                <div class="task-footer">
                    <div class="task-time">–û–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</div>
                    <button class="task-btn" onclick="event.stopPropagation(); showTaskConfirmation(${task.id}, '${escapeHtml(task.title)}')">
                        –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
                    </button>
                </div>
            `;
        }

        // üîß HTML –î–õ–Ø –í–´–ü–û–õ–ù–ï–ù–ù–´–• –ó–ê–î–ê–ù–ò–ô
        function createCompletedTaskHTML(task) {
            return `
                <div class="task-header">
                    <div style="flex: 1;">
                        <div class="task-title">${escapeHtml(task.title)}</div>
                        <div class="task-category">${task.category || '–û–±—â–µ–µ'}</div>
                    </div>
                    <div class="task-price">${task.price} ‚≠ê</div>
                </div>
                <div class="task-description">${escapeHtml(task.description)}</div>
                <div class="task-footer">
                    <div class="task-time">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
                    <div class="task-status completed">‚úÖ</div>
                </div>
            `;
        }

     // –í index.html - –æ–±–Ω–æ–≤–∏–º —Ñ—É–Ω–∫—Ü–∏—é —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
function createRejectedTaskHTML(task) {
    return `
        <div class="task-header">
            <div style="flex: 1;">
                <div class="task-title">${escapeHtml(task.title)}</div>
                <div class="task-category">${task.category || '–û–±—â–µ–µ'}</div>
            </div>
            <div class="task-price">${task.price} ‚≠ê</div>
        </div>
        <div class="task-description">${escapeHtml(task.description)}</div>
        
        <!-- –ë–ª–æ–∫ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏ -->
        <div class="rejection-info" style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; padding: 10px; margin: 10px 0;">
            <div style="color: var(--error); font-size: 12px; font-weight: 600; margin-bottom: 5px;">
                ‚ùå –ó–∞–¥–∞–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
            </div>
            <div style="color: var(--text-secondary); font-size: 11px;">
                –ï—Å–ª–∏ –≤—ã —Å—á–∏—Ç–∞–µ—Ç–µ, —á—Ç–æ —ç—Ç–æ –æ—à–∏–±–∫–∞, –Ω–∞–ø–∏—à–∏—Ç–µ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É
            </div>
        </div>
        
        <div class="task-footer">
            <div class="task-time">–û—Ç–∫–ª–æ–Ω–µ–Ω–æ</div>
            <button class="support-btn" onclick="openAdminChat()" style="background: var(--accent); color: white; border: none; padding: 8px 12px; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;">
                –ù–∞–ø–∏—Å–∞—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É
            </button>
        </div>
    `;
}
// –í index.html - –¥–æ–±–∞–≤–∏–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —á–∞—Ç–∞ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∑–∞–¥–∞–Ω–∏—è
function openSupportChatForTask(task) {
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–¥–∞–Ω–∏–∏ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏
    const taskInfo = {
        id: task.id,
        title: task.title,
        price: task.price,
        category: task.category
    };
    
    // –ú–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ localStorage –∏–ª–∏ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
    localStorage.setItem('supportTaskContext', JSON.stringify(taskInfo));
    
    // –û—Ç–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏
    openAdminChat();
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–¥–∞–Ω–∏–∏ –≤ –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    setTimeout(() => {
        const chatInput = document.getElementById('chat-input-field');
        if (chatInput) {
            chatInput.placeholder = `–í–æ–ø—Ä–æ—Å –ø–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω–æ–º—É –∑–∞–¥–∞–Ω–∏—é: "${task.title}"...`;
        }
    }, 500);
}

// –û–±–Ω–æ–≤–∏–º —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–∫—Ä—ã—Ç–∏—è —á–∞—Ç–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∑–∞–¥–∞–Ω–∏—è
async function openAdminChat() {
    if (!currentUser) {
        showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω', 'error');
        return;
    }
    
    try {
        console.log('üë§ User opening support chat, ID:', currentUser.id);
        
        // –ü–æ–ª—É—á–∞–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º —á–∞—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const chatResult = await makeRequest(`/support/user-chat/${currentUser.id}`);
        
        if (chatResult.success) {
            currentChatId = chatResult.chat.id;
            console.log('‚úÖ Chat ID:', currentChatId);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è
            const taskContext = localStorage.getItem('supportTaskContext');
            if (taskContext) {
                const taskInfo = JSON.parse(taskContext);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–¥–∞–Ω–∏–∏
                const autoMessage = `–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –£ –º–µ–Ω—è –≤–æ–ø—Ä–æ—Å –ø–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω–æ–º—É –∑–∞–¥–∞–Ω–∏—é: "${taskInfo.title}" (${taskInfo.price}‚≠ê). `;
                const chatInput = document.getElementById('chat-input-field');
                if (chatInput) {
                    chatInput.value = autoMessage;
                }
                
                // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
                localStorage.removeItem('supportTaskContext');
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            try {
                const messagesResult = await makeRequest(`/support/chats/${currentChatId}/messages`);
                if (messagesResult.success) {
                    displayChatMessages(messagesResult.messages);
                }
            } catch (messagesError) {
                console.log('No messages yet or error loading messages:', messagesError);
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Å—Ç–æ–π —á–∞—Ç —Å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ–º
                displayChatMessages([]);
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á–∞—Ç
            document.getElementById('admin-chat').classList.add('active');
            
        } else {
            throw new Error(chatResult.error || 'Failed to create chat');
        }
    } catch (error) {
        console.error('‚ùå Error opening user chat:', error);
        showNotification('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —á–∞—Ç–∞: ' + error.message, 'error');
    }
}

        // üîß –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï –°–¢–†–ê–ù–ò–¶–´
        document.addEventListener('DOMContentLoaded', function() {
            // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –ø–æ–∫–∞–∑–∞–Ω—ã –Ω–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è
            setTimeout(() => {
                const newTasksContainer = document.getElementById('new-tasks');
                if (newTasksContainer) {
                    newTasksContainer.classList.add('active');
                    newTasksContainer.style.display = 'block';
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è
                loadTasksForCategory('new');
            }, 500);
        });

        // üîß –≠–ö–°–ü–û–†–¢ –§–£–ù–ö–¶–ò–ô
        window.showTaskCategory = showTaskCategory;
        window.loadTasksForCategory = loadTasksForCategory;
        window.displayTasksForCategory = displayTasksForCategory;

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π
function debugTaskConfirmation() {
   
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
    console.log('- currentUser:', currentUser);
    console.log('- currentUserTaskId:', currentUserTaskId);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
    console.log('- confirmation-modal:', document.getElementById('confirmation-modal'));
    console.log('- screenshot-modal:', document.getElementById('screenshot-modal'));
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω—ã –ª–∏ –∑–∞–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    loadUserTasksForCategory('active').then(() => {
        console.log('‚úÖ Active tasks loaded for debugging');
    });
}

// –í—Ä–µ–º–µ–Ω–Ω–æ –¥–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
function addConfirmationDebugButton() {
    const debugBtn = document.createElement('button');
    debugBtn.textContent = 'üêõ Debug Confirmation';
    debugBtn.style.position = 'fixed';
    debugBtn.style.top = '200px';
    debugBtn.style.right = '10px';
    debugBtn.style.zIndex = '10000';
    debugBtn.style.padding = '10px';
    debugBtn.style.background = 'orange';
    debugBtn.style.color = 'white';
    debugBtn.style.border = 'none';
    debugBtn.style.borderRadius = '5px';
    debugBtn.style.fontSize = '12px';
    debugBtn.onclick = debugTaskConfirmation;
    document.body.appendChild(debugBtn);
}

// –í—ã–∑–æ–≤–∏—Ç–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
setTimeout(addConfirmationDebugButton, 3000);

// –î–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
function addConfirmationDebugButton() {
    const debugBtn = document.createElement('button');
    debugBtn.textContent = 'üêõ Debug Confirmation';
    debugBtn.style.position = 'fixed';
    debugBtn.style.top = '200px';
    debugBtn.style.right = '10px';
    debugBtn.style.zIndex = '10000';
    debugBtn.style.padding = '10px';
    debugBtn.style.background = 'orange';
    debugBtn.style.color = 'white';
    debugBtn.style.border = 'none';
    debugBtn.style.borderRadius = '5px';
    debugBtn.style.fontSize = '12px';
    debugBtn.onclick = debugTaskConfirmation;
    document.body.appendChild(debugBtn);
}

// –í—ã–∑–æ–≤–∏—Ç–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
setTimeout(addConfirmationDebugButton, 3000);

function checkAdminPanelLoaded() {
    const adminTasksSection = document.getElementById('admin-tasks-section');
    const addTaskButton = document.querySelector('#admin-tasks-section .admin-submit');
    
    console.log('üîç Checking admin panel:');
    console.log('- Admin tasks section:', !!adminTasksSection);
    console.log('- Add task button:', !!addTaskButton);
    
    if (adminTasksSection && addTaskButton) {
        console.log('‚úÖ Admin panel is properly loaded');
    } else {
        console.log('‚ùå Admin panel elements missing');
        // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
        setTimeout(() => {
            showAdminSection('tasks');
        }, 1000);
    }
}

// üîß –†–ê–°–®–ò–†–ï–ù–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò
function debugAdminPanelFull() {
    console.log('üîç FULL ADMIN PANEL DEBUG:');
    
    // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É DOM
    console.log('1. DOM STRUCTURE:');
    const adminTab = document.getElementById('admin-tab');
    console.log('- admin-tab:', adminTab);
    console.log('- admin-tab active:', adminTab?.classList.contains('active'));
    
    // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
    console.log('2. ADMIN SECTIONS:');
    const sections = ['posts', 'tasks', 'verification', 'support', 'payments', 'admins'];
    sections.forEach(section => {
        const sectionEl = document.getElementById(`admin-${section}-section`);
        console.log(`- admin-${section}-section:`, sectionEl);
        console.log(`  display: ${sectionEl?.style.display}`);
        console.log(`  classList: ${sectionEl?.classList}`);
    });
    
    // 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–Ω–æ–ø–∫–∏
    console.log('3. ADMIN BUTTONS:');
    const buttons = document.querySelectorAll('.admin-btn');
    buttons.forEach((btn, index) => {
        console.log(`- Button ${index}:`, btn.textContent);
        console.log(`  onclick:`, btn.getAttribute('onclick'));
    });
    
    // 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    console.log('4. CURRENT USER:');
    console.log('- currentUser:', currentUser);
    console.log('- isAdmin:', currentUser?.is_admin);
    console.log('- isMainAdmin:', parseInt(currentUser?.id) === ADMIN_ID);
}


// üîß –ê–í–ê–†–ò–ô–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò
function emergencyFixAdminPanel() {
    console.log('üîß Applying emergency fixes...');
    
    // 1. –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —á—Ç–æ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    let adminTab = document.getElementById('admin-tab');
    if (!adminTab) {
        console.log('‚ùå Admin tab not found, creating...');
        adminTab = document.createElement('div');
        adminTab.id = 'admin-tab';
        adminTab.className = 'tab-content';
        document.querySelector('.main-content').appendChild(adminTab);
    }
    
    // 2. –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —á—Ç–æ —Å–µ–∫—Ü–∏—è –∑–∞–¥–∞–Ω–∏–π —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    let tasksSection = document.getElementById('admin-tasks-section');
    if (!tasksSection) {
        console.log('‚ùå Tasks section not found, creating...');
        tasksSection = document.createElement('div');
        tasksSection.id = 'admin-tasks-section';
        tasksSection.className = 'admin-section';
        tasksSection.style.display = 'none';
        adminTab.appendChild(tasksSection);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –±–∞–∑–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
        tasksSection.innerHTML = `
            <div class="admin-form">
                <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ (EMERGENCY)</h3>
                <p>–°–µ–∫—Ü–∏—è –±—ã–ª–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∞–≤–∞—Ä–∏–π–Ω–æ</p>
                <button class="admin-submit" onclick="testAddTask()">‚úÖ –¢–µ—Å—Ç–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞</button>
            </div>
        `;
    }
    
    // 3. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é
    tasksSection.style.display = 'block';
    tasksSection.style.opacity = '1';
    tasksSection.style.visibility = 'visible';
    
    console.log('‚úÖ Emergency fixes applied');
}
// –í —Å–µ–∫—Ü–∏–∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ:
function addTestButtons() {
    const testDiv = document.createElement('div');
    testDiv.innerHTML = `
        <div style="margin: 20px 0; padding: 15px; background: var(--bg-secondary); border-radius: 10px;">
            <h4>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ endpoints</h4>
            <button onclick="testAdminEndpoints()" class="btn btn-primary" style="margin: 5px;">
                –¢–µ—Å—Ç endpoints
            </button>
            <button onclick="testSimpleAdd()" class="btn btn-warning" style="margin: 5px;">
                –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç
            </button>
            <button onclick="checkServerHealth()" class="btn btn-success" style="margin: 5px;">
                –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
            </button>
        </div>
    `;
    
    const adminSection = document.getElementById('admin-admins-section');
    if (adminSection) {
        adminSection.appendChild(testDiv);
    }
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
async function testAdminEndpoints() {
    console.log('üß™ Testing admin endpoints...');
    
    try {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º health
        const health = await makeRequest('/api/health');
        console.log('‚úÖ Health:', health);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º debug endpoint
        const debug = await makeRequest('/api/admin/debug');
        console.log('‚úÖ Debug:', debug);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º endpoints check
        const endpoints = await makeRequest('/api/admin/endpoints-check');
        console.log('‚úÖ Endpoints:', endpoints);
        
        showNotification('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å', 'success');
        
    } catch (error) {
        console.error('‚ùå Test failed:', error);
        showNotification('–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ' + error.message, 'error');
    }
}

async function testSimpleAdd() {
    console.log('üß™ Testing simple add...');
    
    try {
        const result = await makeRequest('/api/admin/test-add', {
            method: 'POST',
            body: JSON.stringify({
                adminId: currentUser.id,
                username: 'testuser'
            })
        });
        
        console.log('‚úÖ Simple test result:', result);
        showNotification('–ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω!', 'success');
        
    } catch (error) {
        console.error('‚ùå Simple test failed:', error);
        showNotification('–ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç –Ω–µ –ø—Ä–æ–π–¥–µ–Ω: ' + error.message, 'error');
    }
}

async function checkServerHealth() {
    console.log('üîç Checking server health...');
    
    try {
        const response = await fetch(API_BASE_URL + '/api/health');
        console.log('üìä Server response:', {
            status: response.status,
            ok: response.ok,
            url: response.url
        });
        
        if (response.ok) {
            const data = await response.json();
            console.log('‚úÖ Server health:', data);
            showNotification('–°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ', 'success');
        } else {
            throw new Error(`HTTP ${response.status}`);
        }
        
    } catch (error) {
        console.error('‚ùå Server health check failed:', error);
        showNotification('–ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–µ—Ä–≤–µ—Ä–æ–º: ' + error.message, 'error');
    }
}

// –í—ã–∑–æ–≤–∏—Ç–µ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
setTimeout(addTestButtons, 2000);


// üîß –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û–ì–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø LAYOUT
function fixTasksLayout() {
    const tasksTab = document.getElementById('tasks-tab');
    if (!tasksTab) return;
    
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É
    tasksTab.style.minHeight = '500px';
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–¥–∞–Ω–∏–π
    const containers = ['new-tasks', 'confirmation-tasks', 'completed-tasks', 'rejected-tasks'];
    containers.forEach(containerId => {
        const container = document.getElementById(containerId);
        if (container) {
            container.style.position = 'relative';
            container.style.minHeight = '300px';
            // –£–±–∏—Ä–∞–µ–º –≤—Å–µ transition
            container.style.transition = 'none';
        }
    });
    
    console.log('‚úÖ Tasks layout fixed');
}
function showTasksTab() {
    console.log('üéØ –ü–ï–†–ï–•–û–î –ù–ê –í–ö–õ–ê–î–ö–£ –ó–ê–î–ê–ù–ò–ô');
    
    // 1. –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
    hideAllTabs();
    
    // 2. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫—É –∑–∞–¥–∞–Ω–∏–π
    const tasksTab = document.getElementById('tasks-tab');
    if (tasksTab) {
        tasksTab.classList.add('active');
        console.log('‚úÖ –í–∫–ª–∞–¥–∫–∞ –∑–∞–¥–∞–Ω–∏–π –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
    }
    
    // 3. –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
    updateNavState('tasks');
    
    // 4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–∫–ª–∞–¥–∫–∏ –∑–∞–¥–∞–Ω–∏–π
    setTimeout(() => {
        initializeTaskTabs();
    }, 50);
}
function initializeTaskTabHandlers() {
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    const taskTabs = document.querySelectorAll('.task-tab');
    taskTabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const category = getCategoryFromTab(this.textContent);
            if (category) {
                showTaskCategory(category);
            }
        });
    });
}

function getCategoryFromTab(tabText) {
    const text = tabText.toLowerCase();
    if (text.includes('–Ω–æ–≤—ã–µ')) return 'new';
    if (text.includes('–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ')) return 'confirmation';
    if (text.includes('–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ')) return 'completed';
    if (text.includes('–æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ')) return 'rejected';
    return null;
}
function showTasksTab() {
    console.log('üéØ –ü–ï–†–ï–•–û–î –ù–ê –í–ö–õ–ê–î–ö–£ –ó–ê–î–ê–ù–ò–ô - –ù–ê–ß–ê–õ–û');
    
    // 1. –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
    hideAllTabs();
    
    // 2. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫—É –∑–∞–¥–∞–Ω–∏–π
    const tasksTab = document.getElementById('tasks-tab');
    if (tasksTab) {
        tasksTab.classList.add('active');
        console.log('‚úÖ –í–∫–ª–∞–¥–∫–∞ –∑–∞–¥–∞–Ω–∏–π –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
    }
    
    // 3. –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
    updateNavState('tasks');
    
    // 4. –°—Ä–∞–∑—É –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∫–ª–∞–¥–∫—É "–ù–æ–≤—ã–µ"
    setTimeout(() => {
        console.log('üîÑ –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∫–ª–∞–¥–∫—É "–ù–æ–≤—ã–µ"');
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏
        document.querySelectorAll('.task-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        
        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
        const containers = ['new-tasks', 'confirmation-tasks', 'completed-tasks', 'rejected-tasks'];
        containers.forEach(containerId => {
            const container = document.getElementById(containerId);
            if (container) {
                container.style.display = 'none';
                container.classList.remove('active');
            }
        });
        
        // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∫–ª–∞–¥–∫—É "–ù–æ–≤—ã–µ"
        const newTab = document.querySelector('.task-tab:nth-child(1)');
        const newContainer = document.getElementById('new-tasks');
        
        if (newTab && newContainer) {
            newTab.classList.add('active');
            newContainer.style.display = 'block';
            newContainer.classList.add('active');
            console.log('‚úÖ –í–∫–ª–∞–¥–∫–∞ "–ù–æ–≤—ã–µ" –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
            
            // –ù–ï–ú–ï–î–õ–ï–ù–ù–û –∑–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–¥–∞–Ω–∏—è
            console.log('üöÄ –ù–ï–ú–ï–î–õ–ï–ù–ù–ê–Ø –ó–ê–ì–†–£–ó–ö–ê –ó–ê–î–ê–ù–ò–ô');
            loadTasks();
        }
        
        // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
        debugTasksLoading();
        
    }, 50); // –£–º–µ–Ω—å—à–∞–µ–º –∑–∞–¥–µ—Ä–∂–∫—É
}
// üîß –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ó–ê–ì–†–£–ó–ö–ò –ó–ê–î–ê–ù–ò–ô
async function loadTasks(search = '', category = 'all') {
    try {
        console.log('üéØ START loadTasks:', { 
            search, 
            category, 
            userId: currentUser?.id,
            hasUser: !!currentUser
        });

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
        if (!currentUser) {
            console.log('‚ùå No current user, aborting loadTasks');
            showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω', 'error');
            return;
        }

        const newTasksContainer = document.getElementById('new-tasks');
        
        if (!newTasksContainer) {
            console.log('‚ùå new-tasks container not found');
            return;
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        newTasksContainer.innerHTML = `
            <div class="no-tasks" style="min-height: 200px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                <div class="loading-spinner">‚è≥</div>
                <div style="margin-top: 16px;">–ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–¥–∞–Ω–∏—è...</div>
                <div style="font-size: 12px; color: var(--text-secondary); margin-top: 8px;">
                    ID: ${currentUser.id}
                </div>
            </div>
        `;

        // –§–æ—Ä–º–∏—Ä—É–µ–º URL —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
        const params = new URLSearchParams();
        params.append('userId', currentUser.id);
        if (search) params.append('search', search);
        if (category && category !== 'all') params.append('category', category);
        
        const url = `/api/tasks?${params.toString()}`;
        console.log('üì° Request URL:', url);

        // –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
        const response = await fetch(API_BASE_URL + url);
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const result = await response.json();
        console.log('üì® Server response:', result);

        if (result.success) {
            allTasks = result.tasks || [];
            console.log(`‚úÖ Loaded ${allTasks.length} tasks:`, allTasks);
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∑–∞–¥–∞–Ω–∏—è
            displayTasks(allTasks, 'new');
            
        } else {
            throw new Error(result.error || 'Unknown server error');
        }

    } catch (error) {
        console.error('üí• loadTasks error:', error);
        
        const newTasksContainer = document.getElementById('new-tasks');
        if (newTasksContainer) {
            newTasksContainer.innerHTML = `
                <div class="no-tasks" style="min-height: 200px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                    <div style="font-size: 48px; margin-bottom: 16px;">‚ùå</div>
                    <div>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞–Ω–∏–π</div>
                    <div style="font-size: 12px; color: var(--text-secondary); margin: 8px 0;">
                        ${error.message}
                    </div>
                    <button class="btn btn-primary" onclick="loadTasks()" style="margin-top: 16px;">
                        –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                    </button>
                </div>
            `;
        }
        
        showNotification(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞–Ω–∏–π: ${error.message}`, 'error');
    }
}


// üîß –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ì–û –û–ë–ù–û–í–õ–ï–ù–ò–Ø –ò–ù–¢–ï–†–§–ï–ô–°–ê
function updateTaskInterfaces() {
    if (document.getElementById('tasks-tab').classList.contains('active')) {
        const activeCategory = document.querySelector('.task-tab.active');
        if (activeCategory) {
            const category = getActiveCategoryName(activeCategory);
            if (category === 'new') {
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è
                loadTasks();
            } else {
                loadTasksForCategory(category);
            }
        }
    }
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
setInterval(updateTaskInterfaces, 30000);

// –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É
function showTasksTab() {
    console.log('üéØ –ü–ï–†–ï–•–û–î –ù–ê –í–ö–õ–ê–î–ö–£ –ó–ê–î–ê–ù–ò–ô');
    
    hideAllTabs();
    const tasksTab = document.getElementById('tasks-tab');
    if (tasksTab) {
        tasksTab.classList.add('active');
        console.log('‚úÖ –í–∫–ª–∞–¥–∫–∞ –∑–∞–¥–∞–Ω–∏–π –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
    }
    
    updateNavState('tasks');
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
    setTimeout(fixMobileLayout, 100);
    
    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∫–ª–∞–¥–∫—É "–ù–æ–≤—ã–µ" –∏ –û–ë–ù–û–í–õ–Ø–ï–ú –¥–∞–Ω–Ω—ã–µ
    setTimeout(() => {
        showTaskCategory('new');
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        loadTasks();
    }, 150);
}

function getActiveCategoryName(activeTab) {
    const text = activeTab.textContent.toLowerCase();
    if (text.includes('–Ω–æ–≤—ã–µ')) return 'new';
    if (text.includes('–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ')) return 'confirmation';
    if (text.includes('–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ')) return 'completed';
    if (text.includes('–æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ')) return 'rejected';
    return 'new';
}


function displayTasks(tasks, category) {
    console.log(`üéØ START displayTasks: ${tasks?.length} tasks for ${category}`);
    
    const container = document.getElementById(category + '-tasks');
    if (!container) {
        console.error('‚ùå Container not found:', category + '-tasks');
        return;
    }

    console.log('üì¶ Container found, clearing...');
    container.innerHTML = '';

    if (!tasks || tasks.length === 0) {
        console.log('üì≠ No tasks to display');
        container.innerHTML = `
            <div class="no-tasks" style="min-height: 200px; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; text-align: center;">
                <div style="font-size: 48px; margin-bottom: 16px;">üìù</div>
                <div style="font-size: 18px; margin-bottom: 8px;">–ó–∞–¥–∞–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</div>
                <div style="font-size: 14px; color: var(--text-secondary);">
                    –ù–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –ø–æ–∑–∂–µ<br>
                    <small>–°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏</small>
                </div>
            </div>
        `;
        return;
    }

    console.log(`üé® Rendering ${tasks.length} tasks...`);
    
    tasks.forEach((task, index) => {
        console.log(`üìã Task ${index}:`, task);
        
        const taskElement = createTaskCardWithImage(task, category, index);
        container.appendChild(taskElement);
    });
    
    console.log('‚úÖ Tasks displayed successfully');
}
// üîß –ö–ù–û–ü–ö–ê –≠–ö–°–¢–†–ï–ù–ù–û–ì–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –î–õ–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø
function addMobileFixButton() {
    const fixBtn = document.createElement('button');
    fixBtn.textContent = 'üì± FIX MOBILE';
    fixBtn.style.position = 'fixed';
    fixBtn.style.top = '120px';
    fixBtn.style.right = '10px';
    fixBtn.style.zIndex = '10000';
    fixBtn.style.padding = '10px';
    fixBtn.style.background = 'green';
    fixBtn.style.color = 'white';
    fixBtn.style.border = 'none';
    fixBtn.style.borderRadius = '5px';
    fixBtn.style.fontSize = '12px';
    
    fixBtn.onclick = function() {
        console.log('üö® APPLYING MOBILE FIXES');
        emergencyMobileFix();
    };
    
    document.body.appendChild(fixBtn);
}

function emergencyMobileFix() {
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
    document.querySelectorAll('*').forEach(el => {
        el.style.maxWidth = '100%';
        el.style.boxSizing = 'border-box';
    });
    
    document.body.style.overflowX = 'hidden';
    document.documentElement.style.overflowX = 'hidden';
    
    console.log('‚úÖ Emergency mobile fixes applied');
}

// –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
setTimeout(addMobileFixButton, 2000);
// üîß –§–£–ù–ö–¶–ò–Ø –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø –ö–ê–¢–ï–ì–û–†–ò–ò
function formatCategory(category) {
    const categoryMap = {
        'social': 'üë• –°–æ—Ü—Å–µ—Ç–∏ ',
        'subscribe': 'üì± –ü–æ–¥–ø–∏—Å–∫–∏', 
        'view': 'üëÄ –ü—Ä–æ—Å–º–æ—Ç—Ä—ã',
        'comment': 'üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏',
        'repost': 'üîÑ –†–µ–ø–æ—Å—Ç—ã',
        'general': 'üìã –û–±—â–µ–µ',
        'other': 'üéØ –î—Ä—É–≥–æ–µ'
    };
    
    return categoryMap[category] || category;
}
async function initializeApp() {
    console.log('üéÆ Initializing LinkGold app...');

    // –ü—Ä–∏–º–µ–Ω—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è layout —Å—Ä–∞–∑—É
    fixLayoutIssues();
    // –ü—Ä–∏–º–µ–Ω—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è layout —Å—Ä–∞–∑—É
    fixLayoutIssues();

    // üî• –í–ê–ñ–ù–û: –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Å—ã–ª–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω
    if (currentUser && (currentUser.is_admin || parseInt(currentUser.id) === ADMIN_ID)) {
        setTimeout(() => {
            loadReferralLinksList();
        }, 1000);
    }
    // üî• –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–ê–Ø –ó–ê–ì–†–£–ó–ö–ê –ó–ê–î–ê–ù–ò–ô –ü–†–ò –°–¢–ê–†–¢–ï
    console.log('üöÄ FORCE loading tasks on app start...');
    setTimeout(() => {
        if (currentUser) {
            console.log('üë§ User authenticated, loading tasks...');
            loadTasksForCategory('new');
        } else {
            console.log('‚ùå No user for task loading');
        }
    }, 1000);

    // –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏...
    initializeTaskTabHandlers();

    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å API
    try {
        console.log('üîç Testing API connection...');
        const health = await makeRequest('/api/health');
        console.log('‚úÖ API connection successful:', health);

        
    } catch (error) {
        console.error('‚ùå API connection failed:', error);
        showNotification('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è', 'error');
        showRetryButton();
        return;
    }
    
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    await refreshAdminRights();
    
    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
    setupAdminPanel();
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    displayUserProfile();
    checkAdminRights();
    loadMainPagePosts();
    
    // üî• –í–ê–ñ–ù–û: –ó–ê–ì–†–£–ñ–ê–ï–ú –ó–ê–î–ê–ù–ò–Ø –ü–†–ò –ó–ê–ü–£–°–ö–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
    console.log('üöÄ Pre-loading tasks on app start...');
    loadTasks();
    
    initializeSearch();
    loadUserTasks();
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    startUserDataAutoUpdate();
    
    // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω, –∑–∞–≥—Ä—É–∂–∞–µ–º –∞–¥–º–∏–Ω-–¥–∞–Ω–Ω—ã–µ
    if (currentUser && (currentUser.is_admin || parseInt(currentUser.id) === ADMIN_ID)) {
        loadAdminChats();
        loadAdminTasks();
        loadTaskVerifications();
        
        // –ï—Å–ª–∏ —ç—Ç–æ –≥–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω, –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–æ–≤
        if (parseInt(currentUser.id) === ADMIN_ID) {
            setTimeout(() => {
                loadAdminsList();
            }, 500);
        }
    }
    
    // –ü–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–∏–º–µ–Ω—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    setTimeout(fixLayoutIssues, 2000);
     // –°–Ω–∞—á–∞–ª–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –ø—Ä–æ—Ñ–∏–ª—å —Å Telegram
    await syncUserProfile();

    // –ó–∞—Ç–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    displayUserProfile();
    checkAdminRights();
    loadMainPagePosts();
    checkPageVisibility()
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–¥–∞–Ω–∏—è
    loadTasks();
     // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–æ—Ñ–∏–ª—è
    updateProfileStats();
    updateActiveTasksCount();
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    startUserDataAutoUpdate();

    console.log('üéâ App initialized successfully');
        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    setInterval(updateActiveTasksCount, 30000);
}

function checkPageVisibility() {
    const adminTab = document.getElementById('admin-tab');
    if (!adminTab.classList.contains('active')) {
        resetAdminPanel();
    }
}
async function loadUserTasksForCategory(status) {
    if (!currentUser) return;
    
    try {
        console.log(`üîÑ Loading user tasks for category: ${status}`);
        
        let endpoint = '';
        switch(status) {
            case 'active':
                endpoint = `/api/user/${currentUser.id}/tasks/active`;
                break;
            case 'completed':
                endpoint = `/api/user/${currentUser.id}/tasks?status=completed`;
                break;
            case 'rejected':
                endpoint = `/api/user/${currentUser.id}/tasks?status=rejected`;
                break;
            default:
                return;
        }
        
        const result = await makeRequest(endpoint);
        
        if (result.success) {
            // –î–ª—è –∑–∞–¥–∞–Ω–∏–π –Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º user_task_id
            const tasksWithCorrectId = result.tasks.map(task => ({
                ...task,
                id: task.id // —ç—Ç–æ user_task_id –¥–ª—è –∑–∞–¥–∞–Ω–∏–π –Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
            }));
            
            displayUserTasksForCategory(tasksWithCorrectId, status);
        } else {
            console.error('‚ùå Error loading user tasks:', result.error);
        }
    } catch (error) {
        console.error(`‚ùå Error loading ${status} tasks:`, error);
    }
}
// üîß –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û–ì–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø LAYOUT
function fixLayoutIssues() {
    console.log('üîß Applying layout fixes...');
    
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã
    const elements = document.querySelectorAll('*');
    elements.forEach(el => {
        el.style.maxWidth = '100%';
        el.style.boxSizing = 'border-box';
    });
    
    // –û—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º –∑–∞–¥–∞–Ω–∏–π
    const tasksGrid = document.querySelector('.tasks-grid');
    if (tasksGrid) {
        tasksGrid.style.width = '100%';
        tasksGrid.style.margin = '0';
        tasksGrid.style.padding = '0';
        tasksGrid.style.overflow = 'hidden';
    }
    
    // –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–¥–∞–Ω–∏–π
    const taskCards = document.querySelectorAll('.task-card');
    taskCards.forEach(card => {
        card.style.width = '100%';
        card.style.maxWidth = '100%';
        card.style.boxSizing = 'border-box';
        card.style.margin = '0 0 12px 0';
        card.style.overflow = 'hidden';
    });
    
    // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—É—é –ø—Ä–æ–∫—Ä—É—Ç–∫—É
    document.body.style.overflowX = 'hidden';
    document.documentElement.style.overflowX = 'hidden';
    
    console.log('‚úÖ Layout fixes applied');
}

// üîß –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø –†–ê–ó–ú–ï–†–û–í –ü–†–ò –ò–ó–ú–ï–ù–ï–ù–ò–ò –≠–ö–†–ê–ù–ê
function updateLayoutOnResize() {
    fixLayoutIssues();
}

// –í—ã–∑—ã–≤–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞
document.addEventListener('DOMContentLoaded', fixLayoutIssues);
window.addEventListener('resize', updateLayoutOnResize);
window.addEventListener('orientationchange', updateLayoutOnResize);

// –¢–∞–∫–∂–µ –≤—ã–∑—ã–≤–∞–µ–º –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫
function showTasksTab() {
    console.log('üéØ –ü–ï–†–ï–•–û–î –ù–ê –í–ö–õ–ê–î–ö–£ –ó–ê–î–ê–ù–ò–ô');
    
    hideAllTabs();
    const tasksTab = document.getElementById('tasks-tab');
    if (tasksTab) {
        tasksTab.classList.add('active');
    }
    
    updateNavState('tasks');
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
    setTimeout(fixLayoutIssues, 100);
    
    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∫–ª–∞–¥–∫—É "–ù–æ–≤—ã–µ"
    setTimeout(() => {
        showTaskCategory('new');
    }, 150);
}

function displayUserTasksForCategory(tasks, status) {
    let container = null;
    
    switch(status) {
        case 'active':
            container = document.getElementById('confirmation-tasks');
            break;
        case 'completed':
            container = document.getElementById('completed-tasks');
            break;
        case 'rejected':
            container = document.getElementById('rejected-tasks');
            break;
    }
    
    if (!container) {
        console.error(`‚ùå Container not found for status: ${status}`);
        return;
    }
    
    container.innerHTML = '';

    if (!tasks || tasks.length === 0) {
        let message = '';
        switch(status) {
            case 'active':
                message = '–ù–µ—Ç –∑–∞–¥–∞–Ω–∏–π –Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ';
                break;
            case 'completed':
                message = '–ù–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π';
                break;
            case 'rejected':
                message = '–ù–µ—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π';
                break;
        }
        
        container.innerHTML = `
            <div class="no-tasks" style="text-align: center; padding: 40px 20px;">
                <div style="font-size: 48px; margin-bottom: 16px;">üìù</div>
                <div style="font-size: 18px; margin-bottom: 8px;">${message}</div>
                <div style="font-size: 14px; color: var(--text-secondary);">
                    ${status === 'active' ? '–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å' : '–°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏'}
                </div>
            </div>
        `;
        return;
    }

    console.log(`üéØ Displaying ${tasks.length} tasks for ${status} category`);
    
    tasks.forEach((task, index) => {
        const taskElement = createTaskCardWithImage(task, status, index);
        container.appendChild(taskElement);
    });
}

        // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadUserTasks() {
            if (!currentUser) return;
            
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è (–Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ)
                const activeResult = await makeRequest(`/user/${currentUser.id}/tasks?status=active`);
                if (activeResult.success) {
                    displayUserTasksForCategory(activeResult.tasks, 'active');
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è
                const completedResult = await makeRequest(`/user/${currentUser.id}/tasks?status=completed`);
                if (completedResult.success) {
                    displayUserTasksForCategory(completedResult.tasks, 'completed');
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è
                const rejectedResult = await makeRequest(`/user/${currentUser.id}/tasks?status=rejected`);
                if (rejectedResult.success) {
                    displayUserTasksForCategory(rejectedResult.tasks, 'rejected');
                }
                
            } catch (error) {
                console.error('Error loading user tasks:', error);
            }
        }

   // –í index.html - –æ–±–Ω–æ–≤–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞
function initializeSearch() {
    const searchInput = document.getElementById('task-search');
    if (searchInput) {
        let searchTimeout;
        searchInput.addEventListener('input', function(e) {
            clearTimeout(searchTimeout);
            const searchText = e.target.value.trim();
            
            searchTimeout = setTimeout(() => {
                if (searchText.length >= 2 || searchText.length === 0) {
                    // –ü–µ—Ä–µ–¥–∞–µ–º userId –ø—Ä–∏ –ø–æ–∏—Å–∫–µ
                    loadTasks(searchText, getActiveFilter());
                }
            }, 300);
        });
    }
    
    const filterButtons = document.querySelectorAll('.filter-btn');
    filterButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            const filter = this.getAttribute('data-filter');
            // –ü–µ—Ä–µ–¥–∞–µ–º userId –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
            loadTasks('', filter);
            
            filterButtons.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
        });
    });
}

// –í index.html - –¥–æ–±–∞–≤—å—Ç–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
function getActiveFilter() {
    const activeFilter = document.querySelector('.filter-btn.active');
    return activeFilter ? activeFilter.getAttribute('data-filter') : 'all';
}

function getTabIndex(category) {
    switch(category) {
        case 'new': return 1;
        case 'confirmation': return 2;
        case 'completed': return 3;
        case 'rejected': return 4;
        default: return 1;
    }
}




function openTaskModal(taskId) {
    console.log('üìñ Opening task modal for task:', taskId);
    console.log('üìã All available tasks:', allTasks);
    
    selectedTaskId = taskId;
    
    const task = allTasks.find(t => t.id === taskId);
    if (task) {
        console.log('‚úÖ Task found:', task);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        document.getElementById('task-modal-title').textContent = task.title;
        document.getElementById('task-modal-category').textContent = task.category || '–û–±—â–µ–µ';
        document.getElementById('task-modal-price').textContent = `${task.price} ‚≠ê`;
        document.getElementById('task-modal-description').textContent = task.description;
        
        // üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
        const modalImageContainer = document.getElementById('task-modal-image-container');
        if (modalImageContainer) {
            if (task.image_url) {
                modalImageContainer.innerHTML = `
                    <div class="task-image-placeholder">
                        <div style="text-align: center;">
                            <div style="font-size: 32px; margin-bottom: 8px;">üìã</div>
                            <div style="font-size: 12px;">–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</div>
                        </div>
                    </div>
                `;
            } else {
                modalImageContainer.innerHTML = `
                    <div class="task-image-placeholder" style="aspect-ratio: 16/9;">
                        <div style="text-align: center; padding: 40px;">
                            <div style="font-size: 32px; margin-bottom: 8px;">üìã</div>
                            <div>–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</div>
                        </div>
                    </div>
                `;
            }
        }
        
        document.getElementById('task-modal-time').textContent = task.time_to_complete || '5 –º–∏–Ω—É—Ç';
        document.getElementById('task-modal-difficulty').textContent = task.difficulty || '–õ–µ–≥–∫–∞—è';
        
        const peopleRequired = task.people_required || 1;
        const completedCount = task.completed_count || 0;
        const availableTasks = Math.max(0, peopleRequired - completedCount);
        document.getElementById('task-modal-available').textContent = `${availableTasks} –∑–∞–¥–∞–Ω–∏–π`;
        
        // üîß –î–û–ë–ê–í–õ–ï–ù–û: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ
        const taskUrl = task.task_url;
        const startButton = document.querySelector('.task-modal-start');
        
        if (taskUrl && taskUrl.startsWith('http')) {
            // –ï—Å–ª–∏ –µ—Å—Ç—å –≤–∞–ª–∏–¥–Ω–∞—è —Å—Å—ã–ª–∫–∞, –º–µ–Ω—è–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
            startButton.textContent = 'üîó –ü–µ—Ä–µ–π—Ç–∏ –∫ –∑–∞–¥–∞–Ω–∏—é';
            startButton.onclick = function() {
                console.log('üîó Opening task URL:', taskUrl);
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ/–≤–∫–ª–∞–¥–∫–µ
                window.open(taskUrl, '_blank');
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                closeModal('task-modal');
                // –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ
                startTask();
            };
        } else {
            // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ - –ø—Ä–æ—Å—Ç–æ –Ω–∞—á–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ
            startButton.textContent = '–ù–∞—á–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ';
            startButton.onclick = startTask;
        }
        
        document.getElementById('task-modal').classList.add('active');
        console.log('‚úÖ Task modal opened successfully');
    } else {
        console.error('‚ùå Task not found in allTasks array');
        console.error('‚ùå Available task IDs:', allTasks.map(t => t.id));
        showNotification('–û—à–∏–±–∫–∞: –∑–∞–¥–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞–Ω–∏–π.', 'error');
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–¥–∞–Ω–∏—è
        setTimeout(() => {
            loadTasks();
        }, 2000);
    }
}
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–¥–∞–Ω–∏—è—Ö
async function fixExistingTaskImages() {
    try {
        console.log('üîß Fixing existing task images...');
        
        // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
        const tasks = await pool.query(`
            SELECT id, image_url FROM tasks 
            WHERE image_url IS NOT NULL AND image_url != ''
        `);
        
        let fixedCount = 0;
        
        for (const task of tasks.rows) {
            if (task.image_url && !task.image_url.startsWith('http')) {
                // –ò—Å–ø—Ä–∞–≤–ª—è–µ–º URL
                const correctedUrl = `${APP_URL}${task.image_url}`;
                await pool.query(
                    'UPDATE tasks SET image_url = $1 WHERE id = $2',
                    [correctedUrl, task.id]
                );
                fixedCount++;
                console.log(`‚úÖ Fixed image URL for task ${task.id}: ${correctedUrl}`);
            }
        }
        
        console.log(`‚úÖ Fixed ${fixedCount} task images`);
    } catch (error) {
        console.error('‚ùå Error fixing task images:', error);
    }
}

// –í—ã–∑–æ–≤–∏—Ç–µ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞
fixExistingTaskImages();

function showTaskConfirmation(userTaskId, taskName) {
    console.log('üîç Confirming task:', { userTaskId, taskName });
    
    if (!userTaskId) {
        showNotification('–û—à–∏–±–∫–∞: ID –∑–∞–¥–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
        return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ userTaskId - —á–∏—Å–ª–æ
    const numericTaskId = parseInt(userTaskId);
    if (isNaN(numericTaskId)) {
        showNotification('–û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π ID –∑–∞–¥–∞–Ω–∏—è', 'error');
        return;
    }
    
    currentUserTaskId = numericTaskId;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    const taskNameElement = document.getElementById('confirmation-task-name');
    const taskTextElement = document.getElementById('confirmation-task-text');
    
    if (taskNameElement) {
        taskNameElement.textContent = taskName;
    }
    
    if (taskTextElement) {
        taskTextElement.textContent = `–í—ã –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –∑–∞–¥–∞–Ω–∏–µ "${taskName}"?`;
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    const confirmationModal = document.getElementById('confirmation-modal');
    if (confirmationModal) {
        confirmationModal.classList.add('active');
        console.log('‚úÖ Confirmation modal opened for task:', taskName);
    } else {
        console.error('‚ùå Confirmation modal not found');
        showNotification('–û—à–∏–±–∫–∞: –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ', 'error');
    }
}
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–¥–∞–Ω–∏–π
function showScreenshotUpload() {
    closeModal('confirmation-modal');
    closeModal('cancel-confirmation-modal');
    
    // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
    document.getElementById('screenshot-file').value = '';
    document.getElementById('screenshot-preview').style.display = 'none';
    document.getElementById('file-name').textContent = '';
    
    // üî• –í–ê–ñ–ù–û: –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
    const submitBtn = document.getElementById('submit-screenshot-btn');
    if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É';
    }
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Ñ–∞–π–ª–∞
            document.getElementById('screenshot-file').onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    document.getElementById('file-name').textContent = file.name;
                    document.getElementById('submit-screenshot-btn').disabled = false;
                    
                    // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–≤—å—é
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const preview = document.getElementById('screenshot-preview');
                        preview.src = e.target.result;
                        preview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            };
            
            document.getElementById('screenshot-modal').classList.add('active');
        }

        function showCancelConfirmation() {
            closeModal('confirmation-modal');
            document.getElementById('cancel-confirmation-modal').classList.add('active');
        }

        async function submitScreenshot() {
    const fileInput = document.getElementById('screenshot-file');
    if (!fileInput.files[0]) {
        showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª —Å–∫—Ä–∏–Ω—à–æ—Ç–∞', 'error');
        return;
    }

    const formData = new FormData();
    formData.append('screenshot', fileInput.files[0]);
    formData.append('userId', currentUser.id);

    try {
        const response = await fetch(`${API_BASE_URL}/api/user/tasks/${currentUserTaskId}/submit`, {
            method: 'POST',
            body: formData
            // –ù–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Content-Type, –±—Ä–∞—É–∑–µ—Ä —Å–∞–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç —Å boundary
        });

        const result = await response.json();

        if (result.success) {
            showNotification('–°–∫—Ä–∏–Ω—à–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É!', 'success');
            closeModal('screenshot-modal');
            loadUserTasks();
        } else {
            showNotification('–û—à–∏–±–∫–∞: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('Error submitting screenshot:', error);
        showNotification('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞', 'error');
    }
}

// –û–±–Ω–æ–≤–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–º–µ–Ω—ã –∑–∞–¥–∞–Ω–∏—è
async function cancelTask() {
    if (!currentUserTaskId) return;

    try {
        const result = await makeRequest(`/user/tasks/${currentUserTaskId}/cancel`, {
            method: 'POST',
            body: JSON.stringify({
                userId: currentUser.id
            })
        });

        if (result.success) {
            showNotification('–ó–∞–¥–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ', 'success');
            closeModal('cancel-confirmation-modal');
            
            // –ù–ï–ú–ï–î–õ–ï–ù–ù–û –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–∫–∏
            setTimeout(() => {
                loadTasks(); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∑–∞–¥–∞–Ω–∏–µ –≤ –Ω–æ–≤—ã–µ
                loadUserTasks(); // –£–±–∏—Ä–∞–µ–º –∏–∑ –∞–∫—Ç–∏–≤–Ω—ã—Ö
            }, 500);
            
        } else {
            showNotification('–û—à–∏–±–∫–∞: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('Error cancelling task:', error);
        showNotification('–û—à–∏–±–∫–∞ –æ—Ç–º–µ–Ω—ã –∑–∞–¥–∞–Ω–∏—è', 'error');
    }
}
// üîß –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ó–ê–ì–†–£–ó–ö–ò –ü–†–û–í–ï–†–û–ö
async function loadTaskVerifications() {
    if (!currentUser) return;

    try {
        console.log('üîÑ Loading task verifications...');
        const result = await makeRequest(`/api/admin/task-verifications?adminId=${currentUser.id}`);
        
        console.log('üì® Verifications response:', result);
        
        if (result.success) {
            console.log(`‚úÖ Loaded ${result.verifications?.length || 0} verifications`);
            displayTaskVerifications(result.verifications);
        } else {
            console.error('‚ùå Failed to load verifications:', result.error);
        }
    } catch (error) {
        console.error('‚ùå Error loading task verifications:', error);
    }
}
function debugVerificationClick() {
    console.log('üîç Debug verification click:');
    
    const verificationItems = document.querySelectorAll('.verification-item');
    console.log(`Found ${verificationItems.length} verification items`);
    
    verificationItems.forEach((item, index) => {
        console.log(`Item ${index}:`, {
            hasClickListener: !!item.onclick,
            textContent: item.textContent
        });
    });
}

// –í—ã–∑–æ–≤–∏—Ç–µ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
setTimeout(debugVerificationClick, 3000);

function displayTaskVerifications(verifications) {
    const container = document.getElementById('admin-verification-list');
    if (!container) return;

    container.innerHTML = '';

    if (!verifications || verifications.length === 0) {
        container.innerHTML = `
            <div class="no-tasks" style="text-align: center; padding: 40px 20px;">
                <div style="font-size: 48px; margin-bottom: 16px;">‚úÖ</div>
                <div>–ù–µ—Ç –∑–∞–¥–∞–Ω–∏–π –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</div>
                <div style="font-size: 14px; color: var(--text-secondary); margin-top: 8px;">
                    –ù–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
                </div>
            </div>
        `;
        return;
    }

    verifications.forEach(verification => {
        const verificationElement = document.createElement('div');
        verificationElement.className = 'verification-item';
        verificationElement.style.cssText = `
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        `;
        verificationElement.onmouseover = function() {
            this.style.transform = 'translateY(-2px)';
            this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
        };
        verificationElement.onmouseout = function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = 'none';
        };

        // –û–ë–†–ê–ë–û–¢–ß–ò–ö –ö–õ–ò–ö–ê - –û–¢–ö–†–´–í–ê–ï–ú –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û
        verificationElement.onclick = () => openVerificationModal(verification);

        const userAvatar = verification.user_name ? verification.user_name.charAt(0).toUpperCase() : 'U';
        const submissionTime = formatPostDate(verification.submitted_at);

        verificationElement.innerHTML = `
            <div class="verification-header" style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div class="verification-avatar" style="width: 40px; height: 40px; border-radius: 50%; background: var(--purple-gradient); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">
                        ${userAvatar}
                    </div>
                    <div class="verification-user-info">
                        <div class="verification-user-name" style="font-weight: 600; margin-bottom: 4px;">
                            ${verification.user_name}
                            ${verification.username ? `(@${verification.username})` : ''}
                        </div>
                        <div class="verification-task-title" style="color: var(--text-secondary); font-size: 14px;">
                            ${verification.task_title}
                        </div>
                    </div>
                </div>
                <div class="verification-price" style="font-size: 18px; font-weight: 700; color: var(--gold);">
                    ${verification.task_price} ‚≠ê
                </div>
            </div>
            <div class="verification-time" style="color: var(--text-secondary); font-size: 12px;">
                –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: ${submissionTime}
            </div>
            
            <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è -->
            <div style="margin-top: 10px; padding: 8px; background: rgba(59, 130, 246, 0.1); border-radius: 6px; border-left: 3px solid var(--accent);">
                <div style="font-size: 12px; color: var(--accent); font-weight: 600;">
                    üì∏ –ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏
                </div>
            </div>
        `;

        container.appendChild(verificationElement);
    });
}

// –ü–æ–∫–∞–∑–∞—Ç—å —Å–µ–∫—Ü–∏—é –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
function showPromocodesSection() {
    showAdminSection('promocodes');
    loadPromocodesList();
}

async function createPromoCode() {
    try {
        console.log('üé´ START: createPromoCode');
        
        if (!currentUser) {
            throw new Error('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
        }
        
        if (parseInt(currentUser.id) !== ADMIN_ID) {
            throw new Error('–¢–æ–ª—å–∫–æ –≥–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥—ã!');
        }
        
        // –ü–†–û–í–ï–†–ö–ê –°–£–©–ï–°–¢–í–û–í–ê–ù–ò–Ø –≠–õ–ï–ú–ï–ù–¢–û–í
        const codeInput = document.getElementById('promocode-code');
        const maxUsesInput = document.getElementById('promocode-max-uses');
        const rewardInput = document.getElementById('promocode-reward');
        const expiresInput = document.getElementById('promocode-expires');
        const messageDiv = document.getElementById('promocode-form-message');
        const submitBtn = document.getElementById('create-promocode-btn');
        
        // –ü–†–û–í–ï–†–Ø–ï–ú –í–°–ï –≠–õ–ï–ú–ï–ù–¢–´
        if (!codeInput || !maxUsesInput || !rewardInput || !messageDiv || !submitBtn) {
            console.error('‚ùå Missing form elements:', {
                codeInput: !!codeInput,
                maxUsesInput: !!maxUsesInput,
                rewardInput: !!rewardInput,
                messageDiv: !!messageDiv,
                submitBtn: !!submitBtn
            });
            throw new Error('–≠–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
        }
        
        // –ü–û–õ–£–ß–ê–ï–ú –ó–ù–ê–ß–ï–ù–ò–Ø –° –ü–†–û–í–ï–†–ö–û–ô
        const code = codeInput?.value?.trim().toUpperCase() || '';
        const maxUses = maxUsesInput?.value ? parseInt(maxUsesInput.value) : 0;
        const reward = rewardInput?.value ? parseFloat(rewardInput.value) : 0;
        const expiresAt = expiresInput?.value ? new Date(expiresInput.value).toISOString() : null;
        
        console.log('üìä Form data:', { code, maxUses, reward, expiresAt });
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è
        if (!code) {
            throw new Error('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –ø—Ä–æ–º–æ–∫–æ–¥–∞!');
        }
        
        if (!/^[A-Z0-9]+$/.test(code)) {
            throw new Error('–ö–æ–¥ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã!');
        }
        
        if (code.length < 3 || code.length > 20) {
            throw new Error('–î–ª–∏–Ω–∞ –∫–æ–¥–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 3 –¥–æ 20 —Å–∏–º–≤–æ–ª–æ–≤!');
        }
        
        if (!maxUses || maxUses < 1 || maxUses > 10000) {
            throw new Error('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–∞—Ü–∏–π (1-10000)!');
        }
        
        if (!reward || reward < 1 || reward > 100000) {
            throw new Error('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –Ω–∞–≥—Ä–∞–¥—É (1-100000 –∑–≤–µ–∑–¥)!');
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
        submitBtn.disabled = true;
        submitBtn.textContent = '–°–æ–∑–¥–∞–µ–º...';
        showMessage('‚è≥ –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–º–æ–∫–æ–¥...', 'loading', messageDiv);
        
        console.log('üì§ Sending request to server...');
        
        const result = await makeRequest('/api/admin/promocodes/create', {
            method: 'POST',
            body: JSON.stringify({
                adminId: currentUser.id,
                code: code,
                maxUses: maxUses,
                reward: reward,
                expiresAt: expiresAt
            })
        });
        
        console.log('üì® Server response:', result);
        
        if (result.success) {
            showMessage(`‚úÖ ${result.message}`, 'success', messageDiv);
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            codeInput.value = '';
            maxUsesInput.value = '10';
            rewardInput.value = '50';
            expiresInput.value = '';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
            loadPromocodesList();
            
        } else {
            throw new Error(result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
        }
        
    } catch (error) {
        console.error('‚ùå createPromoCode error:', error);
        const messageDiv = document.getElementById('promocode-form-message');
        showMessage(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error', messageDiv);
        showNotification(`–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞: ${error.message}`, 'error');
    } finally {
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ
        const submitBtn = document.getElementById('create-promocode-btn');
        if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.textContent = 'üé´ –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥';
        }
    }
}
function showMessage(text, type, container) {
    if (!container) return;
    
    const colors = {
        success: 'var(--success)',
        error: 'var(--error)',
        loading: 'var(--warning)',
        info: 'var(--text-primary)'
    };
    
    container.innerHTML = `<span style="color: ${colors[type] || colors.info};">${text}</span>`;
}
// –¢–µ—Å—Ç–æ–≤—ã–π endpoint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
// –¢–µ—Å—Ç–æ–≤—ã–π endpoint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
app.get('/api/admin/promocodes/test', async (req, res) => {
    try {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
        await pool.query('SELECT 1');
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
        const tableCheck = await pool.query(`
            SELECT EXISTS (
                SELECT FROM information_schema.tables 
                WHERE table_name = 'promocodes'
            ) as table_exists
        `);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
        const countResult = await pool.query('SELECT COUNT(*) FROM promocodes');
        
        res.json({
            success: true,
            message: 'Promocodes system test',
            database: 'Connected',
            table_exists: tableCheck.rows[0].table_exists,
            promocodes_count: parseInt(countResult.rows[0].count),
            timestamp: new Date().toISOString()
        });
        
    } catch (error) {
        console.error('Promocodes test error:', error);
        res.status(500).json({
            success: false,
            error: error.message
        });
    }
});
// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
async function loadPromocodesList() {
    if (!currentUser || parseInt(currentUser.id) !== ADMIN_ID) return;
    
    try {
        const result = await makeRequest(`/api/admin/promocodes/list?adminId=${currentUser.id}`);
        
        if (result.success) {
            displayPromocodesList(result.promocodes);
        } else {
            console.error('Error loading promocodes:', result.error);
        }
    } catch (error) {
        console.error('Load promocodes error:', error);
    }
}

function displayPromocodesList(promocodes) {
    const container = document.getElementById('promocodes-list');
    if (!container) {
        console.error('‚ùå Promocodes list container not found');
        return;
    }
    
    container.innerHTML = '';
    

    console.log(`üé® Displaying ${promocodes.length} promocodes`);
    
    promocodes.forEach(promo => {
        const promoElement = document.createElement('div');
        promoElement.className = 'admin-task-item';
        
        const usedCount = promo.used_count || 0;
        const isExpired = promo.expires_at && new Date(promo.expires_at) < new Date();
        const isFullyUsed = usedCount >= promo.max_uses;
        const status = isExpired ? 'expired' : (isFullyUsed ? 'used' : 'active');
        
        const statusColors = {
            active: 'var(--success)',
            used: 'var(--warning)',
            expired: 'var(--error)'
        };
        
        const statusTexts = {
            active: '–ê–∫—Ç–∏–≤–µ–Ω',
            used: '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω',
            expired: '–ü—Ä–æ—Å—Ä–æ—á–µ–Ω'
        };
        
        promoElement.innerHTML = `
            <div class="admin-task-header">
                <div class="admin-task-title">
                    <span style="font-size: 18px; font-weight: 800; color: var(--gold);">${promo.code}</span>
                    <span style="color: ${statusColors[status]}; font-size: 12px; margin-left: 10px;">
                        ${statusTexts[status]}
                    </span>
                </div>
                <div class="admin-task-actions">
                    <button class="admin-task-delete" onclick="deactivatePromoCode('${promo.code}')">
                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                    </button>
                </div>
            </div>
            <div class="admin-task-description">
                <div>üéÅ –ù–∞–≥—Ä–∞–¥–∞: <strong>${promo.reward} ‚≠ê</strong></div>
                <div>üë• –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: <strong>${usedCount}/${promo.max_uses}</strong></div>
                <div>üìÖ –°–æ–∑–¥–∞–Ω: ${new Date(promo.created_at).toLocaleDateString('ru-RU')}</div>
                ${promo.expires_at ? `
                    <div>‚è∞ –ò—Å—Ç–µ–∫–∞–µ—Ç: ${new Date(promo.expires_at).toLocaleDateString('ru-RU')}</div>
                ` : ''}
            </div>
        `;
        
            promocodes.forEach(promo => {
        const promoElement = createPromocodeElement(promo);
        container.appendChild(promoElement);
    });
    });
}

// –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞
async function deactivatePromoCode(code) {
    if (!confirm(`–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥ ${code}?`)) return;
    
    if (!currentUser || parseInt(currentUser.id) !== ADMIN_ID) {
        showNotification('–¢–æ–ª—å–∫–æ –≥–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥—ã!', 'error');
        return;
    }
    
    try {
        const result = await makeRequest('/api/admin/promocodes/deactivate', {
            method: 'POST',
            body: JSON.stringify({
                adminId: currentUser.id,
                code: code
            })
        });
        
        if (result.success) {
            showNotification(result.message, 'success');
            loadPromocodesList();
        } else {
            showNotification('–û—à–∏–±–∫–∞: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('Deactivate promocode error:', error);
        showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞', 'error');
    }
}

// üîß –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ê–ö–¢–ò–í–ê–¶–ò–ò –ü–†–û–ú–û–ö–û–î–ê
async function activatePromoCode() {
    const input = document.getElementById('promocode-input');
    const messageDiv = document.getElementById('promocode-message');
    const code = input.value.trim().toUpperCase();
    
    if (!code) {
        messageDiv.innerHTML = '<span style="color: var(--error);">‚ùå –í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥!</span>';
        return;
    }
    
    if (!currentUser) {
        messageDiv.innerHTML = '<span style="color: var(--error);">‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω!</span>';
        return;
    }
    
    messageDiv.innerHTML = '<span style="color: var(--warning);">‚è≥ –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø—Ä–æ–º–æ–∫–æ–¥...</span>';
    input.disabled = true;
    
    try {
        const result = await makeRequest('/api/promocodes/activate', {
            method: 'POST',
            body: JSON.stringify({
                userId: currentUser.id,
                code: code
            })
        });
        
        if (result.success) {
            messageDiv.innerHTML = `<span style="color: var(--success);">‚úÖ ${result.message}</span>`;
            input.value = '';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            await updateUserData();
            
            // üî• –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –∏—Å–ø–æ–ª—å–∑—É–µ–º reward –∏–∑ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞
            if (result.reward) {
                showPromocodeSuccessAnimation(result.reward);
            }
            
        } else {
            messageDiv.innerHTML = `<span style="color: var(--error);">‚ùå ${result.error}</span>`;
        }
        
    } catch (error) {
        console.error('‚ùå Activate promocode error:', error);
        messageDiv.innerHTML = `<span style="color: var(--error);">‚ùå –û—à–∏–±–∫–∞: ${error.message}</span>`;
    } finally {
        input.disabled = false;
    }
}

// –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π
window.showPromocodesSection = showPromocodesSection;
window.createPromoCode = createPromoCode;
window.activatePromoCode = activatePromoCode;
window.deactivatePromoCode = deactivatePromoCode;


// üîß –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –û–¢–ö–†–´–¢–ò–Ø –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–ê –ü–†–û–í–ï–†–ö–ò
function openVerificationModal(verification) {
    console.log('üìñ Opening verification modal:', verification);
    
    if (!verification) {
        console.error('‚ùå No verification data provided');
        showNotification('–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã', 'error');
        return;
    }
    
    currentVerificationId = verification.id;

    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    const userAvatar = document.getElementById('verification-user-avatar');
    const userName = document.getElementById('verification-user-name');
    const taskTitle = document.getElementById('verification-task-title');
    const taskPrice = document.getElementById('verification-task-price');
    const screenshot = document.getElementById('verification-screenshot');
    
    if (userAvatar) {
        userAvatar.textContent = verification.user_name ? 
            verification.user_name.charAt(0).toUpperCase() : 'U';
    }
    
    if (userName) {
        userName.textContent = verification.user_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
    }
    
    if (taskTitle) {
        taskTitle.textContent = verification.task_title || '–ó–∞–¥–∞–Ω–∏–µ';
    }
    
    if (taskPrice) {
        taskPrice.textContent = `${verification.task_price || 0} ‚≠ê`;
    }
    
    // üî• –£–õ–£–ß–®–ï–ù–ù–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê –°–ö–†–ò–ù–®–û–¢–ê
    if (screenshot) {
        if (verification.screenshot_url) {
            screenshot.src = verification.screenshot_url;
            screenshot.style.display = 'block';
            screenshot.onerror = function() {
                console.error('‚ùå Failed to load screenshot');
                this.style.display = 'none';
                // üî• –ü–û–ö–ê–ó–´–í–ê–ï–ú –°–û–û–ë–©–ï–ù–ò–ï –û –ü–†–û–ë–õ–ï–ú–ï –°–û –°–ö–†–ò–ù–®–û–¢–û–ú
                showScreenshotErrorWarning();
            };
        } else {
            screenshot.style.display = 'none';
            showScreenshotErrorWarning();
        }
    }

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    const modal = document.getElementById('verification-modal');
    if (modal) {
        modal.classList.add('active');
        console.log('‚úÖ Verification modal opened');
    } else {
        console.error('‚ùå Verification modal not found');
        showNotification('–û—à–∏–±–∫–∞: –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ', 'error');
    }
}

// üîß –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–û–ö–ê–ó–ê –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–Ø –û –ü–†–û–ë–õ–ï–ú–ï –°–û –°–ö–†–ò–ù–®–û–¢–û–ú
function showScreenshotErrorWarning() {
    const modalBody = document.querySelector('.verification-modal-content .modal-body');
    if (!modalBody) return;
    
    // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
    const existingWarning = document.getElementById('screenshot-warning');
    if (existingWarning) {
        existingWarning.remove();
    }
    
    const warningHTML = `
        <div id="screenshot-warning" style="
            background: rgba(255, 152, 0, 0.1);
            border: 1px solid #ff9800;
            border-radius: 8px;
            padding: 12px;
            margin: 10px 0;
            text-align: center;
        ">
            <div style="color: #ff9800; font-weight: 600; margin-bottom: 5px;">
                ‚ö†Ô∏è –°–∫—Ä–∏–Ω—à–æ—Ç –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω
            </div>
            <div style="font-size: 12px; color: var(--text-secondary);">
                –í—ã –≤—Å–µ —Ä–∞–≤–Ω–æ –º–æ–∂–µ—Ç–µ –æ–¥–æ–±—Ä–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ, –Ω–∞–∂–∞–≤ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ
            </div>
        </div>
    `;
    
    // –í—Å—Ç–∞–≤–ª—è–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –∫–Ω–æ–ø–∫–∞–º–∏ –¥–µ–π—Å—Ç–≤–∏–π
    const actionButtons = modalBody.querySelector('.verification-modal-actions');
    if (actionButtons) {
        actionButtons.insertAdjacentHTML('beforebegin', warningHTML);
    }
}

// üîí –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ë–õ–û–ö–ò–†–û–í–ö–ò –ö–ù–û–ü–ö–ò –û–¢–ü–†–ê–í–ö–ò
function setupSingleSubmission() {
    const submitBtn = document.getElementById('submit-screenshot-btn');
    if (submitBtn) {
        let isSubmitting = false;
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
        const originalOnclick = submitBtn.onclick;
        
        submitBtn.onclick = function(event) {
            if (isSubmitting) {
                event.preventDefault();
                event.stopPropagation();
                showNotification('‚è≥ –ó–∞–¥–∞–Ω–∏–µ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è...', 'warning');
                return false;
            }
            
            isSubmitting = true;
            submitBtn.disabled = true;
            submitBtn.textContent = '‚è≥ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º...';
            
            // –í—ã–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
            if (originalOnclick) {
                const result = originalOnclick.call(this, event);
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π
                setTimeout(() => {
                    isSubmitting = false;
                    submitBtn.disabled = false;
                    submitBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É';
                }, 5000);
                
                return result;
            }
        };
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    setupSingleSubmission();
});

// –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é submitScreenshot –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–∫–∏
async function submitScreenshot() {
    const fileInput = document.getElementById('screenshot-file');
    const submitBtn = document.getElementById('submit-screenshot-btn');
    
    if (!fileInput.files[0]) {
        showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª —Å–∫—Ä–∏–Ω—à–æ—Ç–∞', 'error');
        return;
    }

    try {
        const formData = new FormData();
        formData.append('screenshot', fileInput.files[0]);
        formData.append('userId', currentUser.id);

        const response = await fetch(`${API_BASE_URL}/api/user/tasks/${currentUserTaskId}/submit`, {
            method: 'POST',
            body: formData
        });

        const result = await response.json();

        if (result.success) {
            showNotification('–°–∫—Ä–∏–Ω—à–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É!', 'success');
            closeModal('screenshot-modal');
            loadUserTasks();
        } else {
            showNotification('–û—à–∏–±–∫–∞: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('Error submitting screenshot:', error);
        showNotification('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞', 'error');
    } finally {
        // üî• –í–ê–ñ–ù–û: –í—Å–µ–≥–¥–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
        if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É';
        }
    }
}
// üóëÔ∏è –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –£–î–ê–õ–ï–ù–ò–Ø –ü–†–û–í–ï–†–ö–ò
async function deleteVerification() {
    if (!currentVerificationId) {
        showNotification('‚ùå ID –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
        return;
    }

    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –ø—Ä–æ–≤–µ—Ä–∫—É?\n\n–ó–∞–¥–∞–Ω–∏–µ –≤–µ—Ä–Ω–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞.')) {
        return;
    }

    try {
        console.log(`üóëÔ∏è Deleting verification:`, {
            verificationId: currentVerificationId,
            adminId: currentUser.id
        });

        const result = await makeRequest(`/api/admin/task-verifications/${currentVerificationId}/delete`, {
            method: 'POST',
            body: JSON.stringify({
                adminId: currentUser.id
            })
        });

        console.log('üì® Delete verification response:', result);

        if (result.success) {
            showNotification('‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–¥–∞–ª–µ–Ω–∞! –ó–∞–¥–∞–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.', 'success');
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            closeModal('verification-modal');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–∫–∏
            setTimeout(() => {
                loadTaskVerifications();
                console.log('‚úÖ –°–ø–∏—Å–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏');
            }, 500);
            
        } else {
            throw new Error(result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
        }

    } catch (error) {
        console.error('‚ùå Delete verification error:', error);
        
        let errorMessage = '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏';
        if (error.message.includes('Failed to fetch')) {
            errorMessage = '‚ùå –ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.';
        } else if (error.message.includes('404')) {
            errorMessage = '‚ùå –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.';
        } else if (error.message.includes('403')) {
            errorMessage = '‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω.';
        }
        
        showNotification(errorMessage, 'error');
    }
}
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π
async function monitorReferralSystem() {
    console.log('üîç Monitoring referral system...');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
    try {
        const result = await pool.query(`
            SELECT 
                COUNT(*) as total_referrals,
                SUM(CASE WHEN balance >= 2 THEN 1 ELSE 0 END) as users_with_bonus,
                AVG(balance) as avg_balance
            FROM user_profiles 
            WHERE referred_by IS NOT NULL
        `);
        
        const stats = result.rows[0];
        console.log('üìä Referral system stats:', {
            totalReferrals: stats.total_referrals,
            usersWithBonus: stats.users_with_bonus,
            avgBalance: stats.avg_balance
        });
        
    } catch (error) {
        console.error('Error monitoring referral system:', error);
    }
}

// –ó–∞–ø—É—Å–∫–∞–π—Ç–µ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏
setInterval(monitorReferralSystem, 60000);
// üîß –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –û–î–û–ë–†–ï–ù–ò–Ø –ó–ê–î–ê–ù–ò–Ø
// üîß –£–õ–£–ß–®–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –û–î–û–ë–†–ï–ù–ò–Ø –ó–ê–î–ê–ù–ò–Ø –° –û–ë–†–ê–ë–û–¢–ö–û–ô –û–®–ò–ë–û–ö
async function approveVerification() {
    if (!currentVerificationId) {
        showNotification('‚ùå ID –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
        return;
    }

    if (!currentUser) {
        showNotification('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω', 'error');
        return;
    }

    try {
        console.log(`üîÑ –ù–∞—á–∏–Ω–∞–µ–º –æ–¥–æ–±—Ä–µ–Ω–∏–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏:`, {
            verificationId: currentVerificationId,
            adminId: currentUser.id
        });
// –í —Ñ—É–Ω–∫—Ü–∏–∏ approveVerification –¥–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É:
console.log('üí∞ Income distribution:', {
    taskPrice: taskPrice,
    userReward: userReward,
    referralBonus: referralBonusAmount,
    calculation: `User: ${userReward} (90%), Referrer: ${referralBonusAmount} (10%)`
});
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        const approveBtn = document.querySelector('.btn-success');
        if (approveBtn) {
            approveBtn.disabled = true;
            approveBtn.textContent = '–û–¥–æ–±—Ä—è–µ–º...';
        }

        // üî• –í–ê–ñ–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –¥–∞–∂–µ –µ—Å–ª–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
        const result = await makeRequest(`/api/admin/task-verifications/${currentVerificationId}/approve`, {
            method: 'POST',
            body: JSON.stringify({
                adminId: currentUser.id,
                forceApprove: true // üî• –ù–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–¥–æ–±—Ä–µ–Ω–∏—è
            })
        });

        console.log('üì® –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏:', result);

        if (result.success) {
            let message = `‚úÖ –ó–∞–¥–∞–Ω–∏–µ –æ–¥–æ–±—Ä–µ–Ω–æ! –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏–ª ${result.amountAdded || result.task_price}‚≠ê`;
            
            // üî• –í–ê–ñ–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å
            if (result.referralBonus) {
                message += `\n\nüë• –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å: ${result.referralBonus.referrerName} –ø–æ–ª—É—á–∏–ª ${result.referralBonus.bonusAmount}‚≠ê (10%)`;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –±–æ–Ω—É—Å–∞
                showReferralBonusAnimation(result.referralBonus.referrerName, result.referralBonus.bonusAmount);
            }
            
            if (result.taskRemoved || result.taskCompleted) {
                message += "\n\nüéØ –ó–∞–¥–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–µ–Ω–æ - –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π!";
            }
            
            showNotification(message, 'success');
            
            closeModal('verification-modal');
            
            setTimeout(() => {
                loadTaskVerifications();
                loadAdminTasks();
                updateUserData(); // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                console.log('‚úÖ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω –ø–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è');
            }, 500);
            
        } else {
            // üî• –£–õ–£–ß–®–ï–ù–ù–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö: –ü—Ä–æ–±—É–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–¥–æ–±—Ä–µ–Ω–∏–µ
            if (result.error && (result.error.includes('—Å–∫—Ä–∏–Ω—à–æ—Ç') || result.error.includes('–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ'))) {
                console.log('‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ —Å–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–º, –ø—Ä–æ–±—É–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–¥–æ–±—Ä–µ–Ω–∏–µ...');
                await forceApproveVerification();
            } else {
                throw new Error(result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
            }
        }

    } catch (error) {
        console.error('‚ùå –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏:', error);
        
        // üî• –ê–í–ê–†–ò–ô–ù–´–ô –†–ï–ñ–ò–ú: –ü—Ä–æ–±—É–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–¥–æ–±—Ä–µ–Ω–∏–µ –ø—Ä–∏ –ª—é–±—ã—Ö —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–∫–∞—Ö
        console.log('üö® –ê–≤–∞—Ä–∏–π–Ω—ã–π —Ä–µ–∂–∏–º: –ø—Ä–æ–±—É–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–¥–æ–±—Ä–µ–Ω–∏–µ...');
        await forceApproveVerification();
    }
}

// üîß –§–£–ù–ö–¶–ò–Ø –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û–ì–û –û–î–û–ë–†–ï–ù–ò–Ø –ü–†–ò –û–®–ò–ë–ö–ê–•
async function forceApproveVerification() {
    try {
        console.log('üîß –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–¥–æ–±—Ä–µ–Ω–∏–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏:', currentVerificationId);
        
        const result = await makeRequest(`/api/admin/task-verifications/${currentVerificationId}/force-approve`, {
            method: 'POST',
            body: JSON.stringify({
                adminId: currentUser.id,
                reason: '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–¥–æ–±—Ä–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞'
            })
        });

        if (result.success) {
            showNotification('‚úÖ –ó–∞–¥–∞–Ω–∏–µ –æ–¥–æ–±—Ä–µ–Ω–æ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º)!', 'success');
            
            closeModal('verification-modal');
            
            setTimeout(() => {
                loadTaskVerifications();
                loadAdminTasks();
                updateUserData();
            }, 500);
            
        } else {
            throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–¥–æ–±—Ä–µ–Ω–∏–µ: ' + result.error);
        }
        
    } catch (forceError) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–¥–æ–±—Ä–µ–Ω–∏—è:', forceError);
        showNotification('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ' + forceError.message, 'error');
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
        const approveBtn = document.querySelector('.btn-success');
        if (approveBtn) {
            approveBtn.disabled = false;
            approveBtn.textContent = '‚úÖ –û–¥–æ–±—Ä–∏—Ç—å';
        }
    }
}



function showReferralBonusAnimation(referrerName, bonusAmount) {
    const animation = document.createElement('div');
    animation.style.cssText = `
        position: fixed;
        top: 20%;
        left: 50%;
        transform: translateX(-50%);
        background: var(--success);
        color: white;
        padding: 20px 30px;
        border-radius: 15px;
        text-align: center;
        z-index: 10001;
        box-shadow: 0 10px 25px rgba(34, 197, 94, 0.3);
        border: 2px solid rgba(255, 255, 255, 0.3);
        animation: referralBonusSlide 3s ease-in-out;
        max-width: 300px;
        width: 90%;
    `;
    
    animation.innerHTML = `
        <div style="font-size: 32px; margin-bottom: 10px;">üë•</div>
        <div style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">
            –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å!
        </div>
        <div style="font-size: 14px; margin-bottom: 5px;">
            ${referrerName}
        </div>
        <div style="font-size: 20px; font-weight: 800; color: var(--gold);">
            +${bonusAmount} ‚≠ê
        </div>
        <div style="font-size: 12px; opacity: 0.9; margin-top: 5px;">
            (10% –æ—Ç –∑–∞—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–∞)
        </div>
    `;
    
    document.body.appendChild(animation);
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(() => {
        animation.remove();
    }, 4000);
}

// –î–æ–±–∞–≤—å—Ç–µ CSS –∞–Ω–∏–º–∞—Ü–∏—é
const referralBonusStyles = `
    <style>
        @keyframes referralBonusSlide {
            0% {
                transform: translateX(-50%) translateY(-20px);
                opacity: 0;
            }
            20% {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
            80% {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
            100% {
                transform: translateX(-50%) translateY(-20px);
                opacity: 0;
            }
        }
    </style>
`;

// –î–æ–±–∞–≤—å—Ç–µ —Å—Ç–∏–ª–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç
document.head.insertAdjacentHTML('beforeend', referralBonusStyles);

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º—ã
async function debugApprovalIssue() {
    console.log('üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã –æ–¥–æ–±—Ä–µ–Ω–∏—è:');
    
    if (!currentVerificationId) {
        console.log('‚ùå currentVerificationId –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
        return;
    }
    
    if (!currentUser) {
        console.log('‚ùå currentUser –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
        return;
    }
    
    console.log('üìä –î–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞:', {
        verificationId: currentVerificationId,
        adminId: currentUser.id,
        API_BASE_URL: API_BASE_URL
    });
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint'–∞
    try {
        const testResponse = await fetch(`${API_BASE_URL}/api/health`);
        console.log('‚úÖ –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω:', testResponse.status);
    } catch (error) {
        console.error('‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:', error);
    }
}

// –í—Ä–µ–º–µ–Ω–Ω–æ –¥–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
function addApprovalDebugButton() {
    const debugBtn = document.createElement('button');
    debugBtn.textContent = 'üêõ Debug Approval';
    debugBtn.style.position = 'fixed';
    debugBtn.style.top = '300px';
    debugBtn.style.right = '10px';
    debugBtn.style.zIndex = '10000';
    debugBtn.style.padding = '10px';
    debugBtn.style.background = 'orange';
    debugBtn.style.color = 'white';
    debugBtn.style.border = 'none';
    debugBtn.style.borderRadius = '5px';
    debugBtn.style.fontSize = '12px';
    debugBtn.onclick = debugApprovalIssue;
    document.body.appendChild(debugBtn);
}

setTimeout(addApprovalDebugButton, 3000);

addDebugButton();
// –í —Ñ—É–Ω–∫—Ü–∏–∏ rejectVerification –¥–æ–±–∞–≤—å—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞–Ω–∏–π
// üîß –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –û–¢–ö–õ–û–ù–ï–ù–ò–Ø –ó–ê–î–ê–ù–ò–Ø
async function rejectVerification() {
    if (!currentVerificationId) return;

    try {
        // üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π endpoint —Å /api/
        const result = await makeRequest(`/api/admin/task-verifications/${currentVerificationId}/reject`, {
            method: 'POST',
            body: JSON.stringify({
                adminId: currentUser.id
            })
        });

        if (result.success) {
            showNotification('–ó–∞–¥–∞–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ', 'success');
            closeModal('verification-modal');
            loadTaskVerifications();
            
            // üî• –î–û–ë–ê–í–õ–ï–ù–û: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞–Ω–∏–π
            setTimeout(() => {
                loadTasks(); // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è
                loadUserTasks(); // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            }, 500);
            
        } else {
            showNotification('–û—à–∏–±–∫–∞: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('Error rejecting verification:', error);
        showNotification('–û—à–∏–±–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è', 'error');
    }
}

        // üîß –ê–î–ú–ò–ù-–§–£–ù–ö–¶–ò–ò
        async function addNewPost() {
            const title = document.getElementById('admin-post-title').value;
            const content = document.getElementById('admin-post-content').value;
            
            if (!title || !content) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ø–æ—Å—Ç–∞!', 'error');
                return;
            }
            
            if (!currentUser.isAdmin || parseInt(currentUser.id) !== ADMIN_ID) {
                showNotification('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø–æ—Å—Ç—ã!', 'error');
                return;
            }
            
            try {
                const result = await makeRequest('/posts', {
                    method: 'POST',
                    body: JSON.stringify({
                        title: title,
                        content: content,
                        author: currentUser.firstName,
                        authorId: currentUser.id
                    })
                });

                if (result.success) {
                    showNotification('–ü–æ—Å—Ç —É—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω!', 'success');
                    document.getElementById('admin-post-title').value = '';
                    document.getElementById('admin-post-content').value = '';
                    loadMainPagePosts();
                } else {
                    showNotification('–û—à–∏–±–∫–∞: ' + result.error, 'error');
                }
                
            } catch (error) {
                console.error('Error adding post:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ' + error.message, 'error');
            }
        }

async function addTask() {
    console.log('üéØ Starting add task function...');
    
    try {
        // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —Ñ–æ—Ä–º—ã
        const taskData = {
            title: document.getElementById('admin-task-title').value.trim(),
            description: document.getElementById('admin-task-description').value.trim(),
            price: document.getElementById('admin-task-price').value,
            category: document.getElementById('admin-task-category').value,
            time_to_complete: document.getElementById('admin-task-time').value || '5-10 –º–∏–Ω—É—Ç',
            difficulty: document.getElementById('admin-task-difficulty').value,
            people_required: document.getElementById('admin-task-people').value || 1,
            task_url: document.getElementById('admin-task-url').value || '',
            created_by: currentUser.id
        };

        console.log('üìã Form data collected:', taskData);

        // –í–∞–ª–∏–¥–∞—Ü–∏—è
        if (!taskData.title.trim()) {
            showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è!', 'error');
            return;
        }
        if (!taskData.description.trim()) {
            showNotification('–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è!', 'error');
            return;
        }
        if (!taskData.price) {
            showNotification('–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É –∑–∞–¥–∞–Ω–∏—è!', 'error');
            return;
        }

        const price = parseFloat(taskData.price);
        if (isNaN(price) || price <= 0) {
            showNotification('–¶–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º!', 'error');
            return;
        }

        // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
        const requestData = {
            title: taskData.title.trim(),
            description: taskData.description.trim(),
            price: price,
            category: taskData.category || 'general',
            time_to_complete: taskData.time_to_complete || '5-10 –º–∏–Ω—É—Ç',
            difficulty: taskData.difficulty || '–õ–µ–≥–∫–∞—è',
            people_required: parseInt(taskData.people_required) || 1,
            task_url: taskData.task_url || '',
            created_by: currentUser.id
        };

        console.log('üì§ Sending request to server:', requestData);

        const result = await makeRequest('/api/tasks', {
            method: 'POST',
            body: JSON.stringify(requestData)
        });

        console.log('üì® Server response:', result);

        if (result.success) {
            showNotification('‚úÖ –ó–∞–¥–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ!', 'success');
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            clearTaskForm();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–∫–∏ –∑–∞–¥–∞–Ω–∏–π
            setTimeout(() => {
                loadAdminTasks();
                loadTasks();
            }, 1000);
            
        } else {
            throw new Error(result.error || 'Unknown server error');
        }

    } catch (error) {
        console.error('üí• Error in addTask:', error);
        showNotification(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è: ${error.message}`, 'error');
    }
}
// –î–æ–±–∞–≤—å—Ç–µ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
function debugTaskCreation() {
    
    console.log('- currentUser:', currentUser);
    console.log('- isAdmin:', currentUser?.is_admin);
    console.log('- API_BASE_URL:', API_BASE_URL);
    
    // –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ñ–æ—Ä–º—ã
    const formData = {
        title: document.getElementById('admin-task-title').value,
        description: document.getElementById('admin-task-description').value,
        price: document.getElementById('admin-task-price').value,
        created_by: currentUser?.id
    };
    console.log('- Form data:', formData);
}

// –í—ã–∑–æ–≤–∏—Ç–µ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏—è
debugTaskCreation();

// –í—Ä–µ–º–µ–Ω–Ω–æ –¥–æ–±–∞–≤—å—Ç–µ —ç—Ç—É –∫–Ω–æ–ø–∫—É –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - –£–î–ê–õ–ò–¢–¨ –ò–ó SERVER.JS
function addTestButton() {
    const testBtn = document.createElement('button');
    testBtn.textContent = 'üß™ Test Task Creation';
    testBtn.className = 'btn btn-warning';
    testBtn.style.margin = '10px';
    testBtn.onclick = testTaskCreation;
    
    const tasksSection = document.getElementById('admin-tasks-section');
    if (tasksSection) {
        tasksSection.appendChild(testBtn);
    }
}

async function testTaskCreation() {
    console.log('üß™ Testing task creation...');
    
    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    document.getElementById('admin-task-title').value = '–¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ';
    document.getElementById('admin-task-description').value = '–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è';
    document.getElementById('admin-task-price').value = '50';
    document.getElementById('admin-task-category').value = 'subscribe';
    document.getElementById('admin-task-time').value = '10 –º–∏–Ω—É—Ç';
    document.getElementById('admin-task-difficulty').value = '–õ–µ–≥–∫–∞—è';
    document.getElementById('admin-task-people').value = '5';
    document.getElementById('admin-task-url').value = 'https://example.com';
    
    console.log('‚úÖ Form filled with test data');
    debugTaskCreation();
    
    // –ü—Ä–æ–±—É–µ–º —Å–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ
    await addTask();
}



// –í—ã–∑–æ–≤–∏—Ç–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
setTimeout(debugAdminForm, 2000);
// üîß –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ó–ê–ì–†–£–ó–ö–ò –ó–ê–î–ê–ù–ò–ô –ü–†–ò –û–¢–ö–†–´–¢–ò–ò –°–ï–ö–¶–ò–ò
function loadAdminTasksSection() {
    console.log('üîÑ Loading admin tasks section...');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é
    const section = document.getElementById('admin-tasks-section');
    if (section) {
        section.style.display = 'block';
        console.log('‚úÖ Admin tasks section shown');
    }
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–¥–∞–Ω–∏—è
    loadAdminTasks();
}

async function restoreDeletedTasks() {
    if (!confirm('–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É–¥–∞–ª–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞?')) return;
    
    try {
        const result = await makeRequest('/api/admin/restore-tasks', {
            method: 'POST',
            body: JSON.stringify({
                adminId: currentUser.id
            })
        });
        
        if (result.success) {
            showNotification(`–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ ${result.restoredCount} –∑–∞–¥–∞–Ω–∏–π`, 'success');
            loadAdminTasks();
        } else {
            showNotification('–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('Restore tasks error:', error);
        showNotification('–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π', 'error');
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
async function createTestTask() {
    if (!currentUser) return;
    
    try {
        const testTask = {
            title: '–¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ ' + new Date().toLocaleTimeString(),
            description: '–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã',
            price: 50,
            category: 'general',
            created_by: currentUser.id
        };
        
        const result = await makeRequest('/api/tasks', {
            method: 'POST',
            body: JSON.stringify(testTask)
        });
        
        if (result.success) {
            showNotification('‚úÖ –¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ!', 'success');
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
            loadAdminTasks();
        } else {
            showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è: ' + result.error, 'error');
        }
    } catch (error) {
        showNotification('–û—à–∏–±–∫–∞: ' + error.message, 'error');
    }
}
// Fallback –∫–æ–Ω—Ç–µ–Ω—Ç
function createFallbackAdminTasks() {
    return `
        <div class="admin-stats" style="margin-bottom: 20px; padding: 15px; background: var(--card-bg); border-radius: 12px; border: 1px solid var(--border);">
            <h4 style="margin-bottom: 10px;">üìä –ê–≤–∞—Ä–∏–π–Ω—ã–π —Ä–µ–∂–∏–º</h4>
            <p style="color: var(--text-secondary); margin-bottom: 15px;">
                –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–¥–∞–Ω–∏—è. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
            </p>
            <ul style="color: var(--text-secondary); font-size: 14px; text-align: left; padding-left: 20px;">
                <li>–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ —Å–µ—Ä–≤–µ—Ä—É</li>
                <li>–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</li>
                <li>–ù–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π</li>
            </ul>
        </div>
        
        <div class="admin-form">
            <h3>‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ</h3>
            <input type="text" class="admin-input" id="emergency-task-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è">
            <textarea class="admin-textarea" id="emergency-task-description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è" rows="3"></textarea>
            <input type="number" class="admin-input" id="emergency-task-price" placeholder="–¶–µ–Ω–∞ –≤ –∑–≤–µ–∑–¥–∞—Ö">
            <button class="admin-submit" onclick="createEmergencyTask()">
                üöÄ –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ
            </button>
        </div>
    `;
}

async function createEmergencyTask() {
    const title = document.getElementById('emergency-task-title').value;
    const description = document.getElementById('emergency-task-description').value;
    const price = document.getElementById('emergency-task-price').value;
    
    if (!title || !description || !price) {
        showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!', 'error');
        return;
    }
    
    await createTestTask(); // –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é
}


// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ–¥–ª–µ–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
function isSlowDevice() {
  return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) 
         && /3G|2G|slow|reduce/i.test(navigator.connection.effectiveType);
}

if (isSlowDevice()) {
  // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ä–µ–∂–∏–º
  document.documentElement.classList.add('simplified-mode');
  
  // –û—Ç–∫–ª—é—á–∞–µ–º —Ç—è–∂–µ–ª—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
  window.addEventListener('load', function() {
    const heavyElements = document.querySelectorAll('.hero-banner, .complex-animation');
    heavyElements.forEach(el => el.remove());
  });
}

// üîß –§–£–ù–ö–¶–ò–Ø –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –ê–î–ú–ò–ù-–ó–ê–î–ê–ù–ò–ô


// –í index.html –¥–æ–±–∞–≤—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
async function debugAdminTasks() {
    console.log('üêõ DEBUG Admin Tasks System:');
    
    if (!currentUser) {
        console.log('‚ùå No current user');
        showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω', 'error');
        return;
    }
    
    try {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º endpoint –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
        const debugResult = await makeRequest(`/api/debug/admin-tasks?adminId=${currentUser.id}`);
        console.log('üìä Debug admin tasks result:', debugResult);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏
        if (debugResult.success) {
            let message = `üìä –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–¥–∞–Ω–∏–π:\n`;
            message += `‚Ä¢ –í—Å–µ–≥–æ –∑–∞–¥–∞–Ω–∏–π: ${debugResult.all_tasks_count}\n`;
            message += `‚Ä¢ –ú–æ–∏ –∑–∞–¥–∞–Ω–∏—è: ${debugResult.admin_tasks.length}\n`;
            
            debugResult.status_stats.forEach(stat => {
                message += `‚Ä¢ ${stat.status}: ${stat.count}\n`;
            });
            
            showNotification(message, 'info');
        }
        
    } catch (error) {
        console.error('Debug admin tasks error:', error);
        showNotification('–û—à–∏–±–∫–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏: ' + error.message, 'error');
    }
}
// –û–±–Ω–æ–≤–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é renderAdminTasks
function renderAdminTasks(tasks) {
    const container = document.getElementById('admin-tasks-container');
    if (!container) return;
    
    container.innerHTML = '';
    
    const filter = document.getElementById('admin-task-filter')?.value || 'all';
    
    const filteredTasks = tasks.filter(task => {
        switch (filter) {
            case 'active':
                return task.status === 'active';
            case 'completed':
                return task.status === 'completed';
            case 'my':
                return task.created_by === currentUser.id;
            default:
                return true; // 'all'
        }
    });
    
    console.log(`üéØ Rendering ${filteredTasks.length} filtered tasks (filter: ${filter})`);
    
    if (filteredTasks.length === 0) {
        container.innerHTML = `
            <div class="no-tasks" style="text-align: center; padding: 40px 20px;">
                <div style="font-size: 48px; margin-bottom: 16px;">üîç</div>
                <div>–ó–∞–¥–∞–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>
                <div style="font-size: 14px; color: var(--text-secondary); margin-top: 8px;">
                    –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä
                </div>
                <button class="btn btn-primary" onclick="loadAdminTasks()" style="margin-top: 16px;">
                    üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫
                </button>
            </div>
        `;
        return;
    }
    
    filteredTasks.forEach(task => {
        const taskElement = createAdminTaskElement(task);
        container.appendChild(taskElement);
    });
}

function createAdminTaskElement(task) {
    const taskElement = document.createElement('div');
    taskElement.className = 'admin-task-item';
    taskElement.style.cssText = `
        background: var(--card-bg);
        border: 1px solid ${task.status === 'completed' ? 'var(--success)' : 'var(--border)'};
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 12px;
        opacity: ${task.status === 'completed' ? 0.8 : 1};
    `;
    
    const completedCount = task.completed_count || 0;
    const peopleRequired = task.people_required || 1;
    const progressPercentage = Math.min(100, (completedCount / peopleRequired) * 100);
    const isCompleted = task.status === 'completed';
    
    taskElement.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
            <div style="flex: 1;">
                <div style="font-weight: 600; font-size: 16px; margin-bottom: 4px;">
                    ${task.title}
                    ${isCompleted ? ' <span style="color: var(--success); font-size: 12px;">(–ó–∞–≤–µ—Ä—à–µ–Ω–æ)</span>' : ''}
                </div>
                <div style="color: var(--text-secondary); font-size: 14px;">${task.description}</div>
            </div>
            <div style="display: flex; gap: 8px; align-items: center;">
                
                
            </div>
        </div>
        
        <div style="display: flex; gap: 12px; font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">
            <span>üìÅ ${task.category || 'general'}</span>
            <span>üë• ${peopleRequired} —á–µ–ª.</span>
            <span>‚ö° ${task.difficulty || '–õ–µ–≥–∫–∞—è'}</span>
            <span>üïí ${task.time_to_complete || '5-10 –º–∏–Ω—É—Ç'}</span>
            <span style="color: ${isCompleted ? 'var(--success)' : 'var(--accent)'};">
                ${isCompleted ? '‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ' : 'üü¢ –ê–∫—Ç–∏–≤–Ω–æ'}
            </span>
        </div>
        
        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è -->
        <div style="margin: 10px 0;">
            <div style="display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 4px;">
                <span>–í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${completedCount}/${peopleRequired}</span>
                <span>${Math.round(progressPercentage)}%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: ${progressPercentage}%; background: ${isCompleted ? 'var(--success)' : 'var(--accent)'};"></div>
            </div>
        </div>
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∑–∞–¥–∞–Ω–∏—è–º -->
        <div style="display: flex; gap: 15px; font-size: 11px; color: var(--text-secondary);">
            <span>‚úÖ ${completedCount} –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</span>
            <span>‚ùå ${task.rejected_count || 0} –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ</span>
            <span>‚è≥ ${task.pending_count || 0} –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</span>
            <span>üü° ${task.active_count || 0} –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ</span>
        </div>
        ${!isCompleted ? `
                    <button class="admin-task-delete" onclick="deleteTask(${task.id})" style="background: var(--error); color: white; border: none; padding: 6px 12px;  margin-top: 20px; border-radius: 6px; cursor: pointer;">
                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                    </button>
                ` : ''}
        <div style="font-size: 20px; color: var(--gold); font-weight: 600;">
                    ${task.price} ‚≠ê
                </div>
        ${task.image_url ? `
            <div style="margin-top: 10px;">
                <img src="${task.image_url}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è" style="max-width: 200px; border-radius: 8px; border: 1px solid var(--border);">
            </div>
        ` : ''}
        
        <div style="margin-top: 8px; font-size: 11px; color: var(--text-secondary);">
            –°–æ–∑–¥–∞–Ω–æ: ${new Date(task.created_at).toLocaleDateString('ru-RU')}
            ${task.last_completed ? ` ‚Ä¢ –ü–æ—Å–ª–µ–¥–Ω–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ: ${new Date(task.last_completed).toLocaleDateString('ru-RU')}` : ''}
        </div>
    `;
    
    return taskElement;
}

function filterAdminTasks() {
    const container = document.getElementById('admin-tasks-container');
    if (!container) return;
    
    const currentTasks = window.currentAdminTasks || [];
    if (currentTasks.length > 0) {
        renderAdminTasks(currentTasks);
    }
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
setInterval(() => {
    if (document.getElementById('admin-verification-section').style.display === 'block') {
        console.log('üîÑ Auto-refreshing verification list');
        loadTaskVerifications();
    }
}, 30000);

// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å–µ–∫—Ü–∏–∏
function showAdminVerificationSection() {
    showAdminSection('verification');
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π —á—Ç–æ–±—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É—Å–ø–µ–ª –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è
    setTimeout(() => {
        loadTaskVerifications();
    }, 100);
}

// üîß –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò
function initializeAdminPanel() {
    console.log('üéØ Initializing admin panel...');
    
    // –°–æ–∑–¥–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
    const adminTab = document.getElementById('admin-tab');
    if (!adminTab) {
        console.error('‚ùå Admin tab not found!');
        return;
    }
    
    // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —á—Ç–æ –≤—Å–µ —Å–µ–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã
    const sections = ['posts', 'tasks', 'verification', 'support', 'payments', 'admins'];
    sections.forEach(section => {
        const sectionId = `admin-${section}-section`;
        let sectionElement = document.getElementById(sectionId);
        
        if (!sectionElement) {
            console.log(`‚ö†Ô∏è Creating missing section: ${sectionId}`);
            sectionElement = document.createElement('div');
            sectionElement.id = sectionId;
            sectionElement.className = 'admin-section';
            sectionElement.style.display = 'none';
            sectionElement.innerHTML = `<div>Section ${section} will be loaded here</div>`;
            adminTab.appendChild(sectionElement);
        }
    });
    
    console.log('‚úÖ Admin panel initialized');
}

// –í—ã–∑–æ–≤–∏—Ç–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
setTimeout(initializeAdminPanel, 500);

        async function deletePost(postId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø–æ—Å—Ç?')) return;
            
            if (!currentUser.isAdmin || parseInt(currentUser.id) !== ADMIN_ID) {
                showNotification('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –ø–æ—Å—Ç—ã!', 'error');
                return;
            }
            
            try {
                const result = await makeRequest(`/posts/${postId}`, {
                    method: 'DELETE',
                    body: JSON.stringify({ authorId: currentUser.id })
                });

                if (result.success) {
                    showNotification('–ü–æ—Å—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!', 'success');
                    loadMainPagePosts();
                } else {
                    showNotification('–û—à–∏–±–∫–∞: ' + result.error, 'error');
                }
            } catch (error) {
                console.error('Error deleting post:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ' + error.message, 'error');
            }
        }

        async function deleteTask(taskId) {
    if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ?')) return;
    
    if (!currentUser || !currentUser.isAdmin || parseInt(currentUser.id) !== ADMIN_ID) {
        showNotification('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –∑–∞–¥–∞–Ω–∏—è!', 'error');
        return;
    }
    
    try {
        const result = await makeRequest(`/tasks/${taskId}`, {
            method: 'DELETE',
            body: JSON.stringify({ adminId: currentUser.id })
        });

        if (result.success) {
            showNotification('–ó–∞–¥–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ!', 'success');
            loadAdminTasks();
            loadTasks();
        } else {
            showNotification('–û—à–∏–±–∫–∞: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('Error deleting task:', error);
        showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è: ' + error.message, 'error');
    }
}
     async function openAdminChat() {
    if (!currentUser) {
        showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω', 'error');
        return;
    }
    
    try {
        console.log('üë§ User opening support chat, ID:', currentUser.id);
        
        // –ü–æ–ª—É—á–∞–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º —á–∞—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const chatResult = await makeRequest(`/support/user-chat/${currentUser.id}`);
        
        if (chatResult.success) {
            currentChatId = chatResult.chat.id;
            console.log('‚úÖ Chat ID:', currentChatId);
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            try {
                const messagesResult = await makeRequest(`/support/chats/${currentChatId}/messages`);
                if (messagesResult.success) {
                    displayChatMessages(messagesResult.messages);
                }
            } catch (messagesError) {
                console.log('No messages yet or error loading messages:', messagesError);
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Å—Ç–æ–π —á–∞—Ç —Å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ–º
                displayChatMessages([]);
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á–∞—Ç
            document.getElementById('admin-chat').classList.add('active');
            
        } else {
            throw new Error(chatResult.error || 'Failed to create chat');
        }
    } catch (error) {
        console.error('‚ùå Error opening user chat:', error);
        showNotification('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —á–∞—Ç–∞: ' + error.message, 'error');
    }
}
        
// üîß –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –û–ß–ò–°–¢–ö–ò –°–¢–ê–†–´–• –§–ê–ô–õ–û–í
async function cleanupOldFiles() {
    try {
        const uploadsDir = path.join(__dirname, 'uploads');
        
        if (!fs.existsSync(uploadsDir)) {
            return;
        }
        
        const files = fs.readdirSync(uploadsDir);
        const now = Date.now();
        const maxAge = 24 * 60 * 60 * 1000; // 24 —á–∞—Å–∞
        
        for (const file of files) {
            const filePath = path.join(uploadsDir, file);
            const stats = fs.statSync(filePath);
            
            // –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª—ã —Å—Ç–∞—Ä—à–µ 24 —á–∞—Å–æ–≤
            if (now - stats.mtime.getTime() > maxAge) {
                fs.unlinkSync(filePath);
                console.log(`üßπ Deleted old file: ${file}`);
            }
        }
    } catch (error) {
        console.error('Error cleaning up old files:', error);
    }
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –æ—á–∏—Å—Ç–∫—É –∫–∞–∂–¥—ã–µ 24 —á–∞—Å–∞
setInterval(cleanupOldFiles, 24 * 60 * 60 * 1000);

// –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞
cleanupOldFiles();
// –û–±–Ω–æ–≤–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
async function sendMessageToAdmin() {
    if (!currentUser || !currentChatId) {
        showNotification('–ß–∞—Ç –Ω–µ –æ—Ç–∫—Ä—ã—Ç', 'error');
        return;
    }
    
    const input = document.getElementById('chat-input-field');
    const message = input.value.trim();
    
    if (!message) {
        showNotification('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ', 'error');
        return;
    }
    
    try {
        console.log(`‚úâÔ∏è User sending message to chat ${currentChatId}:`, message);
        
        const userFullName = currentUser.lastName ? 
            `${currentUser.firstName} ${currentUser.lastName}` : 
            currentUser.firstName;
        
        const result = await makeRequest(`/support/chats/${currentChatId}/messages`, {
            method: 'POST',
            body: JSON.stringify({
                user_id: currentUser.id,
                user_name: userFullName,
                user_username: currentUser.username,
                message: message,
                is_admin: false
            })
        });
        
        if (result.success) {
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            const messagesContainer = document.getElementById('chat-messages');
            const messageElement = document.createElement('div');
            messageElement.className = 'message message-user';
            messageElement.innerHTML = `
                <div class="message-text">${escapeHtml(message)}</div>
                <div class="message-time">${new Date().toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'})}</div>
            `;
            messagesContainer.appendChild(messageElement);
            
            input.value = '';
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            showNotification('–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –æ—Ç–≤–µ—Ç–∏—Ç –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.', 'success');
        } else {
            throw new Error(result.error);
        }
    } catch (error) {
        console.error('‚ùå Error sending message:', error);
        showNotification('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ' + error.message, 'error');
    }
}

// –û–±–Ω–æ–≤–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –∞–¥–º–∏–Ω–æ–º
async function sendAdminMessage() {
    if (!currentAdminChat || !currentUser) {
        console.error('No active chat or user');
        showNotification('–ß–∞—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω', 'error');
        return;
    }
    
    const input = document.getElementById('admin-chat-input');
    if (!input) {
        console.error('Admin chat input not found');
        return;
    }
    
    const message = input.value.trim();
    
    if (!message) {
        showNotification('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ', 'error');
        return;
    }
    
    try {
        console.log(`‚úâÔ∏è Admin sending message to chat ${currentAdminChat.id}:`, message);
        
        const result = await makeRequest(`/support/chats/${currentAdminChat.id}/messages`, {
            method: 'POST',
            body: JSON.stringify({
                user_id: currentUser.id,
                user_name: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                user_username: currentUser.username,
                message: message,
                is_admin: true
            })
        });
        
        if (result.success) {
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            const messagesContainer = document.getElementById('admin-chat-messages');
            if (messagesContainer) {
                const messageElement = document.createElement('div');
                messageElement.className = 'message message-admin';
                messageElement.innerHTML = `
                    <div class="message-text">${escapeHtml(message)}</div>
                    <div class="message-time">${new Date().toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'})}</div>
                `;
                messagesContainer.appendChild(messageElement);
                
                input.value = '';
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤
                loadAdminChats();
                
                console.log('‚úÖ Admin message sent successfully');
                showNotification('–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ', 'success');
            }
        } else {
            throw new Error(result.error);
        }
    } catch (error) {
        console.error('‚ùå Error sending admin message:', error);
        showNotification('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è: ' + error.message, 'error');
    }
}

// üîß –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û–ì–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –†–ê–ó–ú–ï–¢–ö–ò –ù–ê –ú–û–ë–ò–õ–¨–ù–´–•
function fixMobileLayout() {
    console.log('üîß Applying mobile layout fixes...');
    
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã
    const tasksGrid = document.querySelector('.tasks-grid');
    if (tasksGrid) {
        tasksGrid.style.width = '100%';
        tasksGrid.style.margin = '0';
        tasksGrid.style.padding = '0';
        tasksGrid.style.overflow = 'hidden';
    }
    
    // –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–¥–∞–Ω–∏–π
    const taskCards = document.querySelectorAll('.task-card');
    taskCards.forEach(card => {
        card.style.width = '100%';
        card.style.maxWidth = '100%';
        card.style.boxSizing = 'border-box';
        card.style.margin = '0 0 12px 0';
        card.style.overflow = 'hidden';
    });
    
    // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—É—é –ø—Ä–æ–∫—Ä—É—Ç–∫—É
    document.body.style.overflowX = 'hidden';
    document.documentElement.style.overflowX = 'hidden';
    
    console.log('‚úÖ Mobile layout fixes applied');
}

// –í—ã–∑—ã–≤–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
document.addEventListener('DOMContentLoaded', fixMobileLayout);
window.addEventListener('resize', fixMobileLayout);
window.addEventListener('orientationchange', fixMobileLayout);

// –¢–∞–∫–∂–µ –≤—ã–∑—ã–≤–∞–µ–º –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫
function showTasksTab() {
    console.log('üéØ –ü–ï–†–ï–•–û–î –ù–ê –í–ö–õ–ê–î–ö–£ –ó–ê–î–ê–ù–ò–ô');
    
    // 1. –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
    hideAllTabs();
    
    // 2. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫—É –∑–∞–¥–∞–Ω–∏–π
    const tasksTab = document.getElementById('tasks-tab');
    if (tasksTab) {
        tasksTab.classList.add('active');
        console.log('‚úÖ –í–∫–ª–∞–¥–∫–∞ –∑–∞–¥–∞–Ω–∏–π –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
    }
    
    // 3. –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
    updateNavState('tasks');
    
    // 4. –ü—Ä–∏–º–µ–Ω—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
    setTimeout(fixMobileLayout, 100);
    
    // 5. –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∫–ª–∞–¥–∫—É "–ù–æ–≤—ã–µ"
    setTimeout(() => {
        showTaskCategory('new');
    }, 150);
}

        function displayChatMessages(messages) {
            const messagesContainer = document.getElementById('chat-messages');
            if (!messagesContainer) return;
            
            messagesContainer.innerHTML = '';
            
            // –ï—Å–ª–∏ –Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
            if (!messages || messages.length === 0) {
                const welcomeMessage = document.createElement('div');
                welcomeMessage.className = 'message message-admin';
                welcomeMessage.innerHTML = `
                    <div class="message-text">–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?</div>
                    <div class="message-time">${new Date().toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'})}</div>
                `;
                messagesContainer.appendChild(welcomeMessage);
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            messages.forEach(message => {
                const messageElement = document.createElement('div');
                messageElement.className = message.is_admin ? 'message message-admin' : 'message message-user';
                
                messageElement.innerHTML = `
                    <div class="message-text">${escapeHtml(message.message)}</div>
                    <div class="message-time">${formatPostDate(message.sent_at)}</div>
                `;
                messagesContainer.appendChild(messageElement);
            });
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function closeChat() {
            document.getElementById('admin-chat').classList.remove('active');
            currentChatId = null;
        }

        // üîß –§–£–ù–ö–¶–ò–ò –ù–ê–í–ò–ì–ê–¶–ò–ò
        function showMainTab() {
            hideAllTabs();
            document.getElementById('main-tab').classList.add('active');
            updateNavState('main');
        }

        function showTasksTab() {
            hideAllTabs();
            document.getElementById('tasks-tab').classList.add('active');
            updateNavState('tasks');
        }


// üîß –§–£–ù–ö–¶–ò–Ø –£–î–ê–õ–ï–ù–ò–Ø –ó–ê–î–ê–ù–ò–Ø
async function deleteTask(taskId) {
    if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ?')) return;
    
    if (!currentUser) {
        showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω', 'error');
        return;
    }
    
    try {
        const result = await makeRequest(`/tasks/${taskId}`, {
            method: 'DELETE',
            body: JSON.stringify({ adminId: currentUser.id })
        });

        if (result.success) {
            showNotification('–ó–∞–¥–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ!', 'success');
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞–Ω–∏–π
            loadAdminTasks();
        } else {
            showNotification('–û—à–∏–±–∫–∞: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('Error deleting task:', error);
        showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è: ' + error.message, 'error');
    }
}

// üîß –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò –° –ó–ê–î–ê–ù–ò–Ø–ú–ò
function debugAdminTasks() {
    console.log('üêõ DEBUG Admin Tasks Section:');
    
    const elements = {
        'admin-tasks-section': document.getElementById('admin-tasks-section'),
        'admin-tasks-list': document.getElementById('admin-tasks-list'),
        'admin-task-title': document.getElementById('admin-task-title'),
        'add-task-button': document.querySelector('#admin-tasks-section .admin-submit')
    };
    
    Object.keys(elements).forEach(key => {
        const element = elements[key];
        console.log(`- ${key}:`, element ? 'FOUND' : 'NOT FOUND');
        if (element) {
            console.log(`  - display: ${element.style.display}`);
            console.log(`  - visible: ${element.offsetParent !== null}`);
        }
    });
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    console.log('- currentUser:', currentUser);
    console.log('- isAdmin:', currentUser?.is_admin);
}

function addAdminDebugButton() {
    const debugBtn = document.createElement('button');
    debugBtn.textContent = 'üêõ Debug Admin Tasks';
    debugBtn.style.position = 'fixed';
    debugBtn.style.top = '80px';
    debugBtn.style.right = '10px';
    debugBtn.style.zIndex = '10000';
    debugBtn.style.padding = '10px';
    debugBtn.style.background = 'red';
    debugBtn.style.color = 'white';
    debugBtn.style.border = 'none';
    debugBtn.style.borderRadius = '5px';
    debugBtn.style.fontSize = '12px';
    
    debugBtn.onclick = async function() {
        console.log('üîç DEBUG ADMIN TASKS:');
        console.log('- Current User:', currentUser);
        console.log('- isAdmin:', currentUser?.is_admin);
        console.log('- isMainAdmin:', parseInt(currentUser?.id) === ADMIN_ID);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–¥–∞–Ω–∏—è
        try {
            const result = await makeRequest('/api/admin/all-tasks?adminId=' + currentUser.id);
            console.log('- Admin tasks result:', result);
            
            if (result.success) {
                showNotification(`–ù–∞–π–¥–µ–Ω–æ ${result.tasks.length} –∑–∞–¥–∞–Ω–∏–π`, 'success');
            } else {
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞–Ω–∏–π: ' + result.error, 'error');
            }
        } catch (error) {
            console.error('Debug error:', error);
            showNotification('–û—à–∏–±–∫–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏: ' + error.message, 'error');
        }
    };
    
    document.body.appendChild(debugBtn);
}

// –í—ã–∑–æ–≤–∏—Ç–µ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
setTimeout(addAdminDebugButton, 3000);
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –≤–∫–ª–∞–¥–∫–∏ –∞–¥–º–∏–Ω–∞ - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø


        function showWithdrawPage() {
            hideAllTabs();
            document.getElementById('withdraw-page').classList.add('active');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—ã–≤–æ–¥–∞
            updateWithdrawPage();
            loadWithdrawHistory();
        }

        function showHowItWorksPage() {
            hideAllTabs();
            document.getElementById('how-it-works-page').classList.add('active');
        }

        function showAboutPage() {
            hideAllTabs();
            document.getElementById('about-page').classList.add('active');
        }

        function goBackToProfile() {
            showProfileTab();
        }

        function hideAllTabs() {
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏ –∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    const allElements = document.querySelectorAll('.tab-content, .page');
    allElements.forEach(element => {
        element.classList.remove('active');
    });
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
    resetAdminPanel();
}
        function updateNavState(activeTab) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const navItems = document.querySelectorAll('.nav-item');
            switch(activeTab) {
                case 'main': 
                    if (navItems[0]) navItems[0].classList.add('active'); 
                    break;
                case 'tasks': 
                    if (navItems[1]) navItems[1].classList.add('active'); 
                    break;
                case 'profile': 
                    if (navItems[2]) navItems[2].classList.add('active'); 
                    break;
                case 'admin': 
                    if (navItems[3]) navItems[3].classList.add('active'); 
                    break;
            }
        }
// üîß –ü–û–õ–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ü–û–ö–ê–ó–ê –ê–î–ú–ò–ù-–°–ï–ö–¶–ò–ô –° –ü–†–û–ú–û–ö–û–î–ê–ú–ò
// –ó–ê–ú–ï–ù–ò–¢–ï —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é showAdminSection –Ω–∞ —ç—Ç—É:
function showAdminSection(section) {
    console.log('üîÑ Switching to admin section:', section);
    
    // –°–∫—Ä—ã–≤–∞–µ–º –í–°–ï –∞–¥–º–∏–Ω —Å–µ–∫—Ü–∏–∏
    const adminSections = document.querySelectorAll('.admin-section');
    adminSections.forEach(sec => {
        sec.style.display = 'none';
    });
    
    // –°–∫—Ä—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä "–°–æ–∑–¥–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è" –µ—Å–ª–∏ –æ–Ω –≤–∏–¥–µ–Ω
    const createdTasksContainer = document.getElementById('admin-tasks-list');
    if (createdTasksContainer && createdTasksContainer.parentElement) {
        createdTasksContainer.parentElement.style.display = 'none';
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å–µ–∫—Ü–∏—é
    const targetSection = document.getElementById('admin-' + section + '-section');
    if (targetSection) {
        targetSection.style.display = 'block';
        console.log(`‚úÖ Showing: admin-${section}-section`);

        // –î–õ–Ø –°–ï–ö–¶–ò–ò –ó–ê–î–ê–ù–ò–ô - –ü–û–ö–ê–ó–´–í–ê–ï–ú –ö–û–ù–¢–ï–ô–ù–ï–†
        if (section === 'tasks') {
            const tasksContainer = document.getElementById('admin-tasks-list-container');
            if (tasksContainer) {
                tasksContainer.style.display = 'block';
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–¥–∞–Ω–∏—è
            setTimeout(() => {
                loadAdminTasks();
            }, 100);
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö —Å–µ–∫—Ü–∏–π
        switch(section) {
            case 'posts':
                loadAdminPosts();
                break;
            case 'payments':
                loadWithdrawalRequests();
                break;
            case 'verification':
                loadTaskVerifications();
                break;
            case 'support':
                loadAdminChats();
                break;
            case 'admins':
                loadAdminsList();
                break;
            case 'promocodes':
                loadPromocodesList();
                break;
        }
    } else {
        console.error(`‚ùå Target section not found: admin-${section}-section`);
    }
}
// üîß –§–£–ù–ö–¶–ò–Ø –ó–ê–ì–†–£–ó–ö–ò –°–ü–ò–°–ö–ê –ü–†–û–ú–û–ö–û–î–û–í
async function loadPromocodesList() {
    console.log('üîÑ Loading promocodes list...');
    
    if (!currentUser || parseInt(currentUser.id) !== ADMIN_ID) {
        console.log('‚ùå User is not main admin, cannot load promocodes');
        showNotification('–¢–æ–ª—å–∫–æ –≥–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥–∞–º–∏!', 'error');
        return;
    }
    
    try {
        const result = await makeRequest(`/api/admin/promocodes/list?adminId=${currentUser.id}`);
        
        if (result.success) {
            displayPromocodesList(result.promocodes);
            console.log(`‚úÖ Loaded ${result.promocodes?.length || 0} promocodes`);
        } else {
            console.error('‚ùå Error loading promocodes:', result.error);
            showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('‚ùå Load promocodes error:', error);
        showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤: ' + error.message, 'error');
    }
}

// üîß –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–†–û–í–ï–†–ö–ò –°–ï–¢–ï–í–û–ì–û –°–û–ï–î–ò–ù–ï–ù–ò–Ø
async function checkNetworkConnection() {
    try {
        const response = await fetch('/api/health', { 
            method: 'HEAD',
            timeout: 5000 
        });
        return response.ok;
    } catch (error) {
        console.error('‚ùå Network connection failed:', error);
        return false;
    }
}

// üîß –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–û–í–¢–û–†–ù–û–ô –ü–û–ü–´–¢–ö–ò –û–î–û–ë–†–ï–ù–ò–Ø
async function retryApproval(maxRetries = 3) {
    let lastError;
    
    for (let attempt = 1; attempt <= maxRetries; attempt++) {
        try {
            console.log(`üîÑ –ü–æ–ø—ã—Ç–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∏—è ${attempt}/${maxRetries}`);
            
            const result = await makeRequest(`/api/admin/task-verifications/${currentVerificationId}/approve`, {
                method: 'POST',
                body: JSON.stringify({
                    adminId: currentUser.id,
                    retryAttempt: attempt
                })
            });
            
            if (result.success) {
                return result;
            }
            
            lastError = new Error(result.error);
            
        } catch (error) {
            lastError = error;
            console.error(`‚ùå –ü–æ–ø—ã—Ç–∫–∞ ${attempt} –Ω–µ —É–¥–∞–ª–∞—Å—å:`, error);
            
            // –ñ–¥–µ–º –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–ø—ã—Ç–∫–æ–π
            if (attempt < maxRetries) {
                await new Promise(resolve => setTimeout(resolve, 1000 * attempt));
            }
        }
    }
    
    throw lastError;
}

// üîß –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø –°–¢–ê–¢–£–°–ê –ö–ù–û–ü–û–ö –ü–†–ò –û–®–ò–ë–ö–ê–•
function updateApprovalButtonOnError() {
    const approveBtn = document.querySelector('.btn-success');
    const emergencyBtn = document.getElementById('emergency-approve-btn');
    
    if (approveBtn) {
        approveBtn.disabled = false;
        approveBtn.textContent = 'üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É';
        approveBtn.onclick = retryApproval;
    }
    
    if (emergencyBtn) {
        emergencyBtn.style.display = 'block';
    }
}

// üîß –§–£–ù–ö–¶–ò–Ø –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –°–ü–ò–°–ö–ê –ü–†–û–ú–û–ö–û–î–û–í
function displayPromocodesList(promocodes) {
    const container = document.getElementById('promocodes-list');
    if (!container) {
        console.error('‚ùå Promocodes list container not found');
        return;
    }
    
    container.innerHTML = '';
    

    
    console.log(`üé® Displaying ${promocodes.length} promocodes`);
    
    promocodes.forEach(promo => {
        const promoElement = createPromocodeElement(promo);
        container.appendChild(promoElement);
    });
}

// üîß –§–£–ù–ö–¶–ò–Ø –°–û–ó–î–ê–ù–ò–Ø –≠–õ–ï–ú–ï–ù–¢–ê –ü–†–û–ú–û–ö–û–î–ê
function createPromocodeElement(promo) {
    const promoElement = document.createElement('div');
    promoElement.className = 'admin-task-item';
    
    const usedCount = promo.used_count || 0;
    const isExpired = promo.expires_at && new Date(promo.expires_at) < new Date();
    const isFullyUsed = usedCount >= promo.max_uses;
    const status = isExpired ? 'expired' : (isFullyUsed ? 'used' : 'active');
    
    const statusColors = {
        active: 'var(--success)',
        used: 'var(--warning)',
        expired: 'var(--error)'
    };
    
    const statusTexts = {
        active: 'üü¢ –ê–∫—Ç–∏–≤–µ–Ω',
        used: 'üü° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω',
        expired: 'üî¥ –ü—Ä–æ—Å—Ä–æ—á–µ–Ω'
    };
    
    const usagePercentage = Math.round((usedCount / promo.max_uses) * 100);
    
    promoElement.innerHTML = `
        <div class="admin-task-header">
            <div class="admin-task-title">
                <span style="font-size: 20px; font-weight: 800; color: var(--gold); letter-spacing: 1px;">${promo.code}</span>
                <span style="color: ${statusColors[status]}; font-size: 12px; margin-left: 10px; font-weight: 600;">
                    ${statusTexts[status]}
                </span>
            </div>
            <div class="admin-task-actions">
                <button class="admin-task-delete" onclick="deactivatePromoCode('${promo.code}')" 
                        style="background: var(--error); color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">
                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                </button>
            </div>
        </div>
        
        <div class="admin-task-description">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                <div>
                    <div style="font-size: 12px; color: var(--text-secondary);">üéÅ –ù–∞–≥—Ä–∞–¥–∞</div>
                    <div style="font-size: 18px; font-weight: 700; color: var(--gold);">${promo.reward} ‚≠ê</div>
                </div>
                <div>
                    <div style="font-size: 12px; color: var(--text-secondary);">üë• –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ</div>
                    <div style="font-size: 16px; font-weight: 600;">${usedCount}/${promo.max_uses}</div>
                </div>
            </div>
            
            <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è -->
            <div style="margin: 10px 0;">
                <div style="display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 4px;">
                    <span>–ü—Ä–æ–≥—Ä–µ—Å—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</span>
                    <span>${usagePercentage}%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${usagePercentage}%; 
                         background: ${status === 'active' ? 'var(--success)' : status === 'used' ? 'var(--warning)' : 'var(--error)'};">
                    </div>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 12px; color: var(--text-secondary);">
                <div>
                    <div>üìÖ –°–æ–∑–¥–∞–Ω</div>
                    <div style="font-weight: 600;">${new Date(promo.created_at).toLocaleDateString('ru-RU')}</div>
                </div>
                <div>
                    <div>‚è∞ ${promo.expires_at ? '–ò—Å—Ç–µ–∫–∞–µ—Ç' : '–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è'}</div>
                    <div style="font-weight: 600;">
                        ${promo.expires_at ? 
                          new Date(promo.expires_at).toLocaleDateString('ru-RU') : 
                          '–ë–µ—Å—Å—Ä–æ—á–Ω—ã–π'}
                    </div>
                </div>
            </div>
            
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–π -->
            ${usedCount > 0 ? `
                <div style="margin-top: 10px; padding: 8px; background: var(--bg-secondary); border-radius: 6px;">
                    <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">
                        üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–π:
                    </div>
                    <div style="font-size: 12px;">
                        –í—Å–µ–≥–æ –≤—ã–¥–∞–Ω–æ: <strong>${usedCount * promo.reward} ‚≠ê</strong>
                    </div>
                </div>
            ` : ''}
        </div>
    `;
    
    return promoElement;
}

// üîß –§–£–ù–ö–¶–ò–Ø –î–ï–ê–ö–¢–ò–í–ê–¶–ò–ò –ü–†–û–ú–û–ö–û–î–ê
async function deactivatePromoCode(code) {
    if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥ "${code}"?\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`)) {
        return;
    }
    
    if (!currentUser || parseInt(currentUser.id) !== ADMIN_ID) {
        showNotification('–¢–æ–ª—å–∫–æ –≥–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥—ã!', 'error');
        return;
    }
    
    try {
        const result = await makeRequest('/api/admin/promocodes/deactivate', {
            method: 'POST',
            body: JSON.stringify({
                adminId: currentUser.id,
                code: code
            })
        });
        
        if (result.success) {
            showNotification(`‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥ "${code}" —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!`, 'success');
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
            loadPromocodesList();
        } else {
            showNotification('‚ùå –û—à–∏–±–∫–∞: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('‚ùå Deactivate promocode error:', error);
        showNotification('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞: ' + error.message, 'error');
    }
}




// üîß –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –°–¢–†–£–ö–¢–£–†–´ –¢–ê–ë–õ–ò–¶–´ –ü–†–û–ú–û–ö–û–î–û–í
async function fixPromocodesTable() {
    try {
        console.log('üîß Fixing promocodes table structure...');
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
        const tableExists = await pool.query(`
            SELECT EXISTS (
                SELECT FROM information_schema.tables 
                WHERE table_name = 'promocodes'
            )
        `);
        
        if (!tableExists.rows[0].exists) {
            console.log('‚ùå Promocodes table does not exist, creating...');
            await createPromocodesTable();
            return;
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏
        const alterQueries = [
            `ALTER TABLE promocodes ADD COLUMN IF NOT EXISTS reward REAL NOT NULL DEFAULT 0`,
            `ALTER TABLE promocodes ADD COLUMN IF NOT EXISTS max_uses INTEGER NOT NULL DEFAULT 1`,
            `ALTER TABLE promocodes ADD COLUMN IF NOT EXISTS used_count INTEGER DEFAULT 0`,
            `ALTER TABLE promocodes ADD COLUMN IF NOT EXISTS expires_at TIMESTAMP`,
            `ALTER TABLE promocodes ADD COLUMN IF NOT EXISTS is_active BOOLEAN DEFAULT true`,
            `ALTER TABLE promocodes ADD COLUMN IF NOT EXISTS created_by BIGINT NOT NULL DEFAULT ${ADMIN_ID}`,
            `ALTER TABLE promocodes ADD COLUMN IF NOT EXISTS created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP`
        ];
        
        for (const query of alterQueries) {
            try {
                await pool.query(query);
                console.log(`‚úÖ Executed: ${query.split('ADD COLUMN IF NOT EXISTS')[1]?.split(' ')[1]}`);
            } catch (error) {
                console.log(`‚ö†Ô∏è Could not execute: ${query}`, error.message);
            }
        }
        
        console.log('‚úÖ Promocodes table structure fixed');
    } catch (error) {
        console.error('‚ùå Error fixing promocodes table:', error);
    }
}
// üîß –ê–ù–ò–ú–ê–¶–ò–Ø –£–°–ü–ï–®–ù–û–ô –ê–ö–¢–ò–í–ê–¶–ò–ò –ü–†–û–ú–û–ö–û–î–ê
function showPromocodeSuccessAnimation(reward) {
    const animation = document.createElement('div');
    animation.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: var(--gold-gradient);
        color: #000;
        padding: 30px;
        border-radius: 20px;
        text-align: center;
        z-index: 10000;
        box-shadow: 0 10px 30px rgba(255, 215, 0, 0.5);
        border: 3px solid rgba(255, 255, 255, 0.3);
        animation: promocodeSuccess 1s ease-out;
    `;
    
    animation.innerHTML = `
        <div style="font-size: 48px; margin-bottom: 15px;">üéâ</div>
        <div style="font-size: 24px; font-weight: 800; margin-bottom: 10px;">
            –ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!
        </div>
        <div style="font-size: 32px; font-weight: 700; color: #000; margin: 15px 0;">
            +${reward} ‚≠ê
        </div>
        <div style="font-size: 16px; opacity: 0.8;">
            –ù–∞–≥—Ä–∞–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–∞ –≤–∞—à –±–∞–ª–∞–Ω—Å
        </div>
    `;
    
    document.body.appendChild(animation);
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(() => {
        animation.remove();
    }, 3000);
}

// üîß –î–û–ë–ê–í–õ–ï–ù–ò–ï CSS –ê–ù–ò–ú–ê–¶–ò–ò
const promocodeStyles = `
    <style>
        @keyframes promocodeSuccess {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.1);
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }
        
        .promocode-stats {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid var(--border);
        }
        
        .promocode-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-light);
        }
        
        .promocode-stat:last-child {
            border-bottom: none;
        }
    </style>
`;

// –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç
document.head.insertAdjacentHTML('beforeend', promocodeStyles);

// üîß –≠–ö–°–ü–û–†–¢ –§–£–ù–ö–¶–ò–ô
window.showAdminSection = showAdminSection;
window.loadPromocodesList = loadPromocodesList;
window.createPromoCode = createPromoCode;
window.activatePromoCode = activatePromoCode;
window.deactivatePromoCode = deactivatePromoCode;
// –î–û–ë–ê–í–¨–¢–ï —ç—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ—Å—Ç–æ–≤:
async function loadAdminPosts() {
    try {
        console.log('üìù Loading admin posts...');
        const result = await makeRequest('/api/posts');
        if (result.success) {
            displayAdminPosts(result.posts);
        } else {
            console.error('Error loading posts:', result.error);
        }
    } catch (error) {
        console.error('Error loading admin posts:', error);
    }
}

function displayAdminPosts(posts) {
    const container = document.getElementById('admin-posts-list');
    if (!container) {
        console.error('‚ùå Admin posts container not found');
        return;
    }
    
    container.innerHTML = '';
    
    if (!posts || posts.length === 0) {
        container.innerHTML = `
            <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                <div style="font-size: 48px; margin-bottom: 16px;">üìù</div>
                <div>–ù–µ—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤</div>
                <div style="font-size: 14px; margin-top: 8px;">
                    –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –ø–æ—Å—Ç –∏—Å–ø–æ–ª—å–∑—É—è —Ñ–æ—Ä–º—É –≤—ã—à–µ
                </div>
            </div>
        `;
        return;
    }
    
    posts.forEach(post => {
        const postElement = document.createElement('div');
        postElement.className = 'admin-task-item';
        postElement.innerHTML = `
            <div class="admin-task-header">
                <div class="admin-task-title">${escapeHtml(post.title)}</div>
                <div class="admin-task-actions">
                    <button class="admin-task-delete" onclick="deletePost(${post.id})">
                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                    </button>
                </div>
            </div>
            <div class="admin-task-description">${escapeHtml(post.content)}</div>
            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 8px;">
                –ê–≤—Ç–æ—Ä: ${post.author} ‚Ä¢ ${new Date(post.created_at).toLocaleDateString('ru-RU')}
            </div>
        `;
        container.appendChild(postElement);
    });
}

// –î–û–ë–ê–í–¨–¢–ï —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:
function emergencyRestoreAdminPanel() {
    console.log('üö® EMERGENCY RESTORE ADMIN PANEL');
    
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é –∑–∞–¥–∞–Ω–∏–π
    const tasksSection = document.getElementById('admin-tasks-section');
    if (tasksSection) {
        tasksSection.style.display = 'block';
        tasksSection.style.opacity = '1';
        tasksSection.style.visibility = 'visible';
    }
    
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–¥–∞–Ω–∏–π
    const tasksContainer = document.getElementById('admin-tasks-list-container');
    if (tasksContainer) {
        tasksContainer.style.display = 'block';
    }
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–¥–∞–Ω–∏—è
    setTimeout(() => {
        loadAdminTasks();
        loadAdminPosts();
    }, 500);
    
    console.log('‚úÖ Emergency restore complete');
}

// –î–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
function addEmergencyButton() {
    const emergencyBtn = document.createElement('button');
    emergencyBtn.textContent = 'üö® –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å';
    emergencyBtn.style.position = 'fixed';
    emergencyBtn.style.top = '150px';
    emergencyBtn.style.right = '10px';
    emergencyBtn.style.zIndex = '10000';
    emergencyBtn.style.padding = '10px';
    emergencyBtn.style.background = 'red';
    emergencyBtn.style.color = 'white';
    emergencyBtn.style.border = 'none';
    emergencyBtn.style.borderRadius = '5px';
    emergencyBtn.style.fontSize = '12px';
    emergencyBtn.onclick = emergencyRestoreAdminPanel;
    document.body.appendChild(emergencyBtn);
}

// –í—ã–∑–æ–≤–∏—Ç–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
setTimeout(addEmergencyButton, 2000);

        // üé® –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function formatPostDate(timestamp) {
            if (!timestamp) return '';
            
            const date = new Date(timestamp);
            
            // –ú–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è (UTC+3)
            const moscowTime = new Date(date.getTime() + (3 * 60 * 60 * 1000));
            
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const postDate = new Date(moscowTime.getFullYear(), moscowTime.getMonth(), moscowTime.getDate());
            
            const diffTime = now - date;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) {
                // –°–µ–≥–æ–¥–Ω—è
                return `–°–µ–≥–æ–¥–Ω—è, ${moscowTime.toLocaleTimeString('ru-RU', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    timeZone: 'Europe/Moscow'
                })} (–ú–°–ö)`;
            } else if (diffDays === 1) {
                // –í—á–µ—Ä–∞
                return `–í—á–µ—Ä–∞, ${moscowTime.toLocaleTimeString('ru-RU', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    timeZone: 'Europe/Moscow'
                })} (–ú–°–ö)`;
            } else {
                // –†–∞–Ω—å—à–µ
                return `${moscowTime.toLocaleDateString('ru-RU', {
                    day: 'numeric',
                    month: 'long',
                    timeZone: 'Europe/Moscow'
                })}, ${moscowTime.toLocaleTimeString('ru-RU', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    timeZone: 'Europe/Moscow'
                })} (–ú–°–ö)`;
            }
        }

// –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞ –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤ - –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
async function requestWithdraw() {
    if (!currentUser) {
        showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω', 'error');
        return;
    }
    
    const currentBalance = currentUser.balance || 0;
    const MIN_WITHDRAWAL = 250; // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞
    
    if (currentBalance < MIN_WITHDRAWAL) {
    showNotification(`–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞: ${MIN_WITHDRAWAL} ‚≠ê\n\n–í–∞—à –±–∞–ª–∞–Ω—Å: ${currentBalance} ‚≠ê`, 'error');
    return;
}
    
    if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–≤–µ—Å—Ç–∏ ${currentBalance} ‚≠ê?\n\n–ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å –±—É–¥–µ—Ç –æ–±–Ω—É–ª–µ–Ω –∏ –∑–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º.`)) {
        return;
    }
    
    try {
        console.log('üîÑ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –≤—ã–≤–æ–¥...');
        
        const result = await makeRequest('/withdrawal/request', {
            method: 'POST',
            body: JSON.stringify({
                user_id: currentUser.id,
                amount: currentBalance,
                username: currentUser.username,
                first_name: currentUser.firstName
            })
        });
        
        console.log('üì® –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', result);
        
        if (result.success) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            currentUser.balance = 0;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            displayUserProfile();
            updateWithdrawPage();
            
            showNotification(`‚úÖ –ó–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥ ${currentBalance} ‚≠ê –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –û–∂–∏–¥–∞–π—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.`, 'success');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é –æ–ø–µ—Ä–∞—Ü–∏–π
            setTimeout(() => {
                loadWithdrawHistory();
            }, 1000);
            
        } else {
            showNotification('‚ùå –û—à–∏–±–∫–∞: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('‚ùå Withdrawal error:', error);
        showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–≤–æ–¥–µ —Å—Ä–µ–¥—Å—Ç–≤: ' + error.message, 'error');
    }
}
// –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –≤—ã–≤–æ–¥–æ–≤
async function loadWithdrawHistory() {
    if (!currentUser) return;
    
    try {
        const result = await makeRequest(`/withdraw/history/${currentUser.id}`);
        if (result.success) {
            displayWithdrawHistory(result.operations);
        }
    } catch (error) {
        console.error('Error loading withdrawal history:', error);
    }
}


// –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –≤—ã–≤–æ–¥–æ–≤
function displayWithdrawHistory(operations) {
    const container = document.getElementById('withdraw-history-list');
    if (!container) return;
    
    container.innerHTML = '';
    
    if (!operations || operations.length === 0) {
        container.innerHTML = `
            <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                <div style="font-size: 48px; margin-bottom: 16px;">üí´</div>
                <div>–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ –≤—ã–≤–æ–¥—É</div>
                <div style="font-size: 12px; margin-top: 8px;">
                    –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞: 200 ‚≠ê
                </div>
            </div>
        `;
        return;
    }
    
    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
    operations.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
    
    operations.forEach(operation => {
        const operationElement = document.createElement('div');
        operationElement.className = 'withdraw-operation';
        operationElement.style.cssText = `
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        `;
        
        const statusText = operation.status === 'completed' ? 
            '‚úÖ –í—ã–ø–ª–∞—á–µ–Ω–æ' : 
            'üîÑ –í –æ–±—Ä–∞–±–æ—Ç–∫–µ';
            
        const statusColor = operation.status === 'completed' ? 
            'var(--success)' : 'var(--warning)';
        
        const date = new Date(operation.created_at).toLocaleDateString('ru-RU', {
            day: 'numeric',
            month: 'short',
            year: 'numeric'
        });
        
        operationElement.innerHTML = `
            <div style="flex: 1;">
                <div style="font-weight: 600; font-size: 16px; margin-bottom: 4px;">
                    ${operation.amount} ‚≠ê
                </div>
                <div style="font-size: 12px; color: var(--text-secondary);">
                    ${date}
                </div>
            </div>
            <div style="color: ${statusColor}; font-weight: 600; font-size: 13px; text-align: right;">
                ${statusText}
                ${operation.completed_at ? `
                    <div style="font-size: 11px; font-weight: normal; margin-top: 2px;">
                        –ó–∞–≤–µ—Ä—à–µ–Ω–æ: ${new Date(operation.completed_at).toLocaleDateString('ru-RU')}
                    </div>
                ` : ''}
            </div>
        `;
        
        container.appendChild(operationElement);
    });
}
// üîß –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫ –Ω–∞ –≤—ã–≤–æ–¥
async function loadWithdrawalRequests() {
    console.log('üîÑ Loading withdrawal requests...');
    
    if (!currentUser) {
        console.log('‚ùå No current user');
        showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω', 'error');
        return;
    }
    
    try {
        // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞
        const rightsResult = await makeRequest(`/admin/debug-rights?userId=${currentUser.id}`);
        console.log('üîç Admin rights check:', rightsResult);
        
        if (!rightsResult.isAdmin) {
            showNotification('‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!', 'error');
            return;
        }
        
        const result = await makeRequest(`/admin/withdrawal-requests?adminId=${currentUser.id}`);
        console.log('üì® Withdrawal requests response:', result);
        
        if (result.success) {
            displayWithdrawalRequests(result.requests);
        } else {
            console.error('‚ùå Failed to load requests:', result.error);
            showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('‚ùå Load withdrawal requests error:', error);
        showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫: ' + error.message, 'error');
    }
}

// üîß –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞—è–≤–æ–∫
function displayWithdrawalRequests(requests) {
    const container = document.getElementById('withdrawal-requests-list');
    if (!container) {
        console.error('‚ùå Container not found');
        return;
    }
    
    container.innerHTML = '';
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    const activeCount = document.getElementById('active-withdrawals-count');
    const totalCount = document.getElementById('total-withdrawals-count');
    
    if (activeCount) activeCount.textContent = requests.length;
    if (totalCount) totalCount.textContent = requests.length;
    
    if (!requests || requests.length === 0) {
        container.innerHTML = `
            <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                <div style="font-size: 48px; margin-bottom: 16px;">üí´</div>
                <div>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –≤—ã–≤–æ–¥</div>
                <div style="font-size: 12px; margin-top: 8px;">–ù–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</div>
            </div>
        `;
        return;
    }
    
    console.log(`‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞–µ–º ${requests.length} –∑–∞—è–≤–æ–∫`);
    
    requests.forEach(request => {
        const requestElement = document.createElement('div');
        requestElement.className = 'admin-task-item';
        requestElement.style.marginBottom = '15px';
        
        const userName = request.first_name || request.username || `User_${request.user_id}`;
        const requestDate = new Date(request.created_at).toLocaleString('ru-RU');
        
        requestElement.innerHTML = `
            <div class="admin-task-header">
                <div class="admin-task-title">
                    ${userName}
                    ${request.username ? ` (@${request.username})` : ''}
                </div>
                <div class="admin-task-price" style="font-size: 20px; color: var(--gold);">
                    ${request.amount} ‚≠ê
                </div>
            </div>
            <div class="admin-task-description">
                <div>ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${request.user_id}</div>
                <div>–ó–∞–ø—Ä–æ—Å —Å–æ–∑–¥–∞–Ω: ${requestDate}</div>
            </div>
<div class="admin-task-actions" style="margin-top: 10px; display: flex; gap: 10px;">
    <button class="admin-task-approve" onclick="completeWithdrawal(${request.id})" 
            style="background: var(--success); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; flex: 1;">
        ‚úÖ –ü–µ—Ä–µ—á–∏—Å–ª–∏–ª —Å—Ä–µ–¥—Å—Ç–≤–∞
    </button>
    <button class="admin-task-cancel" onclick="cancelWithdrawal(${request.id})" 
            style="background: var(--error); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; flex: 1;">
        ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –≤—ã–ø–ª–∞—Ç—É
    </button>
</div>
        `;
        
        container.appendChild(requestElement);
    });
}

// üîß –§–£–ù–ö–¶–ò–Ø –û–¢–ú–ï–ù–´ –í–´–ü–õ–ê–¢–´
async function cancelWithdrawal(requestId) {
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å —ç—Ç—É –≤—ã–ø–ª–∞—Ç—É?\n\n–°—Ä–µ–¥—Å—Ç–≤–∞ –±—É–¥—É—Ç –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã –Ω–∞ –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.')) {
        return;
    }
    
    try {
        console.log('üîÑ Cancelling withdrawal:', requestId);
        
        const result = await makeRequest(`/api/admin/withdrawal-requests/${requestId}/cancel`, {
            method: 'POST',
            body: JSON.stringify({
                adminId: currentUser.id
            })
        });
        
        console.log('üì® Cancel response:', result);
        
        if (result.success) {
            showNotification(`‚úÖ ${result.message}`, 'success');
            loadWithdrawalRequests(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫
        } else {
            showNotification('‚ùå –û—à–∏–±–∫–∞: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('‚ùå Cancel withdrawal error:', error);
        showNotification('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–º–µ–Ω—ã –≤—ã–ø–ª–∞—Ç—ã: ' + error.message, 'error');
    }
}

// üîß –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–†–û–°–ú–û–¢–†–ê –ò–°–¢–û–†–ò–ò –û–¢–ú–ï–ù–ï–ù–ù–´–• –í–´–ü–õ–ê–¢
async function showCancelledWithdrawals() {
    try {
        const result = await makeRequest(`/api/admin/cancelled-withdrawals?adminId=${currentUser.id}`);
        
        if (result.success) {
            displayCancelledWithdrawals(result.cancelledWithdrawals);
        } else {
            showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –æ—Ç–º–µ–Ω: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('Error loading cancelled withdrawals:', error);
        showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –æ—Ç–º–µ–Ω–µ–Ω–Ω—ã—Ö –≤—ã–ø–ª–∞—Ç', 'error');
    }
}

// üîß –§–£–ù–ö–¶–ò–Ø –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –û–¢–ú–ï–ù–ï–ù–ù–´–• –í–´–ü–õ–ê–¢
function displayCancelledWithdrawals(withdrawals) {
    // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏
    const modalHTML = `
        <div class="modal active" id="cancelled-withdrawals-modal">
            <div class="modal-content" style="max-width: 800px; max-height: 80vh;">
                <div class="modal-header">
                    <div class="modal-title">‚ùå –ò—Å—Ç–æ—Ä–∏—è –æ—Ç–º–µ–Ω–µ–Ω–Ω—ã—Ö –≤—ã–ø–ª–∞—Ç</div>
                    <button class="modal-close" onclick="closeModal('cancelled-withdrawals-modal')">√ó</button>
                </div>
                <div class="modal-body">
                    <div id="cancelled-withdrawals-list">
                        ${withdrawals.length === 0 ? 
                            '<div style="text-align: center; padding: 40px; color: var(--text-secondary);">–ù–µ—Ç –æ—Ç–º–µ–Ω–µ–Ω–Ω—ã—Ö –≤—ã–ø–ª–∞—Ç</div>' : 
                            withdrawals.map(withdrawal => `
                                <div class="admin-task-item" style="margin-bottom: 12px;">
                                    <div class="admin-task-header">
                                        <div class="admin-task-title">
                                            ${withdrawal.first_name || withdrawal.username || `User_${withdrawal.user_id}`}
                                            ${withdrawal.username ? ` (@${withdrawal.username})` : ''}
                                        </div>
                                        <div class="admin-task-price" style="color: var(--error);">
                                            ${withdrawal.amount} ‚≠ê
                                        </div>
                                    </div>
                                    <div class="admin-task-description">
                                        <div>–û—Ç–º–µ–Ω–µ–Ω–æ: ${new Date(withdrawal.completed_at).toLocaleString('ru-RU')}</div>
                                        <div>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º: ${withdrawal.admin_name || `ID: ${withdrawal.completed_by}`}</div>
                                        <div>ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${withdrawal.user_id}</div>
                                    </div>
                                </div>
                            `).join('')
                        }
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤ DOM
    document.body.insertAdjacentHTML('beforeend', modalHTML);
}

// –ó–∞–º–µ–Ω–∏—Ç–µ —Å–ª–æ–∂–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç—ã–µ
function simpleShowTab(tabId) {
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.style.display = 'none';
    });
    document.getElementById(tabId).style.display = 'block';
}

// –û—Ç–ª–æ–∂–∏—Ç–µ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
setTimeout(() => {
    loadNonCriticalData();
    initializeAnimations();
}, 1000);
// üîß –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã–ø–ª–∞—Ç—ã
async function completeWithdrawal(requestId) {
    console.log('üîß completeWithdrawal called:', {
        requestId,
        currentUser: currentUser,
        currentUserId: currentUser?.id
    });
    
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ –ø–µ—Ä–µ—á–∏—Å–ª–∏–ª–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é?')) {
        return;
    }
    
    try {
        console.log('üì§ Sending complete request...');
        const result = await makeRequest(`/admin/withdrawal-requests/${requestId}/complete`, {
            method: 'POST',
            body: JSON.stringify({
                adminId: currentUser.id
            })
        });
        
        console.log('üì® Complete response:', result);
        
        if (result.success) {
            showNotification('‚úÖ –í—ã–ø–ª–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞!', 'success');
            loadWithdrawalRequests();
        } else {
            showNotification('‚ùå –û—à–∏–±–∫–∞: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('‚ùå Complete withdrawal error:', error);
        showNotification('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã–ø–ª–∞—Ç—ã: ' + error.message, 'error');
    }
}

// –¢–µ—Å—Ç–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è
async function createTestWithdrawal() {
    try {
        const result = await makeRequest('/test-withdrawal', {
            method: 'POST'
        });
        
        if (result.success) {
            showNotification('‚úÖ –¢–µ—Å—Ç–æ–≤–∞—è –∑–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!', 'success');
            loadWithdrawalRequests();
        }
    } catch (error) {
        console.error('Test withdrawal error:', error);
    }
}

// –û–±–Ω–æ–≤–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–∫–∞–∑–∞ —Å–µ–∫—Ü–∏–∏
function showAdminPaymentsSection() {
    showAdminSection('payments');
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π —á—Ç–æ–±—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É—Å–ø–µ–ª –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è
    setTimeout(() => {
        loadWithdrawalRequests();
    }, 100);
}

// üîó –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ì–ï–ù–ï–†–ê–¢–û–†–ê –°–°–´–õ–û–ö


// –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–∞
async function loadLinkAccessSettings() {
    try {
        const result = await makeRequest('/api/admin/links/settings?adminId=' + currentUser.id);
        if (result.success) {
            document.getElementById('allow-admins-links').checked = result.allowAdminsLinks || false;
        }
    } catch (error) {
        console.error('Error loading link settings:', error);
    }
}


// –°–æ–∑–¥–∞—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
async function createReferralLink() {
    const nameInput = document.getElementById('link-name');
    const descriptionInput = document.getElementById('link-description');
    const messageDiv = document.getElementById('link-form-message');
    const submitBtn = document.getElementById('create-link-btn');
    
    const name = nameInput.value.trim();
    const description = descriptionInput.value.trim();
    
    if (!name) {
        messageDiv.innerHTML = '<span style="color: var(--error);">–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏!</span>';
        return;
    }
    
    if (!currentUser) {
        messageDiv.innerHTML = '<span style="color: var(--error);">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω</span>';
        return;
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
    submitBtn.disabled = true;
    submitBtn.textContent = '–°–æ–∑–¥–∞–µ–º...';
    messageDiv.innerHTML = '<span style="color: var(--warning);">–°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É...</span>';
    
    try {
        const result = await makeRequest('/api/admin/links/create', {
            method: 'POST',
            body: JSON.stringify({
                adminId: currentUser.id,
                name: name,
                description: description,
                createdBy: currentUser.id
            })
        });
        
        if (result.success) {
            messageDiv.innerHTML = `<span style="color: var(--success);">${result.message}</span>`;
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            nameInput.value = '';
            descriptionInput.value = '';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å—Å—ã–ª–æ–∫
            loadReferralLinksList();
            
            showNotification('‚úÖ –°—Å—ã–ª–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!', 'success');
            
        } else {
            throw new Error(result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
        }
        
    } catch (error) {
        console.error('‚ùå Create link error:', error);
        messageDiv.innerHTML = `<span style="color: var(--error);">–û—à–∏–±–∫–∞: ${error.message}</span>`;
        showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏: ' + error.message, 'error');
    } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'üîó –°–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É';
    }
}

// –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å—Å—ã–ª–æ–∫
async function loadReferralLinksList() {
    if (!currentUser) return;
    
    try {
        const result = await makeRequest(`/api/admin/links/list?adminId=${currentUser.id}`);
        
        if (result.success) {
            displayReferralLinksList(result.links);
        } else {
            console.error('Error loading links:', result.error);
        }
    } catch (error) {
        console.error('Load links error:', error);
    }
}

// –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å—Å—ã–ª–æ–∫ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
function displayReferralLinksList(links) {
    const container = document.getElementById('links-list');
    if (!container) return;
    
    container.innerHTML = '';
    
    if (!links || links.length === 0) {
        container.innerHTML = `
            <div class="no-tasks" style="text-align: center; padding: 40px 20px;">
                <div style="font-size: 48px; margin-bottom: 16px;">üîó</div>
                <div>–ù–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫</div>
                <div style="font-size: 14px; color: var(--text-secondary); margin-top: 8px;">
                    –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é —Å—Å—ã–ª–∫—É –∏—Å–ø–æ–ª—å–∑—É—è —Ñ–æ—Ä–º—É –≤—ã—à–µ
                </div>
            </div>
        `;
        return;
    }
    
    links.forEach(link => {
        const linkElement = createSimplifiedLinkElement(link);
        container.appendChild(linkElement);
    });
}

// –°–æ–∑–¥–∞—Ç—å —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç —Å—Å—ã–ª–∫–∏ (—Ç–æ–ª—å–∫–æ –ø–æ–¥—Å—á–µ—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö)
function createSimplifiedLinkElement(link) {
    const linkElement = document.createElement('div');
    linkElement.className = 'admin-task-item';
    
    const referralUrl = link.referral_url || `https://t.me/LinkGoldMoney_bot?start=${link.code}`;
    const isOwner = link.created_by === currentUser.id;
    const isMainAdmin = parseInt(currentUser.id) === ADMIN_ID;
    
    linkElement.innerHTML = `
        <div class="admin-task-header">
            <div class="admin-task-title">
                <span style="font-weight: 600;">${escapeHtml(link.name)}</span>
                ${link.description ? `
                    <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                        ${escapeHtml(link.description)}
                    </div>
                ` : ''}
            </div>
            <div class="admin-task-actions">
                ${(isOwner || isMainAdmin) ? `
                    <button class="admin-task-delete" onclick="deleteReferralLink('${link.code}')">
                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                    </button>
                ` : ''}
            </div>
        </div>
        
        <div class="admin-task-description">
            <!-- –°—Å—ã–ª–∫–∞ -->
            <div style="margin-bottom: 10px;">
                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">–°—Å—ã–ª–∫–∞:</div>
                <div style="display: flex; gap: 8px; align-items: center;">
                    <input type="text" value="${referralUrl}" readonly 
                           style="flex: 1; padding: 8px; background: var(--bg-primary); 
                                  border: 1px solid var(--border); border-radius: 6px; 
                                  color: var(--text-primary); font-size: 12px;">
                    <button class="copy-btn" onclick="copyLink('${referralUrl}')" 
                            style="background: var(--accent); color: white; border: none; 
                                   padding: 8px 12px; border-radius: 6px; cursor: pointer; 
                                   font-size: 12px;">
                        –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                </div>
            </div>
            
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - –¢–û–õ–¨–ö–û –ü–û–î–°–ß–ï–¢ –ü–†–ò–ì–õ–ê–®–ï–ù–ù–´–• -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-top: 10px;">
                <div style="text-align: center;">
                    <div style="font-size: 18px; font-weight: 700; color: var(--accent);">${link.referral_count || 0}</div>
                    <div style="font-size: 11px; color: var(--text-secondary);">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ</div>
                </div>
            </div>
            
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div style="display: flex; justify-content: space-between; font-size: 11px; color: var(--text-secondary); margin-top: 8px;">
                <div>–°–æ–∑–¥–∞–Ω–∞: ${new Date(link.created_at).toLocaleDateString('ru-RU')}</div>
                <div>–ö–æ–¥: ${link.code}</div>
            </div>
            
            <!-- –í–ª–∞–¥–µ–ª–µ—Ü -->
            <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">
                –°–æ–∑–¥–∞–ª: ${link.creator_name || '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä'}
            </div>
        </div>
    `;
    
    return linkElement;
}

// –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
function copyLink(url) {
    navigator.clipboard.writeText(url).then(() => {
        showNotification('‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
    }).catch(() => {
        // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
        const tempInput = document.createElement('input');
        tempInput.value = url;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand('copy');
        document.body.removeChild(tempInput);
        showNotification('‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!', 'success');
    });
}

// üîó –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ì–ï–ù–ï–†–ê–¢–û–†–ê –°–°–´–õ–û–ö

// –ü–æ–∫–∞–∑–∞—Ç—å —Å–µ–∫—Ü–∏—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Å—ã–ª–∫–∞–º–∏
function showAdminLinksSection() {
    showAdminSection('links');
    loadReferralLinksList();
}

// –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å—Å—ã–ª–æ–∫ —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
async function loadReferralLinksList() {
    if (!currentUser) return;
    
    try {
        const result = await makeRequest(`/api/admin/links/list?adminId=${currentUser.id}`);
        
        if (result.success) {
            displayReferralLinksList(result.links);
        } else {
            console.error('Error loading links:', result.error);
        }
    } catch (error) {
        console.error('Load links error:', error);
    }
}

// –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å—Å—ã–ª–æ–∫ —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
function displayReferralLinksList(links) {
    const container = document.getElementById('links-list');
    if (!container) return;
    
    container.innerHTML = '';
    
    if (!links || links.length === 0) {
        container.innerHTML = `
            <div class="no-tasks" style="text-align: center; padding: 40px 20px;">
                <div style="font-size: 48px; margin-bottom: 16px;">üîó</div>
                <div>–ù–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫</div>
                <div style="font-size: 14px; color: var(--text-secondary); margin-top: 8px;">
                    –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é —Å—Å—ã–ª–∫—É –∏—Å–ø–æ–ª—å–∑—É—è —Ñ–æ—Ä–º—É –≤—ã—à–µ
                </div>
            </div>
        `;
        return;
    }
    
    links.forEach(link => {
        const linkElement = createDetailedLinkElement(link);
        container.appendChild(linkElement);
    });
}

// –°–æ–∑–¥–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç —Å—Å—ã–ª–∫–∏ —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
function createDetailedLinkElement(link) {
    const linkElement = document.createElement('div');
    linkElement.className = 'admin-task-item';
    
    const referralUrl = link.referral_url || `https://t.me/LinkGoldMoney_bot?start=${link.code}`;
    const isOwner = link.created_by === currentUser.id;
    const isMainAdmin = parseInt(currentUser.id) === ADMIN_ID;
    
    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
    const totalClicks = link.total_clicks || 0;
    const uniqueClicks = link.unique_clicks || 0;
    const conversions = link.conversions || 0;
    const conversionRate = totalClicks > 0 ? ((conversions / totalClicks) * 100).toFixed(1) : 0;
    
    linkElement.innerHTML = `
        <div class="admin-task-header">
            <div class="admin-task-title">
                <span style="font-weight: 600;">${escapeHtml(link.name)}</span>
                ${link.description ? `
                    <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                        ${escapeHtml(link.description)}
                    </div>
                ` : ''}
            </div>
            <div class="admin-task-actions">
                ${(isOwner || isMainAdmin) ? `
                    <button class="admin-task-delete" onclick="deleteReferralLink('${link.code}')">
                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                    </button>
                ` : ''}
            </div>
        </div>
        
        <div class="admin-task-description">
            <!-- –°—Å—ã–ª–∫–∞ -->
            <div style="margin-bottom: 10px;">
                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">–°—Å—ã–ª–∫–∞:</div>
                <div style="display: flex; gap: 8px; align-items: center;">
                    <input type="text" value="${referralUrl}" readonly 
                           style="flex: 1; padding: 8px; background: var(--bg-primary); 
                                  border: 1px solid var(--border); border-radius: 6px; 
                                  color: var(--text-primary); font-size: 12px;">
                    <button class="copy-btn" onclick="copyLink('${referralUrl}')" 
                            style="background: var(--accent); color: white; border: none; 
                                   padding: 8px 12px; border-radius: 6px; cursor: pointer; 
                                   font-size: 12px;">
                        –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                </div>
            </div>
            
            <!-- –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ -->
            <div style="margin-top: 15px;">
                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">
                    üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤:
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px;">
                    <div style="text-align: center;">
                        <div style="font-size: 18px; font-weight: 700; color: var(--accent);">${totalClicks}</div>
                        <div style="font-size: 11px; color: var(--text-secondary);">–í—Å–µ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 18px; font-weight: 700; color: var(--success);">${uniqueClicks}</div>
                        <div style="font-size: 11px; color: var(--text-secondary);">–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 18px; font-weight: 700; color: var(--gold);">${conversions}</div>
                        <div style="font-size: 11px; color: var(--text-secondary);">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 18px; font-weight: 700; color: var(--purple);">${conversionRate}%</div>
                        <div style="font-size: 11px; color: var(--text-secondary);">–ö–æ–Ω–≤–µ—Ä—Å–∏—è</div>
                    </div>
                </div>
            </div>
            
            <!-- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö -->
            ${totalClicks > 0 ? `
                <div style="margin-top: 12px; padding: 10px; background: var(--bg-secondary); border-radius: 8px;">
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 6px;">
                        üìà –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 11px;">
                        <span>–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∫–ª–∏–∫–æ–≤:</span>
                        <span><strong>${Math.round((uniqueClicks / totalClicks) * 100)}%</strong></span>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 11px; margin-top: 4px;">
                        <span>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å—Å—ã–ª–∫–∏:</span>
                        <span><strong>${conversionRate}%</strong></span>
                    </div>
                </div>
            ` : ''}
            
            <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div style="display: flex; justify-content: space-between; font-size: 11px; color: var(--text-secondary); margin-top: 12px;">
                <div>–°–æ–∑–¥–∞–Ω–∞: ${new Date(link.created_at).toLocaleDateString('ru-RU')}</div>
                <div>–ö–æ–¥: ${link.code}</div>
            </div>
            
            <!-- –í–ª–∞–¥–µ–ª–µ—Ü -->
            <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">
                –°–æ–∑–¥–∞–ª: ${link.creator_name || '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä'}
            </div>
        </div>
    `;
    
    return linkElement;
}

// –°–æ–∑–¥–∞—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
async function createReferralLink() {
    const nameInput = document.getElementById('link-name');
    const descriptionInput = document.getElementById('link-description');
    const messageDiv = document.getElementById('link-form-message');
    const submitBtn = document.getElementById('create-link-btn');
    
    const name = nameInput.value.trim();
    const description = descriptionInput.value.trim();
    
    if (!name) {
        messageDiv.innerHTML = '<span style="color: var(--error);">–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏!</span>';
        return;
    }
    
    if (!currentUser) {
        messageDiv.innerHTML = '<span style="color: var(--error);">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω</span>';
        return;
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
    submitBtn.disabled = true;
    submitBtn.textContent = '–°–æ–∑–¥–∞–µ–º...';
    messageDiv.innerHTML = '<span style="color: var(--warning);">–°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É...</span>';
    
    try {
        const result = await makeRequest('/api/admin/links/create', {
            method: 'POST',
            body: JSON.stringify({
                adminId: currentUser.id,
                name: name,
                description: description,
                createdBy: currentUser.id
            })
        });
        
        if (result.success) {
            messageDiv.innerHTML = `<span style="color: var(--success);">${result.message}</span>`;
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            nameInput.value = '';
            descriptionInput.value = '';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å—Å—ã–ª–æ–∫
            loadReferralLinksList();
            
            showNotification('‚úÖ –°—Å—ã–ª–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!', 'success');
            
        } else {
            throw new Error(result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
        }
        
    } catch (error) {
        console.error('‚ùå Create link error:', error);
        messageDiv.innerHTML = `<span style="color: var(--error);">–û—à–∏–±–∫–∞: ${error.message}</span>`;
        showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏: ' + error.message, 'error');
    } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'üîó –°–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É';
    }
}

// –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
function copyLink(url) {
    navigator.clipboard.writeText(url).then(() => {
        showNotification('‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
    }).catch(() => {
        // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
        const tempInput = document.createElement('input');
        tempInput.value = url;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand('copy');
        document.body.removeChild(tempInput);
        showNotification('‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!', 'success');
    });
}

// –£–¥–∞–ª–∏—Ç—å —Å—Å—ã–ª–∫—É
async function deleteReferralLink(code) {
    if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å—Å—ã–ª–∫—É? –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã.')) {
        return;
    }
    
    try {
        const result = await makeRequest('/api/admin/links/delete', {
            method: 'POST',
            body: JSON.stringify({
                adminId: currentUser.id,
                code: code
            })
        });
        
        if (result.success) {
            showNotification('‚úÖ –°—Å—ã–ª–∫–∞ —É–¥–∞–ª–µ–Ω–∞!', 'success');
            loadReferralLinksList();
        } else {
            showNotification('‚ùå –û—à–∏–±–∫–∞: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('Delete link error:', error);
        showNotification('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏: ' + error.message, 'error');
    }
}

// üîß –≠–ö–°–ü–û–†–¢ –§–£–ù–ö–¶–ò–ô
window.showAdminLinksSection = showAdminLinksSection;
window.createReferralLink = createReferralLink;
window.copyLink = copyLink;
window.deleteReferralLink = deleteReferralLink;

// üîß –≠–ö–°–ü–û–†–¢ –§–£–ù–ö–¶–ò–ô
window.showAdminLinksSection = showAdminLinksSection;
window.createReferralLink = createReferralLink;
window.copyLink = copyLink;
window.deleteReferralLink = deleteReferralLink;

// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∞)
async function saveLinkAccessSettings() {
    if (parseInt(currentUser.id) !== ADMIN_ID) return;
    
    const allowAdmins = document.getElementById('allow-admins-links').checked;
    
    try {
        const result = await makeRequest('/api/admin/links/settings', {
            method: 'POST',
            body: JSON.stringify({
                adminId: currentUser.id,
                allowAdminsLinks: allowAdmins
            })
        });
        
        if (result.success) {
            showNotification('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
        }
    } catch (error) {
        console.error('Save settings error:', error);
        showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫', 'error');
    }
}



// üîß –≠–ö–°–ü–û–†–¢ –§–£–ù–ö–¶–ò–ô
window.showAdminLinksSection = showAdminLinksSection;
window.createReferralLink = createReferralLink;
window.copyLink = copyLink;
window.deleteReferralLink = deleteReferralLink;
window.saveLinkAccessSettings = saveLinkAccessSettings;
// –í —Ñ—É–Ω–∫—Ü–∏–∏ initAdminInputHandlers –¥–æ–±–∞–≤—å—Ç–µ:
const allowAdminsCheckbox = document.getElementById('allow-admins-links');
if (allowAdminsCheckbox) {
    allowAdminsCheckbox.addEventListener('change', saveLinkAccessSettings);
}
// –û–±–Ω–æ–≤–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–∫–∞–∑–∞ —Å–µ–∫—Ü–∏–∏ –æ–ø–ª–∞—Ç
function showAdminPaymentsSection() {
    showAdminSection('payments');
    loadWithdrawalRequests();
}
       // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—ã–≤–æ–¥–∞
function updateWithdrawPage() {
    const balanceDisplay = document.getElementById('withdraw-balance-display');
    const withdrawBtn = document.getElementById('withdraw-btn');
    const MIN_WITHDRAWAL = 250;
    
    if (balanceDisplay && currentUser) {
        balanceDisplay.textContent = `${currentUser.balance || 0} ‚≠ê`;
    }
    
    if (withdrawBtn && currentUser) {
        const currentBalance = currentUser.balance || 0;
        
        if (currentBalance < MIN_WITHDRAWAL) {
    withdrawBtn.disabled = true;
    withdrawBtn.style.opacity = '0.5';
    withdrawBtn.textContent = `–ú–∏–Ω–∏–º—É–º ${MIN_WITHDRAWAL} ‚≠ê`;
} else {
            withdrawBtn.disabled = false;
            withdrawBtn.style.opacity = '1';
            withdrawBtn.textContent = `–í—ã–≤–µ—Å—Ç–∏ ${currentBalance} ‚≠ê`;
        }
    }
}

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–æ–≤ –Ω–∞ –≥–ª–∞–≤–Ω—É—é
        async function loadMainPagePosts() {
            try {
                const result = await makeRequest('/posts');
                
                if (result.success && result.posts && result.posts.length > 0) {
                    displayMainPagePosts(result.posts);
                } else {
                    hidePostsSection();
                }
            } catch (error) {
                console.error('Error loading posts:', error);
                hidePostsSection();
            }
        }

        function displayMainPagePosts(posts) {
            const postsSection = document.getElementById('posts-section');
            const postsContainer = document.getElementById('posts-container');
            
            if (!postsContainer) return;
            
            if (postsSection) postsSection.style.display = 'block';
            
            postsContainer.innerHTML = '';
            
            if (!posts || posts.length === 0) {
                postsContainer.innerHTML = `
                    <div class="no-tasks" style="text-align: center; padding: 40px 20px;">
                        <div style="font-size: 48px; margin-bottom: 16px;">üìù</div>
                        <div>–ü–æ–∫–∞ –Ω–µ—Ç –ø—É–±–ª–∏–∫–∞—Ü–∏–π</div>
                        <div style="font-size: 14px; color: var(--text-secondary); margin-top: 8px;">
                            –°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
                        </div>
                    </div>
                `;
                return;
            }
            
            posts.forEach(post => {
                const postElement = document.createElement('div');
                postElement.className = 'post-item fade-in';
                
                const postDate = formatPostDate(post.timestamp);
                const isAdmin = post.authorId === ADMIN_ID;
                
                postElement.innerHTML = `
                    <div class="post-header">
                        <div style="flex: 1;">
                            <div class="post-title">${escapeHtml(post.title)}</div>
                            <div class="post-author">
                                ${escapeHtml(post.author || '–ö–æ–º–∞–Ω–¥–∞ LinkGold')}
                            </div>
                        </div>
                        <div class="post-date">${postDate}</div>
                    </div>
                    
                    <div class="post-content">${escapeHtml(post.content)}</div>
                    
                    ${post.image_url ? `
                        <img src="${post.image_url}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" class="post-image" onerror="this.style.display='none'">
                    ` : ''}
                    
                    
                    
                    ${currentUser && currentUser.isAdmin && parseInt(currentUser.id) === ADMIN_ID ? `
                        <div style="margin-top: 15px; text-align: right;">
                            <button class="admin-task-delete" onclick="deletePost(${post.id})" style="font-size: 12px; padding: 6px 12px;">
                                üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç
                            </button>
                        </div>
                    ` : ''}
                `;
                
                postsContainer.appendChild(postElement);
            });
        }

        function hidePostsSection() {
            const postsSection = document.getElementById('posts-section');
            if (postsSection) postsSection.style.display = 'none';
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ª–∞–π–∫–æ–≤ –∏ –¥–∏–∑–ª–∞–π–∫–æ–≤
        async function handleLike(postId, button) {
            try {
                const result = await makeRequest(`/posts/${postId}/like`, {
                    method: 'POST',
                    body: JSON.stringify({
                        userId: currentUser.id
                    })
                });

                if (result.success) {
                    const countElement = button.querySelector('.like-count');
                    countElement.textContent = result.likes;
                    
                    // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
                    button.style.transform = 'scale(1.1)';
                    setTimeout(() => {
                        button.style.transform = 'scale(1)';
                    }, 200);
                }
            } catch (error) {
                console.error('Error liking post:', error);
                // –õ–æ–∫–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
                const countElement = button.querySelector('.like-count');
                countElement.textContent = parseInt(countElement.textContent) + 1;
                
                button.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    button.style.transform = 'scale(1)';
                }, 200);
            }
        }

        async function handleDislike(postId, button) {
            try {
                const result = await makeRequest(`/posts/${postId}/dislike`, {
                    method: 'POST',
                    body: JSON.stringify({
                        userId: currentUser.id
                    })
                });

                if (result.success) {
                    const countElement = button.querySelector('.dislike-count');
                    countElement.textContent = result.dislikes;
                    
                    // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
                    button.style.transform = 'scale(1.1)';
                    setTimeout(() => {
                        button.style.transform = 'scale(1)';
                    }, 200);
                }
            } catch (error) {
                console.error('Error disliking post:', error);
                // –õ–æ–∫–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
                const countElement = button.querySelector('.dislike-count');
                countElement.textContent = parseInt(countElement.textContent) + 1;
                
                button.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    button.style.transform = 'scale(1)';
                }, 200);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –≤—ã–≤–æ–¥
        async function submitWithdraw() {
            if (!currentUser) {
                showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω', 'error');
                return;
            }
            
            const amountInput = document.getElementById('withdraw-amount');
            const methodSelect = document.getElementById('withdraw-method');
            const detailsInput = document.getElementById('withdraw-details');
            
            const amount = parseFloat(amountInput?.value);
            const method = methodSelect?.value;
            const details = detailsInput?.value?.trim();
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!amount || amount <= 0) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É', 'error');
                return;
            }
            
            if (amount < 50) {
                showNotification('–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞: 150 ‚≠ê', 'error');
                return;
            }
            
            if (amount > (currentUser.balance || 0)) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ', 'error');
                return;
            }
            
            if (!method) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –≤—ã–≤–æ–¥–∞', 'error');
                return;
            }
            
            if (!details) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –≤—ã–≤–æ–¥–∞', 'error');
                return;
            }
            
            try {
                const result = await makeRequest('/withdrawal/request', {
                    method: 'POST',
                    body: JSON.stringify({
                        user_id: currentUser.id,
                        amount: amount,
                        method: method,
                        details: details
                    })
                });

                if (result.success) {
                    showNotification(`–ó–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–≤–æ–¥ ${amount}‚≠ê –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –û–∂–∏–¥–∞–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤.`, 'success');
                    
                    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                    if (amountInput) amountInput.value = '';
                    if (methodSelect) methodSelect.value = '';
                    if (detailsInput) detailsInput.value = '';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    if (currentUser.balance) {
                        currentUser.balance -= amount;
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
                    displayUserProfile();
                    
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –ø—Ä–æ—Ñ–∏–ª—å
                    setTimeout(() => {
                        showProfileTab();
                    }, 2000);
                    
                } else {
                    showNotification('–û—à–∏–±–∫–∞: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–≤–æ–¥–µ —Å—Ä–µ–¥—Å—Ç–≤:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞', 'error');
            }
        }

        function showNotification(message, type = 'info') {
            // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            document.querySelectorAll('.notification').forEach(notification => {
                notification.remove();
            });
            
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-content">${message}</div>
                <button class="notification-close" onclick="this.parentElement.remove()">√ó</button>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        function copyReferralLink() {
            const referralInput = document.getElementById('referral-link');
            if (!referralInput) return;
            
            referralInput.select();
            referralInput.setSelectionRange(0, 99999);
            
            navigator.clipboard.writeText(referralInput.value).then(() => {
                showNotification('–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!', 'success');
            }).catch(() => {
                document.execCommand('copy');
                showNotification('–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!', 'success');
            });
        }

        function showBalanceModal() {
            document.getElementById('balance-modal').classList.add('active');
        }

        function showPrices() {
            document.getElementById('prices-modal').classList.add('active');
        }

        function openAdminChatFromPrices() {
            document.getElementById('prices-modal').classList.remove('active');
            setTimeout(() => {
                document.getElementById('admin-chat').classList.add('active');
            }, 300);
        }

        function goToProfile() {
            closeModal('balance-modal');
            showProfileTab();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

// –í index.html - –æ–±–Ω–æ–≤–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –Ω–∞—á–∞–ª–∞ –∑–∞–¥–∞–Ω–∏—è
async function startTask() {
    console.log('üéØ Starting task...', { selectedTaskId, currentUser });
    
    if (!currentUser || !selectedTaskId) {
        showNotification('–û—à–∏–±–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏–ª–∏ –∑–∞–¥–∞–Ω–∏–µ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ', 'error');
        return;
    }

    try {
        console.log('üì§ Sending start task request...');
        
        const result = await makeRequest('/api/user/tasks/start', {
            method: 'POST',
            body: JSON.stringify({
                userId: currentUser.id,
                taskId: selectedTaskId
            })
        });

        console.log('üì® Start task response:', result);

        if (result.success) {
            closeModal('task-modal');
            showNotification('‚úÖ –ó–∞–¥–∞–Ω–∏–µ –Ω–∞—á–∞—Ç–æ! –í—ã–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ –∏ –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.', 'success');
            
            // –ù–ï–ú–ï–î–õ–ï–ù–ù–û –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–∫–∏ –∑–∞–¥–∞–Ω–∏–π
            setTimeout(() => {
                loadTasks(); // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è (—É–±–∏—Ä–∞–µ–º –Ω–∞—á–∞—Ç–æ–µ)
                loadUserTasksForCategory('active'); // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–∫—Ç–∏–≤–Ω—ã–µ
            }, 500);
            
        } else {
            showNotification('‚ùå –û—à–∏–±–∫–∞: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('üí• Error starting task:', error);
        showNotification('‚ùå –û—à–∏–±–∫–∞ –Ω–∞—á–∞–ª–∞ –∑–∞–¥–∞–Ω–∏—è: ' + error.message, 'error');
    }
}

// üîß –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò –ù–ê–ß–ê–õ–ê –ó–ê–î–ê–ù–ò–Ø
function debugStartTask() {
    console.log('üêõ DEBUG Start Task:');
    console.log('- currentUser:', currentUser);
    console.log('- selectedTaskId:', selectedTaskId);
    console.log('- API_BASE_URL:', API_BASE_URL);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
    const task = allTasks.find(t => t.id === selectedTaskId);
    console.log('- task found:', !!task);
    console.log('- task details:', task);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    console.log('- task modal visible:', document.getElementById('task-modal')?.classList.contains('active'));
}

// –í—Ä–µ–º–µ–Ω–Ω–æ –¥–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
function addStartTaskDebugButton() {
    const debugBtn = document.createElement('button');
    debugBtn.textContent = 'üêõ Debug Start Task';
    debugBtn.style.position = 'fixed';
    debugBtn.style.top = '250px';
    debugBtn.style.right = '10px';
    debugBtn.style.zIndex = '10000';
    debugBtn.style.padding = '10px';
    debugBtn.style.background = 'purple';
    debugBtn.style.color = 'white';
    debugBtn.style.border = 'none';
    debugBtn.style.borderRadius = '5px';
    debugBtn.style.fontSize = '12px';
    debugBtn.onclick = debugStartTask;
    document.body.appendChild(debugBtn);
}

// –í—ã–∑–æ–≤–∏—Ç–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
setTimeout(addStartTaskDebugButton, 3000);

        async function loadAdminChats() {
    if (!currentUser) return;
    
    try {
        console.log('üì• Loading admin chats...');
        const result = await makeRequest(`/support/chats`);
        
        if (result.success) {
            console.log(`‚úÖ Loaded ${result.chats?.length || 0} active chats`);
            displayAdminChatsList(result.chats || []);
        } else {
            console.error('‚ùå Failed to load chats:', result.error);
        }
    } catch (error) {
        console.error('‚ùå Error loading admin chats:', error);
    }
}

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö —á–∞—Ç–æ–≤ (–≤–∫–ª—é—á–∞—è –∞—Ä—Ö–∏–≤–Ω—ã–µ)
        async function loadAllAdminChats() {
            if (!currentUser || !currentUser.isAdmin) return;
            
            try {
                const result = await makeRequest(`/support/all-chats?adminId=${ADMIN_ID}`);
                if (result.success) {
                    displayAllAdminChats(result.chats || []);
                }
            } catch (error) {
                console.error('Error loading all chats:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∞—Ä—Ö–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤
        async function loadArchivedAdminChats() {
            if (!currentUser || !currentUser.isAdmin) return;
            
            try {
                const result = await makeRequest(`/support/archived-chats?adminId=${ADMIN_ID}`);
                if (result.success) {
                    displayArchivedAdminChats(result.chats || []);
                }
            } catch (error) {
                console.error('Error loading archived chats:', error);
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤
        function displayAdminChatsList(chats) {
            const container = document.getElementById('active-chats-list');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (!chats || chats.length === 0) {
                container.innerHTML = ``;
                return;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            updateChatsStats(chats);
            
            chats.forEach(chat => {
                const chatElement = createChatElement(chat, 'active');
                container.appendChild(chatElement);
            });
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö —á–∞—Ç–æ–≤
        function displayAllAdminChats(chats) {
            const container = document.getElementById('all-chats-list');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (!chats || chats.length === 0) {
                container.innerHTML = ``;
                return;
            }
            
            chats.forEach(chat => {
                const chatElement = createChatElement(chat, 'all');
                container.appendChild(chatElement);
            });
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞—Ä—Ö–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤
        function displayArchivedAdminChats(chats) {
            const container = document.getElementById('archived-chats-list');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (!chats || chats.length === 0) {
                container.innerHTML = `
                    <div class="no-tasks" style="text-align: center; padding: 20px;">
                        <div>–ù–µ—Ç –∞—Ä—Ö–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤</div>
                    </div>
                `;
                return;
            }
            
            chats.forEach(chat => {
                const chatElement = createChatElement(chat, 'archived');
                container.appendChild(chatElement);
            });
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ —á–∞—Ç–∞
        function createChatElement(chat, listType) {
            const chatElement = document.createElement('div');
            const isUnread = chat.unread_count > 0;
            const isArchived = !chat.is_active;
            
            chatElement.className = `chat-item ${isUnread ? 'unread' : ''} ${isArchived ? 'archived' : ''}`;
            chatElement.onclick = () => openAdminChatWindow(chat);
            
            const avatarText = chat.user_name ? chat.user_name.charAt(0).toUpperCase() : 'U';
            const displayName = chat.user_name || `User_${chat.user_id}`;
            const lastMessage = chat.last_message || '–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π';
            
            chatElement.innerHTML = `
                <div class="chat-avatar-small">
                    ${avatarText}
                </div>
                <div class="chat-info-small">
                    <div class="chat-name-small">
                        ${displayName}
                        ${isArchived ? '<span class="archived-badge">–∞—Ä—Ö–∏–≤</span>' : ''}
                    </div>
                    <div class="chat-last-message">${lastMessage}</div>
                </div>
                <div class="chat-meta">
                    <div class="chat-time">${chat.moscow_time || formatPostDate(chat.last_message_time)}</div>
                    ${isUnread ? `<div class="unread-badge">${chat.unread_count}</div>` : ''}
                </div>
                ${listType === 'all' || listType === 'archived' ? `
                    <div class="chat-actions">
                        ${isArchived ? `
                            <button class="chat-action-btn chat-restore-btn" onclick="event.stopPropagation(); restoreChat(${chat.id})" title="–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å">
                                ‚Üª
                            </button>
                        ` : `
                            <button class="chat-action-btn chat-archive-btn" onclick="event.stopPropagation(); archiveChat(${chat.id})" title="–í –∞—Ä—Ö–∏–≤">
                                üìÅ
                            </button>
                        `}
                        <button class="chat-action-btn chat-delete-btn" onclick="event.stopPropagation(); deleteAdminChat(${chat.id})" title="–£–¥–∞–ª–∏—Ç—å">
                            üóëÔ∏è
                        </button>
                    </div>
                ` : ''}
            `;
            
            return chatElement;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —á–∞—Ç–æ–≤
        function updateChatsStats(chats) {
            const activeChats = chats.filter(chat => chat.is_active).length;
            const unreadChats = chats.filter(chat => chat.unread_count > 0).length;
            const totalChats = chats.length;
            
            const activeCount = document.getElementById('active-chats-count');
            const unreadCount = document.getElementById('unread-chats-count');
            const totalCount = document.getElementById('total-chats-count');
            
            if (activeCount) activeCount.textContent = activeChats;
            if (unreadCount) unreadCount.textContent = unreadChats;
            if (totalCount) totalCount.textContent = totalChats;
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏ —á–∞—Ç–æ–≤
        function showChatTab(tab) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–ø–∏—Å–∫–∏ —á–∞—Ç–æ–≤
            const activeList = document.getElementById('active-chats-list');
            const archivedList = document.getElementById('archived-chats-list');
            const allList = document.getElementById('all-chats-list');
            
            if (activeList) activeList.style.display = 'none';
            if (archivedList) archivedList.style.display = 'none';
            if (allList) allList.style.display = 'none';
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.chat-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
            const buttons = document.querySelectorAll('.chat-tab-btn');
            switch(tab) {
                case 'active':
                    if (activeList) activeList.style.display = 'block';
                    buttons[0]?.classList.add('active');
                    loadAdminChats();
                    break;
                case 'archived':
                    if (archivedList) archivedList.style.display = 'block';
                    buttons[1]?.classList.add('active');
                    loadArchivedAdminChats();
                    break;
                case 'all':
                    if (allList) allList.style.display = 'block';
                    buttons[2]?.classList.add('active');
                    loadAllAdminChats();
                    break;
            }
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞ —á–∞—Ç–∞ –∞–¥–º–∏–Ω–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
        async function openAdminChatWindow(chat) {
            console.log('üí¨ Admin opening chat:', chat);
            currentAdminChat = chat;
            
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
                const messagesResult = await makeRequest(`/support/chats/${chat.id}/messages`);
                if (messagesResult.success) {
                    console.log(`üì® Loaded ${messagesResult.messages.length} messages for admin chat`);
                    
                    // –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ
                    try {
                        await makeRequest(`/support/chats/${chat.id}/read`, {
                            method: 'PUT'
                        });
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ (—É–±–∏—Ä–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ)
                        loadAdminChats();
                    } catch (readError) {
                        console.log('Mark as read not available');
                    }
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∫–Ω–æ —á–∞—Ç–∞
                    showAdminChatWindow(chat, messagesResult.messages);
                } else {
                    throw new Error('Failed to load messages');
                }
            } catch (error) {
                console.error('‚ùå Error opening admin chat:', error);
                showNotification('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —á–∞—Ç–∞: ' + error.message, 'error');
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ–∫–Ω–æ —á–∞—Ç–∞ –∞–¥–º–∏–Ω–∞
        function showAdminChatWindow(chat, messages) {
            // –°–æ–∑–¥–∞–µ–º –æ–∫–Ω–æ —á–∞—Ç–∞ –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            let chatWindow = document.getElementById('admin-chat-window');
            if (!chatWindow) {
                createAdminChatWindow();
                chatWindow = document.getElementById('admin-chat-window');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
            const chatUserName = document.getElementById('admin-chat-user-name');
            const chatUserAvatar = document.getElementById('admin-chat-avatar');
            
            if (chatUserName) {
                chatUserName.textContent = chat.user_name || `User_${chat.user_id}`;
            }
            
            if (chatUserAvatar) {
                chatUserAvatar.textContent = chat.user_name ? chat.user_name.charAt(0).toUpperCase() : 'U';
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            displayAdminChatMessages(messages);
            
            chatWindow.classList.add('active');
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –æ–∫–Ω–∞ —á–∞—Ç–∞ –∞–¥–º–∏–Ω–∞
        function createAdminChatWindow() {
            const chatWindowHTML = `
                <div class="admin-chat-window" id="admin-chat-window">
                    <div class="admin-chat-header">
                        <div class="admin-chat-user">
                            <div class="chat-avatar-small" id="admin-chat-avatar">U</div>
                            <div class="chat-info-small">
                                <div class="chat-name-small" id="admin-chat-user-name">User</div>
                                <div class="chat-status">–û–Ω–ª–∞–π–Ω</div>
                            </div>
                        </div>
                        <button class="chat-close" onclick="closeAdminChat()">√ó</button>
                    </div>
                    <div class="admin-chat-messages" id="admin-chat-messages">
                        <!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
                    </div>
                    <div class="admin-chat-input-container">
                        <input type="text" id="admin-chat-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="if(event.key==='Enter') sendAdminMessage()">
                        <button class="admin-chat-send" onclick="sendAdminMessage()">‚û§</button>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', chatWindowHTML);
        }
function addPromocodesTestButton() {
    const testDiv = document.createElement('div');
    testDiv.innerHTML = `
        <div style="margin: 20px 0; padding: 15px; background: var(--bg-secondary); border-radius: 10px;">
            <h4>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤</h4>
            <button onclick="testPromocodesSystem()" class="btn btn-primary" style="margin: 5px;">
                –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
            </button>
            <button onclick="checkPromocodesTable()" class="btn btn-warning" style="margin: 5px;">
                –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É
            </button>
        </div>
    `;
    
    const promocodesSection = document.getElementById('admin-promocodes-section');
    if (promocodesSection) {
        promocodesSection.appendChild(testDiv);
    }
}

async function testPromocodesSystem() {
    try {
        const result = await makeRequest('/api/admin/promocodes/test');
        console.log('üß™ Promocodes test result:', result);
        showNotification(`–¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã: ${result.message}`, result.success ? 'success' : 'error');
    } catch (error) {
        console.error('‚ùå Promocodes test failed:', error);
        showNotification('–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ' + error.message, 'error');
    }
}

async function checkPromocodesTable() {
    try {
        const result = await makeRequest('/api/debug/tables');
        console.log('üìä All tables:', result);
        showNotification('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü –∑–∞–≤–µ—Ä—à–µ–Ω–∞ - —Å–º–æ—Ç—Ä–∏—Ç–µ –∫–æ–Ω—Å–æ–ª—å', 'info');
    } catch (error) {
        console.error('‚ùå Table check failed:', error);
        showNotification('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∞–±–ª–∏—Ü: ' + error.message, 'error');
    }
}

// –í—ã–∑–æ–≤–∏—Ç–µ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
setTimeout(addPromocodesTestButton, 2000);
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Ç–µ –∞–¥–º–∏–Ω–∞
        function displayAdminChatMessages(messages) {
            const container = document.getElementById('admin-chat-messages');
            if (!container) {
                console.error('Admin chat messages container not found!');
                return;
            }
            
            container.innerHTML = '';
            
            if (!messages || messages.length === 0) {
                const welcomeMessage = document.createElement('div');
                welcomeMessage.className = 'message message-admin';
                welcomeMessage.innerHTML = `
                    <div class="message-text">–ù–∞—á–Ω–∏—Ç–µ –¥–∏–∞–ª–æ–≥ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º</div>
                    <div class="message-time">${new Date().toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'})}</div>
                `;
                container.appendChild(welcomeMessage);
                return;
            }
            
            messages.forEach(message => {
                const messageElement = document.createElement('div');
                messageElement.className = message.is_admin ? 'message message-admin' : 'message message-user';
                
                let messageContent = '';
                if (message.image_url) {
                    messageContent = `
                        <div class="message-image">
                            <img src="${message.image_url}" alt="–§–æ—Ç–æ" style="max-width: 200px; border-radius: 10px;">
                        </div>
                    `;
                } else {
                    messageContent = `<div class="message-text">${escapeHtml(message.message)}</div>`;
                }
                
                messageElement.innerHTML = `
                    ${messageContent}
                    <div class="message-time">${message.moscow_time || formatPostDate(message.sent_at)}</div>
                `;
                container.appendChild(messageElement);
            });
            
            container.scrollTop = container.scrollHeight;
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –∞–¥–º–∏–Ω–æ–º
        async function sendAdminMessage() {
            if (!currentAdminChat || !currentUser) {
                console.error('No active chat or user');
                showNotification('–ß–∞—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω', 'error');
                return;
            }
            
            const input = document.getElementById('admin-chat-input');
            if (!input) {
                console.error('Admin chat input not found');
                return;
            }
            
            const message = input.value.trim();
            
            if (!message) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ', 'error');
                return;
            }
            
            try {
                console.log(`‚úâÔ∏è Admin sending message to chat ${currentAdminChat.id}:`, message);
                
                const result = await makeRequest(`/support/chats/${currentAdminChat.id}/messages`, {
                    method: 'POST',
                    body: JSON.stringify({
                        user_id: currentUser.id,
                        user_name: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                        message: message,
                        is_admin: true
                    })
                });
                
                if (result.success) {
                    // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                    const messagesContainer = document.getElementById('admin-chat-messages');
                    if (messagesContainer) {
                        const messageElement = document.createElement('div');
                        messageElement.className = 'message message-admin';
                        messageElement.innerHTML = `
                            <div class="message-text">${escapeHtml(message)}</div>
                            <div class="message-time">${new Date().toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'})}</div>
                        `;
                        messagesContainer.appendChild(messageElement);
                        
                        input.value = '';
                        messagesContainer.scrollTop = messagesContainer.scrollHeight;
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤
                        loadAdminChats();
                        
                        console.log('‚úÖ Admin message sent successfully');
                        showNotification('–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ', 'success');
                    }
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('‚ùå Error sending admin message:', error);
                showNotification('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è: ' + error.message, 'error');
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ —á–∞—Ç–∞ –∞–¥–º–∏–Ω–∞
        function closeAdminChat() {
            const chatWindow = document.getElementById('admin-chat-window');
            if (chatWindow) {
                chatWindow.classList.remove('active');
            }
            currentAdminChat = null;
        }
        // –í—Ä–µ–º–µ–Ω–Ω–æ –¥–æ–±–∞–≤—å—Ç–µ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
async function testPromocodeEndpoint() {
    try {
        console.log('üß™ Testing promocode endpoint...');
        const result = await makeRequest('/api/admin/promocodes/create', {
            method: 'POST',
            body: JSON.stringify({
                adminId: currentUser.id,
                code: 'TEST123',
                maxUses: 10,
                reward: 50,
                expiresAt: null
            })
        });
        console.log('‚úÖ Test result:', result);
    } catch (error) {
        console.error('‚ùå Test failed:', error);
    }
}

// –í—ã–∑–æ–≤–∏—Ç–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
// testPromocodeEndpoint();
// üîß –ü–†–û–í–ï–†–ö–ê –°–¢–†–£–ö–¢–£–†–´ –ë–ê–ó–´ –î–ê–ù–ù–´–•
async function checkDatabaseStructure() {
    try {
        console.log('üîç Checking database structure...');
        const result = await makeRequest('/debug/database');
        console.log('üìä Database structure:', result);
        showNotification('‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞', 'success');
    } catch (error) {
        console.error('‚ùå Database check failed:', error);
        showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ë–î', 'error');
    }
}
        // –ê—Ä—Ö–∏–≤–∞—Ü–∏—è —á–∞—Ç–∞
        async function archiveChat(chatId) {
            if (!confirm('–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —á–∞—Ç –≤ –∞—Ä—Ö–∏–≤?')) return;

            try {
                const result = await makeRequest(`/support/chats/${chatId}/archive`, {
                    method: 'PUT',
                    body: JSON.stringify({ adminId: currentUser.id })
                });

                if (result.success) {
                    showNotification('–ß–∞—Ç –ø–µ—Ä–µ–º–µ—â–µ–Ω –≤ –∞—Ä—Ö–∏–≤', 'success');
                    loadAdminChats();
                    loadAllAdminChats();
                } else {
                    showNotification('–û—à–∏–±–∫–∞: ' + result.error, 'error');
                }
            } catch (error) {
                console.error('Error archiving chat:', error);
                showNotification('–û—à–∏–±–∫–∞ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ —á–∞—Ç–∞', 'error');
            }
        }



// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–µ–º—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
initTheme();
        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞ –∏–∑ –∞—Ä—Ö–∏–≤–∞
        async function restoreChat(chatId) {
            try {
                const result = await makeRequest(`/support/chats/${chatId}/restore`, {
                    method: 'PUT',
                    body: JSON.stringify({ adminId: currentUser.id })
                });

                if (result.success) {
                    showNotification('–ß–∞—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω', 'success');
                    loadAdminChats();
                    loadAllAdminChats();
                    loadArchivedAdminChats();
                } else {
                    showNotification('–û—à–∏–±–∫–∞: ' + result.error, 'error');
                }
            } catch (error) {
                console.error('Error restoring chat:', error);
                showNotification('–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —á–∞—Ç–∞', 'error');
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞
        async function deleteAdminChat(chatId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —á–∞—Ç? –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) return;

            try {
                const result = await makeRequest(`/support/chats/${chatId}`, {
                    method: 'DELETE',
                    body: JSON.stringify({ adminId: currentUser.id })
                });

                if (result.success) {
                    showNotification('–ß–∞—Ç —É–¥–∞–ª–µ–Ω', 'success');
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —Å–ø–∏—Å–∫–∏ —á–∞—Ç–æ–≤
                    loadAdminChats();
                    loadAllAdminChats();
                    loadArchivedAdminChats();
                    
                    // –ï—Å–ª–∏ —É–¥–∞–ª–µ–Ω–Ω—ã–π —á–∞—Ç –±—ã–ª –æ—Ç–∫—Ä—ã—Ç - –∑–∞–∫—Ä—ã–≤–∞–µ–º –µ–≥–æ
                    if (currentAdminChat && currentAdminChat.id === chatId) {
                        closeAdminChat();
                    }
                } else {
                    showNotification('–û—à–∏–±–∫–∞: ' + result.error, 'error');
                }
            } catch (error) {
                console.error('Error deleting chat:', error);
                showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —á–∞—Ç–∞', 'error');
            }
        }
// üîß –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–û–õ–ù–û–ô –û–ß–ò–°–¢–ö–ò –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò
function resetAdminPanel() {
    console.log('üßπ Resetting admin panel display...');
    
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
    const allSections = document.querySelectorAll('.admin-section');
    allSections.forEach(section => {
        section.style.display = 'none';
    });
    
    // –°–∫—Ä—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π
    const tasksContainer = document.getElementById('admin-tasks-list-container');
    if (tasksContainer) {
        tasksContainer.style.display = 'none';
    }
    
    console.log('‚úÖ Admin panel reset complete');
}

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞ –ø—Ä–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–∏ —Å—Ä–µ–¥—Å—Ç–≤
        function playMoneySound() {
            try {
                // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π –∑–≤—É–∫ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ –±—Ä–∞—É–∑–µ—Ä–∞
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (error) {
                console.log('Audio not supported');
            }
        }
// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ Enter –¥–ª—è –ø–æ–ª—è –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
function initAdminInputHandlers() {
    const usernameInput = document.getElementById('new-admin-username');
    if (usernameInput) {
        usernameInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addNewAdmin();
            }
        });
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initAdminInputHandlers);
} else {
    initAdminInputHandlers();
}
        // üîß –≠–ö–°–ü–û–†–¢ –§–£–ù–ö–¶–ò–ô
        window.showTaskCategory = showTaskCategory;
        window.loadUserTasksForCategory = loadUserTasksForCategory;
        window.displayUserTasksForCategory = displayUserTasksForCategory;
        window.openAdminChat = openAdminChat;
        window.closeChat = closeChat;
        window.sendMessageToAdmin = sendMessageToAdmin;
        window.openTaskModal = openTaskModal;
        window.startTask = startTask;
        window.closeModal = closeModal;
        window.showBalanceModal = showBalanceModal;
        window.showPrices = showPrices;
        window.openAdminChatFromPrices = openAdminChatFromPrices;
        window.goToProfile = goToProfile;
        window.copyReferralLink = copyReferralLink;
        window.submitWithdraw = submitWithdraw;
        window.showMainTab = showMainTab;
        window.showTasksTab = showTasksTab;
        window.showProfileTab = showProfileTab;
        window.showAdminTab = showAdminTab;
        window.showHowItWorksPage = showHowItWorksPage;
        window.showAboutPage = showAboutPage;
        window.showWithdrawPage = showWithdrawPage;
        window.showAdminSection = showAdminSection;
        window.addNewPost = addNewPost;
        window.addTask = addTask;
        window.deletePost = deletePost;
        window.deleteTask = deleteTask;
        window.sendAdminMessage = sendAdminMessage;
        window.closeAdminChat = closeAdminChat;
        window.submitTaskCompletion = submitScreenshot;
        window.deleteAdminChat = deleteAdminChat;
        window.archiveChat = archiveChat;
        window.restoreChat = restoreChat;
        window.showChatTab = showChatTab;
        window.handleLike = handleLike;
        window.handleDislike = handleDislike;
        window.showTaskConfirmation = showTaskConfirmation;
        window.showScreenshotUpload = showScreenshotUpload;
        window.showCancelConfirmation = showCancelConfirmation;
        window.submitScreenshot = submitScreenshot;
        window.cancelTask = cancelTask;
        window.loadTaskVerifications = loadTaskVerifications;
        window.openVerificationModal = openVerificationModal;
        window.approveVerification = approveVerification;
        window.rejectVerification = rejectVerification;
        window.goBackToProfile = goBackToProfile;
        window.loadAdminChats = loadAdminChats;
        window.loadAllAdminChats = loadAllAdminChats;
        window.loadArchivedAdminChats = loadArchivedAdminChats;
        window.openAdminChatWindow = openAdminChatWindow;
        window.requestWithdraw = requestWithdraw;
        // üîß –≠–ö–°–ü–û–†–¢ –§–£–ù–ö–¶–ò–ô
window.showAdminAdminsSection = showAdminAdminsSection;
window.loadAdminsList = loadAdminsList;
window.addNewAdmin = addNewAdmin;
window.removeAdmin = removeAdmin;
// üîß –≠–ö–°–ü–û–†–¢ –§–£–ù–ö–¶–ò–ô –î–õ–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ê–î–ú–ò–ù–ê–ú–ò
window.showAdminAdminsSection = showAdminAdminsSection;
window.loadAdminsList = loadAdminsList;
window.addNewAdmin = addNewAdmin;
window.removeAdmin = removeAdmin;
window.showAdminSection = showAdminSection;
// üîß –≠–ö–°–ü–û–†–¢ –§–£–ù–ö–¶–ò–ô –î–õ–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ê–î–ú–ò–ù–ê–ú–ò
window.showAdminAdminsSection = showAdminAdminsSection;
window.loadAdminsList = loadAdminsList;
window.addNewAdmin = addNewAdmin;
window.removeAdmin = removeAdmin;
window.showAdminSection = showAdminSection;
window.refreshUserData = refreshUserData;
window.showAdminAdminsSection = showAdminAdminsSection;
window.loadAdminsList = loadAdminsList;
window.addNewAdmin = addNewAdmin;
window.removeAdmin = removeAdmin;
window.showAdminSection = showAdminSection;
window.refreshUserData = refreshUserData;
window.checkAdminRights = checkAdminRights;
// üîß –§–£–ù–ö–¶–ò–ò –î–õ–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ê–î–ú–ò–ù–ê–ú–ò
// üîß –≠–ö–°–ü–û–†–¢ –§–£–ù–ö–¶–ò–ô –î–õ–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ê–î–ú–ò–ù–ê–ú–ò
window.showAdminAdminsSection = showAdminAdminsSection;
window.loadAdminsList = loadAdminsList;
window.addNewAdmin = addNewAdmin;
window.removeAdmin = removeAdmin;
window.showAdminSection = showAdminSection;

// üîß –≠–ö–°–ü–û–†–¢ –ù–û–í–´–• –§–£–ù–ö–¶–ò–ô
window.refreshAdminRights = refreshAdminRights;
window.debugAdminRights = debugAdminRights;


// –ü–æ–∫–∞–∑–∞—Ç—å —Å–µ–∫—Ü–∏—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞–º–∏
function showAdminAdminsSection() {
    showAdminSection('admins');
    loadAdminsList();
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –∞–¥–º–∏–Ω–æ–≤
async function loadAdminsList() {
    console.log('üîÑ Loading admins list...');
    
    if (!currentUser || parseInt(currentUser.id) !== ADMIN_ID) {
        console.log('‚ùå User is not main admin');
        return;
    }
    
    try {
        const result = await makeRequest(`/admin/admins-list?adminId=${currentUser.id}`);
        
        if (result.success) {
            displayAdminsList(result.admins);
        } else {
            showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –∞–¥–º–∏–Ω–æ–≤: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('‚ùå Error loading admins list:', error);
        showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –∞–¥–º–∏–Ω–æ–≤', 'error');
    }
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∞–¥–º–∏–Ω–æ–≤
function displayAdminsList(admins) {
    const container = document.getElementById('admins-list');
    if (!container) return;
    
    container.innerHTML = '';
    
    if (!admins || admins.length === 0) {
        container.innerHTML = `
            <div class="no-tasks" style="text-align: center; padding: 30px;">
                <div style="font-size: 48px; margin-bottom: 16px;">üë•</div>
                <div>–ù–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤</div>
                <div style="font-size: 14px; color: var(--text-secondary); margin-top: 8px;">
                    –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                </div>
            </div>
        `;
        return;
    }
    
    admins.forEach(admin => {
        const adminElement = document.createElement('div');
        adminElement.className = 'admin-task-item';
        
        const isMainAdmin = parseInt(admin.user_id) === ADMIN_ID;
        const joinDate = new Date(admin.created_at).toLocaleDateString('ru-RU');
        const fullName = `${admin.first_name} ${admin.last_name || ''}`.trim();
        const displayName = fullName || `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${admin.user_id}`;
        
        adminElement.innerHTML = `
            <div class="admin-task-header">
                <div class="admin-task-title">
                    ${displayName}
                    ${isMainAdmin ? ' <span style="color: var(--gold);">(–ì–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω)</span>' : ''}
                </div>
                ${!isMainAdmin ? `
                    <div class="admin-task-actions">
                        <button class="admin-task-delete" onclick="removeAdmin(${admin.user_id})">
                            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </div>
                ` : ''}
            </div>
            <div class="admin-task-description">
                @${admin.username} ‚Ä¢ ID: ${admin.user_id} ‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω: ${joinDate}
            </div>
            <div style="margin-top: 8px; font-size: 12px; color: ${admin.is_admin ? 'var(--success)' : 'var(--error)'};">
                ${admin.is_admin ? '‚úÖ –ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∞–∫—Ç–∏–≤–Ω—ã' : '‚ùå –ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–µ –∞–∫—Ç–∏–≤–Ω—ã'}
            </div>
            
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞–Ω—è—Ç–æ–≥–æ –∞–¥–º–∏–Ω–∞ -->
            ${!isMainAdmin ? `
                <div style="margin-top: 12px; padding: 10px; background: var(--bg-secondary); border-radius: 8px;">
                    <h5 style="margin-bottom: 8px;">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–¥–º–∏–Ω–∞:</h5>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 12px;">
                        <div>üìù –ü–æ—Å—Ç—ã: <strong>${admin.posts_count || 0}</strong></div>
                        <div>üìã –ó–∞–¥–∞–Ω–∏—è: <strong>${admin.tasks_count || 0}</strong></div>
                        <div>‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∏: <strong>${admin.verifications_count || 0}</strong></div>
                        <div>üí¨ –û—Ç–≤–µ—Ç–æ–≤: <strong>${admin.support_count || 0}</strong></div>
                        <div>üí≥ –í—ã–ø–ª–∞—Ç: <strong>${admin.payments_count || 0}</strong></div>
                    </div>
                </div>
                
                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏ -->
                <div style="margin-top: 10px;">
                    <h6 style="margin-bottom: 6px;">üîß –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:</h6>
                    <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                        <label style="font-size: 12px;">
                            <input type="checkbox" ${admin.can_posts ? 'checked' : ''} onchange="updateAdminPermissions(${admin.user_id}, 'posts', this.checked)"> üìù –ü–æ—Å—Ç—ã
                        </label>
                        <label style="font-size: 12px;">
                            <input type="checkbox" ${admin.can_tasks ? 'checked' : ''} onchange="updateAdminPermissions(${admin.user_id}, 'tasks', this.checked)"> üìã –ó–∞–¥–∞–Ω–∏—è
                        </label>
                        <label style="font-size: 12px;">
                            <input type="checkbox" ${admin.can_verification ? 'checked' : ''} onchange="updateAdminPermissions(${admin.user_id}, 'verification', this.checked)"> ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞
                        </label>
                        <label style="font-size: 12px;">
                            <input type="checkbox" ${admin.can_support ? 'checked' : ''} onchange="updateAdminPermissions(${admin.user_id}, 'support', this.checked)"> üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞
                        </label>
                        <label style="font-size: 12px;">
                            <input type="checkbox" ${admin.can_payments ? 'checked' : ''} onchange="updateAdminPermissions(${admin.user_id}, 'payments', this.checked)"> üí≥ –û–ø–ª–∞—Ç—ã
                        </label>
                    </div>
                </div>
            ` : ''}
        `;
        
        container.appendChild(adminElement);
    });
}

async function addNewAdmin() {
    console.log('üîç DEBUG addNewAdmin START');
    
    const usernameInput = document.getElementById('new-admin-username');
    const messageDiv = document.getElementById('admin-form-message');
    const submitBtn = document.getElementById('add-admin-btn');
    
    if (!usernameInput || !messageDiv) {
        console.error('‚ùå Required elements not found');
        showNotification('–û—à–∏–±–∫–∞: —ç–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'error');
        return;
    }
    
    let username = usernameInput.value.trim();
    
    // üîß –û–ß–ò–°–¢–ö–ê USERNAME: —É–±–∏—Ä–∞–µ–º @ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ–≥–æ –≤–≤–µ–ª
    if (username.startsWith('@')) {
        username = username.substring(1);
        usernameInput.value = username; // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–µ
    }
    
    console.log('üë§ Processing username:', username);
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (!username) {
        messageDiv.innerHTML = '<span style="color: var(--error);">–í–≤–µ–¥–∏—Ç–µ Telegram username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!</span>';
        return;
    }
    
    if (username.length < 3) {
        messageDiv.innerHTML = '<span style="color: var(--error);">Username –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞</span>';
        return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
    if (!currentUser) {
        messageDiv.innerHTML = '<span style="color: var(--error);">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω</span>';
        return;
    }
    
    if (parseInt(currentUser.id) !== ADMIN_ID) {
        messageDiv.innerHTML = '<span style="color: var(--error);">–¢–æ–ª—å–∫–æ –≥–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –∞–¥–º–∏–Ω–æ–≤!</span>';
        console.log('‚ùå Not main admin:', { currentUserId: currentUser.id, ADMIN_ID });
        return;
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
    submitBtn.disabled = true;
    submitBtn.textContent = '–î–æ–±–∞–≤–ª—è–µ–º...';
    messageDiv.innerHTML = '<span style="color: var(--warning);">–î–æ–±–∞–≤–ª—è–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞...</span>';
    
    try {
        const requestData = {
            adminId: currentUser.id,
            username: username
        };
        
        console.log('üì§ Sending request:', requestData);
        
        const result = await makeRequest('/api/admin/add-admin', {
            method: 'POST',
            body: JSON.stringify(requestData)
        });
        
        console.log('üì® Server response:', result);
        
        if (result.success) {
            messageDiv.innerHTML = `<span style="color: var(--success);">${result.message}</span>`;
            usernameInput.value = ''; // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–æ–≤
            setTimeout(() => {
                loadAdminsList();
            }, 1000);
            
            showNotification(result.message, 'success');
            
        } else {
            messageDiv.innerHTML = `<span style="color: var(--error);">–û—à–∏–±–∫–∞: ${result.error}</span>`;
            showNotification('–û—à–∏–±–∫–∞: ' + result.error, 'error');
        }
        
    } catch (error) {
        console.error('üí• Error adding admin:', error);
        
        let errorMessage = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∞–¥–º–∏–Ω–∞';
        if (error.message.includes('404')) {
            errorMessage = '–û—à–∏–±–∫–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω. –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.';
        } else if (error.message.includes('Failed to fetch')) {
            errorMessage = '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.';
        } else {
            errorMessage = error.message;
        }
        
        messageDiv.innerHTML = `<span style="color: var(--error);">${errorMessage}</span>`;
        showNotification(errorMessage, 'error');
    } finally {
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
        submitBtn.disabled = false;
        submitBtn.textContent = '‚ûï –î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞';
        console.log('üîç DEBUG addNewAdmin END');
    }
}
async function checkServerConnection() {
    try {
        const response = await fetch(API_BASE_URL + '/api/health');
        if (response.ok) {
            console.log('‚úÖ –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω');
            return true;
        }
    } catch (error) {
        console.error('‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:', error);
        showNotification('–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.', 'error');
        return false;
    }
}

// –£–¥–∞–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞
async function removeAdmin(targetAdminId) {
    if (!currentUser || parseInt(currentUser.id) !== ADMIN_ID) {
        showNotification('–¢–æ–ª—å–∫–æ –≥–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –∞–¥–º–∏–Ω–æ–≤!', 'error');
        return;
    }
    
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞?')) {
        return;
    }
    
    try {
        const result = await makeRequest('/admin/remove-admin', {
            method: 'POST',
            body: JSON.stringify({
                adminId: currentUser.id,
                targetAdminId: targetAdminId
            })
        });
        
        if (result.success) {
            showNotification(result.message, 'success');
            loadAdminsList();
        } else {
            showNotification('–û—à–∏–±–∫–∞: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('‚ùå Error removing admin:', error);
        showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞: ' + error.message, 'error');
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∞–¥–º–∏–Ω–∞
async function updateAdminPermissions(adminId, permission, enabled) {
    try {
        const result = await makeRequest('/admin/update-permissions', {
            method: 'POST',
            body: JSON.stringify({
                adminId: currentUser.id,
                targetAdminId: adminId,
                permission: permission,
                enabled: enabled
            })
        });
        
        if (result.success) {
            showNotification('–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
        } else {
            showNotification('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('Update permissions error:', error);
        showNotification('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞', 'error');
    }
}
// –í —Ñ—É–Ω–∫—Ü–∏–∏ setupAdminPanel –¥–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è —Å—Å—ã–ª–æ–∫
function setupAdminPanel() {
    if (!currentUser) return;
    
    const adminButtons = document.querySelector('.admin-buttons');
    if (adminButtons) {
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Å—ã–ª–∫–∞–º–∏
        adminButtons.innerHTML += `
            <button class="admin-btn" onclick="showAdminLinksSection()">üîó –°—Å—ã–ª–∫–∏</button>
        `;
    }
}


// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
async function refreshUserData() {
    if (!currentUser) return;
    
    try {
        console.log('üîÑ Refreshing user data...');
        
        const result = await makeRequest('/admin/refresh-rights', {
            method: 'POST',
            body: JSON.stringify({
                userId: currentUser.id
            })
        });
        
        if (result.success) {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            Object.assign(currentUser, result.user);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            displayUserProfile();
            updateAdminPanel(); // –û–±–Ω–æ–≤–ª—è–µ–º –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
            
            console.log('‚úÖ User data refreshed:', currentUser);
            showNotification('–ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!', 'success');
        }
    } catch (error) {
        console.error('‚ùå Error refreshing user data:', error);
    }
}

// –£–¥–∞–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞
// –£–¥–∞–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞ - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
async function removeAdmin(targetAdminId) {
    console.log('üóëÔ∏è Removing admin:', targetAdminId);
    
    if (!currentUser || parseInt(currentUser.id) !== ADMIN_ID) {
        showNotification('–¢–æ–ª—å–∫–æ –≥–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –∞–¥–º–∏–Ω–æ–≤!', 'error');
        return;
    }
    
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞?')) {
        return;
    }
    
    try {
        const result = await makeRequest('/admin/remove-admin', {
            method: 'POST',
            body: JSON.stringify({
                adminId: currentUser.id,
                targetAdminId: targetAdminId
            })
        });
        
        if (result.success) {
            showNotification(result.message, 'success');
            loadAdminsList(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–æ–≤
        } else {
            showNotification('–û—à–∏–±–∫–∞: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('‚ùå Error removing admin:', error);
        showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞: ' + error.message, 'error');
    }
}
// –û–±–Ω–æ–≤–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é showAdminSection —á—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å –Ω–æ–≤—É—é —Å–µ–∫—Ü–∏—é

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ Enter –¥–ª—è –ø–æ–ª—è –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
function initAdminInputHandlers() {
    const usernameInput = document.getElementById('new-admin-username');
    if (usernameInput) {
        usernameInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addNewAdmin();
            }
        });
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
document.addEventListener('DOMContentLoaded', function() {
    initAdminInputHandlers();
});
// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
// üîß –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
async function refreshAdminRights() {
    if (!currentUser) return;
    
    try {
        console.log('üîÑ Refreshing admin rights for user:', currentUser.id);
        
        const result = await makeRequest('/admin/refresh-rights', {
            method: 'POST',
            body: JSON.stringify({
                userId: currentUser.id
            })
        });
        
        if (result.success) {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            Object.assign(currentUser, result.user);
            
            console.log('‚úÖ Admin rights refreshed:', {
                id: currentUser.id,
                is_admin: currentUser.is_admin,
                isMainAdmin: parseInt(currentUser.id) === ADMIN_ID
            });
            
            // –ü–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
            checkAdminRights();
            
        } else {
            // –ï—Å–ª–∏ –Ω–æ–≤—ã–π endpoint –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ä—ã–π
            const fallbackResult = await makeRequest(`/user/${currentUser.id}`);
            if (fallbackResult.success) {
                Object.assign(currentUser, fallbackResult.profile);
                checkAdminRights();
            }
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:', error);
        // –ü—Ä–æ–±—É–µ–º —Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
        try {
            const fallbackResult = await makeRequest(`/user/${currentUser.id}`);
            if (fallbackResult.success) {
                Object.assign(currentUser, fallbackResult.profile);
                checkAdminRights();
            }
        } catch (fallbackError) {
            console.error('Fallback method also failed:', fallbackError);
        }
    }
}
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
function debugAdminRights() {
    console.log('üêõ DEBUG Admin Rights:');
    console.log('- Current User:', currentUser);
    console.log('- ADMIN_ID:', ADMIN_ID);
    console.log('- is_admin:', currentUser?.is_admin);
    console.log('- isMainAdmin:', parseInt(currentUser?.id) === ADMIN_ID);
    console.log('- Admin Nav Visible:', document.getElementById('admin-nav-item')?.style.display);
}

// –í—ã–∑–æ–≤ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
setTimeout(debugAdminRights, 2000);
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (—Ç–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è)
async function testAdminRights() {
    if (!currentUser) {
        console.log('‚ùå No current user for rights test');
        return;
    }
    
    try {
        const result = await makeRequest(`/admin/debug-rights?userId=${currentUser.id}`);
        console.log('üîç Admin rights debug:', result);
    } catch (error) {
        console.error('Error testing admin rights:', error);
    }
}

// –í—ã–∑–æ–≤ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ (—Ç–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)
setTimeout(() => {
    if (typeof currentUser !== 'undefined') {
        testAdminRights();
    }
}, 3000);


function updateLevelProgress() {
    if (!currentUser) return;
    
    const completedTasks = currentUser.tasks_completed || 0;
    const levelInfo = calculateUserLevel(completedTasks);
    
    console.log('üìä Level progress calculation:', {
        completedTasks,
        level: levelInfo.level,
        percentage: levelInfo.progressPercentage
    });
    
    const progressBar = document.getElementById('level-progress-bar');
    const levelCount = document.querySelector('.level-count');
    const levelInfoText = document.querySelector('.level-info');
    
    if (progressBar) {
        progressBar.style.width = `${levelInfo.progressPercentage}%`;
    }
    
    if (levelCount) {
        if (levelInfo.isMaxLevel) {
            levelCount.textContent = "–ú–∞–∫—Å. —É—Ä–æ–≤–µ–Ω—å!";
        } else {
            const nextLevelRequirement = LEVEL_SYSTEM[levelInfo.level + 1].tasksRequired;
            const tasksNeeded = nextLevelRequirement - completedTasks;
            levelCount.textContent = `${completedTasks}/${nextLevelRequirement}`;
        }
    }
    
    if (levelInfoText) {
        if (levelInfo.isMaxLevel) {
            levelInfoText.innerHTML = `üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è!`;
        } else {
            const nextLevelRequirement = LEVEL_SYSTEM[levelInfo.level + 1].tasksRequired;
            const tasksNeeded = nextLevelRequirement - completedTasks;
            levelInfoText.innerHTML = 
                `–£—Ä–æ–≤–µ–Ω—å <strong>${levelInfo.levelName}</strong> ‚Ä¢ ` +
                `–î–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è: <strong>${tasksNeeded}</strong> –∑–∞–¥–∞–Ω–∏–π`;
        }
    }
}

// üîß –û–ë–ù–û–í–õ–ï–ù–ù–´–ô HTML –î–õ–Ø –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –ü–†–û–ì–†–ï–°–°–ê –£–†–û–í–ù–Ø –ë–ï–ó –ë–û–ù–£–°–û–í
function createLevelProgressHTML() {
    const completedTasks = currentUser?.tasks_completed || 0;
    const levelInfo = calculateUserLevel(completedTasks);
    
    const tasksForThisLevel = levelInfo.tasksForNextLevel - LEVEL_SYSTEM[levelInfo.level].tasksRequired;
    const currentProgress = levelInfo.currentLevelTasks;
    
    return `
        <div class="level-progress">
            <div class="level-header">
                <div class="level-title">–°–∏—Å—Ç–µ–º–∞ —É—Ä–æ–≤–Ω–µ–π</div>
                <div class="level-badge">–£—Ä–æ–≤–µ–Ω—å ${levelInfo.level}</div>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="level-progress-bar" style="width: ${levelInfo.progressPercentage}%"></div>
                </div>
                <div class="progress-stats">
                    <span>${currentProgress} –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</span>
                    <span>${levelInfo.progressPercentage}%</span>
                    <span>${tasksForThisLevel} –¥–æ —Å–ª–µ–¥. —É—Ä–æ–≤–Ω—è</span>
                </div>
            </div>
            
            <div class="level-info">
                ${levelInfo.isMaxLevel ? 
                    'üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è!' : 
                    `–¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å: <strong>${levelInfo.levelName}</strong> ‚Ä¢ ` +
                    `–ü—Ä–æ–≥—Ä–µ—Å—Å: <strong>${currentProgress}/${tasksForThisLevel}</strong> –∑–∞–¥–∞–Ω–∏–π`
                }
            </div>
        </div>
    `;
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —É—Ä–æ–≤–Ω–µ –≤ –ø—Ä–æ—Ñ–∏–ª–µ
function updateProfileLevelInfo(levelInfo) {
    const levelStats = document.querySelectorAll('.profile-stat');
    if (levelStats.length >= 4) {
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π
        levelStats[1].querySelector('.stat-value').textContent = levelInfo.completedTasks;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –µ—Å–ª–∏ –µ—Å—Ç—å –º–µ—Å—Ç–æ
        const levelDisplay = document.getElementById('profile-level-display');
        if (!levelDisplay) {
            const levelHtml = `
                <div class="profile-stat" id="profile-level-display">
                    <div class="stat-value">${levelInfo.level}</div>
                    <div class="stat-label">–£—Ä–æ–≤–µ–Ω—å</div>
                </div>
            `;
            // –í—Å—Ç–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –∫–∞—á–µ—Å—Ç–≤–∞
            if (levelStats[3] && levelStats[3].parentNode) {
                levelStats[3].insertAdjacentHTML('beforebegin', levelHtml);
            }
        } else {
            levelDisplay.querySelector('.stat-value').textContent = levelInfo.level;
        }
    }
}



// –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–æ–≤—ã—à–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è
function showLevelUpNotification(level, levelName, bonus) {
    const notificationHTML = `
        <div class="level-up-notification" style="
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--gold-gradient);
            color: #000;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            z-index: 10000;
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.5);
            border: 3px solid rgba(255, 255, 255, 0.3);
            animation: levelUpPop 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            max-width: 300px;
            width: 90%;
        ">
            <div style="font-size: 48px; margin-bottom: 15px;">üéâ</div>
            <div style="font-size: 24px; font-weight: 800; margin-bottom: 10px;">
                –ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å!
            </div>
            <div style="font-size: 20px; font-weight: 700; margin-bottom: 15px;">
                ${levelName}
            </div>
            <div style="font-size: 16px; margin-bottom: 20px;">
                –£—Ä–æ–≤–µ–Ω—å <strong>${level}</strong> –¥–æ—Å—Ç–∏–≥–Ω—É—Ç!
            </div>
            <div style="
                background: rgba(255, 255, 255, 0.3);
                padding: 10px;
                border-radius: 10px;
                font-weight: 700;
                margin-bottom: 15px;
            ">
                üéÅ –ë–æ–Ω—É—Å: +${bonus}‚≠ê
            </div>
            <button onclick="this.parentElement.remove()" style="
                background: #000;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 10px;
                font-weight: 600;
                cursor: pointer;
            ">
                –û—Ç–ª–∏—á–Ω–æ!
            </button>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', notificationHTML);
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
    setTimeout(() => {
        const notification = document.querySelector('.level-up-notification');
        if (notification) {
            notification.remove();
        }
    }, 5000);
}

// CSS –∞–Ω–∏–º–∞—Ü–∏—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
const levelUpStyles = `
    <style>
        @keyframes levelUpPop {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.1);
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }
        
        .level-progress {
            background: var(--card-bg);
            border-radius: 14px;
            padding: 16px;
            margin: 16px 0;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }
        
        .level-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .level-title {
            font-weight: 600;
            font-size: 16px;
        }
        
        .level-badge {
            background: var(--purple-gradient);
            color: white;
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .progress-container {
            margin-bottom: 8px;
        }
        
        .progress-stats {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .level-rewards {
            margin-top: 12px;
            padding: 10px;
            background: var(--bg-secondary);
            border-radius: 8px;
            border-left: 3px solid var(--gold);
        }
        
        .reward-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            margin-bottom: 4px;
        }
        
        .reward-item:last-child {
            margin-bottom: 0;
        }
    </style>
`;

// –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç
document.head.insertAdjacentHTML('beforeend', levelUpStyles);

// üîß –û–ë–ù–û–í–õ–ï–ù–ù–´–ô HTML –î–õ–Ø –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –ü–†–û–ì–†–ï–°–°–ê –£–†–û–í–ù–Ø

function createLevelProgressHTML() {
    const completedTasks = currentUser?.tasks_completed || 0;
    const levelInfo = calculateUserLevel(completedTasks);
    
    return `
        <div class="level-progress">
            <div class="level-header">
                <div class="level-title">–°–∏—Å—Ç–µ–º–∞ —É—Ä–æ–≤–Ω–µ–π</div>
                <div class="level-badge">–£—Ä–æ–≤–µ–Ω—å ${levelInfo.level}</div>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="level-progress-bar" style="width: ${levelInfo.progressPercentage}%"></div>
                </div>
                <div class="progress-stats">
                    <span>${levelInfo.completedTasks} –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</span>
                    <span>${levelInfo.progressPercentage}%</span>
                    <span>${levelInfo.tasksForNextLevel} –¥–æ —Å–ª–µ–¥. —É—Ä–æ–≤–Ω—è</span>
                </div>
            </div>
            
            <div class="level-info">
                ${levelInfo.isMaxLevel ? 
                    'üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è!' : 
                    `–¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å: <strong>${levelInfo.levelName}</strong> ‚Ä¢ ` +
                    `–î–æ —É—Ä–æ–≤–Ω—è ${levelInfo.level + 1}: <strong>${levelInfo.tasksForNextLevel - completedTasks}</strong> –∑–∞–¥–∞–Ω–∏–π`
                }
            </div>
            
            ${!levelInfo.isMaxLevel ? `
                <div class="level-rewards">
                    <div class="reward-item">
                        <span>üéÅ</span>
                        <span>–ë–æ–Ω—É—Å –∑–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å: <strong>+${levelInfo.nextLevelBonus}‚≠ê</strong></span>
                    </div>
                </div>
            ` : ''}
        </div>
    `;
}

// üîß –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –°–ò–°–¢–ï–ú–´ –£–†–û–í–ù–ï–ô

// –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ—Ñ–∏–ª—è
function initializeLevelSystem() {
    updateLevelProgress();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
    setInterval(updateLevelProgress, 30000);
}


// üîß –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ü–†–ò –ó–ê–í–ï–†–®–ï–ù–ò–ò –ó–ê–î–ê–ù–ò–Ø
async function onTaskCompleted(userId, taskPrice) {
    try {
        // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const result = await makeRequest(`/user/${userId}`);
        if (result.success) {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            currentUser = { ...currentUser, ...result.profile };
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            displayUserProfile();
            
            console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω—ã –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è');
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è:', error);
    }
}

// üîß –≠–ö–°–ü–û–†–¢ –§–£–ù–ö–¶–ò–ô
window.updateLevelProgress = updateLevelProgress;
window.calculateUserLevel = calculateUserLevel;
window.initializeLevelSystem = initializeLevelSystem;
function clearTaskImage() {
    const input = document.getElementById('task-image-input');
    const preview = document.getElementById('task-image-preview');
    const placeholder = document.querySelector('.upload-placeholder');
    
    if (input) input.value = '';
    if (preview) {
        preview.src = '';
        preview.style.display = 'none';
    }
    if (placeholder) {
        placeholder.style.display = 'block';
    }
    
    currentTaskImage = null;
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∏–ª–∏ –æ–±–ª–∞—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏
    const area = document.getElementById('image-upload-area');
    if (area) {
        area.style.borderColor = '';
        area.style.background = '';
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è drag and drop
initImageUploadDragDrop();
function initImageUploadDragDrop() {
    const area = document.getElementById('image-upload-area');
    if (!area) return;
    
    area.addEventListener('dragover', function(e) {
        e.preventDefault();
        area.classList.add('dragover');
        area.style.borderColor = 'var(--accent)';
        area.style.background = 'rgba(99, 102, 241, 0.05)';
    });
    
    area.addEventListener('dragleave', function(e) {
        e.preventDefault();
        area.classList.remove('dragover');
        area.style.borderColor = '';
        area.style.background = '';
    });
    
    area.addEventListener('drop', function(e) {
        e.preventDefault();
        area.classList.remove('dragover');
        area.style.borderColor = '';
        area.style.background = '';
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            const fileInput = document.getElementById('task-image-input');
            if (fileInput) {
                // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π DataTransfer –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ñ–∞–π–ª–∞
                const dataTransfer = new DataTransfer();
                dataTransfer.items.add(files[0]);
                fileInput.files = dataTransfer.files;
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–µ–≤—å—é
                previewTaskImage(fileInput);
            }
        }
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –æ–±–ª–∞—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏
    area.addEventListener('click', function() {
        const fileInput = document.getElementById('task-image-input');
        if (fileInput) {
            fileInput.click();
        }
    });
}
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –æ–±–ª–∞—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏
    area.addEventListener('click', function() {
        const fileInput = document.getElementById('task-image-input');
        if (fileInput) {
            fileInput.click();
        }
    });

async function addTaskWithImage() {
    console.log('üéØ Starting add task with image...');
    
    try {
        // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —Ñ–æ—Ä–º—ã
        const taskData = {
            title: document.getElementById('admin-task-title').value.trim(),
            description: document.getElementById('admin-task-description').value.trim(),
            price: document.getElementById('admin-task-price').value,
            category: document.getElementById('admin-task-category').value,
            time_to_complete: document.getElementById('admin-task-time').value || '5-10 –º–∏–Ω—É—Ç',
            difficulty: document.getElementById('admin-task-difficulty').value,
            people_required: document.getElementById('admin-task-people').value || 1,
            task_url: document.getElementById('admin-task-url').value || '',
            created_by: currentUser.id
        };

        console.log('üìã Form data collected:', taskData);

        // –í–∞–ª–∏–¥–∞—Ü–∏—è
        if (!taskData.title.trim()) {
            showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è!', 'error');
            return;
        }
        if (!taskData.description.trim()) {
            showNotification('–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è!', 'error');
            return;
        }
        if (!taskData.price) {
            showNotification('–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É –∑–∞–¥–∞–Ω–∏—è!', 'error');
            return;
        }

        const price = parseFloat(taskData.price);
        if (isNaN(price) || price <= 0) {
            showNotification('–¶–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º!', 'error');
            return;
        }

        // –°–æ–∑–¥–∞–µ–º FormData –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å —Ñ–∞–π–ª–æ–º
        const formData = new FormData();
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        Object.keys(taskData).forEach(key => {
            formData.append(key, taskData[key]);
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å
        if (currentTaskImage) {
            formData.append('image', currentTaskImage);
            console.log('üì∏ Adding image to form data:', currentTaskImage.name);
        } else {
            console.log('‚ÑπÔ∏è No image selected');
        }

        console.log('üì§ Sending task with image...');

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
        const response = await fetch('/api/tasks-with-image', {
            method: 'POST',
            body: formData
        });

        const result = await response.json();
        console.log('üì® Server response:', result);

        if (result.success) {
            showNotification('‚úÖ –ó–∞–¥–∞–Ω–∏–µ —Å —Ñ–æ—Ç–æ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ!', 'success');
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            clearTaskForm();
            clearTaskImage();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–∫–∏
            setTimeout(() => {
                loadAdminTasks();
                loadTasks();
            }, 1000);
            
        } else {
            throw new Error(result.error || 'Unknown server error');
        }

    } catch (error) {
        console.error('üí• Error in addTaskWithImage:', error);
        showNotification(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è: ${error.message}`, 'error');
    }
}
function clearTaskForm() {
    const formFields = [
        'admin-task-title', 
        'admin-task-description', 
        'admin-task-price', 
        'admin-task-time', 
        'admin-task-people', 
        'admin-task-url'
    ];
    
    formFields.forEach(fieldId => {
        const element = document.getElementById(fieldId);
        if (element) element.value = '';
    });
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–µ —Å–ø–∏—Å–∫–∏
    document.getElementById('admin-task-category').value = 'subscribe';
    document.getElementById('admin-task-difficulty').value = '–õ–µ–≥–∫–∞—è';
    
    // –û—á–∏—â–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    clearTaskImage();
}
function createTaskCard(task, category, index) {
    const taskElement = document.createElement('div');
    taskElement.className = 'task-card';
    taskElement.style.animationDelay = `${index * 0.1}s`;
    
    const peopleRequired = task.people_required || 1;
    const completedCount = task.completed_count || 0;
    const availableTasks = Math.max(0, peopleRequired - completedCount);
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    let buttonHtml = '';
    switch(category) {
        case 'new':
            buttonHtml = `<button class="task-btn" onclick="event.stopPropagation(); openTaskModal(${task.id})">
                –ù–∞—á–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ
            </button>`;
            break;
        case 'confirmation':
            buttonHtml = `<button class="task-btn" onclick="event.stopPropagation(); showTaskConfirmation(${task.id}, '${escapeHtml(task.title)}')">
                –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É
            </button>`;
            break;
        case 'completed':
            buttonHtml = `<div class="task-status completed">‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>`;
            break;
        case 'rejected':
            buttonHtml = `<div class="task-status rejected">‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ</div>`;
            break;
    }
    
    taskElement.innerHTML = `
        ${availableTasks > 0 && category === 'new' ? `<div class="task-availability">${availableTasks} –æ—Å—Ç–∞–ª–æ—Å—å</div>` : ''}
        
        <div class="task-header">
            <div class="task-title">${escapeHtml(task.title)}</div>
            <div class="task-price">${task.price} ‚≠ê</div>
        </div>
        
        <div class="task-meta">
            <div class="task-category">${formatCategory(task.category)}</div>
            ${task.difficulty ? `<div class="task-difficulty ${task.difficulty.toLowerCase()}">${task.difficulty}</div>` : ''}
        </div>
        
        <div class="task-description">
            ${escapeHtml(task.description.length > 100 ? task.description.substring(0, 100) + '...' : task.description)}
        </div>
        
        ${peopleRequired > 1 && category === 'new' ? `
            <div class="task-progress">
                <div class="task-progress-bar" style="width: ${Math.min(100, (completedCount / peopleRequired) * 100)}%"></div>
            </div>
            <div class="task-progress-text">
                –í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${completedCount}/${peopleRequired}
            </div>
        ` : ''}
        
        <div class="task-footer">
            <div class="task-time">
                ${category === 'confirmation' ? '–û–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è' : 
                  category === 'completed' ? '–í—ã–ø–æ–ª–Ω–µ–Ω–æ' :
                  category === 'rejected' ? '–û—Ç–∫–ª–æ–Ω–µ–Ω–æ' : 
                  task.time_to_complete || '5-10 –º–∏–Ω—É—Ç'}
            </div>
            ${buttonHtml}
        </div>
    `;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏–π
    if (category === 'new') {
        taskElement.addEventListener('click', function(e) {
            if (!e.target.classList.contains('task-btn')) {
                openTaskModal(task.id);
            }
        });
    }
    
    return taskElement;
}
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
function displayTasksWithImages(tasks, category) {
    const container = document.getElementById(category + '-tasks');
    if (!container) return;

    container.innerHTML = '';

    if (!tasks || tasks.length === 0) {
        container.innerHTML = `
            <div class="no-tasks" style="text-align: center; padding: 40px 20px;">
                <div style="font-size: 48px; margin-bottom: 16px;">üìù</div>
                <div>–ó–∞–¥–∞–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</div>
                <div style="font-size: 14px; color: var(--text-secondary); margin-top: 8px;">
                    –ù–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –ø–æ–∑–∂–µ
                </div>
            </div>
        `;
        return;
    }

    tasks.forEach((task, index) => {
        const taskElement = createTaskCardWithImage(task, category, index);
        container.appendChild(taskElement);
    });
}
// –í index.html - –æ–±–Ω–æ–≤–∏–º —Ñ—É–Ω–∫—Ü–∏—é —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–¥–∞–Ω–∏—è –¥–ª—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö
function createTaskCardWithImage(task, category, index) {
    const taskElement = document.createElement('div');
    taskElement.className = 'task-card task-card-with-image';
    if (category === 'rejected') {
        taskElement.classList.add('rejected');
    }
    taskElement.style.animationDelay = `${index * 0.1}s`;
    
    // –î–æ–±–∞–≤–ª—è–µ–º data-attribute –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
    taskElement.setAttribute('data-task-id', task.id);
    taskElement.setAttribute('data-task-title', task.title);
    
    console.log(`üé® Creating task card: ${task.id} - "${task.title}"`);
    
    const hasImage = task.image_url && task.image_url !== '';
    const peopleRequired = task.people_required || 1;
    const completedCount = task.completed_count || 0;
    const availableTasks = Math.max(0, peopleRequired - completedCount);
    
    let imageHtml = '';
    if (hasImage) {
        imageHtml = `
            <div class="task-image-container">
                <img src="${task.image_url}" alt="${escapeHtml(task.title)}" 
                     class="task-image"
                     onerror="this.onerror=null; this.style.display='none';">
                ${availableTasks > 0 && category === 'new' ? `<div class="task-badge">${availableTasks} –æ—Å—Ç–∞–ª–æ—Å—å</div>` : ''}
            </div>
        `;
    } else {
        imageHtml = `
            ${availableTasks > 0 && category === 'new' ? `<div class="task-availability">${availableTasks} –æ—Å—Ç–∞–ª–æ—Å—å</div>` : ''}
        `;
    }
    
    let buttonHtml = '';
    switch(category) {
        case 'new':
            buttonHtml = `<button class="task-btn" onclick="event.stopPropagation(); openTaskModal(${task.id})">
                –ù–∞—á–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ
            </button>`;
            break;
        case 'confirmation':
            buttonHtml = `<button class="task-btn" onclick="event.stopPropagation(); showTaskConfirmation(${task.id}, '${escapeHtml(task.title)}')">
                –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É
            </button>`;
            break;
        case 'completed':
            buttonHtml = `<div class="task-status completed">‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>`;
            break;
        case 'rejected':
            buttonHtml = `<div class="task-status rejected">‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ</div>`;
            break;
    }
    
    taskElement.innerHTML = `
        ${imageHtml}
        
        <div class="task-header">
            <div class="task-title">${escapeHtml(task.title)}</div>
            <div class="task-price">${task.price} ‚≠ê</div>
        </div>
        
        <div class="task-meta">
            <div class="task-category">${formatCategory(task.category)}</div>
            ${task.difficulty ? `<div class="task-difficulty ${task.difficulty.toLowerCase()}">${task.difficulty}</div>` : ''}
        </div>
        
        <div class="task-description">
            ${escapeHtml(task.description.length > 100 ? task.description.substring(0, 100) + '...' : task.description)}
        </div>
        
        ${peopleRequired > 1 && category === 'new' ? `
            <div class="task-progress">
                <div class="task-progress-bar" style="width: ${Math.min(100, (completedCount / peopleRequired) * 100)}%"></div>
            </div>
            <div class="task-progress-text">
                –í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${completedCount}/${peopleRequired}
            </div>
        ` : ''}
        
        <div class="task-footer">
            <div class="task-time">
                ${category === 'confirmation' ? '–û–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è' : 
                  category === 'completed' ? '–í—ã–ø–æ–ª–Ω–µ–Ω–æ' :
                  category === 'rejected' ? '–û—Ç–∫–ª–æ–Ω–µ–Ω–æ' : 
                  task.time_to_complete || '5-10 –º–∏–Ω—É—Ç'}
            </div>
            ${buttonHtml}
        </div>
    `;
    
    if (category === 'new') {
        taskElement.addEventListener('click', function(e) {
            if (!e.target.classList.contains('task-btn')) {
                openTaskModal(task.id);
            }
        });
    }
       if (category === 'rejected') {
        taskElement.innerHTML = createRejectedTaskHTML(task);
    } else {
        // ... —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∫–æ–¥ –¥–ª—è –¥—Ä—É–≥–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π ...
    }
    
    return taskElement;
}
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    initImageUploadDragDrop();
});


// üîß –≠–ö–°–ü–û–†–¢ –ù–û–í–´–• –§–£–ù–ö–¶–ò–ô
window.addNewPostAsAdmin = addNewPostAsAdmin;
window.deletePostAsAdmin = deletePostAsAdmin;
window.addTaskAsAdmin = addTaskAsAdmin;
window.deleteTaskAsAdmin = deleteTaskAsAdmin;
window.loadTaskVerificationsForAdmin = loadTaskVerificationsForAdmin;
window.openAdminSupportChat = openAdminSupportChat;
window.approveVerification = approveVerification;
window.rejectVerification = rejectVerification;
window.closeModal = closeModal;
// üîß –≠–ö–°–ü–û–†–¢ –ù–û–í–´–• –§–£–ù–ö–¶–ò–ô
window.requestWithdraw = requestWithdraw;
window.loadWithdrawHistory = loadWithdrawHistory;
window.loadWithdrawalRequests = loadWithdrawalRequests;
window.completeWithdrawal = completeWithdrawal;
window.showAdminSection = showAdminSection;
// üîß –≠–ö–°–ü–û–†–¢ –ù–û–í–´–• –§–£–ù–ö–¶–ò–ô
window.fixTasksLayout = fixTasksLayout;
window.addTask = addTask;
window.showAdminSection = showAdminSection;
window.loadAdminTasks = loadAdminTasks;
// üîß –≠–ö–°–ü–û–†–¢ –§–£–ù–ö–¶–ò–ô
window.addTask = addTask;
// üîß –≠–ö–°–ü–û–†–¢ –§–£–ù–ö–¶–ò–ô –î–õ–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ê–î–ú–ò–ù–ê–ú–ò
window.showAdminAdminsSection = showAdminAdminsSection;
window.loadAdminsList = loadAdminsList;
window.addNewAdmin = addNewAdmin;
window.removeAdmin = removeAdmin;
window.updateAdminPermissions = updateAdminPermissions;
// –î–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞
window.loadWithdrawalRequests = loadWithdrawalRequests;
window.completeWithdrawal = completeWithdrawal;
window.showAdminPaymentsSection = showAdminPaymentsSection;

// üîß –≠–ö–°–ü–û–†–¢ –ù–û–í–´–• –§–£–ù–ö–¶–ò–ô
window.deleteVerification = deleteVerification;
</script>
</body>
</html>
